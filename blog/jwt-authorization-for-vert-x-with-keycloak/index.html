<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>JWT Authorization for Vert.x with Keycloak | 博客 | Eclipse Vert.x</title><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/styles.bee17d6f.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.bee17d6f.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5B%5B...slug%5D%5D-ff5b3ed8f1ab05c5e7a9.js" as="script"/></head><body data-build-time="2021-06-07T22:50:00.017Z" data-build-commit-id="632866e430a89541b30ffb5527995b681a3b459c" data-build-run-id="916512958"><div id="__next"><main class="page"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content"><div class="container"><div class="blog-post"><div class="blog-navbar"><h2>Blog</h2><ul><li><a href="/blog/">All posts</a></li><li><a href="/blog/category/releases/">releases</a></li><li><a href="/blog/category/guides/">guides</a></li><li><a href="/blog/category/news/">news</a></li></ul><div class="feed-icons"><a href="/feed/atom.xml"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div><div class="blog-post-main"><div class="blog-post-content"><h1>JWT Authorization for Vert.x with Keycloak</h1><span><p><strong>TL;DR:</strong></p><p>In this blog post you’ll learn:</p><ul><li>JWT foun­da­tions</li><li>How to pro­tect routes with a JWT Au­tho­riza­tion</li><li>How to ex­tract claims from a JWT en­coded token</li><li>How to apply RBAC with Key­cloak Realm roles</li></ul><h2 id="hello-again"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#hello-again"></a>Hello again</h2><p>Hi there! In my last blog post <a href="/blog/easy-sso-for-vert-x-with-keycloak/">Easy SSO for Vert.x with Key­cloak</a>, we learned how to con­fig­ure sin­gle sign-​on for a Vert.x web ap­pli­ca­tion with Key­cloak and OpenID con­nect. This time, we’ll see how we can pro­tect an ap­pli­ca­tion with Vert.x’s <a href="/docs/vertx-web/java/#_jwt_authorisation">JWT Au­tho­riza­tion</a> sup­port and Key­cloak.</p><h2 id="keycloak-setup"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#keycloak-setup"></a>Keycloak Setup</h2><p>To se­cure our Vert.x app, we need to use a Key­cloak server for ob­tain­ing JWT to­kens. Al­though <a href="https://www.keycloak.org/docs/latest/getting_started/">Key­cloak has a great get­ting started guide</a> I wanted to make it a bit eas­ier to put every­thing to­gether, there­fore I pre­pared a local Key­cloak docker con­tainer <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm">as de­scribed here</a>, which comes with all the re­quired con­fig­u­ra­tion in place, that you can start eas­ily.</p><p>The pre­con­fig­ured Key­cloak realm <code>vertx</code> con­tains a <code>vertx-service</code> OpenID con­nect client for our Vert.x app and a set
of users for test­ing. To ease test­ing, the <code>vertx-service</code> is con­fig­ured with <code>Direct Access Grant</code> en­abled in Key­cloak, which
en­ables sup­port for the OAuth2 re­source owner pass­word cre­den­tials grant (ROPC) flow.</p><p>To start Key­cloak with the pre­con­fig­ured realm, just start the docker con­tainer with the fol­low­ing com­mand:</p><pre><code class="hljs language-bash">docker run \
  -it \
  --name vertx-keycloak \
  --rm \
  -e KEYCLOAK_USER=admin \
  -e KEYCLOAK_PASSWORD=admin \
  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \
  -v <span class="hljs-variable">$PWD</span>/vertx-realm.json:/tmp/vertx-realm.json \
  -v <span class="hljs-variable">$PWD</span>/data:/opt/jboss/keycloak/standalone/data \
  -p 8080:8080 \
  quay.io/keycloak/keycloak:11.0.2
</code></pre><h2 id="vertx-app"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#vertx-app"></a>Vert.x App</h2><p>The ex­am­ple app con­sists of a sin­gle <code>Verticle</code>, that runs on <code>http://localhost:3000</code> and pro­vides a few routes with pro­tected re­sources. <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java">You can find the com­plete ex­am­ple here</a>.</p><p>Our web app con­tains the fol­low­ing pro­tected routes with han­dlers:</p><ul><li><code>/api/greet</code> - The greet­ing re­source, which re­turns a greet­ing mes­sage, only au­then­ti­cated users can ac­cess this re­source.</li><li><code>/api/user</code> - The user re­source, which re­turns some in­for­ma­tion about the user, only users with role <code>user</code> can ac­cess this re­source.</li><li><code>/api/admin</code> - The user re­source, which re­turns some in­for­ma­tion about the admin, only users with role <code>admin</code> can ac­cess this re­source.</li></ul><p>This ex­am­ple is built with Vert.x ver­sion 3.9.3.</p><h3 id="running-the-app-in-the-console"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#running-the-app-in-the-console"></a>Running the app in the console</h3><p>To run the app, we need to build it first:</p><pre><code class="hljs language-bash"><span class="hljs-built_in">cd</span> jwt-service-vertx
mvn clean package
</code></pre><p>This cre­ates a jar, which we can run:</p><pre><code class="hljs language-bash">java -jar target/*.jar
</code></pre><p>Note, that we need to start Key­cloak first, since our app fetches the con­fig­u­ra­tion from Key­cloak on startup.</p><h3 id="running-the-app-in-the-ide"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#running-the-app-in-the-ide"></a>Running the app in the IDE</h3><p>We can also run the app di­rectly from your favourite IDE like In­tel­liJ Idea or Eclipse.
To run the app from an IDE, we need to cre­ate a launch con­fig­u­ra­tion and use the main class <code>io.vertx.core.Launcher</code>. Then set the the pro­gram ar­gu­ments to
<code>run demo.MainVerticle</code> and use the class­path of the <code>jwt-service-vertx</code> mod­ule.
With that in place we should be able to run the app.</p><h2 id="jwt-authorization"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-authorization"></a>JWT Authorization</h2><h3 id="jwt-foundations"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-foundations"></a>JWT Foundations</h3><p><a href="https://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a> is an open stan­dard to se­curely ex­change in­for­ma­tion be­tween two par­ties in the form
of <a href="https://base64.guru/standards/base64url">Base64URL</a> en­coded JSON ob­jects.
A stan­dard JWT is just a string which com­prises three base64url en­coded parts header, pay­load and a sig­na­ture, which are sep­a­rated by a ”<code>.</code>” char­ac­ter.
There are other vari­ants of JWT that can have more parts.</p><p>An ex­am­ple JWT can look like this:</p><pre><code class="hljs language-text">eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg
</code></pre><p>The header and pay­load sec­tions con­tain in­for­ma­tion as a JSON ob­ject, whereas the sig­na­ture is just a plain string. JSON ob­jects con­tain key value pairs which are called <code>claims</code>.</p><p>The claims in­for­ma­tion can be ver­i­fied and trusted be­cause it is dig­i­tally signed with the pri­vate key from a pub­lic/pri­vate key-​pair.
The sig­na­ture can later be ver­i­fied with a cor­re­spond­ing pub­lic key. The iden­ti­fier of the pub­lic/pri­vate key-​pair used to sign a JWT can be
con­tained in a spe­cial claim called <code>kid</code> (key iden­ti­fier) in the header sec­tion of the JWT.</p><p>An ex­am­ple for a JWT header that ref­er­ences a pub­lic/pri­vate key-​pair looks like this:</p><pre><code class="hljs language-json">{
  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;RS256&quot;</span>,
  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>,
  <span class="hljs-attr">&quot;kid&quot;</span>: <span class="hljs-string">&quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs&quot;</span>
}
</code></pre><p>It is quite com­mon to use JWTs to con­vey in­for­ma­tion about au­then­ti­ca­tion (user iden­tity) and au­tho­riza­tion (scopes, user roles, per­mis­sions and other claims).
OpenID providers such as <a href="https://www.keycloak.org/">Key­cloak</a> sup­port is­su­ing OAuth2 ac­cess to­kens after au­then­ti­ca­tion for users to clients in the form of JWTs.
An ac­cess token can then be used to ac­cess other ser­vices or APIs on be­half of the user. The server pro­vid­ing those ser­vices or APIs is often called <code>resource server</code>.</p><p>An ex­am­ple JWT pay­load gen­er­ated by Key­cloak looks like this:</p><pre><code class="hljs language-json">{
  <span class="hljs-attr">&quot;exp&quot;</span>: <span class="hljs-number">1601318422</span>,
  <span class="hljs-attr">&quot;iat&quot;</span>: <span class="hljs-number">1601318122</span>,
  <span class="hljs-attr">&quot;jti&quot;</span>: <span class="hljs-string">&quot;7635f5a1-f1d7-457d-b869-ad492352f4d2&quot;</span>,
  <span class="hljs-attr">&quot;iss&quot;</span>: <span class="hljs-string">&quot;http://localhost:8080/auth/realms/vertx&quot;</span>,
  <span class="hljs-attr">&quot;aud&quot;</span>: <span class="hljs-string">&quot;account&quot;</span>,
  <span class="hljs-attr">&quot;sub&quot;</span>: <span class="hljs-string">&quot;27b3fac0-9aec-4421-81cf-d4b02428f901&quot;</span>,
  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;Bearer&quot;</span>,
  <span class="hljs-attr">&quot;azp&quot;</span>: <span class="hljs-string">&quot;vertx-service&quot;</span>,
  <span class="hljs-attr">&quot;session_state&quot;</span>: <span class="hljs-string">&quot;68708213-40b7-458a-aee1-39d6f9da07ad&quot;</span>,
  <span class="hljs-attr">&quot;acr&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
  <span class="hljs-attr">&quot;realm_access&quot;</span>: {
    <span class="hljs-attr">&quot;roles&quot;</span>: [
      <span class="hljs-string">&quot;offline_access&quot;</span>,
      <span class="hljs-string">&quot;uma_authorization&quot;</span>,
      <span class="hljs-string">&quot;user&quot;</span>
    ]
  },
  <span class="hljs-attr">&quot;scope&quot;</span>: <span class="hljs-string">&quot;email profile&quot;</span>,
  <span class="hljs-attr">&quot;email_verified&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Theo Tester&quot;</span>,
  <span class="hljs-attr">&quot;preferred_username&quot;</span>: <span class="hljs-string">&quot;tester&quot;</span>,
  <span class="hljs-attr">&quot;given_name&quot;</span>: <span class="hljs-string">&quot;Theo&quot;</span>,
  <span class="hljs-attr">&quot;family_name&quot;</span>: <span class="hljs-string">&quot;Tester&quot;</span>,
  <span class="hljs-attr">&quot;email&quot;</span>: <span class="hljs-string">&quot;tom+tester@localhost&quot;</span>
}
</code></pre><p>If a <code>resource server</code> re­ceives a re­quest with such an ac­cess token, it needs to ver­ify and in­spect the token be­fore it can trust its con­tent.
To ver­ify the token, the <code>resource server</code> needs to ob­tain the <code>public key</code> to check the token sig­na­ture.
This <code>public key</code> can ei­ther be con­fig­ured sta­t­i­cally or fetched dy­nam­i­cally from the OpenID Provider by lever­ag­ing the <code>kid</code> in­for­ma­tion from the JWT header sec­tion.
Note that most <code>OpenID providers</code>, such as Key­cloak, pro­vide a ded­i­cated end­point for dy­namic pub­lic key lookups, e.g. <code>http://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs</code>.
A stan­dard for pro­vid­ing pub­lic key in­for­ma­tion is <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key Set (JWKS)</a>.
The JWKS in­for­ma­tion is usu­ally cached by the re­source server to avoid the over­head of fetch­ing JWKS for every re­quest.</p><p>An ex­am­ple re­sponse for Key­cloak’s JWKS end­point looks like this:</p><pre><code class="hljs language-json">{
   <span class="hljs-attr">&quot;keys&quot;</span>:[
      {
         <span class="hljs-attr">&quot;kid&quot;</span>:<span class="hljs-string">&quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs&quot;</span>,
         <span class="hljs-attr">&quot;kty&quot;</span>:<span class="hljs-string">&quot;RSA&quot;</span>,
         <span class="hljs-attr">&quot;alg&quot;</span>:<span class="hljs-string">&quot;RS256&quot;</span>,
         <span class="hljs-attr">&quot;use&quot;</span>:<span class="hljs-string">&quot;sig&quot;</span>,
         <span class="hljs-attr">&quot;n&quot;</span>:<span class="hljs-string">&quot;iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw&quot;</span>,
         <span class="hljs-attr">&quot;e&quot;</span>:<span class="hljs-string">&quot;AQAB&quot;</span>,
         <span class="hljs-attr">&quot;x5c&quot;</span>:[
            <span class="hljs-string">&quot;MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb&quot;</span>
         ],
         <span class="hljs-attr">&quot;x5t&quot;</span>:<span class="hljs-string">&quot;MVYTXCx5cUQ8lT1ymIDDRYO7_ZI&quot;</span>,
         <span class="hljs-attr">&quot;x5t#S256&quot;</span>:<span class="hljs-string">&quot;yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY&quot;</span>
      }
   ]
}
</code></pre><p>The <code>keys</code> array con­tains the JWKS struc­ture with the pub­lic key in­for­ma­tion that be­longs to the pub­lic/pri­vate key-​pair which was used
to sign the JWT ac­cess token from above. Note the match­ing <code>kid</code> claim from our ear­lier JWT header ex­am­ple.</p><p>Now that we have the ap­pro­pri­ate pub­lic key, we can use the in­for­ma­tion from the JWT header to val­i­date the sig­na­ture of the JWT ac­cess token.
If the sig­na­ture is valid, we can go on and check ad­di­tional claims from the pay­load sec­tion of the JWT, such as ex­pi­ra­tion, al­lowed is­suer and au­di­ence etc. </p><p>Now that we have the nec­es­sary build­ing blocks in place, we can fi­nally look at how to con­fig­ure JWT au­tho­riza­tion in Vert.x.</p><h3 id="jwt-authorization-in-vertx"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-authorization-in-vertx"></a>JWT Authorization in Vert.x</h3><p>Set­ting up JWT au­tho­riza­tion in Vert.x is quite easy. First we need to add the <code>vertx-auth-jwt</code> mod­ule as a de­pen­dency to our project.</p><pre><code class="hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-auth-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre><p>In our ex­am­ple, the whole JWT au­tho­riza­tion setup hap­pens in the method <code>setupJwtAuth</code>.</p><p>We use a <code>WebClient</code> to dy­nam­i­cally fetch the pub­lic key in­for­ma­tion from the <code>/protocol/openid-connect/certs</code> JWKS end­point rel­a­tive to our Key­cloak is­suer URL.
After that, we con­fig­ure a <code>JWTAuth</code> in­stance and cus­tomize the JWT val­i­da­tion via <code>JWTOptions</code> and <code>JWTAuthOptions</code>.
Note that we use Key­cloak’s realm roles for role based au­tho­riza­tion via the <code>JWTAuthOptions#setPermissionsClaimKey(..)</code> method.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupJwtAuth</span><span class="hljs-params">(Startup startup)</span> </span>{

    <span class="hljs-keyword">var</span> jwtConfig = startup.config.getJsonObject(<span class="hljs-string">&quot;jwt&quot;</span>);
    <span class="hljs-keyword">var</span> issuer = jwtConfig.getString(<span class="hljs-string">&quot;issuer&quot;</span>);
    <span class="hljs-keyword">var</span> issuerUri = URI.create(issuer);

    <span class="hljs-comment">// derive JWKS uri from Keycloak issuer URI</span>
    <span class="hljs-keyword">var</span> jwksUri = URI.create(jwtConfig.getString(<span class="hljs-string">&quot;jwksUri&quot;</span>, String.format(<span class="hljs-string">&quot;%s://%s:%d%s&quot;</span>,
            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + <span class="hljs-string">&quot;/protocol/openid-connect/certs&quot;</span>)));

    <span class="hljs-keyword">var</span> promise = Promise.&lt;JWTAuth&gt;promise();

    <span class="hljs-comment">// fetch JWKS from `/certs` endpoint</span>
    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())
            .as(BodyCodec.jsonObject())
            .send(ar -&gt; {

                <span class="hljs-keyword">if</span> (!ar.succeeded()) {
                    startup.bootstrap.fail(String.format(<span class="hljs-string">&quot;Could not fetch JWKS from URI: %s&quot;</span>, jwksUri));
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">var</span> response = ar.result();

                <span class="hljs-keyword">var</span> jwksResponse = response.body();
                <span class="hljs-keyword">var</span> keys = jwksResponse.getJsonArray(<span class="hljs-string">&quot;keys&quot;</span>);

                <span class="hljs-comment">// Configure JWT validation options</span>
                <span class="hljs-keyword">var</span> jwtOptions = <span class="hljs-keyword">new</span> JWTOptions();
                jwtOptions.setIssuer(issuer);

                <span class="hljs-comment">// extract JWKS from keys array</span>
                <span class="hljs-keyword">var</span> jwks = ((List&lt;Object&gt;) keys.getList()).stream()
                        .map(o -&gt; <span class="hljs-keyword">new</span> JsonObject((Map&lt;String, Object&gt;) o))
                        .collect(Collectors.toList());

                <span class="hljs-comment">// configure JWTAuth</span>
                <span class="hljs-keyword">var</span> jwtAuthOptions = <span class="hljs-keyword">new</span> JWTAuthOptions();
                jwtAuthOptions.setJwks(jwks);
                jwtAuthOptions.setJWTOptions(jwtOptions);
                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(<span class="hljs-string">&quot;permissionClaimsKey&quot;</span>, <span class="hljs-string">&quot;realm_access/roles&quot;</span>));

                JWTAuth jwtAuth = JWTAuth.create(vertx, jwtAuthOptions);
                promise.complete(jwtAuth);
            });

    <span class="hljs-keyword">return</span> promise.future().compose(auth -&gt; {
        jwtAuth = auth;
        <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
    });
}
</code></pre><h3 id="protecting-routes-with-jwtauthhandler"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#protecting-routes-with-jwtauthhandler"></a>Protecting routes with JWTAuthHandler</h3><p>Now that our <code>JWTAuth</code> is con­fig­ured, we can use the <code>JWTAuthHandler</code> in the <code>setupRouter</code> method to apply
JWT au­tho­riza­tion to all routes match­ing the path pat­tern <code>/api/*</code>. The <code>JWTAuthHandler</code> val­i­dates re­ceived JWTs and per­forms
ad­di­tional checks like ex­pi­ra­tion and al­lowed is­suers. With that in place, we con­fig­ure our ac­tual routes in <code>setupRoutes</code>.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupRouter</span><span class="hljs-params">(Startup startup)</span> </span>{

    router = Router.router(vertx);

    router.route(<span class="hljs-string">&quot;/api/*&quot;</span>).handler(JWTAuthHandler.create(jwtAuth));

    <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupRoutes</span><span class="hljs-params">(Startup startup)</span> </span>{

    router.get(<span class="hljs-string">&quot;/api/greet&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleGreet);
    router.get(<span class="hljs-string">&quot;/api/user&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleUserData);
    router.get(<span class="hljs-string">&quot;/api/admin&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleAdminData);

    <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
}
</code></pre><h3 id="extracting-user-information-from-jwtuser"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#extracting-user-information-from-jwtuser"></a>Extracting user information from JWTUser</h3><p>To ac­cess user in­for­ma­tion in our <code>handleGreet</code> method, we cast the re­sult of the <code>io.vertx.ext.web.RoutingContext#user</code> method to <code>JWTUser</code>
which al­lows us to ac­cess token claim in­for­ma­tion via the <code>io.vertx.ext.auth.jwt.impl.JWTUser#principal</code> JSON ob­ject.</p><p>If we’d like to use the JWT ac­cess token for other ser­vice calls, we could ex­tract the token from the <code>Authorization</code> header.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleGreet</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    <span class="hljs-keyword">var</span> accessToken = ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(<span class="hljs-string">&quot;Bearer &quot;</span>.length());
    <span class="hljs-comment">// Use accessToken for down-stream calls if needed...</span>

    ctx.request().response().end(String.format(<span class="hljs-string">&quot;Hi %s (%s) %s%n&quot;</span>, username, userId, Instant.now()));
}
</code></pre><h3 id="obtaining-an-access-token-from-keycloak-for-user-tester"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#obtaining-an-access-token-from-keycloak-for-user-tester"></a>Obtaining an Access Token from Keycloak for user <code>tester</code></h3><p>To test our ap­pli­ca­tion we can use the fol­low­ing <code>curl</code> com­mands in a bash like shell to ob­tain an JWT ac­cess token to call one
of our end­points as the user <code>tester</code> with the role <code>user</code>.</p><p>Note that this ex­am­ple uses the cli tool <a href="https://stedolan.github.io/jq/">jq</a> for JSON pro­cess­ing.</p><pre><code class="hljs language-bash">KC_USERNAME=tester
KC_PASSWORD=<span class="hljs-built_in">test</span>
KC_CLIENT=vertx-service
KC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c
KC_REALM=vertx
KC_URL=http://localhost:8080/auth
KC_RESPONSE=$(curl  -k \
        -d <span class="hljs-string">&quot;username=<span class="hljs-variable">$KC_USERNAME</span>&quot;</span> \
        -d <span class="hljs-string">&quot;password=<span class="hljs-variable">$KC_PASSWORD</span>&quot;</span> \
        -d <span class="hljs-string">&#x27;grant_type=password&#x27;</span> \
        -d <span class="hljs-string">&quot;client_id=<span class="hljs-variable">$KC_CLIENT</span>&quot;</span> \
        -d <span class="hljs-string">&quot;client_secret=<span class="hljs-variable">$KC_CLIENT_SECRET</span>&quot;</span> \
        <span class="hljs-string">&quot;<span class="hljs-variable">$KC_URL</span>/realms/<span class="hljs-variable">$KC_REALM</span>/protocol/openid-connect/token&quot;</span> \
    | jq .)

KC_ACCESS_TOKEN=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_RESPONSE</span>| jq -r .access_token)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_ACCESS_TOKEN</span>
</code></pre><p>Here we use the JWT ac­cess token in the <code>Authorization</code> header with the <code>Bearer</code> pre­fix to call our <code>greet</code> route:</p><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/greet
</code></pre><p>Ex­am­ple out­put:</p><pre><code class="hljs language-bash">Hi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z
</code></pre><h3 id="applying-role-based-access-control-with-jwtuser"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#applying-role-based-access-control-with-jwtuser"></a>Applying Role-based Access-Control with JWTUser</h3><p>To lever­age sup­port for role based ac­cess con­trol (RBAC) we can use the <code>io.vertx.ext.auth.User#isAuthorised</code> method
to check whether the cur­rent user has the re­quired role. If the role is present we re­turn some data about the user, oth­er­wise
we send a re­sponse with sta­tus code 403 and a <code>forbidden</code> error mes­sage.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleUserData</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    jwtUser.isAuthorized(<span class="hljs-string">&quot;user&quot;</span>, res -&gt; {

        <span class="hljs-keyword">if</span> (!res.succeeded() || !res.result()) {
            toJsonResponse(ctx).setStatusCode(<span class="hljs-number">403</span>).end(<span class="hljs-string">&quot;{\&quot;error\&quot;: \&quot;forbidden\&quot;}&quot;</span>);
            <span class="hljs-keyword">return</span>;
        }

        JsonObject data = <span class="hljs-keyword">new</span> JsonObject()
                .put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>)
                .put(<span class="hljs-string">&quot;username&quot;</span>, username)
                .put(<span class="hljs-string">&quot;userId&quot;</span>, userId)
                .put(<span class="hljs-string">&quot;timestamp&quot;</span>, Instant.now());

        toJsonResponse(ctx).end(data.toString());
    });
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleAdminData</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    jwtUser.isAuthorized(<span class="hljs-string">&quot;admin&quot;</span>, res -&gt; {

        <span class="hljs-keyword">if</span> (!res.succeeded() || !res.result()) {
            toJsonResponse(ctx).setStatusCode(<span class="hljs-number">403</span>).end(<span class="hljs-string">&quot;{\&quot;error\&quot;: \&quot;forbidden\&quot;}&quot;</span>);
            <span class="hljs-keyword">return</span>;
        }

        JsonObject data = <span class="hljs-keyword">new</span> JsonObject()
                .put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>)
                .put(<span class="hljs-string">&quot;username&quot;</span>, username)
                .put(<span class="hljs-string">&quot;userId&quot;</span>, userId)
                .put(<span class="hljs-string">&quot;timestamp&quot;</span>, Instant.now());

        toJsonResponse(ctx).end(data.toString());
    });
}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/user
</code></pre><p>Out­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;tester&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;27b3fac0-9aec-4421-81cf-d4b02428f901&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:07:49.340950300Z&quot;</span>}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/admin
</code></pre><p>Out­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-string">&quot;forbidden&quot;</span>}
</code></pre><h3 id="obtaining-an-access-token-from-keycloak-for-user-vadmin"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#obtaining-an-access-token-from-keycloak-for-user-vadmin"></a>Obtaining an Access Token from Keycloak for user <code>vadmin</code></h3><p>To check ac­cess with an <code>admin</code> role, we ob­tain a new token for the user <code>vadmin</code> which has the roles <code>admin</code> and <code>user</code>. </p><pre><code class="hljs language-bash">KC_USERNAME=vadmin
KC_PASSWORD=<span class="hljs-built_in">test</span>
KC_CLIENT=vertx-service
KC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c
KC_REALM=vertx
KC_URL=http://localhost:8080/auth
KC_RESPONSE=$(curl  -k \
        -d <span class="hljs-string">&quot;username=<span class="hljs-variable">$KC_USERNAME</span>&quot;</span> \
        -d <span class="hljs-string">&quot;password=<span class="hljs-variable">$KC_PASSWORD</span>&quot;</span> \
        -d <span class="hljs-string">&#x27;grant_type=password&#x27;</span> \
        -d <span class="hljs-string">&quot;client_id=<span class="hljs-variable">$KC_CLIENT</span>&quot;</span> \
        -d <span class="hljs-string">&quot;client_secret=<span class="hljs-variable">$KC_CLIENT_SECRET</span>&quot;</span> \
        <span class="hljs-string">&quot;<span class="hljs-variable">$KC_URL</span>/realms/<span class="hljs-variable">$KC_REALM</span>/protocol/openid-connect/token&quot;</span> \
    | jq .)

KC_ACCESS_TOKEN=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_RESPONSE</span>| jq -r .access_token)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_ACCESS_TOKEN</span>
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/user
</code></pre><p>Out­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;vadmin&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;75090eac-36ff-4cd8-847d-fc2941bc024e&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:13:05.099393900Z&quot;</span>}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/admin
</code></pre><p>Out­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;vadmin&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;75090eac-36ff-4cd8-847d-fc2941bc024e&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:13:34.945276500Z&quot;</span>}
</code></pre><h3 id="conclusion"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#conclusion"></a>Conclusion</h3><p>We learned how to con­fig­ure a Vert.x ap­pli­ca­tion with JWT au­tho­riza­tion pow­ered by Key­cloak. Al­though the con­fig­u­ra­tion is quite com­plete
al­ready, there are still some parts that can be im­proved, like the dy­namic JWKS fetch­ing on public-​key pair ro­ta­tion as well as ex­trac­tion of nested roles.</p><p>Nev­er­the­less this is a good start­ing point for se­cur­ing your own Vert.x ser­vices with JWT and Key­cloak.</p><p>You can check out the <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx">com­plete ex­am­ple in keycloak-​vertx Ex­am­ples Repo</a>.</p><p>Thank you for your time, stay tuned for more up­dates! If you want to learn more about Key­cloak, feel free to reach out to me. You can find me via <a href="https://twitter.com/thomasdarimont">thomas­da­ri­mont on twit­ter</a>.</p><p>Happy Hack­ing!</p></span></div><div class="blog-post-sidebar"><div class="blog-post-author"><img class="blog-post-author-avatar" src="https://github.com/thomasdarimont.png?size=160"/><div class="blog-post-author-name">by <a href="https://github.com/thomasdarimont" target="_blank" rel="noopener noreferrer">Thomas Darimont</a></div></div><div class="blog-post-sidebar-date">Posted on <!-- -->1 October 2020</div>in <a class="blog-post-sidebar-category" href="/blog/category/guides/">guides</a><div class="blog-post-sidebar-reading-time"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <!-- -->11 min read</div><div class="blog-post-sidebar-share-icons"><a href="https://twitter.com/intent/tweet?text=JWT%20Authorization%20for%20Vert.x%20with%20Keycloak&amp;url=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak&amp;via=vertx_project" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>Twitter</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>Facebook</title><path d="M23.9981 11.9991C23.9981 5.37216 18.626 0 11.9991 0C5.37216 0 0 5.37216 0 11.9991C0 17.9882 4.38789 22.9522 10.1242 23.8524V15.4676H7.07758V11.9991H10.1242V9.35553C10.1242 6.34826 11.9156 4.68714 14.6564 4.68714C15.9692 4.68714 17.3424 4.92149 17.3424 4.92149V7.87439H15.8294C14.3388 7.87439 13.8739 8.79933 13.8739 9.74824V11.9991H17.2018L16.6698 15.4676H13.8739V23.8524C19.6103 22.9522 23.9981 17.9882 23.9981 11.9991Z"></path></svg></a></div></div></div><div class="blog-post-next-prev"><div class="blog-post-next-prev-entry"><h5>Next post</h5><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">15 October 2020</span>​<a class="blog-entry-category" href="/blog/category/releases/">releases</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/eclipse-vert-x-3-9-4-released/">Eclipse Vert.x 3.9.4 released!</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/vietj.png?size=50"/><a href="https://github.com/vietj" target="_blank" rel="noopener noreferrer">Julien Viet</a></li></ul></span><p class="blog-entry-summary">Eclipse Vert.x version 3.9.4 has just been released. It fixes quite a few bugs that have been reported by the community.</p><span class="read-more-link"><a href="/blog/eclipse-vert-x-3-9-4-released/"> 阅读更多</a></span></div></div><div class="blog-post-next-prev-entry"><h5>Previous post</h5><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">25 September 2020</span>​<a class="blog-entry-category" href="/blog/category/releases/">releases</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/eclipse-vert-x-4-beta-3-released/">Eclipse Vert.x 4 beta 3 released!</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/vietj.png?size=50"/><a href="https://github.com/vietj" target="_blank" rel="noopener noreferrer">Julien Viet</a></li></ul></span><p class="blog-entry-summary">The third beta version of Eclipse Vert.x 4.0 highlights many features including (but not limited to) HTTP client request creation, HTTP tunnel improvements, and WebSocket upgrade improvements.</p><span class="read-more-link"><a href="/blog/eclipse-vert-x-4-beta-3-released/"> 阅读更多</a></span></div></div></div><div class="blog-post-related"><h5>Related posts</h5><div class="blog-post-related-posts"><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">16 March 2020</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/easy-sso-for-vert-x-with-keycloak/">Easy SSO for Vert.x with Keycloak</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/thomasdarimont.png?size=50"/><a href="https://github.com/thomasdarimont" target="_blank" rel="noopener noreferrer">Thomas Darimont</a></li></ul></span><p class="blog-entry-summary">In this blog post, you&#x27;ll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x.</p><span class="read-more-link"><a href="/blog/easy-sso-for-vert-x-with-keycloak/"> 阅读更多</a></span></div><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">23 January 2021</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/eclipse-vert-x-CSRF-concerns/">Things to keep in mind concerning CSRF attacks</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/xhlika.png?size=50"/><a href="https://github.com/xhlika" target="_blank" rel="noopener noreferrer">Xhelal Likaj</a></li></ul></span><p class="blog-entry-summary">Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses.</p><span class="read-more-link"><a href="/blog/eclipse-vert-x-CSRF-concerns/"> 阅读更多</a></span></div><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">3 August 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/unit-and-integration-tests/">Unit and Integration Tests</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/cescoffier.png?size=50"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="blog-entry-summary">Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API.</p><span class="read-more-link"><a href="/blog/unit-and-integration-tests/"> 阅读更多</a></span></div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">联系渠道</a></li><li><a href="https://how-to.vertx.io/">操作指南</a></li><li><a href="https://start.vertx.io/">应用生成器</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse 基金会</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">隐私政策</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">使用条款</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">版权代理</a></li><li><a href="https://www.eclipse.org/legal/">法律资源</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x™<br/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>协议下获得了双重许可。<br class="footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a> 设计。</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"JWT Authorization for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn about JWT foundations, protect routes with JWT Authorization, JWT encoded tokens, and RBAC with Keycloak"},"date":"2020-10-01","slug":"jwt-authorization-for-vert-x-with-keycloak","readingTime":{"text":"11 min read","minutes":10.075,"time":604500,"words":2015},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TL;DR:\")), mdx(\"p\", null, \"In this blog post you\\u2019ll learn:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"JWT foun\\xADda\\xADtions\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"How to pro\\xADtect routes with a JWT Au\\xADtho\\xADriza\\xADtion\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"How to ex\\xADtract claims from a JWT en\\xADcoded token\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"How to apply RBAC with Key\\xADcloak Realm roles\")), mdx(\"h2\", {\n    \"id\": \"hello-again\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#hello-again\"\n  })), \"Hello again\"), mdx(\"p\", null, \"Hi there! In my last blog post \", mdx(Link, {\n    href: \"/blog/easy-sso-for-vert-x-with-keycloak/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"Easy SSO for Vert.x with Key\\xADcloak\")), \", we learned how to con\\xADfig\\xADure sin\\xADgle sign-\\u200Bon for a Vert.x web ap\\xADpli\\xADca\\xADtion with Key\\xADcloak and OpenID con\\xADnect. This time, we\\u2019ll see how we can pro\\xADtect an ap\\xADpli\\xADca\\xADtion with Vert.x\\u2019s \", mdx(Link, {\n    href: \"/docs/vertx-web/java/#_jwt_authorisation\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"JWT Au\\xADtho\\xADriza\\xADtion\")), \" sup\\xADport and Key\\xADcloak.\"), mdx(\"h2\", {\n    \"id\": \"keycloak-setup\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#keycloak-setup\"\n  })), \"Keycloak Setup\"), mdx(\"p\", null, \"To se\\xADcure our Vert.x app, we need to use a Key\\xADcloak server for ob\\xADtain\\xADing JWT to\\xADkens. Al\\xADthough \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.keycloak.org/docs/latest/getting_started/\"\n  }), \"Key\\xADcloak has a great get\\xADting started guide\"), \" I wanted to make it a bit eas\\xADier to put every\\xADthing to\\xADgether, there\\xADfore I pre\\xADpared a local Key\\xADcloak docker con\\xADtainer \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm\"\n  }), \"as de\\xADscribed here\"), \", which comes with all the re\\xADquired con\\xADfig\\xADu\\xADra\\xADtion in place, that you can start eas\\xADily.\"), mdx(\"p\", null, \"The pre\\xADcon\\xADfig\\xADured Key\\xADcloak realm \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx\"), \" con\\xADtains a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-service\"), \" OpenID con\\xADnect client for our Vert.x app and a set\\nof users for test\\xADing. To ease test\\xADing, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-service\"), \" is con\\xADfig\\xADured with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Direct Access Grant\"), \" en\\xADabled in Key\\xADcloak, which\\nen\\xADables sup\\xADport for the OAuth2 re\\xADsource owner pass\\xADword cre\\xADden\\xADtials grant (ROPC) flow.\"), mdx(\"p\", null, \"To start Key\\xADcloak with the pre\\xADcon\\xADfig\\xADured realm, just start the docker con\\xADtainer with the fol\\xADlow\\xADing com\\xADmand:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"docker run \\\\\\n  -it \\\\\\n  --name vertx-keycloak \\\\\\n  --rm \\\\\\n  -e KEYCLOAK_USER=admin \\\\\\n  -e KEYCLOAK_PASSWORD=admin \\\\\\n  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \\\\\\n  -v \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$PWD\"), \"/vertx-realm.json:/tmp/vertx-realm.json \\\\\\n  -v \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$PWD\"), \"/data:/opt/jboss/keycloak/standalone/data \\\\\\n  -p 8080:8080 \\\\\\n  quay.io/keycloak/keycloak:11.0.2\\n\")), mdx(\"h2\", {\n    \"id\": \"vertx-app\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#vertx-app\"\n  })), \"Vert.x App\"), mdx(\"p\", null, \"The ex\\xADam\\xADple app con\\xADsists of a sin\\xADgle \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Verticle\"), \", that runs on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:3000\"), \" and pro\\xADvides a few routes with pro\\xADtected re\\xADsources. \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java\"\n  }), \"You can find the com\\xADplete ex\\xADam\\xADple here\"), \".\"), mdx(\"p\", null, \"Our web app con\\xADtains the fol\\xADlow\\xADing pro\\xADtected routes with han\\xADdlers:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/api/greet\"), \" - The greet\\xADing re\\xADsource, which re\\xADturns a greet\\xADing mes\\xADsage, only au\\xADthen\\xADti\\xADcated users can ac\\xADcess this re\\xADsource.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/api/user\"), \" - The user re\\xADsource, which re\\xADturns some in\\xADfor\\xADma\\xADtion about the user, only users with role \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"user\"), \" can ac\\xADcess this re\\xADsource.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/api/admin\"), \" - The user re\\xADsource, which re\\xADturns some in\\xADfor\\xADma\\xADtion about the admin, only users with role \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"admin\"), \" can ac\\xADcess this re\\xADsource.\")), mdx(\"p\", null, \"This ex\\xADam\\xADple is built with Vert.x ver\\xADsion 3.9.3.\"), mdx(\"h3\", {\n    \"id\": \"running-the-app-in-the-console\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#running-the-app-in-the-console\"\n  })), \"Running the app in the console\"), mdx(\"p\", null, \"To run the app, we need to build it first:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" jwt-service-vertx\\nmvn clean package\\n\")), mdx(\"p\", null, \"This cre\\xADates a jar, which we can run:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"java -jar target/*.jar\\n\")), mdx(\"p\", null, \"Note, that we need to start Key\\xADcloak first, since our app fetches the con\\xADfig\\xADu\\xADra\\xADtion from Key\\xADcloak on startup.\"), mdx(\"h3\", {\n    \"id\": \"running-the-app-in-the-ide\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#running-the-app-in-the-ide\"\n  })), \"Running the app in the IDE\"), mdx(\"p\", null, \"We can also run the app di\\xADrectly from your favourite IDE like In\\xADtel\\xADliJ Idea or Eclipse.\\nTo run the app from an IDE, we need to cre\\xADate a launch con\\xADfig\\xADu\\xADra\\xADtion and use the main class \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"io.vertx.core.Launcher\"), \". Then set the the pro\\xADgram ar\\xADgu\\xADments to\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"run demo.MainVerticle\"), \" and use the class\\xADpath of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jwt-service-vertx\"), \" mod\\xADule.\\nWith that in place we should be able to run the app.\"), mdx(\"h2\", {\n    \"id\": \"jwt-authorization\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#jwt-authorization\"\n  })), \"JWT Authorization\"), mdx(\"h3\", {\n    \"id\": \"jwt-foundations\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#jwt-foundations\"\n  })), \"JWT Foundations\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://tools.ietf.org/html/rfc7519\"\n  }), \"JSON Web Token (JWT)\"), \" is an open stan\\xADdard to se\\xADcurely ex\\xADchange in\\xADfor\\xADma\\xADtion be\\xADtween two par\\xADties in the form\\nof \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://base64.guru/standards/base64url\"\n  }), \"Base64URL\"), \" en\\xADcoded JSON ob\\xADjects.\\nA stan\\xADdard JWT is just a string which com\\xADprises three base64url en\\xADcoded parts header, pay\\xADload and a sig\\xADna\\xADture, which are sep\\xADa\\xADrated by a \\u201D\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".\"), \"\\u201D char\\xADac\\xADter.\\nThere are other vari\\xADants of JWT that can have more parts.\"), mdx(\"p\", null, \"An ex\\xADam\\xADple JWT can look like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg\\n\")), mdx(\"p\", null, \"The header and pay\\xADload sec\\xADtions con\\xADtain in\\xADfor\\xADma\\xADtion as a JSON ob\\xADject, whereas the sig\\xADna\\xADture is just a plain string. JSON ob\\xADjects con\\xADtain key value pairs which are called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"claims\"), \".\"), mdx(\"p\", null, \"The claims in\\xADfor\\xADma\\xADtion can be ver\\xADi\\xADfied and trusted be\\xADcause it is dig\\xADi\\xADtally signed with the pri\\xADvate key from a pub\\xADlic/pri\\xADvate key-\\u200Bpair.\\nThe sig\\xADna\\xADture can later be ver\\xADi\\xADfied with a cor\\xADre\\xADspond\\xADing pub\\xADlic key. The iden\\xADti\\xADfier of the pub\\xADlic/pri\\xADvate key-\\u200Bpair used to sign a JWT can be\\ncon\\xADtained in a spe\\xADcial claim called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"kid\"), \" (key iden\\xADti\\xADfier) in the header sec\\xADtion of the JWT.\"), mdx(\"p\", null, \"An ex\\xADam\\xADple for a JWT header that ref\\xADer\\xADences a pub\\xADlic/pri\\xADvate key-\\u200Bpair looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"alg\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"RS256\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"typ\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"JWT\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"kid\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\\\"\"), \"\\n}\\n\")), mdx(\"p\", null, \"It is quite com\\xADmon to use JWTs to con\\xADvey in\\xADfor\\xADma\\xADtion about au\\xADthen\\xADti\\xADca\\xADtion (user iden\\xADtity) and au\\xADtho\\xADriza\\xADtion (scopes, user roles, per\\xADmis\\xADsions and other claims).\\nOpenID providers such as \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.keycloak.org/\"\n  }), \"Key\\xADcloak\"), \" sup\\xADport is\\xADsu\\xADing OAuth2 ac\\xADcess to\\xADkens after au\\xADthen\\xADti\\xADca\\xADtion for users to clients in the form of JWTs.\\nAn ac\\xADcess token can then be used to ac\\xADcess other ser\\xADvices or APIs on be\\xADhalf of the user. The server pro\\xADvid\\xADing those ser\\xADvices or APIs is often called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"resource server\"), \".\"), mdx(\"p\", null, \"An ex\\xADam\\xADple JWT pay\\xADload gen\\xADer\\xADated by Key\\xADcloak looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"exp\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1601318422\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"iat\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1601318122\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"jti\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"7635f5a1-f1d7-457d-b869-ad492352f4d2\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"iss\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"http://localhost:8080/auth/realms/vertx\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"aud\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"account\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"sub\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"27b3fac0-9aec-4421-81cf-d4b02428f901\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"typ\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Bearer\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"azp\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx-service\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"session_state\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"68708213-40b7-458a-aee1-39d6f9da07ad\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"acr\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"1\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"realm_access\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"roles\\\"\"), \": [\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"offline_access\\\"\"), \",\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"uma_authorization\\\"\"), \",\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user\\\"\"), \"\\n    ]\\n  },\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"scope\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"email profile\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"email_verified\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"name\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Theo Tester\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"preferred_username\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"tester\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"given_name\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Theo\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"family_name\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Tester\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"email\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"tom+tester@localhost\\\"\"), \"\\n}\\n\")), mdx(\"p\", null, \"If a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"resource server\"), \" re\\xADceives a re\\xADquest with such an ac\\xADcess token, it needs to ver\\xADify and in\\xADspect the token be\\xADfore it can trust its con\\xADtent.\\nTo ver\\xADify the token, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"resource server\"), \" needs to ob\\xADtain the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public key\"), \" to check the token sig\\xADna\\xADture.\\nThis \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public key\"), \" can ei\\xADther be con\\xADfig\\xADured sta\\xADt\\xADi\\xADcally or fetched dy\\xADnam\\xADi\\xADcally from the OpenID Provider by lever\\xADag\\xADing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"kid\"), \" in\\xADfor\\xADma\\xADtion from the JWT header sec\\xADtion.\\nNote that most \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"OpenID providers\"), \", such as Key\\xADcloak, pro\\xADvide a ded\\xADi\\xADcated end\\xADpoint for dy\\xADnamic pub\\xADlic key lookups, e.g. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs\"), \".\\nA stan\\xADdard for pro\\xADvid\\xADing pub\\xADlic key in\\xADfor\\xADma\\xADtion is \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://tools.ietf.org/html/rfc7517\"\n  }), \"JSON Web Key Set (JWKS)\"), \".\\nThe JWKS in\\xADfor\\xADma\\xADtion is usu\\xADally cached by the re\\xADsource server to avoid the over\\xADhead of fetch\\xADing JWKS for every re\\xADquest.\"), mdx(\"p\", null, \"An ex\\xADam\\xADple re\\xADsponse for Key\\xADcloak\\u2019s JWKS end\\xADpoint looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"keys\\\"\"), \":[\\n      {\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"kid\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"kty\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"RSA\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"alg\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"RS256\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"use\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"sig\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"n\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"e\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"AQAB\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"x5c\\\"\"), \":[\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb\\\"\"), \"\\n         ],\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"x5t\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"MVYTXCx5cUQ8lT1ymIDDRYO7_ZI\\\"\"), \",\\n         \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"x5t#S256\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY\\\"\"), \"\\n      }\\n   ]\\n}\\n\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"keys\"), \" array con\\xADtains the JWKS struc\\xADture with the pub\\xADlic key in\\xADfor\\xADma\\xADtion that be\\xADlongs to the pub\\xADlic/pri\\xADvate key-\\u200Bpair which was used\\nto sign the JWT ac\\xADcess token from above. Note the match\\xADing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"kid\"), \" claim from our ear\\xADlier JWT header ex\\xADam\\xADple.\"), mdx(\"p\", null, \"Now that we have the ap\\xADpro\\xADpri\\xADate pub\\xADlic key, we can use the in\\xADfor\\xADma\\xADtion from the JWT header to val\\xADi\\xADdate the sig\\xADna\\xADture of the JWT ac\\xADcess token.\\nIf the sig\\xADna\\xADture is valid, we can go on and check ad\\xADdi\\xADtional claims from the pay\\xADload sec\\xADtion of the JWT, such as ex\\xADpi\\xADra\\xADtion, al\\xADlowed is\\xADsuer and au\\xADdi\\xADence etc. \"), mdx(\"p\", null, \"Now that we have the nec\\xADes\\xADsary build\\xADing blocks in place, we can fi\\xADnally look at how to con\\xADfig\\xADure JWT au\\xADtho\\xADriza\\xADtion in Vert.x.\"), mdx(\"h3\", {\n    \"id\": \"jwt-authorization-in-vertx\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#jwt-authorization-in-vertx\"\n  })), \"JWT Authorization in Vert.x\"), mdx(\"p\", null, \"Set\\xADting up JWT au\\xADtho\\xADriza\\xADtion in Vert.x is quite easy. First we need to add the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-auth-jwt\"), \" mod\\xADule as a de\\xADpen\\xADdency to our project.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-xml\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"dependency\"), \"\u003e\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"groupId\"), \"\u003e\"), \"io.vertx\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"groupId\"), \"\u003e\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"artifactId\"), \"\u003e\"), \"vertx-auth-jwt\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"artifactId\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"dependency\"), \"\u003e\"), \"\\n\")), mdx(\"p\", null, \"In our ex\\xADam\\xADple, the whole JWT au\\xADtho\\xADriza\\xADtion setup hap\\xADpens in the method \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"setupJwtAuth\"), \".\"), mdx(\"p\", null, \"We use a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WebClient\"), \" to dy\\xADnam\\xADi\\xADcally fetch the pub\\xADlic key in\\xADfor\\xADma\\xADtion from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/protocol/openid-connect/certs\"), \" JWKS end\\xADpoint rel\\xADa\\xADtive to our Key\\xADcloak is\\xADsuer URL.\\nAfter that, we con\\xADfig\\xADure a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuth\"), \" in\\xADstance and cus\\xADtomize the JWT val\\xADi\\xADda\\xADtion via \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTOptions\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuthOptions\"), \".\\nNote that we use Key\\xADcloak\\u2019s realm roles for role based au\\xADtho\\xADriza\\xADtion via the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuthOptions#setPermissionsClaimKey(..)\"), \" method.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" Future\u003cStartup\u003e \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"setupJwtAuth\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(Startup startup)\"), \" \"), \"{\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtConfig = startup.config.getJsonObject(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"jwt\\\"\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" issuer = jwtConfig.getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"issuer\\\"\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" issuerUri = URI.create(issuer);\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// derive JWKS uri from Keycloak issuer URI\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwksUri = URI.create(jwtConfig.getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"jwksUri\\\"\"), \", String.format(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"%s://%s:%d%s\\\"\"), \",\\n            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/protocol/openid-connect/certs\\\"\"), \")));\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" promise = Promise.\u003cJWTAuth\u003epromise();\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// fetch JWKS from `/certs` endpoint\"), \"\\n    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())\\n            .as(BodyCodec.jsonObject())\\n            .send(ar -\u003e {\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (!ar.succeeded()) {\\n                    startup.bootstrap.fail(String.format(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Could not fetch JWKS from URI: %s\\\"\"), \", jwksUri));\\n                    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \";\\n                }\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" response = ar.result();\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwksResponse = response.body();\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" keys = jwksResponse.getJsonArray(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"keys\\\"\"), \");\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Configure JWT validation options\"), \"\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtOptions = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JWTOptions();\\n                jwtOptions.setIssuer(issuer);\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// extract JWKS from keys array\"), \"\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwks = ((List\u003cObject\u003e) keys.getList()).stream()\\n                        .map(o -\u003e \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject((Map\u003cString, Object\u003e) o))\\n                        .collect(Collectors.toList());\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// configure JWTAuth\"), \"\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtAuthOptions = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JWTAuthOptions();\\n                jwtAuthOptions.setJwks(jwks);\\n                jwtAuthOptions.setJWTOptions(jwtOptions);\\n                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"permissionClaimsKey\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"realm_access/roles\\\"\"), \"));\\n\\n                JWTAuth jwtAuth = JWTAuth.create(vertx, jwtAuthOptions);\\n                promise.complete(jwtAuth);\\n            });\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" promise.future().compose(auth -\u003e {\\n        jwtAuth = auth;\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture(startup);\\n    });\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"protecting-routes-with-jwtauthhandler\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#protecting-routes-with-jwtauthhandler\"\n  })), \"Protecting routes with JWTAuthHandler\"), mdx(\"p\", null, \"Now that our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuth\"), \" is con\\xADfig\\xADured, we can use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuthHandler\"), \" in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"setupRouter\"), \" method to apply\\nJWT au\\xADtho\\xADriza\\xADtion to all routes match\\xADing the path pat\\xADtern \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/api/*\"), \". The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTAuthHandler\"), \" val\\xADi\\xADdates re\\xADceived JWTs and per\\xADforms\\nad\\xADdi\\xADtional checks like ex\\xADpi\\xADra\\xADtion and al\\xADlowed is\\xADsuers. With that in place, we con\\xADfig\\xADure our ac\\xADtual routes in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"setupRoutes\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" Future\u003cStartup\u003e \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"setupRouter\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(Startup startup)\"), \" \"), \"{\\n\\n    router = Router.router(vertx);\\n\\n    router.route(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/*\\\"\"), \").handler(JWTAuthHandler.create(jwtAuth));\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture(startup);\\n}\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" Future\u003cStartup\u003e \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"setupRoutes\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(Startup startup)\"), \" \"), \"{\\n\\n    router.get(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/greet\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::handleGreet);\\n    router.get(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/user\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::handleUserData);\\n    router.get(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/admin\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::handleAdminData);\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture(startup);\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"extracting-user-information-from-jwtuser\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#extracting-user-information-from-jwtuser\"\n  })), \"Extracting user information from JWTUser\"), mdx(\"p\", null, \"To ac\\xADcess user in\\xADfor\\xADma\\xADtion in our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"handleGreet\"), \" method, we cast the re\\xADsult of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"io.vertx.ext.web.RoutingContext#user\"), \" method to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JWTUser\"), \"\\nwhich al\\xADlows us to ac\\xADcess token claim in\\xADfor\\xADma\\xADtion via the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"io.vertx.ext.auth.jwt.impl.JWTUser#principal\"), \" JSON ob\\xADject.\"), mdx(\"p\", null, \"If we\\u2019d like to use the JWT ac\\xADcess token for other ser\\xADvice calls, we could ex\\xADtract the token from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Authorization\"), \" header.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"handleGreet\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(RoutingContext ctx)\"), \" \"), \"{\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtUser = (JWTUser) ctx.user();\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" username = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"preferred_username\\\"\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" userId = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"sub\\\"\"), \");\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" accessToken = ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Bearer \\\"\"), \".length());\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Use accessToken for down-stream calls if needed...\"), \"\\n\\n    ctx.request().response().end(String.format(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Hi %s (%s) %s%n\\\"\"), \", username, userId, Instant.now()));\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"obtaining-an-access-token-from-keycloak-for-user-tester\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#obtaining-an-access-token-from-keycloak-for-user-tester\"\n  })), \"Obtaining an Access Token from Keycloak for user \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"tester\")), mdx(\"p\", null, \"To test our ap\\xADpli\\xADca\\xADtion we can use the fol\\xADlow\\xADing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"curl\"), \" com\\xADmands in a bash like shell to ob\\xADtain an JWT ac\\xADcess token to call one\\nof our end\\xADpoints as the user \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tester\"), \" with the role \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"user\"), \".\"), mdx(\"p\", null, \"Note that this ex\\xADam\\xADple uses the cli tool \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stedolan.github.io/jq/\"\n  }), \"jq\"), \" for JSON pro\\xADcess\\xADing.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"KC_USERNAME=tester\\nKC_PASSWORD=\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"test\"), \"\\nKC_CLIENT=vertx-service\\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\\nKC_REALM=vertx\\nKC_URL=http://localhost:8080/auth\\nKC_RESPONSE=$(curl  -k \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"username=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_USERNAME\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"password=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_PASSWORD\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'grant_type=password'\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"client_id=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_CLIENT\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"client_secret=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_CLIENT_SECRET\"), \"\\\"\"), \" \\\\\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_URL\"), \"/realms/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_REALM\"), \"/protocol/openid-connect/token\\\"\"), \" \\\\\\n    | jq .)\\n\\nKC_ACCESS_TOKEN=$(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"echo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_RESPONSE\"), \"| jq -r .access_token)\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"echo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\n\")), mdx(\"p\", null, \"Here we use the JWT ac\\xADcess token in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Authorization\"), \" header with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Bearer\"), \" pre\\xADfix to call our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"greet\"), \" route:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"curl --silent -H \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Authorization: Bearer \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\\"\"), \" http://localhost:3000/api/greet\\n\")), mdx(\"p\", null, \"Ex\\xADam\\xADple out\\xADput:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"Hi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z\\n\")), mdx(\"h3\", {\n    \"id\": \"applying-role-based-access-control-with-jwtuser\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#applying-role-based-access-control-with-jwtuser\"\n  })), \"Applying Role-based Access-Control with JWTUser\"), mdx(\"p\", null, \"To lever\\xADage sup\\xADport for role based ac\\xADcess con\\xADtrol (RBAC) we can use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"io.vertx.ext.auth.User#isAuthorised\"), \" method\\nto check whether the cur\\xADrent user has the re\\xADquired role. If the role is present we re\\xADturn some data about the user, oth\\xADer\\xADwise\\nwe send a re\\xADsponse with sta\\xADtus code 403 and a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"forbidden\"), \" error mes\\xADsage.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"handleUserData\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(RoutingContext ctx)\"), \" \"), \"{\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtUser = (JWTUser) ctx.user();\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" username = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"preferred_username\\\"\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" userId = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"sub\\\"\"), \");\\n\\n    jwtUser.isAuthorized(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user\\\"\"), \", res -\u003e {\\n\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (!res.succeeded() || !res.result()) {\\n            toJsonResponse(ctx).setStatusCode(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"403\"), \").end(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"{\\\\\\\"error\\\\\\\": \\\\\\\"forbidden\\\\\\\"}\\\"\"), \");\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \";\\n        }\\n\\n        JsonObject data = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject()\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"type\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user\\\"\"), \")\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"username\\\"\"), \", username)\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"userId\\\"\"), \", userId)\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"timestamp\\\"\"), \", Instant.now());\\n\\n        toJsonResponse(ctx).end(data.toString());\\n    });\\n}\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"handleAdminData\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(RoutingContext ctx)\"), \" \"), \"{\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" jwtUser = (JWTUser) ctx.user();\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" username = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"preferred_username\\\"\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" userId = jwtUser.principal().getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"sub\\\"\"), \");\\n\\n    jwtUser.isAuthorized(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"admin\\\"\"), \", res -\u003e {\\n\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (!res.succeeded() || !res.result()) {\\n            toJsonResponse(ctx).setStatusCode(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"403\"), \").end(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"{\\\\\\\"error\\\\\\\": \\\\\\\"forbidden\\\\\\\"}\\\"\"), \");\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \";\\n        }\\n\\n        JsonObject data = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject()\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"type\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"admin\\\"\"), \")\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"username\\\"\"), \", username)\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"userId\\\"\"), \", userId)\\n                .put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"timestamp\\\"\"), \", Instant.now());\\n\\n        toJsonResponse(ctx).end(data.toString());\\n    });\\n}\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"curl --silent -H \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Authorization: Bearer \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\\"\"), \" http://localhost:3000/api/user\\n\")), mdx(\"p\", null, \"Out\\xADput:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"username\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"tester\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"userId\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"27b3fac0-9aec-4421-81cf-d4b02428f901\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"timestamp\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"2020-09-28T21:07:49.340950300Z\\\"\"), \"}\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"curl --silent -H \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Authorization: Bearer \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\\"\"), \" http://localhost:3000/api/admin\\n\")), mdx(\"p\", null, \"Out\\xADput:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"error\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"forbidden\\\"\"), \"}\\n\")), mdx(\"h3\", {\n    \"id\": \"obtaining-an-access-token-from-keycloak-for-user-vadmin\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#obtaining-an-access-token-from-keycloak-for-user-vadmin\"\n  })), \"Obtaining an Access Token from Keycloak for user \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"vadmin\")), mdx(\"p\", null, \"To check ac\\xADcess with an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"admin\"), \" role, we ob\\xADtain a new token for the user \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vadmin\"), \" which has the roles \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"admin\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"user\"), \". \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"KC_USERNAME=vadmin\\nKC_PASSWORD=\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"test\"), \"\\nKC_CLIENT=vertx-service\\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\\nKC_REALM=vertx\\nKC_URL=http://localhost:8080/auth\\nKC_RESPONSE=$(curl  -k \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"username=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_USERNAME\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"password=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_PASSWORD\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'grant_type=password'\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"client_id=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_CLIENT\"), \"\\\"\"), \" \\\\\\n        -d \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"client_secret=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_CLIENT_SECRET\"), \"\\\"\"), \" \\\\\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_URL\"), \"/realms/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_REALM\"), \"/protocol/openid-connect/token\\\"\"), \" \\\\\\n    | jq .)\\n\\nKC_ACCESS_TOKEN=$(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"echo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_RESPONSE\"), \"| jq -r .access_token)\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"echo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"curl --silent -H \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Authorization: Bearer \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\\"\"), \" http://localhost:3000/api/user\\n\")), mdx(\"p\", null, \"Out\\xADput:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"username\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vadmin\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"userId\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"75090eac-36ff-4cd8-847d-fc2941bc024e\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"timestamp\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"2020-09-28T21:13:05.099393900Z\\\"\"), \"}\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"curl --silent -H \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Authorization: Bearer \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"$KC_ACCESS_TOKEN\"), \"\\\"\"), \" http://localhost:3000/api/admin\\n\")), mdx(\"p\", null, \"Out\\xADput:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"admin\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"username\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vadmin\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"userId\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"75090eac-36ff-4cd8-847d-fc2941bc024e\\\"\"), \",\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"timestamp\\\"\"), \":\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"2020-09-28T21:13:34.945276500Z\\\"\"), \"}\\n\")), mdx(\"h3\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"We learned how to con\\xADfig\\xADure a Vert.x ap\\xADpli\\xADca\\xADtion with JWT au\\xADtho\\xADriza\\xADtion pow\\xADered by Key\\xADcloak. Al\\xADthough the con\\xADfig\\xADu\\xADra\\xADtion is quite com\\xADplete\\nal\\xADready, there are still some parts that can be im\\xADproved, like the dy\\xADnamic JWKS fetch\\xADing on public-\\u200Bkey pair ro\\xADta\\xADtion as well as ex\\xADtrac\\xADtion of nested roles.\"), mdx(\"p\", null, \"Nev\\xADer\\xADthe\\xADless this is a good start\\xADing point for se\\xADcur\\xADing your own Vert.x ser\\xADvices with JWT and Key\\xADcloak.\"), mdx(\"p\", null, \"You can check out the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx\"\n  }), \"com\\xADplete ex\\xADam\\xADple in keycloak-\\u200Bvertx Ex\\xADam\\xADples Repo\"), \".\"), mdx(\"p\", null, \"Thank you for your time, stay tuned for more up\\xADdates! If you want to learn more about Key\\xADcloak, feel free to reach out to me. You can find me via \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/thomasdarimont\"\n  }), \"thomas\\xADda\\xADri\\xADmont on twit\\xADter\"), \".\"), mdx(\"p\", null, \"Happy Hack\\xADing!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003e\u003cstrong\u003eTL;DR:\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eIn this blog post you’ll learn:\u003c/p\u003e\u003cul\u003e\u003cli\u003eJWT foun­da­tions\u003c/li\u003e\u003cli\u003eHow to pro­tect routes with a JWT Au­tho­riza­tion\u003c/li\u003e\u003cli\u003eHow to ex­tract claims from a JWT en­coded token\u003c/li\u003e\u003cli\u003eHow to apply RBAC with Key­cloak Realm roles\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"hello-again\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#hello-again\"\u003e\u003c/a\u003eHello again\u003c/h2\u003e\u003cp\u003eHi there! In my last blog post \u003ca href=\"/blog/easy-sso-for-vert-x-with-keycloak/\"\u003eEasy SSO for Vert.x with Key­cloak\u003c/a\u003e, we learned how to con­fig­ure sin­gle sign-​on for a Vert.x web ap­pli­ca­tion with Key­cloak and OpenID con­nect. This time, we’ll see how we can pro­tect an ap­pli­ca­tion with Vert.x’s \u003ca href=\"/docs/vertx-web/java/#_jwt_authorisation\"\u003eJWT Au­tho­riza­tion\u003c/a\u003e sup­port and Key­cloak.\u003c/p\u003e\u003ch2 id=\"keycloak-setup\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#keycloak-setup\"\u003e\u003c/a\u003eKeycloak Setup\u003c/h2\u003e\u003cp\u003eTo se­cure our Vert.x app, we need to use a Key­cloak server for ob­tain­ing JWT to­kens. Al­though \u003ca href=\"https://www.keycloak.org/docs/latest/getting_started/\"\u003eKey­cloak has a great get­ting started guide\u003c/a\u003e I wanted to make it a bit eas­ier to put every­thing to­gether, there­fore I pre­pared a local Key­cloak docker con­tainer \u003ca href=\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm\"\u003eas de­scribed here\u003c/a\u003e, which comes with all the re­quired con­fig­u­ra­tion in place, that you can start eas­ily.\u003c/p\u003e\u003cp\u003eThe pre­con­fig­ured Key­cloak realm \u003ccode\u003evertx\u003c/code\u003e con­tains a \u003ccode\u003evertx-service\u003c/code\u003e OpenID con­nect client for our Vert.x app and a set\nof users for test­ing. To ease test­ing, the \u003ccode\u003evertx-service\u003c/code\u003e is con­fig­ured with \u003ccode\u003eDirect Access Grant\u003c/code\u003e en­abled in Key­cloak, which\nen­ables sup­port for the OAuth2 re­source owner pass­word cre­den­tials grant (ROPC) flow.\u003c/p\u003e\u003cp\u003eTo start Key­cloak with the pre­con­fig­ured realm, just start the docker con­tainer with the fol­low­ing com­mand:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker run \\\n  -it \\\n  --name vertx-keycloak \\\n  --rm \\\n  -e KEYCLOAK_USER=admin \\\n  -e KEYCLOAK_PASSWORD=admin \\\n  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \\\n  -v \u003cspan class=\"hljs-variable\"\u003e$PWD\u003c/span\u003e/vertx-realm.json:/tmp/vertx-realm.json \\\n  -v \u003cspan class=\"hljs-variable\"\u003e$PWD\u003c/span\u003e/data:/opt/jboss/keycloak/standalone/data \\\n  -p 8080:8080 \\\n  quay.io/keycloak/keycloak:11.0.2\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"vertx-app\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#vertx-app\"\u003e\u003c/a\u003eVert.x App\u003c/h2\u003e\u003cp\u003eThe ex­am­ple app con­sists of a sin­gle \u003ccode\u003eVerticle\u003c/code\u003e, that runs on \u003ccode\u003ehttp://localhost:3000\u003c/code\u003e and pro­vides a few routes with pro­tected re­sources. \u003ca href=\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java\"\u003eYou can find the com­plete ex­am­ple here\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eOur web app con­tains the fol­low­ing pro­tected routes with han­dlers:\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003e/api/greet\u003c/code\u003e - The greet­ing re­source, which re­turns a greet­ing mes­sage, only au­then­ti­cated users can ac­cess this re­source.\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/api/user\u003c/code\u003e - The user re­source, which re­turns some in­for­ma­tion about the user, only users with role \u003ccode\u003euser\u003c/code\u003e can ac­cess this re­source.\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/api/admin\u003c/code\u003e - The user re­source, which re­turns some in­for­ma­tion about the admin, only users with role \u003ccode\u003eadmin\u003c/code\u003e can ac­cess this re­source.\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eThis ex­am­ple is built with Vert.x ver­sion 3.9.3.\u003c/p\u003e\u003ch3 id=\"running-the-app-in-the-console\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#running-the-app-in-the-console\"\u003e\u003c/a\u003eRunning the app in the console\u003c/h3\u003e\u003cp\u003eTo run the app, we need to build it first:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e jwt-service-vertx\nmvn clean package\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis cre­ates a jar, which we can run:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ejava -jar target/*.jar\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNote, that we need to start Key­cloak first, since our app fetches the con­fig­u­ra­tion from Key­cloak on startup.\u003c/p\u003e\u003ch3 id=\"running-the-app-in-the-ide\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#running-the-app-in-the-ide\"\u003e\u003c/a\u003eRunning the app in the IDE\u003c/h3\u003e\u003cp\u003eWe can also run the app di­rectly from your favourite IDE like In­tel­liJ Idea or Eclipse.\nTo run the app from an IDE, we need to cre­ate a launch con­fig­u­ra­tion and use the main class \u003ccode\u003eio.vertx.core.Launcher\u003c/code\u003e. Then set the the pro­gram ar­gu­ments to\n\u003ccode\u003erun demo.MainVerticle\u003c/code\u003e and use the class­path of the \u003ccode\u003ejwt-service-vertx\u003c/code\u003e mod­ule.\nWith that in place we should be able to run the app.\u003c/p\u003e\u003ch2 id=\"jwt-authorization\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#jwt-authorization\"\u003e\u003c/a\u003eJWT Authorization\u003c/h2\u003e\u003ch3 id=\"jwt-foundations\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#jwt-foundations\"\u003e\u003c/a\u003eJWT Foundations\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://tools.ietf.org/html/rfc7519\"\u003eJSON Web Token (JWT)\u003c/a\u003e is an open stan­dard to se­curely ex­change in­for­ma­tion be­tween two par­ties in the form\nof \u003ca href=\"https://base64.guru/standards/base64url\"\u003eBase64URL\u003c/a\u003e en­coded JSON ob­jects.\nA stan­dard JWT is just a string which com­prises three base64url en­coded parts header, pay­load and a sig­na­ture, which are sep­a­rated by a ”\u003ccode\u003e.\u003c/code\u003e” char­ac­ter.\nThere are other vari­ants of JWT that can have more parts.\u003c/p\u003e\u003cp\u003eAn ex­am­ple JWT can look like this:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003eeyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe header and pay­load sec­tions con­tain in­for­ma­tion as a JSON ob­ject, whereas the sig­na­ture is just a plain string. JSON ob­jects con­tain key value pairs which are called \u003ccode\u003eclaims\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eThe claims in­for­ma­tion can be ver­i­fied and trusted be­cause it is dig­i­tally signed with the pri­vate key from a pub­lic/pri­vate key-​pair.\nThe sig­na­ture can later be ver­i­fied with a cor­re­spond­ing pub­lic key. The iden­ti­fier of the pub­lic/pri­vate key-​pair used to sign a JWT can be\ncon­tained in a spe­cial claim called \u003ccode\u003ekid\u003c/code\u003e (key iden­ti­fier) in the header sec­tion of the JWT.\u003c/p\u003e\u003cp\u003eAn ex­am­ple for a JWT header that ref­er­ences a pub­lic/pri­vate key-​pair looks like this:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;alg\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;RS256\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;typ\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;JWT\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;kid\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\u0026quot;\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIt is quite com­mon to use JWTs to con­vey in­for­ma­tion about au­then­ti­ca­tion (user iden­tity) and au­tho­riza­tion (scopes, user roles, per­mis­sions and other claims).\nOpenID providers such as \u003ca href=\"https://www.keycloak.org/\"\u003eKey­cloak\u003c/a\u003e sup­port is­su­ing OAuth2 ac­cess to­kens after au­then­ti­ca­tion for users to clients in the form of JWTs.\nAn ac­cess token can then be used to ac­cess other ser­vices or APIs on be­half of the user. The server pro­vid­ing those ser­vices or APIs is often called \u003ccode\u003eresource server\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eAn ex­am­ple JWT pay­load gen­er­ated by Key­cloak looks like this:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;exp\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1601318422\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;iat\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1601318122\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;jti\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;7635f5a1-f1d7-457d-b869-ad492352f4d2\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;iss\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;http://localhost:8080/auth/realms/vertx\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;aud\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;account\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;sub\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;27b3fac0-9aec-4421-81cf-d4b02428f901\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;typ\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Bearer\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;azp\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx-service\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;session_state\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;68708213-40b7-458a-aee1-39d6f9da07ad\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;acr\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;1\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;realm_access\u0026quot;\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;roles\u0026quot;\u003c/span\u003e: [\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;offline_access\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;uma_authorization\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e\n    ]\n  },\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scope\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;email profile\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;email_verified\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Theo Tester\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;preferred_username\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;tester\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;given_name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Theo\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;family_name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Tester\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;email\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;tom+tester@localhost\u0026quot;\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIf a \u003ccode\u003eresource server\u003c/code\u003e re­ceives a re­quest with such an ac­cess token, it needs to ver­ify and in­spect the token be­fore it can trust its con­tent.\nTo ver­ify the token, the \u003ccode\u003eresource server\u003c/code\u003e needs to ob­tain the \u003ccode\u003epublic key\u003c/code\u003e to check the token sig­na­ture.\nThis \u003ccode\u003epublic key\u003c/code\u003e can ei­ther be con­fig­ured sta­t­i­cally or fetched dy­nam­i­cally from the OpenID Provider by lever­ag­ing the \u003ccode\u003ekid\u003c/code\u003e in­for­ma­tion from the JWT header sec­tion.\nNote that most \u003ccode\u003eOpenID providers\u003c/code\u003e, such as Key­cloak, pro­vide a ded­i­cated end­point for dy­namic pub­lic key lookups, e.g. \u003ccode\u003ehttp://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs\u003c/code\u003e.\nA stan­dard for pro­vid­ing pub­lic key in­for­ma­tion is \u003ca href=\"https://tools.ietf.org/html/rfc7517\"\u003eJSON Web Key Set (JWKS)\u003c/a\u003e.\nThe JWKS in­for­ma­tion is usu­ally cached by the re­source server to avoid the over­head of fetch­ing JWKS for every re­quest.\u003c/p\u003e\u003cp\u003eAn ex­am­ple re­sponse for Key­cloak’s JWKS end­point looks like this:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\n   \u003cspan class=\"hljs-attr\"\u003e\u0026quot;keys\u0026quot;\u003c/span\u003e:[\n      {\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;kid\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;kty\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;RSA\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;alg\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;RS256\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;use\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;sig\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;n\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;e\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;AQAB\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;x5c\u0026quot;\u003c/span\u003e:[\n            \u003cspan class=\"hljs-string\"\u003e\u0026quot;MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb\u0026quot;\u003c/span\u003e\n         ],\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;x5t\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;MVYTXCx5cUQ8lT1ymIDDRYO7_ZI\u0026quot;\u003c/span\u003e,\n         \u003cspan class=\"hljs-attr\"\u003e\u0026quot;x5t#S256\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY\u0026quot;\u003c/span\u003e\n      }\n   ]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe \u003ccode\u003ekeys\u003c/code\u003e array con­tains the JWKS struc­ture with the pub­lic key in­for­ma­tion that be­longs to the pub­lic/pri­vate key-​pair which was used\nto sign the JWT ac­cess token from above. Note the match­ing \u003ccode\u003ekid\u003c/code\u003e claim from our ear­lier JWT header ex­am­ple.\u003c/p\u003e\u003cp\u003eNow that we have the ap­pro­pri­ate pub­lic key, we can use the in­for­ma­tion from the JWT header to val­i­date the sig­na­ture of the JWT ac­cess token.\nIf the sig­na­ture is valid, we can go on and check ad­di­tional claims from the pay­load sec­tion of the JWT, such as ex­pi­ra­tion, al­lowed is­suer and au­di­ence etc. \u003c/p\u003e\u003cp\u003eNow that we have the nec­es­sary build­ing blocks in place, we can fi­nally look at how to con­fig­ure JWT au­tho­riza­tion in Vert.x.\u003c/p\u003e\u003ch3 id=\"jwt-authorization-in-vertx\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#jwt-authorization-in-vertx\"\u003e\u003c/a\u003eJWT Authorization in Vert.x\u003c/h3\u003e\u003cp\u003eSet­ting up JWT au­tho­riza­tion in Vert.x is quite easy. First we need to add the \u003ccode\u003evertx-auth-jwt\u003c/code\u003e mod­ule as a de­pen­dency to our project.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-auth-jwt\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIn our ex­am­ple, the whole JWT au­tho­riza­tion setup hap­pens in the method \u003ccode\u003esetupJwtAuth\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eWe use a \u003ccode\u003eWebClient\u003c/code\u003e to dy­nam­i­cally fetch the pub­lic key in­for­ma­tion from the \u003ccode\u003e/protocol/openid-connect/certs\u003c/code\u003e JWKS end­point rel­a­tive to our Key­cloak is­suer URL.\nAfter that, we con­fig­ure a \u003ccode\u003eJWTAuth\u003c/code\u003e in­stance and cus­tomize the JWT val­i­da­tion via \u003ccode\u003eJWTOptions\u003c/code\u003e and \u003ccode\u003eJWTAuthOptions\u003c/code\u003e.\nNote that we use Key­cloak’s realm roles for role based au­tho­riza­tion via the \u003ccode\u003eJWTAuthOptions#setPermissionsClaimKey(..)\u003c/code\u003e method.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e Future\u0026lt;Startup\u0026gt; \u003cspan class=\"hljs-title\"\u003esetupJwtAuth\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Startup startup)\u003c/span\u003e \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtConfig = startup.config.getJsonObject(\u003cspan class=\"hljs-string\"\u003e\u0026quot;jwt\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e issuer = jwtConfig.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;issuer\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e issuerUri = URI.create(issuer);\n\n    \u003cspan class=\"hljs-comment\"\u003e// derive JWKS uri from Keycloak issuer URI\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwksUri = URI.create(jwtConfig.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;jwksUri\u0026quot;\u003c/span\u003e, String.format(\u003cspan class=\"hljs-string\"\u003e\u0026quot;%s://%s:%d%s\u0026quot;\u003c/span\u003e,\n            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;/protocol/openid-connect/certs\u0026quot;\u003c/span\u003e)));\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e promise = Promise.\u0026lt;JWTAuth\u0026gt;promise();\n\n    \u003cspan class=\"hljs-comment\"\u003e// fetch JWKS from `/certs` endpoint\u003c/span\u003e\n    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())\n            .as(BodyCodec.jsonObject())\n            .send(ar -\u0026gt; {\n\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!ar.succeeded()) {\n                    startup.bootstrap.fail(String.format(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Could not fetch JWKS from URI: %s\u0026quot;\u003c/span\u003e, jwksUri));\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n                }\n\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response = ar.result();\n\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwksResponse = response.body();\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e keys = jwksResponse.getJsonArray(\u003cspan class=\"hljs-string\"\u003e\u0026quot;keys\u0026quot;\u003c/span\u003e);\n\n                \u003cspan class=\"hljs-comment\"\u003e// Configure JWT validation options\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JWTOptions();\n                jwtOptions.setIssuer(issuer);\n\n                \u003cspan class=\"hljs-comment\"\u003e// extract JWKS from keys array\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwks = ((List\u0026lt;Object\u0026gt;) keys.getList()).stream()\n                        .map(o -\u0026gt; \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject((Map\u0026lt;String, Object\u0026gt;) o))\n                        .collect(Collectors.toList());\n\n                \u003cspan class=\"hljs-comment\"\u003e// configure JWTAuth\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtAuthOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JWTAuthOptions();\n                jwtAuthOptions.setJwks(jwks);\n                jwtAuthOptions.setJWTOptions(jwtOptions);\n                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;permissionClaimsKey\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;realm_access/roles\u0026quot;\u003c/span\u003e));\n\n                JWTAuth jwtAuth = JWTAuth.create(vertx, jwtAuthOptions);\n                promise.complete(jwtAuth);\n            });\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e promise.future().compose(auth -\u0026gt; {\n        jwtAuth = auth;\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(startup);\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"protecting-routes-with-jwtauthhandler\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#protecting-routes-with-jwtauthhandler\"\u003e\u003c/a\u003eProtecting routes with JWTAuthHandler\u003c/h3\u003e\u003cp\u003eNow that our \u003ccode\u003eJWTAuth\u003c/code\u003e is con­fig­ured, we can use the \u003ccode\u003eJWTAuthHandler\u003c/code\u003e in the \u003ccode\u003esetupRouter\u003c/code\u003e method to apply\nJWT au­tho­riza­tion to all routes match­ing the path pat­tern \u003ccode\u003e/api/*\u003c/code\u003e. The \u003ccode\u003eJWTAuthHandler\u003c/code\u003e val­i­dates re­ceived JWTs and per­forms\nad­di­tional checks like ex­pi­ra­tion and al­lowed is­suers. With that in place, we con­fig­ure our ac­tual routes in \u003ccode\u003esetupRoutes\u003c/code\u003e.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e Future\u0026lt;Startup\u0026gt; \u003cspan class=\"hljs-title\"\u003esetupRouter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Startup startup)\u003c/span\u003e \u003c/span\u003e{\n\n    router = Router.router(vertx);\n\n    router.route(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/*\u0026quot;\u003c/span\u003e).handler(JWTAuthHandler.create(jwtAuth));\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(startup);\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e Future\u0026lt;Startup\u0026gt; \u003cspan class=\"hljs-title\"\u003esetupRoutes\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Startup startup)\u003c/span\u003e \u003c/span\u003e{\n\n    router.get(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/greet\u0026quot;\u003c/span\u003e).handler(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e::handleGreet);\n    router.get(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/user\u0026quot;\u003c/span\u003e).handler(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e::handleUserData);\n    router.get(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/admin\u0026quot;\u003c/span\u003e).handler(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e::handleAdminData);\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(startup);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"extracting-user-information-from-jwtuser\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#extracting-user-information-from-jwtuser\"\u003e\u003c/a\u003eExtracting user information from JWTUser\u003c/h3\u003e\u003cp\u003eTo ac­cess user in­for­ma­tion in our \u003ccode\u003ehandleGreet\u003c/code\u003e method, we cast the re­sult of the \u003ccode\u003eio.vertx.ext.web.RoutingContext#user\u003c/code\u003e method to \u003ccode\u003eJWTUser\u003c/code\u003e\nwhich al­lows us to ac­cess token claim in­for­ma­tion via the \u003ccode\u003eio.vertx.ext.auth.jwt.impl.JWTUser#principal\u003c/code\u003e JSON ob­ject.\u003c/p\u003e\u003cp\u003eIf we’d like to use the JWT ac­cess token for other ser­vice calls, we could ex­tract the token from the \u003ccode\u003eAuthorization\u003c/code\u003e header.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehandleGreet\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(RoutingContext ctx)\u003c/span\u003e \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtUser = (JWTUser) ctx.user();\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e username = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;preferred_username\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e userId = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;sub\u0026quot;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e accessToken = ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Bearer \u0026quot;\u003c/span\u003e.length());\n    \u003cspan class=\"hljs-comment\"\u003e// Use accessToken for down-stream calls if needed...\u003c/span\u003e\n\n    ctx.request().response().end(String.format(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Hi %s (%s) %s%n\u0026quot;\u003c/span\u003e, username, userId, Instant.now()));\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"obtaining-an-access-token-from-keycloak-for-user-tester\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#obtaining-an-access-token-from-keycloak-for-user-tester\"\u003e\u003c/a\u003eObtaining an Access Token from Keycloak for user \u003ccode\u003etester\u003c/code\u003e\u003c/h3\u003e\u003cp\u003eTo test our ap­pli­ca­tion we can use the fol­low­ing \u003ccode\u003ecurl\u003c/code\u003e com­mands in a bash like shell to ob­tain an JWT ac­cess token to call one\nof our end­points as the user \u003ccode\u003etester\u003c/code\u003e with the role \u003ccode\u003euser\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eNote that this ex­am­ple uses the cli tool \u003ca href=\"https://stedolan.github.io/jq/\"\u003ejq\u003c/a\u003e for JSON pro­cess­ing.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eKC_USERNAME=tester\nKC_PASSWORD=\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e\nKC_CLIENT=vertx-service\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\nKC_REALM=vertx\nKC_URL=http://localhost:8080/auth\nKC_RESPONSE=$(curl  -k \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;username=\u003cspan class=\"hljs-variable\"\u003e$KC_USERNAME\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;password=\u003cspan class=\"hljs-variable\"\u003e$KC_PASSWORD\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026#x27;grant_type=password\u0026#x27;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;client_id=\u003cspan class=\"hljs-variable\"\u003e$KC_CLIENT\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;client_secret=\u003cspan class=\"hljs-variable\"\u003e$KC_CLIENT_SECRET\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u003cspan class=\"hljs-variable\"\u003e$KC_URL\u003c/span\u003e/realms/\u003cspan class=\"hljs-variable\"\u003e$KC_REALM\u003c/span\u003e/protocol/openid-connect/token\u0026quot;\u003c/span\u003e \\\n    | jq .)\n\nKC_ACCESS_TOKEN=$(\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$KC_RESPONSE\u003c/span\u003e| jq -r .access_token)\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eHere we use the JWT ac­cess token in the \u003ccode\u003eAuthorization\u003c/code\u003e header with the \u003ccode\u003eBearer\u003c/code\u003e pre­fix to call our \u003ccode\u003egreet\u003c/code\u003e route:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl --silent -H \u003cspan class=\"hljs-string\"\u003e\u0026quot;Authorization: Bearer \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\u0026quot;\u003c/span\u003e http://localhost:3000/api/greet\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eEx­am­ple out­put:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eHi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"applying-role-based-access-control-with-jwtuser\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#applying-role-based-access-control-with-jwtuser\"\u003e\u003c/a\u003eApplying Role-based Access-Control with JWTUser\u003c/h3\u003e\u003cp\u003eTo lever­age sup­port for role based ac­cess con­trol (RBAC) we can use the \u003ccode\u003eio.vertx.ext.auth.User#isAuthorised\u003c/code\u003e method\nto check whether the cur­rent user has the re­quired role. If the role is present we re­turn some data about the user, oth­er­wise\nwe send a re­sponse with sta­tus code 403 and a \u003ccode\u003eforbidden\u003c/code\u003e error mes­sage.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehandleUserData\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(RoutingContext ctx)\u003c/span\u003e \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtUser = (JWTUser) ctx.user();\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e username = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;preferred_username\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e userId = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;sub\u0026quot;\u003c/span\u003e);\n\n    jwtUser.isAuthorized(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e, res -\u0026gt; {\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!res.succeeded() || !res.result()) {\n            toJsonResponse(ctx).setStatusCode(\u003cspan class=\"hljs-number\"\u003e403\u003c/span\u003e).end(\u003cspan class=\"hljs-string\"\u003e\u0026quot;{\\\u0026quot;error\\\u0026quot;: \\\u0026quot;forbidden\\\u0026quot;}\u0026quot;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n        }\n\n        JsonObject data = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, username)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;userId\u0026quot;\u003c/span\u003e, userId)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;timestamp\u0026quot;\u003c/span\u003e, Instant.now());\n\n        toJsonResponse(ctx).end(data.toString());\n    });\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehandleAdminData\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(RoutingContext ctx)\u003c/span\u003e \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e jwtUser = (JWTUser) ctx.user();\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e username = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;preferred_username\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e userId = jwtUser.principal().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;sub\u0026quot;\u003c/span\u003e);\n\n    jwtUser.isAuthorized(\u003cspan class=\"hljs-string\"\u003e\u0026quot;admin\u0026quot;\u003c/span\u003e, res -\u0026gt; {\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!res.succeeded() || !res.result()) {\n            toJsonResponse(ctx).setStatusCode(\u003cspan class=\"hljs-number\"\u003e403\u003c/span\u003e).end(\u003cspan class=\"hljs-string\"\u003e\u0026quot;{\\\u0026quot;error\\\u0026quot;: \\\u0026quot;forbidden\\\u0026quot;}\u0026quot;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n        }\n\n        JsonObject data = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;admin\u0026quot;\u003c/span\u003e)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, username)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;userId\u0026quot;\u003c/span\u003e, userId)\n                .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;timestamp\u0026quot;\u003c/span\u003e, Instant.now());\n\n        toJsonResponse(ctx).end(data.toString());\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl --silent -H \u003cspan class=\"hljs-string\"\u003e\u0026quot;Authorization: Bearer \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\u0026quot;\u003c/span\u003e http://localhost:3000/api/user\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOut­put:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\u003cspan class=\"hljs-attr\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;tester\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;userId\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;27b3fac0-9aec-4421-81cf-d4b02428f901\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;timestamp\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;2020-09-28T21:07:49.340950300Z\u0026quot;\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl --silent -H \u003cspan class=\"hljs-string\"\u003e\u0026quot;Authorization: Bearer \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\u0026quot;\u003c/span\u003e http://localhost:3000/api/admin\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOut­put:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\u003cspan class=\"hljs-attr\"\u003e\u0026quot;error\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;forbidden\u0026quot;\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"obtaining-an-access-token-from-keycloak-for-user-vadmin\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#obtaining-an-access-token-from-keycloak-for-user-vadmin\"\u003e\u003c/a\u003eObtaining an Access Token from Keycloak for user \u003ccode\u003evadmin\u003c/code\u003e\u003c/h3\u003e\u003cp\u003eTo check ac­cess with an \u003ccode\u003eadmin\u003c/code\u003e role, we ob­tain a new token for the user \u003ccode\u003evadmin\u003c/code\u003e which has the roles \u003ccode\u003eadmin\u003c/code\u003e and \u003ccode\u003euser\u003c/code\u003e. \u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eKC_USERNAME=vadmin\nKC_PASSWORD=\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e\nKC_CLIENT=vertx-service\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\nKC_REALM=vertx\nKC_URL=http://localhost:8080/auth\nKC_RESPONSE=$(curl  -k \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;username=\u003cspan class=\"hljs-variable\"\u003e$KC_USERNAME\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;password=\u003cspan class=\"hljs-variable\"\u003e$KC_PASSWORD\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026#x27;grant_type=password\u0026#x27;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;client_id=\u003cspan class=\"hljs-variable\"\u003e$KC_CLIENT\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        -d \u003cspan class=\"hljs-string\"\u003e\u0026quot;client_secret=\u003cspan class=\"hljs-variable\"\u003e$KC_CLIENT_SECRET\u003c/span\u003e\u0026quot;\u003c/span\u003e \\\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u003cspan class=\"hljs-variable\"\u003e$KC_URL\u003c/span\u003e/realms/\u003cspan class=\"hljs-variable\"\u003e$KC_REALM\u003c/span\u003e/protocol/openid-connect/token\u0026quot;\u003c/span\u003e \\\n    | jq .)\n\nKC_ACCESS_TOKEN=$(\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$KC_RESPONSE\u003c/span\u003e| jq -r .access_token)\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl --silent -H \u003cspan class=\"hljs-string\"\u003e\u0026quot;Authorization: Bearer \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\u0026quot;\u003c/span\u003e http://localhost:3000/api/user\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOut­put:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\u003cspan class=\"hljs-attr\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;vadmin\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;userId\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;75090eac-36ff-4cd8-847d-fc2941bc024e\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;timestamp\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;2020-09-28T21:13:05.099393900Z\u0026quot;\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl --silent -H \u003cspan class=\"hljs-string\"\u003e\u0026quot;Authorization: Bearer \u003cspan class=\"hljs-variable\"\u003e$KC_ACCESS_TOKEN\u003c/span\u003e\u0026quot;\u003c/span\u003e http://localhost:3000/api/admin\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOut­put:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\u003cspan class=\"hljs-attr\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;admin\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;vadmin\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;userId\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;75090eac-36ff-4cd8-847d-fc2941bc024e\u0026quot;\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003e\u0026quot;timestamp\u0026quot;\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026quot;2020-09-28T21:13:34.945276500Z\u0026quot;\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"\u003e\u003c/a\u003eConclusion\u003c/h3\u003e\u003cp\u003eWe learned how to con­fig­ure a Vert.x ap­pli­ca­tion with JWT au­tho­riza­tion pow­ered by Key­cloak. Al­though the con­fig­u­ra­tion is quite com­plete\nal­ready, there are still some parts that can be im­proved, like the dy­namic JWKS fetch­ing on public-​key pair ro­ta­tion as well as ex­trac­tion of nested roles.\u003c/p\u003e\u003cp\u003eNev­er­the­less this is a good start­ing point for se­cur­ing your own Vert.x ser­vices with JWT and Key­cloak.\u003c/p\u003e\u003cp\u003eYou can check out the \u003ca href=\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx\"\u003ecom­plete ex­am­ple in keycloak-​vertx Ex­am­ples Repo\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eThank you for your time, stay tuned for more up­dates! If you want to learn more about Key­cloak, feel free to reach out to me. You can find me via \u003ca href=\"https://twitter.com/thomasdarimont\"\u003ethomas­da­ri­mont on twit­ter\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eHappy Hack­ing!\u003c/p\u003e","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 3.9.4 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"Eclipse Vert.x version 3.9.4 has just been released. It fixes quite a few bugs that have been reported by the community."},"date":"2020-10-15","slug":"eclipse-vert-x-3-9-4-released"},"nextPost":{"meta":{"title":"Eclipse Vert.x 4 beta 3 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The third beta version of Eclipse Vert.x 4.0 highlights many features including (but not limited to) HTTP client request creation, HTTP tunnel improvements, and WebSocket upgrade improvements."},"date":"2020-09-25","slug":"eclipse-vert-x-4-beta-3-released"},"relatedPosts":[{"meta":{"title":"Easy SSO for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x."},"date":"2020-03-16","slug":"easy-sso-for-vert-x-with-keycloak"},{"meta":{"title":"Things to keep in mind concerning CSRF attacks","category":"guides","authors":[{"name":"Xhelal Likaj","github_id":"xhlika"}],"summary":"Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses."},"date":"2021-01-23","slug":"eclipse-vert-x-CSRF-concerns"},{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"}]},"__N_SSG":true},"page":"/blog/[[...slug]]","query":{"slug":["jwt-authorization-for-vert-x-with-keycloak"]},"buildId":"G6c0p4Z3S8-2fF1Kverdd","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5B%5B...slug%5D%5D-ff5b3ed8f1ab05c5e7a9.js" async=""></script><script src="/_next/static/G6c0p4Z3S8-2fF1Kverdd/_buildManifest.js" async=""></script><script src="/_next/static/G6c0p4Z3S8-2fF1Kverdd/_ssgManifest.js" async=""></script></body></html>