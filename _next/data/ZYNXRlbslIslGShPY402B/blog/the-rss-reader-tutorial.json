{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"The RSS reader tutorial","category":"guides","authors":[{"name":"Pavel Drankov","github_id":"Sammers21"}],"summary":"In this tutorial, you will learn how to use the Eclipse Vert.x Cassandra client in practice. We will develop an RSS reader with three HTTP endpoints."},"date":"2018-08-20","slug":"the-rss-reader-tutorial","readingTime":{"text":"7 min read","minutes":6.18,"time":370799.99999999994,"words":1236},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This tu\\xADto\\xADr\\xADial is ded\\xADi\\xADcated for users who\\u2019d like to know how to use the Eclipse Vert.x Cas\\xADsan\\xADdra client in prac\\xADtice.\"), mdx(\"h2\", {\n    \"id\": \"before-you-start-this-tutorial\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#before-you-start-this-tutorial\"\n  })), \"Before you start this tutorial\"), mdx(\"p\", null, \"Be\\xADfore start\\xADing, you should\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"be fa\\xADmil\\xADiar with \", mdx(Link, {\n    href: \"/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"Eclipse Vert.x\")), \". If you are not, here is the \", mdx(Link, {\n    href: \"/docs/guide-for-java-devs/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"guide for Java de\\xADvel\\xADop\\xADers\")), \".\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"have some basic un\\xADder\\xADstand\\xADing of data\\xADbases. Ex\\xADtended knowl\\xADedge of Cas\\xADsan\\xADdra is not re\\xADquired.\"))), mdx(\"p\", null, \"You also may find it use\\xADful to read \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://validator.w3.org/feed/docs/rss2.html\"\n  }), \"the RSS 2.0\"), \" spec\\xADi\\xADfi\\xADca\\xADtion, be\\xADcause the re\\xADsulted app is, ba\\xADsi\\xADcally, a stor\\xADage of RSS 2.0 feeds.\"), mdx(\"p\", null, \"To give you an idea of what the App is about, here is how it looks like from the fronted side:\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://i.imgur.com/2V954zx.png\",\n    \"alt\": \"see how it looks\"\n  }))), mdx(\"p\", null, \"In the image, we see that browser space is split into 2 parts:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Saved feed names\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"List of ar\\xADti\\xADcles for the se\\xADlected feed\")), mdx(\"p\", null, \"Here you also can enter a link to a new feed, so the App will fetch and parse the feed.\\nAfter that, it will ap\\xADpear in the left col\\xADumn along with other saved feeds.\"), mdx(\"h2\", {\n    \"id\": \"requirements\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#requirements\"\n  })), \"Requirements\"), mdx(\"p\", null, \"For com\\xADplet\\xADing this tu\\xADto\\xADr\\xADial you need:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Java 8 or higher\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Git\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"1 hour of your time\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You fa\\xADvorite code ed\\xADi\\xADtor\")), mdx(\"p\", null, \"For run\\xADning the ex\\xADam\\xADple you should en\\xADsure that Cas\\xADsan\\xADdra ser\\xADvice is run\\xADning lo\\xADcally on port 9042.\\nAs an op\\xADtion, you can run Cas\\xADsan\\xADdra with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/riptano/ccm#installation\"\n  }), \"ccm\"), \"(Cas\\xADsan\\xADdra Clus\\xADter Man\\xADager).\\nFol\\xADlow \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/riptano/ccm#installation\"\n  }), \"this\"), \" in\\xADstruc\\xADtions for in\\xADstalling ccm.\\nAfter in\\xADstalling you will be able to run a sin\\xADgle node clus\\xADter:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-better-shell\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" ccm create rss_reader -v 3.11.2 -n 1 -s\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" ccm start\"), \"\\n\")), mdx(\"p\", null, \"Be\\xADfore com\\xADplet\\xADing this step make sure that you have suc\\xADcess\\xADfully cloned the RSS reader repos\\xADi\\xADtory and checked out the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"step_1\"), \" branch:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-better-shell\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" git \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"clone\"), \" https://github.com/Sammers21/rss-reader\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" rss-reader\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" git checkout step_1\"), \"\\n\")), mdx(\"p\", null, \"Now you can try to tun this ex\\xADam\\xADple and see if it works:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-better-shell\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" ./gradlew vertxRun\"), \"\\n\")), mdx(\"h2\", {\n    \"id\": \"schema\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#schema\"\n  })), \"Schema\"), mdx(\"p\", null, \"If you are fa\\xADmil\\xADiar with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://cassandra.apache.org/\"\n  }), \"Apache Cas\\xADsan\\xADdra\"), \", you\\nshould know that the way your data is stored in Cas\\xADsan\\xADdra is de\\xADpen\\xADdent on queries\\nyou are run\\xADning. It means that you need first to fig\\xADure out what kind of queries\\nyou will be run\\xADning, and then you can pro\\xADduce a stor\\xADage scheme.\"), mdx(\"p\", null, \"In our case, we\\u2019d like our ap\\xADpli\\xADca\\xADtion to have 3 end\\xADpoints:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"POST /user/{user_id}/rss_link\"), \" - for adding links to a user\\u2019s feed\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"GET /user/{user_id}/rss_channels\"), \" - for re\\xADtriev\\xADing in\\xADfor\\xADma\\xADtion about RSS chan\\xADnels a user sub\\xADscribed on\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"GET /articles/by_rss_link?link={rss_link}\"), \" - for re\\xADtriev\\xADing in\\xADfor\\xADma\\xADtion about ar\\xADti\\xADcles on a spe\\xADcific RSS chan\\xADnel\")), mdx(\"p\", null, \"For im\\xADple\\xADment\\xADing this end\\xADpoints, the schema should look as fol\\xADlows:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-sql\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"CREATE\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"TABLE\"), \" rss_by_user (login \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \" , rss_link \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", PRIMARY \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"KEY\"), \" (login, rss_link));\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"CREATE\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"TABLE\"), \" articles_by_rss_link(rss_link \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", pubDate \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"timestamp\"), \", title \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", article_link \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", description \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", PRIMARY \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"KEY\"), \" ( rss_link , pubDate , article_link));\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"CREATE\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"TABLE\"), \" channel_info_by_rss_link(rss_link \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", last_fetch_time \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"timestamp\"), \",title \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", site_link \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", description \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"text\"), \", PRIMARY \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"KEY\"), \"(rss_link));\\n\")), mdx(\"h2\", {\n    \"id\": \"what-to-do-in-this-step\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#what-to-do-in-this-step\"\n  })), \"What to do in this step\"), mdx(\"p\", null, \"In this step, we will im\\xADple\\xADment only the first end\\xADpoint\"), mdx(\"h2\", {\n    \"id\": \"project-overview\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#project-overview\"\n  })), \"Project overview\"), mdx(\"p\", null, \"There are two no\\xADtable classes in the project: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FetchVerticle\"), \". The first one is a \", mdx(Link, {\n    href: \"/docs/vertx-core/java/#_verticles\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"Ver\\xADti\\xADcle\")), \" re\\xADspon\\xADsi\\xADble for HTTP re\\xADquest han\\xADdling and stor\\xADage schema ini\\xADtial\\xADiza\\xADtion. The sec\\xADond one is a \", mdx(Link, {\n    href: \"/docs/vertx-core/java/#_verticles\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"Ver\\xADti\\xADcle\")), \" as well, but re\\xADspon\\xADsi\\xADble for RSS feeds fetch\\xADing.\"), mdx(\"p\", null, \"The idea is sim\\xADple. When the ap\\xADpli\\xADca\\xADtion is start\\xADing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle\"), \" is de\\xADployed, then it tries to ini\\xADtial\\xADize stor\\xADage schema, de\\xADscribed in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/main/resources/schema.cql\"), \" file by read\\xADing it and ex\\xADe\\xADcut\\xADing listed queries line by line. After the schema ini\\xADtial\\xADiza\\xADtion the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle\"), \" de\\xADploys \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FetchVerticle\"), \" and starts a HTTP server.\"), mdx(\"h2\", {\n    \"id\": \"implementing-the-endpoint\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#implementing-the-endpoint\"\n  })), \"Implementing the endpoint\"), mdx(\"p\", null, \"Now, it is time to im\\xADple\\xADment the first end\\xADpoint. Pay at\\xADten\\xADtion to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TODO\"), \"s, they are for point\\xADing you out about where changes should be made.\"), mdx(\"p\", null, \"Now, let\\u2019s have a look at the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle#postRssLink\"), \" method. This method is called each time the first end\\xADpoint is called, so we can fig\\xADure out what is the posted body and id of the user, who per\\xADformed the re\\xADquest, di\\xADrectly there. There are 2 main things we want to do in this method:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"No\\xADti\\xADfy\\xADing via the \", mdx(Link, {\n    href: \"/docs/vertx-core/java/#event_bus\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"\"\n  }), \"Event Bus\")), \" the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"FetchVerticle\"), \" to fetch given by user link link to an RSS feed.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"In\\xADsert\\xADing an entry to the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"rss_by_user\"), \" table.\")), mdx(\"p\", null, \"This is how the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle#postRssLink\"), \" method should be im\\xADple\\xADmented:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"postRssLink\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(RoutingContext ctx)\"), \" \"), \"{\\n    ctx.request().bodyHandler(body -> {\\n        JsonObject bodyAsJson = body.toJsonObject();\\n        String link = bodyAsJson.getString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"link\\\"\"), \");\\n        String userId = ctx.request().getParam(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"user_id\\\"\"), \");\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (link == \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"null\"), \" || userId == \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"null\"), \") {\\n            responseWithInvalidRequest(ctx);\\n        } \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"else\"), \" {\\n            vertx.eventBus().send(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"fetch.rss.link\\\"\"), \", link);\\n            Future<ResultSet> future = Future.future();\\n            BoundStatement query = insertNewLinkForUser.bind(userId, link);\\n            client.execute(query, future);\\n            future.setHandler(result -> {\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (result.succeeded()) {\\n                    ctx.response().end(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject().put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"message\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"The feed just added\\\"\"), \").toString());\\n                } \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"else\"), \" {\\n                    ctx.response().setStatusCode(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"400\"), \").end(result.cause().getMessage());\\n                }\\n            });\\n        }\\n    });\\n}\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"responseWithInvalidRequest\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(RoutingContext ctx)\"), \" \"), \"{\\n    ctx.response()\\n            .setStatusCode(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"400\"), \")\\n            .putHeader(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"content-type\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"application/json; charset=utf-8\\\"\"), \")\\n            .end(invalidRequest().toString());\\n}\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" JsonObject \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"invalidRequest\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"()\"), \" \"), \"{\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject().put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"message\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Invalid request\\\"\"), \");\\n}\\n\")), mdx(\"p\", null, \"You may no\\xADtice that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"insertNewLinkForUser\"), \" is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PreparedStatement\"), \", and should be ini\\xADtial\\xADized be\\xADfore the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle\"), \" start. Let\\u2019s do it in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppVerticle#prepareNecessaryQueries\"), \" method:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" Future<Void> \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"prepareNecessaryQueries\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"()\"), \" \"), \"{\\n    Future<PreparedStatement> insertNewLinkForUserPrepFuture = Future.future();\\n    client.prepare(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"INSERT INTO rss_by_user (login , rss_link ) VALUES ( ?, ?);\\\"\"), \", insertNewLinkForUserPrepFuture);\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" insertNewLinkForUserPrepFuture.compose(preparedStatement -> {\\n        insertNewLinkForUser = preparedStatement;\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture();\\n    });\\n}\\n\")), mdx(\"p\", null, \"Also, we should not for\\xADget to fetch a RSS by the link sent to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FetchVerticle\"), \" via the Event Bus. We can do it in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FetchVerticle#startFetchEventBusConsumer\"), \" method:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"vertx.eventBus().localConsumer(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"fetch.rss.link\\\"\"), \", message -> {\\n    String rssLink = (String) message.body();\\n    log.info(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"fetching \\\"\"), \" + rssLink);\\n    webClient.getAbs(rssLink).send(response -> {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (response.succeeded()) {\\n            String bodyAsString = response.result().bodyAsString(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"UTF-8\\\"\"), \");\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"try\"), \" {\\n                RssChannel rssChannel = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" RssChannel(bodyAsString);\\n\\n                BatchStatement batchStatement = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" BatchStatement();\\n                BoundStatement channelInfoInsertQuery = insertChannelInfo.bind(\\n                        rssLink, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" Date(System.currentTimeMillis()), rssChannel.description, rssChannel.link, rssChannel.title\\n                );\\n                batchStatement.add(channelInfoInsertQuery);\\n\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"for\"), \" (Article article : rssChannel.articles) {\\n                    batchStatement.add(insertArticleInfo.bind(rssLink, article.pubDate, article.link, article.description, article.title));\\n                }\\n                Future<ResultSet> insertArticlesFuture = Future.future();\\n                cassandraClient.execute(batchStatement, insertArticlesFuture);\\n\\n                insertArticlesFuture.compose(insertDone -> Future.succeededFuture());\\n            } \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"catch\"), \" (Exception e) {\\n                log.error(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Unable to fetch: \\\"\"), \" + rssLink, e);\\n            }\\n        } \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"else\"), \" {\\n            log.error(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Unable to fetch: \\\"\"), \" + rssLink);\\n        }\\n    });\\n});\\n\")), mdx(\"p\", null, \"And, fi\\xADnally, this code would not work if \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"insertChannelInfo\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"insertArticleInfo\"), \" state\\xADments will not be ini\\xADtial\\xADized at ver\\xADti\\xADcle start. Let\\u2019s to this in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FetchVerticle#prepareNecessaryQueries\"), \" method:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" Future<Void> \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"prepareNecessaryQueries\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"()\"), \" \"), \"{\\n        Future<PreparedStatement> insertChannelInfoPrepFuture = Future.future();\\n        cassandraClient.prepare(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"INSERT INTO channel_info_by_rss_link ( rss_link , last_fetch_time, description , site_link , title ) VALUES (?, ?, ?, ?, ?);\\\"\"), \", insertChannelInfoPrepFuture);\\n\\n        Future<PreparedStatement> insertArticleInfoPrepFuture = Future.future();\\n        cassandraClient.prepare(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"INSERT INTO articles_by_rss_link ( rss_link , pubdate , article_link , description , title ) VALUES ( ?, ?, ?, ?, ?);\\\"\"), \", insertArticleInfoPrepFuture);\\n\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" CompositeFuture.all(\\n                insertChannelInfoPrepFuture.compose(preparedStatement -> {\\n                    insertChannelInfo = preparedStatement;\\n                    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture();\\n                }), insertArticleInfoPrepFuture.compose(preparedStatement -> {\\n                    insertArticleInfo = preparedStatement;\\n                    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" Future.succeededFuture();\\n                })\\n        ).mapEmpty();\\n    }\\n\")), mdx(\"h2\", {\n    \"id\": \"observing\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#observing\"\n  })), \"Observing\"), mdx(\"p\", null, \"After all these changes, you should en\\xADsure that the first end\\xADpoint is work\\xADing cor\\xADrectly. You need to run the ap\\xADpli\\xADca\\xADtion, go to lo\\xADcal\\xADhost:8080 in\\xADsert a link to a rss feed there(\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://feeds.bbci.co.uk/news/uk/rss.xml\"\n  }), \"BBC UK feed news\"), \" for ex\\xADam\\xADple) and then click the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ENTER\"), \" but\\xADton. Now you can con\\xADnect to your local Cas\\xADsan\\xADdra in\\xADstance, for in\\xADstance with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.datastax.com/en/cql/3.3/cql/cql_reference/cqlsh.html\"\n  }), \"cqlsh\"), \", and find out how RSS feed data had been saved in the rss_reader key\\xADspace:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-sql\"\n  }), \"cqlsh> \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"SELECT\"), \" * \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"FROM\"), \" rss_reader.rss_by_user \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"limit\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1\"), \"  ;\\n\\n login | rss_link\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"-------+-----------------------------------------\"), \"\\n Pavel | http://feeds.bbci.co.uk/news/uk/rss.xml\\n\\n(1 rows)\\ncqlsh> \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"SELECT\"), \" description \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"FROM\"), \" rss_reader.articles_by_rss_link  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"limit\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1\"), \";\\n\\n description\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"-------------------------------------\"), \"\\n BBC coverage of latest developments\\n\\n(1 rows)\\n\")), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"In this ar\\xADti\\xADcle we fig\\xADured out how to im\\xADple\\xADment the first end\\xADpoint of RSS-\\u200Breader app. If you have any prob\\xADlems with com\\xADplet\\xADing this step you can check\\xADout to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"step_2\"), \", where you can find all changes made for com\\xADplet\\xADing this step:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-better-shell\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"$\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"bash\"\n  }), \" git checkout step_2\"), \"\\n\")), mdx(\"p\", null, \"Thanks for read\\xADing this. I hope you en\\xADjoyed read\\xADing this ar\\xADti\\xADcle. See you soon on our \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gitter.im/eclipse-vertx/vertx-users\"\n  }), \"Git\\xADter chan\\xADnel\"), \"!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>This tu­to­r­ial is ded­i­cated for users who’d like to know how to use the Eclipse Vert.x Cas­san­dra client in prac­tice.</p><h2 id=\"before-you-start-this-tutorial\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#before-you-start-this-tutorial\"></a>Before you start this tutorial</h2><p>Be­fore start­ing, you should</p><ul><li><p>be fa­mil­iar with <a href=\"/\">Eclipse Vert.x</a>. If you are not, here is the <a href=\"/docs/guide-for-java-devs/\">guide for Java de­vel­op­ers</a>.</p></li><li><p>have some basic un­der­stand­ing of data­bases. Ex­tended knowl­edge of Cas­san­dra is not re­quired.</p></li></ul><p>You also may find it use­ful to read <a href=\"https://validator.w3.org/feed/docs/rss2.html\">the RSS 2.0</a> spec­i­fi­ca­tion, be­cause the re­sulted app is, ba­si­cally, a stor­age of RSS 2.0 feeds.</p><p>To give you an idea of what the App is about, here is how it looks like from the fronted side:</p><p><img src=\"https://i.imgur.com/2V954zx.png\" alt=\"see how it looks\"/></p><p>In the image, we see that browser space is split into 2 parts:</p><ol><li>Saved feed names</li><li>List of ar­ti­cles for the se­lected feed</li></ol><p>Here you also can enter a link to a new feed, so the App will fetch and parse the feed.\nAfter that, it will ap­pear in the left col­umn along with other saved feeds.</p><h2 id=\"requirements\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#requirements\"></a>Requirements</h2><p>For com­plet­ing this tu­to­r­ial you need:</p><ul><li>Java 8 or higher</li><li>Git</li><li>1 hour of your time</li><li>You fa­vorite code ed­i­tor</li></ul><p>For run­ning the ex­am­ple you should en­sure that Cas­san­dra ser­vice is run­ning lo­cally on port 9042.\nAs an op­tion, you can run Cas­san­dra with <a href=\"https://github.com/riptano/ccm#installation\">ccm</a>(Cas­san­dra Clus­ter Man­ager).\nFol­low <a href=\"https://github.com/riptano/ccm#installation\">this</a> in­struc­tions for in­stalling ccm.\nAfter in­stalling you will be able to run a sin­gle node clus­ter:</p><pre><code class=\"hljs language-better-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> ccm create rss_reader -v 3.11.2 -n 1 -s</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> ccm start</span>\n</code></pre><p>Be­fore com­plet­ing this step make sure that you have suc­cess­fully cloned the RSS reader repos­i­tory and checked out the <code>step_1</code> branch:</p><pre><code class=\"hljs language-better-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> git <span class=\"hljs-built_in\">clone</span> https://github.com/Sammers21/rss-reader</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">cd</span> rss-reader</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> git checkout step_1</span>\n</code></pre><p>Now you can try to tun this ex­am­ple and see if it works:</p><pre><code class=\"hljs language-better-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> ./gradlew vertxRun</span>\n</code></pre><h2 id=\"schema\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#schema\"></a>Schema</h2><p>If you are fa­mil­iar with <a href=\"http://cassandra.apache.org/\">Apache Cas­san­dra</a>, you\nshould know that the way your data is stored in Cas­san­dra is de­pen­dent on queries\nyou are run­ning. It means that you need first to fig­ure out what kind of queries\nyou will be run­ning, and then you can pro­duce a stor­age scheme.</p><p>In our case, we’d like our ap­pli­ca­tion to have 3 end­points:</p><ol><li><code>POST /user/{user_id}/rss_link</code> - for adding links to a user’s feed</li><li><code>GET /user/{user_id}/rss_channels</code> - for re­triev­ing in­for­ma­tion about RSS chan­nels a user sub­scribed on</li><li><code>GET /articles/by_rss_link?link={rss_link}</code> - for re­triev­ing in­for­ma­tion about ar­ti­cles on a spe­cific RSS chan­nel</li></ol><p>For im­ple­ment­ing this end­points, the schema should look as fol­lows:</p><pre><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> rss_by_user (login <span class=\"hljs-built_in\">text</span> , rss_link <span class=\"hljs-built_in\">text</span>, PRIMARY <span class=\"hljs-keyword\">KEY</span> (login, rss_link));\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> articles_by_rss_link(rss_link <span class=\"hljs-built_in\">text</span>, pubDate <span class=\"hljs-built_in\">timestamp</span>, title <span class=\"hljs-built_in\">text</span>, article_link <span class=\"hljs-built_in\">text</span>, description <span class=\"hljs-built_in\">text</span>, PRIMARY <span class=\"hljs-keyword\">KEY</span> ( rss_link , pubDate , article_link));\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> channel_info_by_rss_link(rss_link <span class=\"hljs-built_in\">text</span>, last_fetch_time <span class=\"hljs-built_in\">timestamp</span>,title <span class=\"hljs-built_in\">text</span>, site_link <span class=\"hljs-built_in\">text</span>, description <span class=\"hljs-built_in\">text</span>, PRIMARY <span class=\"hljs-keyword\">KEY</span>(rss_link));\n</code></pre><h2 id=\"what-to-do-in-this-step\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#what-to-do-in-this-step\"></a>What to do in this step</h2><p>In this step, we will im­ple­ment only the first end­point</p><h2 id=\"project-overview\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#project-overview\"></a>Project overview</h2><p>There are two no­table classes in the project: <code>AppVerticle</code> and <code>FetchVerticle</code>. The first one is a <a href=\"/docs/vertx-core/java/#_verticles\">Ver­ti­cle</a> re­spon­si­ble for HTTP re­quest han­dling and stor­age schema ini­tial­iza­tion. The sec­ond one is a <a href=\"/docs/vertx-core/java/#_verticles\">Ver­ti­cle</a> as well, but re­spon­si­ble for RSS feeds fetch­ing.</p><p>The idea is sim­ple. When the ap­pli­ca­tion is start­ing the <code>AppVerticle</code> is de­ployed, then it tries to ini­tial­ize stor­age schema, de­scribed in <code>src/main/resources/schema.cql</code> file by read­ing it and ex­e­cut­ing listed queries line by line. After the schema ini­tial­iza­tion the <code>AppVerticle</code> de­ploys <code>FetchVerticle</code> and starts a HTTP server.</p><h2 id=\"implementing-the-endpoint\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#implementing-the-endpoint\"></a>Implementing the endpoint</h2><p>Now, it is time to im­ple­ment the first end­point. Pay at­ten­tion to <code>TODO</code>s, they are for point­ing you out about where changes should be made.</p><p>Now, let’s have a look at the <code>AppVerticle#postRssLink</code> method. This method is called each time the first end­point is called, so we can fig­ure out what is the posted body and id of the user, who per­formed the re­quest, di­rectly there. There are 2 main things we want to do in this method:</p><ol><li>No­ti­fy­ing via the <a href=\"/docs/vertx-core/java/#event_bus\">Event Bus</a> the <code>FetchVerticle</code> to fetch given by user link link to an RSS feed.</li><li>In­sert­ing an entry to the <code>rss_by_user</code> table.</li></ol><p>This is how the <code>AppVerticle#postRssLink</code> method should be im­ple­mented:</p><pre><code class=\"hljs language-java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postRssLink</span><span class=\"hljs-params\">(RoutingContext ctx)</span> </span>{\n    ctx.request().bodyHandler(body -&gt; {\n        JsonObject bodyAsJson = body.toJsonObject();\n        String link = bodyAsJson.getString(<span class=\"hljs-string\">&quot;link&quot;</span>);\n        String userId = ctx.request().getParam(<span class=\"hljs-string\">&quot;user_id&quot;</span>);\n        <span class=\"hljs-keyword\">if</span> (link == <span class=\"hljs-keyword\">null</span> || userId == <span class=\"hljs-keyword\">null</span>) {\n            responseWithInvalidRequest(ctx);\n        } <span class=\"hljs-keyword\">else</span> {\n            vertx.eventBus().send(<span class=\"hljs-string\">&quot;fetch.rss.link&quot;</span>, link);\n            Future&lt;ResultSet&gt; future = Future.future();\n            BoundStatement query = insertNewLinkForUser.bind(userId, link);\n            client.execute(query, future);\n            future.setHandler(result -&gt; {\n                <span class=\"hljs-keyword\">if</span> (result.succeeded()) {\n                    ctx.response().end(<span class=\"hljs-keyword\">new</span> JsonObject().put(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-string\">&quot;The feed just added&quot;</span>).toString());\n                } <span class=\"hljs-keyword\">else</span> {\n                    ctx.response().setStatusCode(<span class=\"hljs-number\">400</span>).end(result.cause().getMessage());\n                }\n            });\n        }\n    });\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">responseWithInvalidRequest</span><span class=\"hljs-params\">(RoutingContext ctx)</span> </span>{\n    ctx.response()\n            .setStatusCode(<span class=\"hljs-number\">400</span>)\n            .putHeader(<span class=\"hljs-string\">&quot;content-type&quot;</span>, <span class=\"hljs-string\">&quot;application/json; charset=utf-8&quot;</span>)\n            .end(invalidRequest().toString());\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> JsonObject <span class=\"hljs-title\">invalidRequest</span><span class=\"hljs-params\">()</span> </span>{\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> JsonObject().put(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-string\">&quot;Invalid request&quot;</span>);\n}\n</code></pre><p>You may no­tice that <code>insertNewLinkForUser</code> is a <code>PreparedStatement</code>, and should be ini­tial­ized be­fore the <code>AppVerticle</code> start. Let’s do it in the <code>AppVerticle#prepareNecessaryQueries</code> method:</p><pre><code class=\"hljs language-java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> Future&lt;Void&gt; <span class=\"hljs-title\">prepareNecessaryQueries</span><span class=\"hljs-params\">()</span> </span>{\n    Future&lt;PreparedStatement&gt; insertNewLinkForUserPrepFuture = Future.future();\n    client.prepare(<span class=\"hljs-string\">&quot;INSERT INTO rss_by_user (login , rss_link ) VALUES ( ?, ?);&quot;</span>, insertNewLinkForUserPrepFuture);\n\n    <span class=\"hljs-keyword\">return</span> insertNewLinkForUserPrepFuture.compose(preparedStatement -&gt; {\n        insertNewLinkForUser = preparedStatement;\n        <span class=\"hljs-keyword\">return</span> Future.succeededFuture();\n    });\n}\n</code></pre><p>Also, we should not for­get to fetch a RSS by the link sent to <code>FetchVerticle</code> via the Event Bus. We can do it in the <code>FetchVerticle#startFetchEventBusConsumer</code> method:</p><pre><code class=\"hljs language-java\">vertx.eventBus().localConsumer(<span class=\"hljs-string\">&quot;fetch.rss.link&quot;</span>, message -&gt; {\n    String rssLink = (String) message.body();\n    log.info(<span class=\"hljs-string\">&quot;fetching &quot;</span> + rssLink);\n    webClient.getAbs(rssLink).send(response -&gt; {\n        <span class=\"hljs-keyword\">if</span> (response.succeeded()) {\n            String bodyAsString = response.result().bodyAsString(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>);\n            <span class=\"hljs-keyword\">try</span> {\n                RssChannel rssChannel = <span class=\"hljs-keyword\">new</span> RssChannel(bodyAsString);\n\n                BatchStatement batchStatement = <span class=\"hljs-keyword\">new</span> BatchStatement();\n                BoundStatement channelInfoInsertQuery = insertChannelInfo.bind(\n                        rssLink, <span class=\"hljs-keyword\">new</span> Date(System.currentTimeMillis()), rssChannel.description, rssChannel.link, rssChannel.title\n                );\n                batchStatement.add(channelInfoInsertQuery);\n\n                <span class=\"hljs-keyword\">for</span> (Article article : rssChannel.articles) {\n                    batchStatement.add(insertArticleInfo.bind(rssLink, article.pubDate, article.link, article.description, article.title));\n                }\n                Future&lt;ResultSet&gt; insertArticlesFuture = Future.future();\n                cassandraClient.execute(batchStatement, insertArticlesFuture);\n\n                insertArticlesFuture.compose(insertDone -&gt; Future.succeededFuture());\n            } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                log.error(<span class=\"hljs-string\">&quot;Unable to fetch: &quot;</span> + rssLink, e);\n            }\n        } <span class=\"hljs-keyword\">else</span> {\n            log.error(<span class=\"hljs-string\">&quot;Unable to fetch: &quot;</span> + rssLink);\n        }\n    });\n});\n</code></pre><p>And, fi­nally, this code would not work if <code>insertChannelInfo</code> and <code>insertArticleInfo</code> state­ments will not be ini­tial­ized at ver­ti­cle start. Let’s to this in the <code>FetchVerticle#prepareNecessaryQueries</code> method:</p><pre><code class=\"hljs language-java\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> Future&lt;Void&gt; <span class=\"hljs-title\">prepareNecessaryQueries</span><span class=\"hljs-params\">()</span> </span>{\n        Future&lt;PreparedStatement&gt; insertChannelInfoPrepFuture = Future.future();\n        cassandraClient.prepare(<span class=\"hljs-string\">&quot;INSERT INTO channel_info_by_rss_link ( rss_link , last_fetch_time, description , site_link , title ) VALUES (?, ?, ?, ?, ?);&quot;</span>, insertChannelInfoPrepFuture);\n\n        Future&lt;PreparedStatement&gt; insertArticleInfoPrepFuture = Future.future();\n        cassandraClient.prepare(<span class=\"hljs-string\">&quot;INSERT INTO articles_by_rss_link ( rss_link , pubdate , article_link , description , title ) VALUES ( ?, ?, ?, ?, ?);&quot;</span>, insertArticleInfoPrepFuture);\n\n        <span class=\"hljs-keyword\">return</span> CompositeFuture.all(\n                insertChannelInfoPrepFuture.compose(preparedStatement -&gt; {\n                    insertChannelInfo = preparedStatement;\n                    <span class=\"hljs-keyword\">return</span> Future.succeededFuture();\n                }), insertArticleInfoPrepFuture.compose(preparedStatement -&gt; {\n                    insertArticleInfo = preparedStatement;\n                    <span class=\"hljs-keyword\">return</span> Future.succeededFuture();\n                })\n        ).mapEmpty();\n    }\n</code></pre><h2 id=\"observing\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#observing\"></a>Observing</h2><p>After all these changes, you should en­sure that the first end­point is work­ing cor­rectly. You need to run the ap­pli­ca­tion, go to lo­cal­host:8080 in­sert a link to a rss feed there(<a href=\"http://feeds.bbci.co.uk/news/uk/rss.xml\">BBC UK feed news</a> for ex­am­ple) and then click the <em>ENTER</em> but­ton. Now you can con­nect to your local Cas­san­dra in­stance, for in­stance with <a href=\"https://docs.datastax.com/en/cql/3.3/cql/cql_reference/cqlsh.html\">cqlsh</a>, and find out how RSS feed data had been saved in the rss_reader key­space:</p><pre><code class=\"hljs language-sql\">cqlsh&gt; <span class=\"hljs-keyword\">SELECT</span> * <span class=\"hljs-keyword\">FROM</span> rss_reader.rss_by_user <span class=\"hljs-keyword\">limit</span> <span class=\"hljs-number\">1</span>  ;\n\n login | rss_link\n<span class=\"hljs-comment\">-------+-----------------------------------------</span>\n Pavel | http://feeds.bbci.co.uk/news/uk/rss.xml\n\n(1 rows)\ncqlsh&gt; <span class=\"hljs-keyword\">SELECT</span> description <span class=\"hljs-keyword\">FROM</span> rss_reader.articles_by_rss_link  <span class=\"hljs-keyword\">limit</span> <span class=\"hljs-number\">1</span>;\n\n description\n<span class=\"hljs-comment\">-------------------------------------</span>\n BBC coverage of latest developments\n\n(1 rows)\n</code></pre><h2 id=\"conclusion\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"></a>Conclusion</h2><p>In this ar­ti­cle we fig­ured out how to im­ple­ment the first end­point of RSS-​reader app. If you have any prob­lems with com­plet­ing this step you can check­out to <code>step_2</code>, where you can find all changes made for com­plet­ing this step:</p><pre><code class=\"hljs language-better-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> git checkout step_2</span>\n</code></pre><p>Thanks for read­ing this. I hope you en­joyed read­ing this ar­ti­cle. See you soon on our <a href=\"https://gitter.im/eclipse-vertx/vertx-users\">Git­ter chan­nel</a>!</p>","scope":{}}},"prevPost":{"meta":{"title":"The RSS reader tutorial (Step 2)","category":"guides","authors":[{"name":"Pavel Drankov","github_id":"Sammers21"}],"summary":"In this second installment of our Vert.x Cassandra Client tutorial, we will add an endpoint that produces an array of RSS channels for a given user ID."},"date":"2018-09-05","slug":"the-rss-reader-tutorial-step-2"},"nextPost":{"meta":{"title":"Eclipse Vert.x 3.5.3","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"We have just released Vert.x 3.5.3, a bug fix release of Vert.x 3.5.x."},"date":"2018-07-13","slug":"eclipse-vert-x-3-5-3"},"relatedPosts":[{"meta":{"title":"The RSS reader tutorial (Step 2)","category":"guides","authors":[{"name":"Pavel Drankov","github_id":"Sammers21"}],"summary":"In this second installment of our Vert.x Cassandra Client tutorial, we will add an endpoint that produces an array of RSS channels for a given user ID."},"date":"2018-09-05","slug":"the-rss-reader-tutorial-step-2"},{"meta":{"title":"Easy SSO for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x."},"date":"2020-03-16","slug":"easy-sso-for-vert-x-with-keycloak"},{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"}]},"__N_SSG":true}