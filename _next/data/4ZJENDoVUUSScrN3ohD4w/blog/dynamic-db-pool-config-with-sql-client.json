{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"Dynamic database pool configuration with Vert.x SQL Client","category":"guides","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"You will learn how to achieve dynamic database configuration of the Vert.x SQL Client pool"},"date":"2021-08-11","slug":"dynamic-db-pool-config-with-sql-client","readingTime":{"text":"2 min read","minutes":1.13,"time":67800,"words":226},"content":{"compiledSource":"var d=Object.defineProperty,m=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var c=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var p=(e,a,o)=>a in e?d(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,n=(e,a)=>{for(var o in a||(a={}))c.call(a,o)&&p(e,o,a[o]);if(s)for(var o of s(a))r.call(a,o)&&p(e,o,a[o]);return e},i=(e,a)=>m(e,h(a));var l=(e,a)=>{var o={};for(var t in e)c.call(e,t)&&a.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&s)for(var t of s(e))a.indexOf(t)<0&&r.call(e,t)&&(o[t]=e[t]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var t=o,{components:e}=t,a=l(t,[\"components\"]);return mdx(MDXLayout,i(n(n({},layoutProps),a),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Since Vert.x 4.1.1, the SQL Client pro\\xADvides con\\xADnec\\xADtion cre\\xADation load bal\\xADanc\\xADing.\"),mdx(\"p\",null,\"You can cre\\xADate a pool with a list of con\\xADnect op\\xADtions that the pool uses with a round robin pol\\xADicy when it needs to cre\\xADate a con\\xADnec\\xADtion.\"),mdx(\"pre\",null,mdx(\"code\",n({parentName:\"pre\"},{className:\"hljs language-java\"}),`List<PgConnectOptions> servers = getListOfServers();\n\nPgPool pool = PgPool.create(vertx, servers);\n`)),mdx(\"p\",null,\"Load bal\\xADanc\\xADing is ac\\xADtu\\xADally a helper in front of a more pow\\xADer\\xADful fea\\xADture:\"),mdx(\"pre\",null,mdx(\"code\",n({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-class\"}),mdx(\"span\",n({parentName:\"span\"},{className:\"hljs-keyword\"}),\"interface\"),\" \",mdx(\"span\",n({parentName:\"span\"},{className:\"hljs-title\"}),\"Pool\"),\" \"),`{\n  ....\n  `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-function\"}),\"Pool \",mdx(\"span\",n({parentName:\"span\"},{className:\"hljs-title\"}),\"connectionProvider\"),mdx(\"span\",n({parentName:\"span\"},{className:\"hljs-params\"}),\"(Function<Context, Future<SqlConnection>> provider)\")),`;\n  ....\n}\n`)),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"connectionProvider\"),\" is called by the pool when it needs to cre\\xADate a new con\\xADnec\\xADtion. Here is a triv\\xADial ex\\xADam\\xADple:\"),mdx(\"pre\",null,mdx(\"code\",n({parentName:\"pre\"},{className:\"hljs language-java\"}),\"ConnectionFactory factory = \",mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` PgDriver().connectionFactory(vertx, connectOptions);\npool.connectionProvider(ctx -> {\n  `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` factory.connect(ctx);\n});\n`)),mdx(\"p\",null,\"Since the provider is asyn\\xADchro\\xADnous, it can be used to pro\\xADvide dy\\xADnamic pool con\\xADfig\\xADu\\xADra\\xADtion.\"),mdx(\"pre\",null,mdx(\"code\",n({parentName:\"pre\"},{className:\"hljs language-java\"}),`pool.connectionProvider(ctx -> {\n  Future<PgConnectOptions> fut = retrieveOptions();\n  `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` fut.compose(connectOptions -> {\n    `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Do not forget to close later\"),`\n    ConnectionFactory factory = `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` PgDriver().connectionFactory(vertx, connectOptions);\n    `,mdx(\"span\",n({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` factory.connect(ctx);\n  });\n});\n`)),mdx(\"p\",null,`Im\\xADpor\\xADtant caveat: when the con\\xADnec\\xADtion fac\\xADtory be\\xADcomes use\\xADless (e.g be\\xADcause of a new con\\xADfig\\xADu\\xADra\\xADtion) it must be closed\nto re\\xADlease its re\\xADsources.`),mdx(\"p\",null,`The SQL client does not pro\\xADvide this fea\\xADture out of the box be\\xADcause of this caveat. It is dif\\xADfi\\xADcult to de\\xADter\\xADmine when\nthe fac\\xADto\\xADries need to be dis\\xADposed. In\\xADstead, we ex\\xADpose the `,mdx(\"inlineCode\",{parentName:\"p\"},\"connectionProvider\"),` to allow ap\\xADpli\\xADca\\xADtions to im\\xADple\\xADment it triv\\xADially since each\nap\\xADpli\\xADca\\xADtion knows best how and when to re\\xADlease the re\\xADsources.`))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 4.2.0.Beta1 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The first beta of the upcoming Vert.x 4.2 has just been released. We\n  consider it feature complete and invite the community to test it."},"date":"2021-08-25","slug":"eclipse-vertx-4-2-Beta1-released"},"nextPost":{"meta":{"title":"Eclipse Vert.x 4.1.2 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"Eclipse Vert.x version 4.1.2 has just been released. It fixes quite a few bugs that have been reported by the community and provides a couple of features"},"date":"2021-07-20","slug":"eclipse-vert-x-4-1-2"},"relatedPosts":[{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},{"meta":{"title":"Using the asynchronous SQL client","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Finally, back... This post is the fifth post of the introduction to vert.x blog series, after a not-that-small break. In this post we are going to see how we can use JDBC in a vert.x application."},"date":"2015-10-19","slug":"using-the-asynchronous-sql-client"},{"meta":{"title":"Building services and APIs with AMQP 1.0","category":"guides","authors":[{"name":"Jakub Scholz","github_id":"scholzj"}],"summary":"Microservices and APIs are everywhere. Everyone talks about them, presentation slides are full of them ... some people are actually even building them."},"date":"2017-01-25","slug":"building-services-and-apis-with-amqp-1-0"}]},"__N_SSG":true}