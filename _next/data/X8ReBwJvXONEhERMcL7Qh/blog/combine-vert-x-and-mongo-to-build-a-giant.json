{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"Combine vert.x and mongo to build a giant","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This blog post is part of the introduction to Vert.x series. We are now going to replace this JDBC client by the vertx-mongo-client, and thus connect to a Mongo database."},"date":"2015-11-30","slug":"combine-vert-x-and-mongo-to-build-a-giant","readingTime":{"text":"9 min read","minutes":8.995,"time":539700,"words":1799},"content":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      em: \"em\",\n      code: \"code\",\n      a: \"a\",\n      h2: \"h2\",\n      ol: \"ol\",\n      li: \"li\",\n      img: \"img\",\n      pre: \"pre\",\n      span: \"span\",\n      ul: \"ul\"\n    }, props.components), {Link, Alert} = _components;\n    if (!Alert) _missingMdxReference(\"Alert\", true);\n    if (!Link) _missingMdxReference(\"Link\", true);\n    return _jsxs(_Fragment, {\n      children: [_jsxs(_components.p, {\n        children: [\"This blog post is part of the \", _jsx(_components.em, {\n          children: \"in­tro­duc­tion to vert.x\"\n        }), \" se­ries. Last time, we have seen how we can use the \", _jsx(_components.code, {\n          children: \"vertx-jdbc-client\"\n        }), \" to con­nect to a data­base using a JDBC dri­ver. In this post, we are going to re­place this JDBC client by the \", _jsx(_components.code, {\n          children: \"vertx-mongo-client\"\n        }), \", and thus con­nect to a Mongo data­base.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"You don’t un­der­stand the title, check the \", _jsx(_components.a, {\n          href: \"https://www.mongodb.org\",\n          children: \"mon­goDB\"\n        }), \" web­site.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"But be­fore going fur­ther, let’s recap.\"\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"previously-in--introduction-to-vertx\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#previously-in--introduction-to-vertx\"\n        }), \"Previously in  ‘introduction to vert.x’\"]\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(Link, {\n            href: \"/blog/my-first-vert-x-3-application/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"first post\"\n            })\n          }), \" has de­scribed how to build a vert.x ap­pli­ca­tion with Maven and ex­e­cute unit tests.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(Link, {\n            href: \"/blog/vert-x-application-configuration/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"sec­ond post\"\n            })\n          }), \" has de­scribed how this ap­pli­ca­tion can be­come con­fig­urable.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(Link, {\n            href: \"/blog/some-rest-with-vert-x/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"third post\"\n            })\n          }), \" has in­tro­duced \", _jsx(Link, {\n            href: \"/docs/vertx-web/java/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"vertx-​web\"\n            })\n          }), \", and a small col­lec­tion man­age­ment ap­pli­ca­tion has been de­vel­oped. This ap­pli­ca­tion of­fers a REST API used by a HTML/JavaScript fron­tend.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(Link, {\n            href: \"/blog/unit-and-integration-tests/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"fourth post\"\n            })\n          }), \" has pre­sented how you can run in­te­gra­tion tests to en­sure the be­hav­ior of your ap­pli­ca­tion.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(Link, {\n            href: \"/blog/using-the-asynchronous-sql-client/\",\n            passHref: true,\n            children: _jsx(_components.a, {\n              href: \"\",\n              children: \"last post\"\n            })\n          }), \" has pre­sented how you can in­ter­act with a JDBC data­base using the vertx-​jdbc-client.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This post shows an­other client that lets you use Mon­goDB in a vert.x ap­pli­ca­tion. This client pro­vides an vert.x API to ac­cess asyn­chro­nously to the Mongo data­base. We won’t com­pare whether or not JDBC is su­pe­rior to Mongo, they have both pros and cons, and you should use the one that meet your re­quire­ments. Vert.x lets you choose, that’s the point.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The vertx-​mongo-client doc­u­men­ta­tion is avail­able \", _jsx(Link, {\n          href: \"/docs/vertx-mongo-client/java/\",\n          passHref: true,\n          children: _jsx(_components.a, {\n            href: \"\",\n            children: \"here\"\n          })\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The code de­vel­oped in this blog post is avail­able in the branch \", _jsx(_components.a, {\n          href: \"https://github.com/cescoffier/my-vertx-first-app/tree/post-6\",\n          children: \"post-6\"\n        }), \". Our start­ing point is the code from the \", _jsx(_components.a, {\n          href: \"https://github.com/cescoffier/my-vertx-first-app/tree/post-5\",\n          children: \"post-5 branch\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"asynchronous-data-access\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#asynchronous-data-access\"\n        }), \"Asynchronous data access\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"One of the vert.x char­ac­ter­is­tics is being asyn­chro­nous. With an asyn­chro­nous API, you don’t wait for a re­sult, but you are no­ti­fied when this re­sult is ready. Thanks to vert.x, this no­ti­fi­ca­tion hap­pens in the same thread (un­der­stand event loop) as the ini­tial re­quest:\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/images/blog/intro-series/async-data.png\",\n          alt: \"Asynchronous data access\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Your code (on the left) is going to in­voke the mongo client and pass a call­back that will be in­voked when the re­sult is avail­able. The in­vo­ca­tion to the mongo client is non block­ing and re­turns im­me­di­ately. The client is deal­ing with the mongo data­base and when the re­sult has been com­puted / re­trieved, it in­vokes the call­back in the same event loop as the re­quest.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This model is par­tic­u­larly pow­er­ful as it avoids the syn­chro­niza­tion pit­falls. In­deed, your code is only called by a sin­gle thread, no need to syn­chro­nize any­thing.\"\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"as-with-every-maven-project\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#as-with-every-maven-project\"\n        }), \"As with every Maven project…\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"… we need to up­date the \", _jsx(_components.code, {\n          children: \"pom.xml\"\n        }), \" file first.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"In the \", _jsx(_components.code, {\n          children: \"pom.xml\"\n        }), \" file, re­place the \", _jsx(_components.code, {\n          children: \"vertx-jdbc-client\"\n        }), \" by the \", _jsx(_components.code, {\n          children: \"vertx-mongo-client\"\n        }), \":\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"io.vertx\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"vertx-mongo-client\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"3.1.0\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Un­like JDBC where we were in­stan­ti­at­ing a data­base on the fly, here we need to ex­plic­itly starts a Mon­goDB server. In order to launch a Mongo server in our test, we are going to add an­other de­pen­dency:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"de.flapdoodle.embed\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"de.flapdoodle.embed.mongo\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"1.50.0\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"scope\"\n            }), \">\"]\n          }), \"test\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"scope\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"This de­pen­dency will be used in our unit tests, as it lets us start a mongo server pro­gram­mat­i­cally. For our in­te­gra­tion tests, we are going to use a Maven plug­in start­ing and stop­ping the mongo server be­fore and after our in­te­gra­tion tests. Add this plug­in to the \", _jsx(_components.code, {\n          children: \"<plugins/>\"\n        }), \" sec­tion of your \", _jsx(_components.code, {\n          children: \"pom.xml\"\n        }), \" file.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"plugin\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"com.github.joelittlejohn.embedmongo\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"embedmongo-maven-plugin\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"0.2.0\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"version\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"executions\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"execution\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"id\"\n            }), \">\"]\n          }), \"start\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"id\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goals\"\n            }), \">\"]\n          }), \"\\n        \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goal\"\n            }), \">\"]\n          }), \"start\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goal\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goals\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"configuration\"\n            }), \">\"]\n          }), \"\\n        \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"port\"\n            }), \">\"]\n          }), \"37017\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"port\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"configuration\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"execution\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"execution\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"id\"\n            }), \">\"]\n          }), \"stop\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"id\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goals\"\n            }), \">\"]\n          }), \"\\n        \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goal\"\n            }), \">\"]\n          }), \"stop\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goal\"\n            }), \">\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"goals\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"execution\"\n            }), \">\"]\n          }), \"\\n  \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"executions\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"plugin\"\n            }), \">\"]\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"No­tice the port we use here (37017), we will use this port later.\"\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"enough-xml-for-today\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#enough-xml-for-today\"\n        }), \"Enough XML for today\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Now that we have up­dated our \", _jsx(_components.code, {\n          children: \"pom.xml\"\n        }), \" file, it’s time to change our ver­ti­cle. The first thing to do is to re­place the jdbc client by the mongo client:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-java\",\n          children: \"mongo = MongoClient.createShared(vertx, config());\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This client is con­fig­ured with the con­fig­u­ra­tion given to the ver­ti­cle (more on this below).\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Once done, we need to change how we start the ap­pli­ca­tion. With the mongo client, no need to ac­quire a con­nec­tion, it han­dles this in­ter­nally. So our startup se­quence is a bit more sim­ple:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-java\",\n          children: \"createSomeData(\\n    (nothing) -> startWebApp(\\n        (http) -> completeStartup(http, fut)\\n    ), fut);\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"As in the pre­vi­ous post, we need to in­sert some pre­de­fined data if the data­base is empty:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"createSomeData\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(Handler<AsyncResult<Void>> next, Future<Void> fut)\"\n          }), \" {\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"Whisky\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"bowmore\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"Whisky\"\n          }), \"(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Bowmore 15 Years Laimrig\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Scotland, Islay\\\"\"\n          }), \");\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"Whisky\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"talisker\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"Whisky\"\n          }), \"(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Talisker 57° North\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Scotland, Island\\\"\"\n          }), \");\\n  System.out.println(bowmore.toJson());\\n  \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// Do we have data in the collection ?\"\n          }), \"\\n  mongo.count(COLLECTION, \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"(), count -> {\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (count.succeeded()) {\\n      \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (count.result() == \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"0\"\n          }), \") {\\n        \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// no whiskies, insert data\"\n          }), \"\\n        mongo.insert(COLLECTION, bowmore.toJson(), ar -> {\\n          \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (ar.failed()) {\\n            fut.fail(ar.cause());\\n          } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n            mongo.insert(COLLECTION, talisker.toJson(), ar2 -> {\\n              \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (ar2.failed()) {\\n                fut.failed();\\n              } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n                next.handle(Future.<Void>succeededFuture());\\n              }\\n            });\\n          }\\n        });\\n      } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n        next.handle(Future.<Void>succeededFuture());\\n      }\\n    } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n      \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// report the error\"\n          }), \"\\n      fut.fail(count.cause());\\n    }\\n  });\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To de­tect whether or not the data­base al­ready con­tains some data, we re­trieve the num­ber of \", _jsx(_components.em, {\n          children: \"doc­u­ments\"\n        }), \" from the \", _jsx(_components.code, {\n          children: \"whiskies\"\n        }), \" col­lec­tion. This is done with : \", _jsx(_components.code, {\n          children: \"mongo.count(COLLECTION, new JsonObject(), count -> {})\"\n        }), \". The sec­ond pa­ra­me­ter is the query. In our case, we want to count all doc­u­ments. This is done using \", _jsx(_components.code, {\n          children: \"new JsonObject()\"\n        }), \" that would cre­ate a query ac­cept­ing all doc­u­ments from the col­lec­tion (it’s equiv­a­lent to a \", _jsx(_components.code, {\n          children: \"SELECT * FROM ...\"\n        }), \").\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Also no­tice the \", _jsx(_components.code, {\n          children: \"insert\"\n        }), \" calls. Doc­u­ments are passed as JSON ob­ject, so to in­sert an ob­ject, just se­ri­al­ize it to JSON and use \", _jsx(_components.code, {\n          children: \"mongo.insert(COLLECTION, json, completion handler)\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"mongo-ize-the-rest-handlers\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#mongo-ize-the-rest-handlers\"\n        }), \"Mongo-ize the REST handlers\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Now that the ap­pli­ca­tion boot se­quence has been mi­grated to mongo, it’s time to up­date the code han­dling the REST re­quests.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Let’s start by the \", _jsx(_components.code, {\n          children: \"getAll\"\n        }), \" method that re­turns all stored prod­ucts. To im­ple­ment this, we use the \", _jsx(_components.code, {\n          children: \"find\"\n        }), \" method. As we saw for the \", _jsx(_components.code, {\n          children: \"count\"\n        }), \" method, we pass an empty json ob­ject to de­scribe a query ac­cept­ing all doc­u­ments:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"getAll\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext routingContext)\"\n          }), \" {\\n  mongo.find(COLLECTION, \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"(), results -> {\\n    List<JsonObject> objects = results.result();\\n    List<Whisky> whiskies = objects.stream().map(Whisky::\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \").collect(Collectors.toList());\\n    routingContext.response()\\n        .putHeader(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"content-type\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"application/json; charset=utf-8\\\"\"\n          }), \")\\n        .end(Json.encodePrettily(whiskies));\\n  });\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The query re­sults are passed as a list of JSON ob­jects. From this list we can cre­ate our prod­uct in­stances, and fill the HTTP re­sponse with this set.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To delete a spe­cific doc­u­ment we need to se­lect the doc­u­ment using its \", _jsx(_components.code, {\n          children: \"id\"\n        }), \":\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"deleteOne\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext routingContext)\"\n          }), \" {\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"String\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"id\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" routingContext.request().getParam(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"id\\\"\"\n          }), \");\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (id == \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \") {\\n    routingContext.response().setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"400\"\n          }), \").end();\\n  } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n    mongo.removeOne(COLLECTION, \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"().put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"_id\\\"\"\n          }), \", id),\\n        ar -> routingContext.response().setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"204\"\n          }), \").end());\\n  }\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"new JsonObject().put(\\\"_id\\\", id)\"\n        }), \" de­scribes a query se­lect­ing a sin­gle doc­u­ment (se­lected by its unique \", _jsx(_components.code, {\n          children: \"id\"\n        }), \", so it’s the equiv­a­lent to \", _jsx(_components.code, {\n          children: \"SELECT * WHERE id=...\"\n        }), \"). No­tice the \", _jsx(_components.code, {\n          children: \"_id\"\n        }), \" which is a mongo trick to se­lect a doc­u­ment by id.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Up­dat­ing a doc­u­ment is a less triv­ial:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"updateOne\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext routingContext)\"\n          }), \" {\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"final\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"String\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"id\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" routingContext.request().getParam(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"id\\\"\"\n          }), \");\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"JsonObject\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"json\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" routingContext.getBodyAsJson();\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (id == \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \" || json == \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \") {\\n    routingContext.response().setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"400\"\n          }), \").end();\\n  } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n    mongo.update(COLLECTION,\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"().put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"_id\\\"\"\n          }), \", id), \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// Select a unique document\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// The update syntax: {$set, the json object containing the fields to update}\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"()\\n            .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"$set\\\"\"\n          }), \", json),\\n        v -> {\\n          \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (v.failed()) {\\n            routingContext.response().setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"404\"\n          }), \").end();\\n          } \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"else\"\n          }), \" {\\n            routingContext.response()\\n                .putHeader(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"content-type\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"application/json; charset=utf-8\\\"\"\n          }), \")\\n                .end(Json.encodePrettily(\\n                  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"Whisky\"\n          }), \"(id, json.getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"name\\\"\"\n          }), \"),\\n                    json.getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"origin\\\"\"\n          }), \"))));\\n          }\\n        });\\n  }\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"As we can see, the \", _jsx(_components.code, {\n          children: \"update\"\n        }), \" method takes two JSON ob­jects as pa­ra­me­ter:\"]\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"The first one de­notes the query (here we se­lect a sin­gle doc­u­ment using its id).\"\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The sec­ond ob­ject ex­presses the change to apply to the se­lected doc­u­ment. It uses a mongo syn­tax. In our case, we up­date the doc­u­ment using the \", _jsx(_components.code, {\n            children: \"$set\"\n          }), \" op­er­a­tor.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(Alert, {\n        info: true,\n        children: _jsxs(_components.p, {\n          children: [\"In this code we up­date the doc­u­ment and re­place only a set of fields. You can also re­place the whole doc­u­ment using \", _jsx(_components.code, {\n            children: \"mongo.replace(...)\"\n          }), \".\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I def­i­nitely rec­om­mend to have a look to the Mon­goDB doc­u­men­ta­tion, es­pe­cially:\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: _jsx(_components.a, {\n            href: \"https://docs.mongodb.org/manual/tutorial/query-documents/\",\n            title: \"MongoDB Query Documentation\",\n            children: \"Query syn­tax doc­u­men­ta­tion\"\n          })\n        }), \"\\n\", _jsx(_components.li, {\n          children: _jsx(_components.a, {\n            href: \"https://docs.mongodb.org/manual/tutorial/modify-documents/\",\n            title: \"MongoDB Update Documentation\",\n            children: \"Up­date syn­tax doc­u­men­ta­tion\"\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"time-for-configuration\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#time-for-configuration\"\n        }), \"Time for configuration\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Well, the code is mi­grated, but we still need to up­date the con­fig­u­ra­tion. With JDBC we passed the JDBC url and the dri­ver class in the con­fig­u­ra­tion. With mongo, we need to con­fig­ure the \", _jsx(_components.code, {\n          children: \"connection_string\"\n        }), \" - the \", _jsx(_components.code, {\n          children: \"mongo://\"\n        }), \" url on which the ap­pli­ca­tion is con­nected, and \", _jsx(_components.code, {\n          children: \"db_name\"\n        }), \" - a name for the data source.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Let’s start by the unit test. Edit the \", _jsx(_components.code, {\n          children: \"MyFirstVerticleTest\"\n        }), \" file and add the fol­low­ing code:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"static\"\n          }), \" MongodProcess MONGO;\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"static\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"int\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"MONGO_PORT\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"12345\"\n          }), \";\\n\", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@BeforeClass\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"static\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"initialize\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"throws\"\n          }), \" IOException {\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"MongodStarter\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"starter\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" MongodStarter.getDefaultInstance();\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"IMongodConfig\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"mongodConfig\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"MongodConfigBuilder\"\n          }), \"()\\n      .version(Version.Main.PRODUCTION)\\n      .net(\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"Net\"\n          }), \"(MONGO_PORT, Network.localhostIsIPv6()))\\n      .build();\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"MongodExecutable\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"mongodExecutable\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \"\\n      starter.prepare(mongodConfig);\\n  MONGO = mongodExecutable.start();\\n}\\n\\n\", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@AfterClass\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"static\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"shutdown\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" {  MONGO.stop(); }\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Be­fore our tests, we start (pro­gram­mat­i­cally) a mongo data­base on the port 12345. When all our tests have been ex­e­cuted, we shut­down the data­base.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"So now that the mongo server is man­aged, we need to to give the right con­fig­u­ra­tion to our ver­ti­cle. Up­date the \", _jsx(_components.code, {\n          children: \"DeploymentOption\"\n        }), \" in­stance with:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"DeploymentOptions\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"options\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"DeploymentOptions\"\n          }), \"()\\n    .setConfig(\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"JsonObject\"\n          }), \"()\\n        .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"http.port\\\"\"\n          }), \", port)\\n        .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"db_name\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"whiskies-test\\\"\"\n          }), \")\\n        .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"connection_string\\\"\"\n          }), \",\\n            \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"mongodb://localhost:\\\"\"\n          }), \" + MONGO_PORT)\\n);\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"That’s all for the unit tests.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"For the integration-​test, we are using an ex­ter­nal­ized json file. Edit the \", _jsx(_components.code, {\n          children: \"src/test/resources/my-it-config.json\"\n        }), \" with the fol­low­ing con­tent:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"http.port\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" $\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"http.port\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"db_name\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"whiskies-it\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"connection_string\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"mongodb://localhost:37017\\\"\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"No­tice the port we are using for the mongo server. This port was con­fig­ured in the \", _jsx(_components.code, {\n          children: \"pom.xml\"\n        }), \" file.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Last but not least, we still have a con­fig­u­ra­tion file to edit: the con­fig­u­ra­tion you use to launch the ap­pli­ca­tion in \", _jsx(_components.code, {\n          children: \"production\"\n        }), \":\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"http.port\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"8082\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"db_name\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"whiskies\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"connection_string\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"mongodb://localhost:27017\\\"\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Here you would need to edit the \", _jsx(_components.code, {\n          children: \"localhost:27017\"\n        }), \" with the right url for your mongo server.\"]\n      }), \"\\n\", _jsx(Alert, {\n        info: true,\n        title: \"Some changes in the integration tests\",\n        children: _jsx(_components.p, {\n          children: \"Be­cause mongo doc­u­ment id are String and not in­te­ger, we have to slightly change doc­u­ment se­lec­tion in the in­te­gra­tion test.\"\n        })\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"time-for-a-run\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#time-for-a-run\"\n        }), \"Time for a run\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"It’s time to pack­age and run the ap­pli­ca­tion and check that every­thing works as ex­pected. Let’s pack­age the ap­pli­ca­tion using:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-text\",\n          children: \"mvn clean verify\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"And then to launch it, start your mongo server and launch:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-text\",\n          children: \"java -jar target/my-first-app-1.0-SNAPSHOT-fat.jar \\\\\\n  -conf src/main/conf/my-application-conf.json\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"If you are, like me, using docker / docker-​machine for al­most every­thing, edit the con­fig­u­ra­tion file to refer to the right host (lo­cal­host for docker, the docker-​machine ip if you use docker-​machine) and then launch:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"docker run -d -p 27017:27017 mongo\\njava -jar target/my-first-app-1.0-SNAPSHOT-fat.jar \\\\\\n  -conf src/main/conf/my-application-conf.json\\n\", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"# or\"\n          }), \"\\njava -jar target/my-first-app-1.0-SNAPSHOT-fat.jar \\\\\\n  -conf src/main/conf/my-application-conf-docker-machine.json\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/images/blog/intro-series/whisky-mongo.png\",\n          alt: \"The application live and running\"\n        })\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"thats-all-folks\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#thats-all-folks\"\n        }), \"That’s all folks!\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"We are reach­ing the end of this post. We saw how you can use the vert-​mongo-client to ac­cess asyn­chro­nously data stored in­side a mongo data­base as well as in­sert­ing/up­dat­ing this data. Now you have the choice be­tween JDBC or Mongo. In ad­di­tion, vert.x pro­vides a client for Redis.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Next time, we will see how the ver­ti­cle class can be split in two ver­ti­cles in order to bet­ter or­ga­nize your code. The in­ter­ac­tion be­tween the two ver­ti­cles will uses \", _jsx(_components.em, {\n          children: \"ser­vices\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Stay tuned & Happy cod­ing!\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n"},"prevPost":{"meta":{"title":"Vert.x 3.2.0 is released!","category":"releases","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"We are pleased to announce the release of Vert.x 3.2.0!"},"date":"2015-12-15","slug":"vert-x-3-2-0-is-released"},"nextPost":{"meta":{"title":"Vert.x ES6 back to the future","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"On October 21th, 2015 we all rejoiced with the return from the past of Marty McFly with his flying car and so on, however in the Vert.x world we were quite sad about our rather old JavaScript support."},"date":"2015-11-25","slug":"vert-x-es6-back-to-the-future"},"relatedPosts":[{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},{"meta":{"title":"Using the asynchronous SQL client","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Finally, back... This post is the fifth post of the introduction to vert.x blog series, after a not-that-small break. In this post we are going to see how we can use JDBC in a vert.x application."},"date":"2015-10-19","slug":"using-the-asynchronous-sql-client"},{"meta":{"title":"My first Vert.x 3 Application","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let's say, you heard someone saying that Vert.x is awesome. Ok great, but you may want to try it by yourself. Well, the next natural question is “where do I start ?”"},"date":"2015-07-14","slug":"my-first-vert-x-3-application"}]},"__N_SSG":true}