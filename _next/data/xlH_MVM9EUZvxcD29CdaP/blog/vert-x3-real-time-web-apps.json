{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"Vert.x 3 real time web apps","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"One of the interesting features of Vert.x is the SockJS event bus bridge. It allows external applications to communicate with Vert.x event bus using Websockets."},"date":"2015-08-31","slug":"vert-x3-real-time-web-apps","readingTime":{"text":"7 min read","minutes":6.975,"time":418500,"words":1395},"content":{"compiledSource":"var m=Object.defineProperty,d=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;var l=(a,s,n)=>s in a?m(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,e=(a,s)=>{for(var n in s||(s={}))r.call(s,n)&&l(a,n,s[n]);if(p)for(var n of p(s))o.call(s,n)&&l(a,n,s[n]);return a},i=(a,s)=>d(a,N(s));var c=(a,s)=>{var n={};for(var t in a)r.call(a,t)&&s.indexOf(t)<0&&(n[t]=a[t]);if(a!=null&&p)for(var t of p(a))s.indexOf(t)<0&&o.call(a,t)&&(n[t]=a[t]);return n};const makeShortcode=a=>function(n){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},n))},Link=makeShortcode(\"Link\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var t=n,{components:a}=t,s=c(t,[\"components\"]);return mdx(MDXLayout,i(e(e({},layoutProps),s),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"One of the in\\xADter\\xADest\\xADing fea\\xADtures of Vert.x is the \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://sockjs.org\"}),\"SockJS\"),` event bus bridge. This piece of soft\\xADware\nal\\xADlows ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtions to com\\xADmu\\xADni\\xADcate with Vert.x event bus using Web\\xADsock\\xADets and if your browser does not\nsup\\xADport it then it grace\\xADfully de\\xADgrades to pool\\xADing AJAX calls.`),mdx(\"p\",null,`Web\\xADSock\\xADets bring a new level of in\\xADter\\xADac\\xADtion to the web, they re\\xADally bring real time to web ap\\xADpli\\xADca\\xADtions due to the\nfact that its com\\xADmu\\xADni\\xADca\\xADtion model is bi-\\u200Bdirectional in con\\xADtrast to the tra\\xADdi\\xADtional HTTP model where a client can\nini\\xADti\\xADate a data re\\xADquest to a server but not the other way around.`),mdx(\"p\",null,`In this small post I will demon\\xADstrate how you can cre\\xADate a sim\\xADple col\\xADlab\\xADo\\xADra\\xADtive draw\\xADing app. The idea is sim\\xADple, all\nusers that open the app will be be pre\\xADsented with a empty can\\xADvas and what they draw or is drawn on other can\\xADvas is\nshared in real time on their screen.`),mdx(\"p\",null,`For the sake of sim\\xADplic\\xADity and mak\\xADing this post light there is no se\\xADcu\\xADrity in\\xADvolved so, every\\xADone is free to lis\\xADten to\nwhat is being drawn, how\\xADever the ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtion has lim\\xADited read write ac\\xADcess to a sin\\xADgle ad\\xADdress on Vert.x\nevent bus, en\\xADsur\\xADing that other ser\\xADvices run\\xADning on the clus\\xADter will not be ex\\xADposed.`),mdx(\"p\",null,\"This is what you should ex\\xADpect to see:\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/images/blog/vertx3-realtime-webapps/screencast.gif\",alt:\"Screencast\"}))),mdx(\"h2\",e({},{id:\"bootstrap-a-project\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#bootstrap-a-project\"})),\"Bootstrap a project\"),mdx(\"p\",null,\"If you fol\\xADlowed the pre\\xADvi\\xADous \",mdx(Link,{href:\"/blog/my-first-vert-x-3-application/\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"se\\xADries\")),` on Vert.x de\\xADvel\\xADop\\xADment, you saw\nthat Java and Maven were the main topic, since Vert.x is poly\\xADglot I will focus on JavaScript and\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.npmjs.com/\"}),\"NPM\"),\" as my pro\\xADgram\\xADming lan\\xADguage and pack\\xADage man\\xADage\\xADment tool.\"),mdx(\"p\",null,\"With NPM start by cre\\xADat\\xADing a \",mdx(\"inlineCode\",{parentName:\"p\"},\"package.json\"),\", in order to do this we should run:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`npm init\n`)),mdx(\"p\",null,\"This will present a se\\xADlec\\xADtion of ques\\xADtions and in the end you should have a basic \",mdx(\"inlineCode\",{parentName:\"p\"},\"package.json\"),` file. This\ncon\\xADfig\\xADu\\xADra\\xADtion is very basic so you need to add a `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.npmjs.com/package/vertx3-full\"}),\"de\\xADpen\\xADdency\"),` to Vert.x so\nyou can run the ap\\xADpli\\xADca\\xADtion. You can add it to the `,mdx(\"inlineCode\",{parentName:\"p\"},\"dependencies\"),\" prop\\xADerty and it should look more or less like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-javascript\"}),`{\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"name\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"draw\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"private\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"true\"),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"dependencies\"'),`: {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx3-full\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"3.0.0-1\"'),`\n  },\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"scripts\"'),`: {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"start\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx run server.js\"'),`\n  },\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"version\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"1.0.0\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"main\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"server.js\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"devDependencies\"'),`: {},\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"author\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"license\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"ISC\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"description\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"A Real Time Drawing App\"'),`\n}\n`)),mdx(\"p\",null,\"If you do not know why there is the de\\xADpen\\xADdency on \",mdx(\"inlineCode\",{parentName:\"p\"},\"vertx3-full\"),\" or why the added \",mdx(\"inlineCode\",{parentName:\"p\"},\"scripts\"),\" prop\\xADerty please check the \",mdx(Link,{href:\"/blog/vert-x3-says-hello-to-npm-users/\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"older\")),\" blog post about it.\"),mdx(\"h2\",e({},{id:\"project-structure\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#project-structure\"})),\"Project Structure\"),mdx(\"p\",null,`This post has no pref\\xADer\\xADence over project struc\\xADture, so if you do not agree with the struc\\xADture used here feel free to\nuse what you feel best. For this ex\\xADam\\xADple I will keep it to:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-text\"}),`\\u251C\\u2500\\u2500 package.json\n\\u251C\\u2500\\u2500 server.js\n\\u2514\\u2500\\u2500 webroot\n  \\u251C\\u2500\\u2500 assets\n  \\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 js\n  \\u2502\\xA0\\xA0   \\u251C\\u2500\\u2500 script.js\n  \\u2502\\xA0\\xA0   \\u2514\\u2500\\u2500 vertxbus.js\n  \\u2514\\u2500\\u2500 index.html\n\n3 directories, 5 files\n`)),mdx(\"p\",null,\"As you can imag\\xADine \",mdx(\"inlineCode\",{parentName:\"p\"},\"server.js\"),\" will be our Vert.x ap\\xADpli\\xADca\\xADtion and every\\xADthing under \",mdx(\"inlineCode\",{parentName:\"p\"},\"webroot\"),` will be the client\nap\\xADpli\\xADca\\xADtion.`),mdx(\"p\",null,`The client ap\\xADpli\\xADca\\xADtion is not re\\xADally Vert.x spe\\xADcific and could in the\\xADory be used by any other frame\\xADwork so I will go\nlightly over its code.`),mdx(\"h3\",e({},{id:\"client-application\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#client-application\"})),\"Client Application\"),mdx(\"p\",null,\"Our ap\\xADpli\\xADca\\xADtion main entry point is as one can ex\\xADpect \",mdx(\"inlineCode\",{parentName:\"p\"},\"index.html\"),\". In the index file de\\xADfine the fol\\xADlow\\xADing HTML:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-html\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-meta\"}),\"<!DOCTYPE \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-meta-keyword\"}),\"html\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"html\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"head\"),\">\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"meta\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"charset\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"utf-8\"'),\"/>\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"title\"),\">\"),\"Real time drawing App\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"title\"),\">\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),`<!--[if lt IE 9]>\n  <script src=\"http://html5shiv.googlecode.com/svn/trunk/html5.js\"><\\/script>\n  <![endif]-->`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"head\"),\">\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"body\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"canvas\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"id\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"paper\"'),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"width\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"1900\"'),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"height\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"1000\"'),\">\"),`\n  Your browser needs to support canvas for this to work!\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"canvas\"),\">\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"<!-- JavaScript includes. -->\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"src\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"http://code.jquery.com/jquery-1.8.0.min.js\"'),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"src\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js\"'),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"src\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),\"'assets/js/vertxbus.js'\"),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"<\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-attr\"}),\"src\"),\"=\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-string\"}),'\"assets/js/script.js\"'),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"script\"),\">\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"body\"),\">\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"</\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"html\"),\">\"),`\n`)),mdx(\"p\",null,`As I pre\\xADvi\\xADously wrote, the idea is to keep it as sim\\xADple as pos\\xADsi\\xADble so it is all about hav\\xADing a can\\xADvas el\\xADe\\xADment and a\nap\\xADpli\\xADca\\xADtion main script `,mdx(\"inlineCode\",{parentName:\"p\"},\"script.js\"),`. All the rest are files served by CDNs that pro\\xADvide com\\xADmon web ap\\xADpli\\xADca\\xADtion\nli\\xADbraries such as `,mdx(\"inlineCode\",{parentName:\"p\"},\"jQuery\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"HTML5\"),\" shim for older browsers, \",mdx(\"inlineCode\",{parentName:\"p\"},\"SockJS\"),\" client and \",mdx(\"inlineCode\",{parentName:\"p\"},\"vertxbus\"),\" bridge.\"),mdx(\"p\",null,\"The main code is on \",mdx(\"inlineCode\",{parentName:\"p\"},\"script.js\"),\" file:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-javascript\"}),\"$(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"})),\") \"),`{\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// This demo depends on the canvas element\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" (!(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'getContext'\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"in\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"document\"),\".createElement(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'canvas'\"),`))) {\n    alert(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'Sorry, it looks like your browser does not support canvas!'\"),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"false\"),`;\n  }\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" doc = $(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"document\"),`),\n    canvas = $(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'#paper'\"),`),\n    ctx = canvas[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),\"].getContext(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'2d'\"),`);\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Generate an unique ID\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" id = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),\".round($.now() * \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),`.random());\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// A flag for drawing activity\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" drawing = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"false\"),`;\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` clients = {};\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// create a event bus bridge to the server that served this file\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" eb = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` vertx.EventBus(\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"window\"),\".location.protocol + \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'//'\"),\" + \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"window\"),\".location.hostname + \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"':'\"),\" + \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"window\"),\".location.port + \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'/eventbus'\"),`);\n\n  eb.onopen = `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"})),\") \"),`{\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// listen to draw events\"),`\n    eb.registerHandler(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'draw'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"data\"),\") \"),`{\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Is the user drawing?\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (data.drawing && clients[data.id]) {\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Draw a line on the canvas. clients[data.id] holds\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// the previous position of this user's mouse pointer\"),`\n\n        drawLine(clients[data.id].x, clients[data.id].y, data.x, data.y);\n      }\n\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Saving the current client state\"),`\n      clients[data.id] = data;\n      clients[data.id].updated = $.now();\n    });\n  };\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` prev = {};\n\n  canvas.on(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'mousedown'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"e\"),\") \"),`{\n    e.preventDefault();\n    drawing = `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"true\"),`;\n    prev.x = e.pageX;\n    prev.y = e.pageY;\n  });\n\n  doc.bind(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'mouseup mouseleave'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"})),\") \"),`{\n    drawing = `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"false\"),`;\n  });\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` lastEmit = $.now();\n\n  doc.on(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'mousemove'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"e\"),\") \"),`{\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" ($.now() - lastEmit > \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"30\"),`) {\n      eb.publish(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'draw'\"),`, {\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'x'\"),`: e.pageX,\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'y'\"),`: e.pageY,\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'drawing'\"),`: drawing,\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'id'\"),`: id\n      });\n      lastEmit = $.now();\n    }\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Draw a line for the current user's movement, as it is\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// not received in the eventbus\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (drawing) {\n\n      drawLine(prev.x, prev.y, e.pageX, e.pageY);\n\n      prev.x = e.pageX;\n      prev.y = e.pageY;\n    }\n  });\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Remove inactive clients after 10 seconds of inactivity\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"setInterval\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" (\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"})),\") \"),`{\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"for\"),\" (\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" ident \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"in\"),` clients) {\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (clients.hasOwnProperty(ident)) {\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" ($.now() - clients[ident].updated > \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"10000\"),`) {\n          `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Last update was more than 10 seconds ago.\"),`\n          `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// This user has probably closed the page\"),`\n          `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"delete\"),` clients[ident];\n        }\n      }\n    }\n\n  }, `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"10000\"),`);\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"drawLine\"),\"(\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"fromx, fromy, tox, toy\"),\") \"),`{\n    ctx.moveTo(fromx, fromy);\n    ctx.lineTo(tox, toy);\n    ctx.stroke();\n  }\n\n});\n`)),mdx(\"p\",null,\"The most im\\xADpor\\xADtant part in this code is all the code re\\xADlated to \",mdx(\"inlineCode\",{parentName:\"p\"},\"eb\"),\". The vari\\xADable \",mdx(\"inlineCode\",{parentName:\"p\"},\"eb\"),` is our bridge to the event\nbus, Start by cre\\xADat\\xADing a bridge using the `,mdx(\"inlineCode\",{parentName:\"p\"},\"vertx.EventBus\"),` ob\\xADject and de\\xADfine where to con\\xADnect, using the de\\xADtails\nof the cur\\xADrent win\\xADdow lo\\xADca\\xADtion.`),mdx(\"p\",null,\"Then add a \",mdx(\"inlineCode\",{parentName:\"p\"},\"onopen\"),\" lis\\xADtener that will sub\\xADscribe to the ad\\xADdress \",mdx(\"inlineCode\",{parentName:\"p\"},\"draw\"),` on the event bus so it can lis\\xADten to all\nmes\\xADsages re\\xADgard\\xADing draw\\xADing and per\\xADform the draw\\xADing ac\\xADtions. Since lis\\xADten\\xADing is not enough I also add a mouse lis\\xADtener\nto the doc\\xADu\\xADment so when it moves it pub\\xADlishes events to the `,mdx(\"inlineCode\",{parentName:\"p\"},\"draw\"),\" ad\\xADdress.\"),mdx(\"p\",null,\"Note that I am using \",mdx(\"inlineCode\",{parentName:\"p\"},\"publish\"),\" and not \",mdx(\"inlineCode\",{parentName:\"p\"},\"send\"),`, the rea\\xADson should be ob\\xADvi\\xADous, I want every\\xADone to know this users mouse\nmove\\xADments, I am not in\\xADter\\xADested on send\\xADing the events to just a sin\\xADgle user. You can see now that if you want to have\na draw\\xADing app in a one on one user basis then in\\xADstead of `,mdx(\"inlineCode\",{parentName:\"p\"},\"publish()\"),\" you should use \",mdx(\"inlineCode\",{parentName:\"p\"},\"send()\"),\".\"),mdx(\"h3\",e({},{id:\"server-application\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#server-application\"})),\"Server Application\"),mdx(\"p\",null,\"The server code is quite straight for\\xADward, all you need is:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-javascript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" Router = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"require\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx-web-js/router\"'),`);\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" SockJSHandler = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"require\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx-web-js/sock_js_handler\"'),`);\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" StaticHandler = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"require\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx-web-js/static_handler\"'),`);\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` router = Router.router(vertx);\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Allow outbound traffic to the draw address\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` options = {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"outboundPermitteds\"'),\" : [{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"address\"'),\" : \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"draw\"'),`}],\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"inboundPermitteds\"'),\" :  [{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"address\"'),\" : \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"draw\"'),`}]\n};\n\nrouter.route(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/eventbus/*\"'),`).handler(SockJSHandler.create(vertx).bridge(options).handle);\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Serve the static resources\"),`\nrouter.route().handler(StaticHandler.create().handle);\n\nvertx.createHttpServer().requestHandler(router.accept).listen(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"8080\"),`);\n`)),mdx(\"p\",null,\"We start with the usual im\\xADports, we im\\xADport a ref\\xADer\\xADence to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"Router\"),` ob\\xADject and a cou\\xADple of helper han\\xADdlers\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"SockJSHandler\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"StaticHandler\"),`. As their names should tell you one han\\xADdler will be re\\xADspon\\xADsi\\xADble to han\\xADdle all\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"SockJS\"),\" data and the other all HTTP file serv\\xADing re\\xADquests.\"),mdx(\"p\",null,`We then add then to a router and start a HTTP server that will han\\xADdle all in\\xADcom\\xADing re\\xADquest using the han\\xADdler ac\\xADcept\nfunc\\xADtion. Fi\\xADnally we lis\\xADten on port `,mdx(\"inlineCode\",{parentName:\"p\"},\"8080\"),\" and we are ready.\"),mdx(\"p\",null,\"Note that there is a op\\xADtions ob\\xADject where a cou\\xADple of prop\\xADer\\xADties are de\\xADfined \",mdx(\"inlineCode\",{parentName:\"p\"},\"outbound/inbound\"),` per\\xADmit\\xADted ad\\xADdresses.\nWith\\xADout this con\\xADfig\\xADu\\xADra\\xADtion the ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtion will not be al\\xADlowed to con\\xADnect to the vert.x bus, in fact the\nde\\xADfault con\\xADfig\\xADu\\xADra\\xADtion of the Sock\\xADJSHan\\xADdler is deny all. So you must spec\\xADify ex\\xADplic\\xADitly which ad\\xADdress are al\\xADlowed to\nre\\xADceive mes\\xADsages from `,mdx(\"inlineCode\",{parentName:\"p\"},\"SockJS\"),\" and which ones are al\\xADlowed to send/pub\\xADlish to \",mdx(\"inlineCode\",{parentName:\"p\"},\"SockJS\"),\".\"),mdx(\"p\",null,\"Now you can start your ap\\xADpli\\xADca\\xADtion, don\\u2019t for\\xADget to in\\xADstall the de\\xADpen\\xADden\\xADcies for the first time:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`npm install\n`)),mdx(\"p\",null,\"And then run the ap\\xADpli\\xADca\\xADtion:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`npm start\n`)),mdx(\"p\",null,`If you now open 2 browser win\\xADdows you will be able to draw nice pic\\xADtures and see the draw\\xADing show\\xADing in \\u201Creal time\\u201D\non the other win\\xADdow, if you then draw on the sec\\xADond you should get the mir\\xADror ef\\xADfect on the first win\\xADdow.`),mdx(\"p\",null,\"Have fun!\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"prevPost":{"meta":{"title":"Writing secure Vert.x Web apps","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"This is a starting guide for securing Vert.x web applications. Standard rules and practices apply to Vert.x apps as if they would to any other web framework."},"date":"2015-09-14","slug":"writing-secure-vert-x-web-apps"},"nextPost":{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},"relatedPosts":[{"meta":{"title":"Things to keep in mind concerning CSRF attacks","category":"guides","authors":[{"name":"Xhelal Likaj","github_id":"xhlika"}],"summary":"Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses."},"date":"2021-01-23","slug":"eclipse-vert-x-CSRF-concerns"},{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},{"meta":{"title":"Combine vert.x and mongo to build a giant","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This blog post is part of the introduction to Vert.x series. We are now going to replace this JDBC client by the vertx-mongo-client, and thus connect to a Mongo database."},"date":"2015-11-30","slug":"combine-vert-x-and-mongo-to-build-a-giant"}]},"__N_SSG":true}