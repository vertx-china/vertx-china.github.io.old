{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"Building a real-time web app with Angular/Ngrx and Vert.x","category":"guides","authors":[{"name":"Benoit Hediard","github_id":"benorama"}],"summary":"There are multiple tech stacks to build a real-time web app. What are the best choices to build Angular client apps, connected to a JVM-based backend?"},"date":"2017-04-26","slug":"building-a-real-time-web-app-with-angular-ngrx-and-vert-x","readingTime":{"text":"7 min read","minutes":6.23,"time":373800,"words":1246},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Nowa\\xADdays, there are mul\\xADti\\xADple tech stacks to build a real-\\u200Btime web app. What are the best choices to build real-\\u200Btime An\\xADgu\\xADlar client apps, con\\xADnected to a JVM-\\u200Bbased back\\xADend? This ar\\xADti\\xADcle de\\xADscribes an An\\xADgu\\xADlar+Vertx real-\\u200Btime ar\\xADchi\\xADtec\\xADture with a Proof of Con\\xADcept demo app.\"), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"This is a re-\\u200Bpublication of the fol\\xADlow\\xADing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/@benorama/building-a-realtime-web-app-with-angular-ngrx-and-vert-x-a5381c0397a1\"\n  }), \"Medium post\"))), mdx(\"h2\", {\n    \"id\": \"intro\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#intro\"\n  })), \"Intro\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Wel\\xADcome to the real-\\u200Btime web!\"), \" It\\u2019s time to move on from tra\\xADdi\\xADtional syn\\xADchro\\xADnous HTTP re\\xADquest/re\\xADsponse ar\\xADchi\\xADtec\\xADtures to re\\xADac\\xADtive apps with con\\xADnected clients (ouch\\u2026 that\\u2019s a lot of buzz\\xADwords in just one sen\\xADtence)!\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-realtime-angular-ngrx/data-in-motion.jpg\",\n    \"alt\": null\n  }))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Image source: \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://www.voxxed.com\"\n  }), \"https://www.voxxed.com\"))), mdx(\"p\", null, \"To build this kind of app, \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.meteor.com\"\n  }), \"Me\\xADte\\xADorJS\"), \" is the new cool kid on the block (v1.0 re\\xADleased in oc\\xADto\\xADber 2014): \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"a full stack Javascript plat\\xADform to build connected-\\u200Bclient re\\xADac\\xADtive ap\\xADpli\\xADca\\xADtions\"), \". It al\\xADlows JS de\\xADvel\\xADop\\xADers to build and de\\xADploy amaz\\xADing mod\\xADern web and mo\\xADbile apps (iOS/An\\xADdroid) in no time, using a uni\\xADfied back\\xADend+fron\\xADtend code within a sin\\xADgle app repo. That\\u2019s a pretty am\\xADbi\\xADtious ap\\xADproach but it re\\xADquires a very opin\\xADion\\xADated and highly cou\\xADpled JS tech stack and it\\u2019s still a pretty niche frame\\xADwork.\"), mdx(\"p\", null, \"More\\xADover, we are a Java shop on the back\\xADend. At Ago\\xADra\\xADPulse, we rely heav\\xADily on :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://angular.io\"\n  }), \"An\\xADgu\\xADlar\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://ionicframework.com\"\n  }), \"Ionic\"), \" for the JS fron\\xADtend (with a shared busi\\xADness/data ar\\xADchi\\xADtec\\xADture based on \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/ngrx/store\"\n  }), \"Ngrx\"), \"),\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://www.groovy-lang.org\"\n  }), \"Groovy\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://grails.org\"\n  }), \"Grails\"), \" ecosys\\xADtem for the JVM back\\xADend.\")), mdx(\"p\", null, \"So my ques\\xADtion is:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"What are the best choices to build real-\\u200Btime An\\xADgu\\xADlar client apps, con\\xADnected to a JVM-\\u200Bbased back\\xADend these days?\")), mdx(\"p\", null, \"Our re\\xADquire\\xADments are pretty basic. We don\\u2019t need full Me\\xADteor\\u2019s end-\\u200Bto-end ap\\xADpli\\xADca\\xADtion model.\\nWe just want to be able to :\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"build a re\\xADac\\xADtive app with an event bus on the JVM, and\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"ex\\xADtend the event bus down to the browser to be able to pub\\xADlish/sub\\xADscribe to real-\\u200Btime events from an An\\xADgu\\xADlar app.\")), mdx(\"h3\", {\n    \"id\": \"server-side-jvm\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#server-side-jvm\"\n  })), \"Server side (JVM)\"), mdx(\"p\", null, \"Re\\xADac\\xADtive apps is a hot topic nowa\\xADdays and there are many great libs/plat\\xADforms to build this type of event-\\u200Bdriven ar\\xADchi\\xADtec\\xADture on the JVM:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(Link, {\n    href: \"/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"\"\n  }), \"Vert.x\")), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.lightbend.com\"\n  }), \"Light\\xADbend\"), \" plat\\xADform (Play, Akka, Scala),\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Spring \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://projectreactor.io\"\n  }), \"Project Re\\xADac\\xADtor\"), \" (in\\xADte\\xADgrated into Grails 3.0).\")), mdx(\"h3\", {\n    \"id\": \"client-side\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#client-side\"\n  })), \"Client side\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://facebook.github.io/react/\"\n  }), \"Re\\xADac\\xADtJS\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://angular.io\"\n  }), \"An\\xADgu\\xADlar\"), \" are the two most pop\\xADu\\xADlar frame\\xADwork right now to build mod\\xADern JS apps. Most plat\\xADforms use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/sockjs/sockjs-client\"\n  }), \"SockJS\"), \" to han\\xADdle real-\\u200Btime con\\xADnec\\xADtions:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(Link, {\n    href: \"/docs/vertx-web/groovy/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"\"\n  }), \"Vertx-\\u200Bweb\")), \" pro\\xADvides a SockJS server im\\xADple\\xADmen\\xADta\\xADtion with an event bus bridge and a \", mdx(Link, {\n    href: \"/docs/vertx-web/groovy/#_sockjs_event_bus_bridge\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"\"\n  }), \"vertx-\\u200Bevenbus.js\")), \" client li\\xADbrary (very easy to use),\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Spring pro\\xADvides web\\xADsocket SockJS sup\\xADport though Spring Mes\\xADsag\\xADing and Web\\xADsocket libs (see an ex\\xADam\\xADple \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://spring.io/guides/gs/messaging-stomp-websocket/\"\n  }), \"here\"), \")\")), mdx(\"h3\", {\n    \"id\": \"final-choice-vertx--angular\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#final-choice-vertx--angular\"\n  })), \"Final choice: Vert.x + Angular\"), mdx(\"p\", null, \"In the end, I\\u2019ve cho\\xADsen to ex\\xADper\\xADi\\xADment with Vert.x for its ex\\xADcel\\xADlent Groovy sup\\xADport, dis\\xADtrib\\xADuted event bus, scal\\xADa\\xADbil\\xADity and ease of use.\"), mdx(\"p\", null, \"I en\\xADjoyed it very much. Let me show you the re\\xADsult of my ex\\xADper\\xADi\\xADmen\\xADta\\xADtion which is the root of our real-\\u200Btime fea\\xADtures com\\xADing very soon in Ago\\xADra\\xADPulse v6.0!\"), mdx(\"h2\", {\n    \"id\": \"why-vertx\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#why-vertx\"\n  })), \"Why Vert.x?\"), mdx(\"p\", null, \"Like other re\\xADac\\xADtive plat\\xADform, Vert.x is event dri\\xADven and non block\\xADing. It scales very well (even more that Node.js).\"), mdx(\"p\", null, \"Un\\xADlike other re\\xADac\\xADtive plat\\xADforms, Vert.x is poly\\xADglot: you can use Vert.x with mul\\xADti\\xADple lan\\xADguages in\\xADclud\\xADing Java, JavaScript, Groovy, Ruby, Cey\\xADlon, Scala and Kotlin.\"), mdx(\"p\", null, \"Un\\xADlike Node.js, Vert.x is a gen\\xADeral pur\\xADpose tool-\\u200Bkit and un\\xADopin\\xADion\\xADated. It\\u2019s a ver\\xADsa\\xADtile plat\\xADform suit\\xADable for many things: from sim\\xADple net\\xADwork util\\xADi\\xADties, so\\xADphis\\xADti\\xADcated mod\\xADern web ap\\xADpli\\xADca\\xADtions, HTTP/REST mi\\xADcroser\\xADvices or a full blown back-\\u200Bend message-\\u200Bbus ap\\xADpli\\xADca\\xADtion.\"), mdx(\"p\", null, \"Like other re\\xADac\\xADtive plat\\xADforms, it looks scary in the be\\xADgin\\xADing when you read the doc\\xADu\\xADmen\\xADta\\xADtion\\u2026 ;) But once you start play\\xADing with it, it re\\xADmains fun and sim\\xADple to use, es\\xADpe\\xADcially with Groovy! Vert.x re\\xADally al\\xADlows you to build sub\\xADstan\\xADtial sys\\xADtems with\\xADout get\\xADting tan\\xADgled in com\\xADplex\\xADity.\"), mdx(\"p\", null, \"In my case, I was mainly in\\xADter\\xADested by the dis\\xADtrib\\xADuted event-\\u200Bbus pro\\xADvided (a core fea\\xADture of Vert.x).\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"To val\\xADi\\xADdate our ap\\xADproach, we built pro\\xADto\\xADtypes with the fol\\xADlow\\xADing goals:\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"share and syn\\xADchro\\xADnize a com\\xADmon (Ngrx-\\u200Bbased) state be\\xADtween mul\\xADti\\xADple con\\xADnected clients, and\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"dis\\xADtrib\\xADute real-\\u200Btime (Ngrx-\\u200Bbased) ac\\xADtions across mul\\xADti\\xADple con\\xADnected clients, which im\\xADpact local states/re\\xADduc\\xADers.\"))), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngrx/store\"\n  }), \"@ngrx/store\"), \" is a RxJS pow\\xADered state man\\xADage\\xADment in\\xADspired by Redux for An\\xADgu\\xADlar apps. It\\u2019s cur\\xADrently the most pop\\xADu\\xADlar way to struc\\xADture com\\xADplex busi\\xADness logic in An\\xADgu\\xADlar apps.\")), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-realtime-angular-ngrx/redux.png\",\n    \"alt\": \"Redux\"\n  }))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Source: \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://www.smashingmagazine.com/2016/06/an-introduction-to-redux/\"\n  }), \"https://www.smash\\xADing\\xADmagazine.com/2016/06/an-\\u200Bintroduction-to-redux/\"))), mdx(\"h2\", {\n    \"id\": \"proof-of-concept\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#proof-of-concept\"\n  })), \"PROOF OF CONCEPT\"), mdx(\"p\", null, \"Here is the repo of our ini\\xADtial proof of con\\xADcept:\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://github.com/benorama/ngrx-realtime-app\"\n  }), \"http://github.com/beno\\xADrama/ngrx-\\u200Brealtime-app\")), mdx(\"p\", null, \"The repo is di\\xADvided into two sep\\xADa\\xADrate projects:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Vert.x server app\"), \", based on \", mdx(Link, {\n    href: \"/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"\"\n  }), \"Vert.x\")), \" (ver\\xADsion 3.3), man\\xADaged by \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://gradle.org\"\n  }), \"Gra\\xADdle\"), \", with a main ver\\xADti\\xADcle de\\xADvel\\xADoped in \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://groovy-lang.org\"\n  }), \"Groovy\"), \" lang.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"An\\xADgu\\xADlar client app\"), \", based on An\\xADgu\\xADlar (ver\\xADsion 4.0.1), man\\xADaged by \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://angular.io\"\n  }), \"An\\xADgu\\xADlar\"), \" CLI with state, re\\xADduc\\xADers and ac\\xADtions logic based on \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/ngrx/store\"\n  }), \"@ngrx/store\"), \" (ver\\xADsion 2.2.1)\")), mdx(\"p\", null, \"For the demo, we are using the counter ex\\xADam\\xADple code (ac\\xADtions and re\\xADduc\\xADers) from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngrx/store\"\n  }), \"@ngrx/store\"), \".\"), mdx(\"p\", null, \"The counter client busi\\xADness logic is based on:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"CounterState\"), \" in\\xADter\\xADface, counter state model,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"counterReducer\"), \" re\\xADducer, counter state man\\xADage\\xADment based on dis\\xADpatched ac\\xADtions, and\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"In\\xADcre\\xADment\"), \", \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"decre\\xADment\"), \" and \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"reset\"), \" counter ac\\xADtions.\")), mdx(\"p\", null, \"State is main\\xADtained server-\\u200Bside with a sim\\xADple sin\\xADgle\\xADton \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CounterService\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-groovy\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-class\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"class\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"CounterService\"), \" {\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"static\"), \" INCREMENT = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'[Counter] Increment'\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"static\"), \" DECREMENT = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'[Counter] Decrement'\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"static\"), \" RESET = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'[Counter] Reset'\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"int\"), \" total = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"0\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" handleEvent(event) {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"switch\"), \"(event.type) {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"case\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"INCREMENT:\"), \"\\n                total++\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"break\"), \"\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"case\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"DECREMENT:\"), \"\\n                total--\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"break\"), \"\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"case\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"RESET:\"), \"\\n                total = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"0\"), \"\\n                \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"break\"), \"\\n        }\\n    }\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"client-state-initialization-through-requestresponse\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#client-state-initialization-through-requestresponse\"\n  })), \"Client state initialization through Request/Response\"), mdx(\"p\", null, \"Ini\\xADtial state is ini\\xADtial\\xADized with sim\\xADple \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"re\\xADquest/re\\xADsponse\"), \" (or send/reply) on the event bus.\\nOnce the client is con\\xADnected, it sends a re\\xADquest to the event bus at the ad\\xADdress \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"counter::total\"), \". The server replies di\\xADrectly with the value of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CounterService\"), \" total and the client dis\\xADpatches lo\\xADcally a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"reset\"), \" ac\\xADtion with the total value from the reply.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-realtime-angular-ngrx/vertx-request-response.png\",\n    \"alt\": \"Vertx Request Response\"\n  }))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Source: \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://www.slideshare.net/RedHatDevelopers/vertx-microservices-were-never-so-easy-clement-escoffier\"\n  }), \"https://www.slideshare.net/Red\\xADHat\\xADDe\\xADvel\\xADop\\xADers/vertx-\\u200Bmicroservices-were-never-so-easy-clement-escoffier\"))), mdx(\"p\", null, \"Here is an ex\\xADtract of the cor\\xADre\\xADspond\\xADing code (from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppEventBusService\"), \"):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-typescript\"\n  }), \"initializeCounter() {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".eventBusService.send(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'counter::total'\"), \", body, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), \"(\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"error, message\"), \") =>\"), \" {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Handle reply\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (message && message.body) {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"let\"), \" localAction = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" CounterActions.ResetAction();\\n            localAction.payload = message.body; \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Total value\"), \"\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".store.dispatch(localAction);\\n        }\\n    });\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"actions-distribution-through-publishsubscribe\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#actions-distribution-through-publishsubscribe\"\n  })), \"Actions distribution through Publish/Subscribe\"), mdx(\"p\", null, \"Ac\\xADtion dis\\xADtri\\xADb\\xADu\\xADtion/sync uses the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"pub\\xADlish/sub\\xADscribe\"), \" pat\\xADtern.\"), mdx(\"p\", null, \"Counter ac\\xADtions are pub\\xADlished from the client to the event bus at the ad\\xADdress \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"counter::ac\\xADtions\"), \".\"), mdx(\"p\", null, \"Any client that have sub\\xADscribed to \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"counter::ac\\xADtions\"), \" ad\\xADdress will re\\xADceive the ac\\xADtions and re\\xADdis\\xADpatch them lo\\xADcally to im\\xADpact app states/re\\xADduc\\xADers.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-realtime-angular-ngrx/vertx-publish-subscribe.png\",\n    \"alt\": \"Vertx Publish Subscribe\"\n  }))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Source: \", mdx(\"a\", _extends({\n    parentName: \"em\"\n  }, {\n    \"href\": \"https://www.slideshare.net/RedHatDevelopers/vertx-microservices-were-never-so-easy-clement-escoffier\"\n  }), \"https://www.slideshare.net/Red\\xADHat\\xADDe\\xADvel\\xADop\\xADers/vertx-\\u200Bmicroservices-were-never-so-easy-clement-escoffier\"))), mdx(\"p\", null, \"Here is an ex\\xADtract of the cor\\xADre\\xADspond\\xADing code (from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AppEventBusService\"), \"):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-typescript\"\n  }), \"publishAction(action: RemoteAction) {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (action.publishedByUser) {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"console\"), \".error(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"This action has already been published\\\"\"), \");\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \";\\n    }\\n    action.publishedByUser = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".currentUser;\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".eventBusService.publish(action.eventBusAddress, action);\\n}\\nsubscribeToActions(eventBusAddress: \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"string\"), \") {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".eventBusService.registerHandler(eventBusAddress, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), \"(\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"error, message\"), \") =>\"), \" {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Handle message from subscription\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (message.body.publishedByUser === \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".currentUser) {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Ignore action sent by current manager\"), \"\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \";\\n        }\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"let\"), \" localAction = message.body;\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".store.dispatch(localAction);\\n    });\\n}\\n\")), mdx(\"p\", null, \"The event bus pub\\xADlish\\xADing logic is achieved through a sim\\xADple Ngrx Ef\\xADfects. Any ac\\xADtions that ex\\xADtend \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"RemoteAction\"), \" class will be pub\\xADlished to the event bus.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-typescript\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"@Injectable\"), \"()\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"export\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"class\"), \" AppEventBusEffects {\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"constructor\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" actions$: Actions, \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"private\"), \" appEventBusService: AppEventBusService\"), \") {}\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Listen to all actions and publish remote actions to account event bus\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"@Effect\"), \"({dispatch: \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \"}) remoteAction$ = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".actions$\\n        .filter(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"action\"), \" =>\"), \" action \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"instanceof\"), \" RemoteAction && action.publishedByUser == \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"undefined\"), \")\\n        .do(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), \"(\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"action: RemoteAction\"), \") =>\"), \" {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".appEventBusService.publishAction(action);\\n        });\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"@Effect\"), \"({dispatch: \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \"}) login$ = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".actions$\\n        .ofType(UserActionTypes.LOGIN)\\n        .do(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), \"() =>\"), \" {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"this\"), \".appEventBusService.connect();\\n        });\\n}\\n\")), mdx(\"p\", null, \"You can see all of this in ac\\xADtion by lo\\xADcally launch\\xADing the server and the client app in two sep\\xADa\\xADrate browser win\\xADdows.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-realtime-angular-ngrx/demo-app-screen.png\",\n    \"alt\": \"Demo app screen\"\n  }))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Bonus: the demo app also in\\xADcludes user sta\\xADtus (of\\xADfline/on\\xADline), based of the event bus con\\xADnec\\xADtion sta\\xADtus.\")), mdx(\"p\", null, \"The counter state is shared and syn\\xADchro\\xADnized be\\xADtween con\\xADnected clients and each local ac\\xADtion is dis\\xADtrib\\xADuted in real-\\u200Btime to other clients.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Mis\\xADsion ac\\xADcom\\xADplished!\")), mdx(Alert, {\n    info: true,\n    title: \"Typescript version of Vertx EventBus Client\",\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"The app uses our own Type\\xADscript ver\\xADsion of the of\\xADfi\\xADcial JS \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-bus-bower\"\n  }), \"Vertx Event\\xADBus Client\"), \". It can be found \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gist.github.com/benorama/93373c3c1c3574732d6cc1b4754aab9f\"\n  }), \"here\"), \", any feed\\xADback, im\\xADprove\\xADment sug\\xADges\\xADtions are wel\\xADcome!\")));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>Nowa­days, there are mul­ti­ple tech stacks to build a real-​time web app. What are the best choices to build real-​time An­gu­lar client apps, con­nected to a JVM-​based back­end? This ar­ti­cle de­scribes an An­gu­lar+Vertx real-​time ar­chi­tec­ture with a Proof of Con­cept demo app.</p><div class=\"alert info\"><p>This is a re-​publication of the fol­low­ing <a href=\"https://medium.com/@benorama/building-a-realtime-web-app-with-angular-ngrx-and-vert-x-a5381c0397a1\">Medium post</a></p></div><h2 id=\"intro\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#intro\"></a>Intro</h2><p><strong>Wel­come to the real-​time web!</strong> It’s time to move on from tra­di­tional syn­chro­nous HTTP re­quest/re­sponse ar­chi­tec­tures to re­ac­tive apps with con­nected clients (ouch… that’s a lot of buzz­words in just one sen­tence)!</p><p><img src=\"/images/blog/vertx-realtime-angular-ngrx/data-in-motion.jpg\"/></p><p><em>Image source: <a href=\"https://www.voxxed.com\">https://www.voxxed.com</a></em></p><p>To build this kind of app, <a href=\"https://www.meteor.com\">Me­te­orJS</a> is the new cool kid on the block (v1.0 re­leased in oc­to­ber 2014): <strong>a full stack Javascript plat­form to build connected-​client re­ac­tive ap­pli­ca­tions</strong>. It al­lows JS de­vel­op­ers to build and de­ploy amaz­ing mod­ern web and mo­bile apps (iOS/An­droid) in no time, using a uni­fied back­end+fron­tend code within a sin­gle app repo. That’s a pretty am­bi­tious ap­proach but it re­quires a very opin­ion­ated and highly cou­pled JS tech stack and it’s still a pretty niche frame­work.</p><p>More­over, we are a Java shop on the back­end. At Ago­ra­Pulse, we rely heav­ily on :</p><ul><li><a href=\"https://angular.io\">An­gu­lar</a> and <a href=\"http://ionicframework.com\">Ionic</a> for the JS fron­tend (with a shared busi­ness/data ar­chi­tec­ture based on <a href=\"https://github.com/ngrx/store\">Ngrx</a>),</li><li><a href=\"http://www.groovy-lang.org\">Groovy</a> and <a href=\"https://grails.org\">Grails</a> ecosys­tem for the JVM back­end.</li></ul><p>So my ques­tion is:</p><blockquote><p>What are the best choices to build real-​time An­gu­lar client apps, con­nected to a JVM-​based back­end these days?</p></blockquote><p>Our re­quire­ments are pretty basic. We don’t need full Me­teor’s end-​to-end ap­pli­ca­tion model.\nWe just want to be able to :</p><ol><li>build a re­ac­tive app with an event bus on the JVM, and</li><li>ex­tend the event bus down to the browser to be able to pub­lish/sub­scribe to real-​time events from an An­gu­lar app.</li></ol><h3 id=\"server-side-jvm\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#server-side-jvm\"></a>Server side (JVM)</h3><p>Re­ac­tive apps is a hot topic nowa­days and there are many great libs/plat­forms to build this type of event-​driven ar­chi­tec­ture on the JVM:</p><ul><li><a href=\"/\">Vert.x</a>,</li><li><a href=\"https://www.lightbend.com\">Light­bend</a> plat­form (Play, Akka, Scala),</li><li>Spring <a href=\"http://projectreactor.io\">Project Re­ac­tor</a> (in­te­grated into Grails 3.0).</li></ul><h3 id=\"client-side\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#client-side\"></a>Client side</h3><p><a href=\"http://facebook.github.io/react/\">Re­ac­tJS</a> and <a href=\"https://angular.io\">An­gu­lar</a> are the two most pop­u­lar frame­work right now to build mod­ern JS apps. Most plat­forms use <a href=\"https://github.com/sockjs/sockjs-client\">SockJS</a> to han­dle real-​time con­nec­tions:</p><ul><li><a href=\"/docs/vertx-web/groovy/\">Vertx-​web</a> pro­vides a SockJS server im­ple­men­ta­tion with an event bus bridge and a <a href=\"/docs/vertx-web/groovy/#_sockjs_event_bus_bridge\">vertx-​evenbus.js</a> client li­brary (very easy to use),</li><li>Spring pro­vides web­socket SockJS sup­port though Spring Mes­sag­ing and Web­socket libs (see an ex­am­ple <a href=\"https://spring.io/guides/gs/messaging-stomp-websocket/\">here</a>)</li></ul><h3 id=\"final-choice-vertx--angular\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#final-choice-vertx--angular\"></a>Final choice: Vert.x + Angular</h3><p>In the end, I’ve cho­sen to ex­per­i­ment with Vert.x for its ex­cel­lent Groovy sup­port, dis­trib­uted event bus, scal­a­bil­ity and ease of use.</p><p>I en­joyed it very much. Let me show you the re­sult of my ex­per­i­men­ta­tion which is the root of our real-​time fea­tures com­ing very soon in Ago­ra­Pulse v6.0!</p><h2 id=\"why-vertx\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#why-vertx\"></a>Why Vert.x?</h2><p>Like other re­ac­tive plat­form, Vert.x is event dri­ven and non block­ing. It scales very well (even more that Node.js).</p><p>Un­like other re­ac­tive plat­forms, Vert.x is poly­glot: you can use Vert.x with mul­ti­ple lan­guages in­clud­ing Java, JavaScript, Groovy, Ruby, Cey­lon, Scala and Kotlin.</p><p>Un­like Node.js, Vert.x is a gen­eral pur­pose tool-​kit and un­opin­ion­ated. It’s a ver­sa­tile plat­form suit­able for many things: from sim­ple net­work util­i­ties, so­phis­ti­cated mod­ern web ap­pli­ca­tions, HTTP/REST mi­croser­vices or a full blown back-​end message-​bus ap­pli­ca­tion.</p><p>Like other re­ac­tive plat­forms, it looks scary in the be­gin­ing when you read the doc­u­men­ta­tion… ;) But once you start play­ing with it, it re­mains fun and sim­ple to use, es­pe­cially with Groovy! Vert.x re­ally al­lows you to build sub­stan­tial sys­tems with­out get­ting tan­gled in com­plex­ity.</p><p>In my case, I was mainly in­ter­ested by the dis­trib­uted event-​bus pro­vided (a core fea­ture of Vert.x).</p><p><strong>To val­i­date our ap­proach, we built pro­to­types with the fol­low­ing goals:</strong></p><ul><li><strong>share and syn­chro­nize a com­mon (Ngrx-​based) state be­tween mul­ti­ple con­nected clients, and</strong></li><li><strong>dis­trib­ute real-​time (Ngrx-​based) ac­tions across mul­ti­ple con­nected clients, which im­pact local states/re­duc­ers.</strong></li></ul><div class=\"alert info\"><p><a href=\"https://github.com/ngrx/store\">@ngrx/store</a> is a RxJS pow­ered state man­age­ment in­spired by Redux for An­gu­lar apps. It’s cur­rently the most pop­u­lar way to struc­ture com­plex busi­ness logic in An­gu­lar apps.</p></div><p><img src=\"/images/blog/vertx-realtime-angular-ngrx/redux.png\" alt=\"Redux\"/></p><p><em>Source: <a href=\"https://www.smashingmagazine.com/2016/06/an-introduction-to-redux/\">https://www.smash­ing­magazine.com/2016/06/an-​introduction-to-redux/</a></em></p><h2 id=\"proof-of-concept\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#proof-of-concept\"></a>PROOF OF CONCEPT</h2><p>Here is the repo of our ini­tial proof of con­cept:</p><p><a href=\"http://github.com/benorama/ngrx-realtime-app\">http://github.com/beno­rama/ngrx-​realtime-app</a></p><p>The repo is di­vided into two sep­a­rate projects:</p><ul><li><strong>Vert.x server app</strong>, based on <a href=\"/\">Vert.x</a> (ver­sion 3.3), man­aged by <a href=\"https://gradle.org\">Gra­dle</a>, with a main ver­ti­cle de­vel­oped in <a href=\"http://groovy-lang.org\">Groovy</a> lang.</li><li><strong>An­gu­lar client app</strong>, based on An­gu­lar (ver­sion 4.0.1), man­aged by <a href=\"https://angular.io\">An­gu­lar</a> CLI with state, re­duc­ers and ac­tions logic based on <a href=\"https://github.com/ngrx/store\">@ngrx/store</a> (ver­sion 2.2.1)</li></ul><p>For the demo, we are using the counter ex­am­ple code (ac­tions and re­duc­ers) from <a href=\"https://github.com/ngrx/store\">@ngrx/store</a>.</p><p>The counter client busi­ness logic is based on:</p><ul><li><code>CounterState</code> in­ter­face, counter state model,</li><li><code>counterReducer</code> re­ducer, counter state man­age­ment based on dis­patched ac­tions, and</li><li><em>In­cre­ment</em>, <em>decre­ment</em> and <em>reset</em> counter ac­tions.</li></ul><p>State is main­tained server-​side with a sim­ple sin­gle­ton <code>CounterService</code>.</p><pre><code class=\"hljs language-groovy\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CounterService</span> {</span>\n    <span class=\"hljs-keyword\">static</span> INCREMENT = <span class=\"hljs-string\">&#x27;[Counter] Increment&#x27;</span>\n    <span class=\"hljs-keyword\">static</span> DECREMENT = <span class=\"hljs-string\">&#x27;[Counter] Decrement&#x27;</span>\n    <span class=\"hljs-keyword\">static</span> RESET = <span class=\"hljs-string\">&#x27;[Counter] Reset&#x27;</span>\n    <span class=\"hljs-keyword\">int</span> total = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-keyword\">void</span> handleEvent(event) {\n        <span class=\"hljs-keyword\">switch</span>(event.type) {\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-attr\">INCREMENT:</span>\n                total++\n                <span class=\"hljs-keyword\">break</span>\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-attr\">DECREMENT:</span>\n                total--\n                <span class=\"hljs-keyword\">break</span>\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-attr\">RESET:</span>\n                total = <span class=\"hljs-number\">0</span>\n                <span class=\"hljs-keyword\">break</span>\n        }\n    }\n}\n</code></pre><h3 id=\"client-state-initialization-through-requestresponse\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#client-state-initialization-through-requestresponse\"></a>Client state initialization through Request/Response</h3><p>Ini­tial state is ini­tial­ized with sim­ple <strong>re­quest/re­sponse</strong> (or send/reply) on the event bus.\nOnce the client is con­nected, it sends a re­quest to the event bus at the ad­dress <strong>counter::total</strong>. The server replies di­rectly with the value of <code>CounterService</code> total and the client dis­patches lo­cally a <em>reset</em> ac­tion with the total value from the reply.</p><p><img src=\"/images/blog/vertx-realtime-angular-ngrx/vertx-request-response.png\" alt=\"Vertx Request Response\"/></p><p><em>Source: <a href=\"https://www.slideshare.net/RedHatDevelopers/vertx-microservices-were-never-so-easy-clement-escoffier\">https://www.slideshare.net/Red­Hat­De­vel­op­ers/vertx-​microservices-were-never-so-easy-clement-escoffier</a></em></p><p>Here is an ex­tract of the cor­re­spond­ing code (from <code>AppEventBusService</code>):</p><pre><code class=\"hljs language-typescript\">initializeCounter() {\n    <span class=\"hljs-built_in\">this</span>.eventBusService.send(<span class=\"hljs-string\">&#x27;counter::total&#x27;</span>, body, <span class=\"hljs-function\">(<span class=\"hljs-params\">error, message</span>) =&gt;</span> {\n    <span class=\"hljs-comment\">// Handle reply</span>\n    <span class=\"hljs-keyword\">if</span> (message &amp;&amp; message.body) {\n            <span class=\"hljs-keyword\">let</span> localAction = <span class=\"hljs-keyword\">new</span> CounterActions.ResetAction();\n            localAction.payload = message.body; <span class=\"hljs-comment\">// Total value</span>\n            <span class=\"hljs-built_in\">this</span>.store.dispatch(localAction);\n        }\n    });\n}\n</code></pre><h3 id=\"actions-distribution-through-publishsubscribe\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#actions-distribution-through-publishsubscribe\"></a>Actions distribution through Publish/Subscribe</h3><p>Ac­tion dis­tri­b­u­tion/sync uses the <strong>pub­lish/sub­scribe</strong> pat­tern.</p><p>Counter ac­tions are pub­lished from the client to the event bus at the ad­dress <strong>counter::ac­tions</strong>.</p><p>Any client that have sub­scribed to <strong>counter::ac­tions</strong> ad­dress will re­ceive the ac­tions and re­dis­patch them lo­cally to im­pact app states/re­duc­ers.</p><p><img src=\"/images/blog/vertx-realtime-angular-ngrx/vertx-publish-subscribe.png\" alt=\"Vertx Publish Subscribe\"/></p><p><em>Source: <a href=\"https://www.slideshare.net/RedHatDevelopers/vertx-microservices-were-never-so-easy-clement-escoffier\">https://www.slideshare.net/Red­Hat­De­vel­op­ers/vertx-​microservices-were-never-so-easy-clement-escoffier</a></em></p><p>Here is an ex­tract of the cor­re­spond­ing code (from <code>AppEventBusService</code>):</p><pre><code class=\"hljs language-typescript\">publishAction(action: RemoteAction) {\n    <span class=\"hljs-keyword\">if</span> (action.publishedByUser) {\n        <span class=\"hljs-built_in\">console</span>.error(<span class=\"hljs-string\">&quot;This action has already been published&quot;</span>);\n        <span class=\"hljs-keyword\">return</span>;\n    }\n    action.publishedByUser = <span class=\"hljs-built_in\">this</span>.currentUser;\n    <span class=\"hljs-built_in\">this</span>.eventBusService.publish(action.eventBusAddress, action);\n}\nsubscribeToActions(eventBusAddress: <span class=\"hljs-built_in\">string</span>) {\n    <span class=\"hljs-built_in\">this</span>.eventBusService.registerHandler(eventBusAddress, <span class=\"hljs-function\">(<span class=\"hljs-params\">error, message</span>) =&gt;</span> {\n        <span class=\"hljs-comment\">// Handle message from subscription</span>\n        <span class=\"hljs-keyword\">if</span> (message.body.publishedByUser === <span class=\"hljs-built_in\">this</span>.currentUser) {\n            <span class=\"hljs-comment\">// Ignore action sent by current manager</span>\n            <span class=\"hljs-keyword\">return</span>;\n        }\n        <span class=\"hljs-keyword\">let</span> localAction = message.body;\n        <span class=\"hljs-built_in\">this</span>.store.dispatch(localAction);\n    });\n}\n</code></pre><p>The event bus pub­lish­ing logic is achieved through a sim­ple Ngrx Ef­fects. Any ac­tions that ex­tend <code>RemoteAction</code> class will be pub­lished to the event bus.</p><pre><code class=\"hljs language-typescript\"><span class=\"hljs-meta\">@Injectable</span>()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> AppEventBusEffects {\n\n    <span class=\"hljs-keyword\">constructor</span>(<span class=\"hljs-params\"><span class=\"hljs-keyword\">private</span> actions$: Actions, <span class=\"hljs-keyword\">private</span> appEventBusService: AppEventBusService</span>) {}\n    <span class=\"hljs-comment\">// Listen to all actions and publish remote actions to account event bus</span>\n    <span class=\"hljs-meta\">@Effect</span>({dispatch: <span class=\"hljs-literal\">false</span>}) remoteAction$ = <span class=\"hljs-built_in\">this</span>.actions$\n        .filter(<span class=\"hljs-function\"><span class=\"hljs-params\">action</span> =&gt;</span> action <span class=\"hljs-keyword\">instanceof</span> RemoteAction &amp;&amp; action.publishedByUser == <span class=\"hljs-literal\">undefined</span>)\n        .do(<span class=\"hljs-function\">(<span class=\"hljs-params\">action: RemoteAction</span>) =&gt;</span> {\n            <span class=\"hljs-built_in\">this</span>.appEventBusService.publishAction(action);\n        });\n\n    <span class=\"hljs-meta\">@Effect</span>({dispatch: <span class=\"hljs-literal\">false</span>}) login$ = <span class=\"hljs-built_in\">this</span>.actions$\n        .ofType(UserActionTypes.LOGIN)\n        .do(<span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">this</span>.appEventBusService.connect();\n        });\n}\n</code></pre><p>You can see all of this in ac­tion by lo­cally launch­ing the server and the client app in two sep­a­rate browser win­dows.</p><p><img src=\"/images/blog/vertx-realtime-angular-ngrx/demo-app-screen.png\" alt=\"Demo app screen\"/></p><p><em>Bonus: the demo app also in­cludes user sta­tus (of­fline/on­line), based of the event bus con­nec­tion sta­tus.</em></p><p>The counter state is shared and syn­chro­nized be­tween con­nected clients and each local ac­tion is dis­trib­uted in real-​time to other clients.</p><p><strong>Mis­sion ac­com­plished!</strong></p><div class=\"alert info\"><div class=\"alert-title\">Typescript version of Vertx EventBus Client</div><p>The app uses our own Type­script ver­sion of the of­fi­cial JS <a href=\"https://github.com/vert-x3/vertx-bus-bower\">Vertx Event­Bus Client</a>. It can be found <a href=\"https://gist.github.com/benorama/93373c3c1c3574732d6cc1b4754aab9f\">here</a>, any feed­back, im­prove­ment sug­ges­tions are wel­come!</p></div>","scope":{}}},"prevPost":{"meta":{"title":"Time scheduling with Chime","category":"guides","authors":[{"name":"Lisi","github_id":"LisiLisenok"}],"summary":"Eclipse Vert.x executes periodic and delayed actions with periodic and one-shot timers. Chime is a time scheduler verticle that works on the Vert.x event bus."},"date":"2017-05-09","slug":"time-scheduling-with-chime"},"nextPost":{"meta":{"title":"Dynamic Routing in Serverless Microservice with Vert.x Event Bus","category":"guides","authors":[{"name":"Rowell Belen","github_id":"bytekast"}],"summary":"The Serverless Framework has become the de facto toolkit for building and deploying serverless functions or applications."},"date":"2017-04-14","slug":"dynamic-routing-in-serverless-microservice-with-vert-x-event-bus"},"relatedPosts":[{"meta":{"title":"Real-time bidding with Websockets and Vert.x","category":"guides","authors":[{"name":"Marcin Warczyglowa","github_id":"mwarc"}],"summary":"The expectations of users for interactivity with web applications have changed over the past few years.\n    Users during bidding in auction no longer want to press the refresh button."},"date":"2016-01-15","slug":"real-time-bidding-with-websockets-and-vert-x"},{"meta":{"title":"Easy SSO for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x."},"date":"2020-03-16","slug":"easy-sso-for-vert-x-with-keycloak"},{"meta":{"title":"Eclipse Vert.x metrics now with Micrometer.io","category":"guides","authors":[{"name":"Joel Takvorian","github_id":"jotak"}],"summary":"The new vertx-micrometer-metrics module provides support for collecting metrics with Micrometer.io and storing them in backends such as Graphite or InfluxDB."},"date":"2018-04-09","slug":"eclipse-vert-x-metrics-now-with-micrometer-io"}]},"__N_SSG":true}