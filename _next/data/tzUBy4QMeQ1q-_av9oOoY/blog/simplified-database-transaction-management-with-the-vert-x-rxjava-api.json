{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"Simplified database transaction management with the Vert.x RxJava API","category":"guides","authors":[{"name":"Thomas Segismont","github_id":"tsegismont"}],"summary":"As of Vert.x 3.5, managing database transactions requires a lot of boilerplate code. Vert.x 3.6 provides helpers to easily make a reactive flow transactional."},"date":"2018-07-02","slug":"simplified-database-transaction-management-with-the-vert-x-rxjava-api","readingTime":{"text":"4 min read","minutes":3.235,"time":194100,"words":647},"content":{"compiledSource":"var c=Object.defineProperty,d=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var i=(a,n,t)=>n in a?c(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=>{for(var t in n||(n={}))o.call(n,t)&&i(a,t,n[t]);if(r)for(var t of r(n))l.call(n,t)&&i(a,t,n[t]);return a},m=(a,n)=>d(a,h(n));var p=(a,n)=>{var t={};for(var s in a)o.call(a,s)&&n.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&r)for(var s of r(a))n.indexOf(s)<0&&l.call(a,s)&&(t[s]=a[s]);return t};const makeShortcode=a=>function(t){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},t))},Link=makeShortcode(\"Link\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=p(s,[\"components\"]);return mdx(MDXLayout,m(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"TL;DR As of 3.5, man\\xADag\\xADing data\\xADbase trans\\xADac\\xADtions with Vert.x re\\xADquires a lot of boil\\xADer\\xADplate code.\"),`\n`,mdx(\"em\",{parentName:\"p\"},\"Vert.x 3.6 will pro\\xADvide helpers and \",mdx(\"inlineCode\",{parentName:\"em\"},\"Observable\"),\" trans\\xADform\\xADers to eas\\xADily make a re\\xADac\\xADtive flow trans\\xADac\\xADtional.\")),mdx(\"h2\",e({},{id:\"simple-queries-with-the-rxified-api\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#simple-queries-with-the-rxified-api\"})),\"Simple queries with the \",mdx(\"em\",{parentName:\"h2\"},\"\\u201CRxified\\u201D\"),\" API\"),mdx(\"p\",null,\"The \",mdx(Link,{href:\"/docs/vertx-rx/java2/\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"Vert.x API for Rx\\xADJava\")),\" is one of the most pop\\xADu\\xADlar mod\\xADules in the Vert.x stack.\"),mdx(\"p\",null,\"So we make sure the \",mdx(\"em\",{parentName:\"p\"},\"\\u201CRx\\xADi\\xADfied\\u201D\"),\" API is easy to use for com\\xADmon pro\\xADgram\\xADming tasks, such as read\\xADing rows from a re\\xADla\\xADtional data\\xADbase and send\\xADing the re\\xADsult to the client:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),\"dbClient.rxQuery(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"SELECT name, duration FROM tracks WHERE album = 'The Israelites'\"`),`)\n  .map(ResultSet::getResults)\n  .map(rows -> {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Transform DB rows into a client-friendly JSON object\"),`\n  })\n  .subscribe(json -> {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send JSON to the client\"),`\n  }, t -> {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send error to the client\"),`\n  });\n`)),mdx(\"h2\",e({},{id:\"managing-transactions-with-vertx-35\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#managing-transactions-with-vertx-35\"})),\"Managing transactions with Vert.x 3.5\"),mdx(\"p\",null,`But very often, de\\xADvel\\xADop\\xADers have to im\\xADple\\xADment com\\xADplex in\\xADter\\xADac\\xADtions with the data\\xADbase, run\\xADning in\\xADside a sin\\xADgle trans\\xADac\\xADtion.\nTo do so, the im\\xADple\\xADmen\\xADta\\xADtion must fol\\xADlow this process:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"get a con\\xADnec\\xADtion from the pool,\"),mdx(\"li\",{parentName:\"ul\"},\"start a trans\\xADac\\xADtion,\"),mdx(\"li\",{parentName:\"ul\"},\"ex\\xADe\\xADcute queries,\"),mdx(\"li\",{parentName:\"ul\"},\"if all queries suc\\xADceed, com\\xADmit the trans\\xADac\\xADtion,\"),mdx(\"li\",{parentName:\"ul\"},\"oth\\xADer\\xADwise, roll\\xADback the changes.\")),mdx(\"p\",null,\"How does that trans\\xADlate to code?\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Get a connection from the pool\"),`\ndbClient.rxGetConnection().flatMap(sqlConnection -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Setting auto-commit mode to false implicitely starts a transaction\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" sqlConnection.rxSetAutoCommit(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"false\"),`)\n    .andThen(\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Database queries\"),`\n      sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO albums (name) VALUES ('The Israelites')\"`),`)\n        .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Israelites')\"`),`))\n        .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Too Much Too Soon')\"`),`))\n        .andThen(sqlConnection.rxQuery(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"SELECT name FROM tracks WHERE album = 'The Israelites'\"`),`).map(ResultSet::getResults))\n    )\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Commit if all queries succeed\"),`\n    .flatMap(rows -> sqlConnection.rxCommit().andThen(Single.just(rows)))\n    .onErrorResumeNext(throwable -> {\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// On error, rollback the changes\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` sqlConnection.rxRollback().onErrorComplete()\n        .andThen(sqlConnection.rxSetAutoCommit(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"true\"),`).onErrorComplete())\n        .andThen(Single.error(throwable));\n    }).flatMap(rows -> sqlConnection.rxSetAutoCommit(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"true\"),`).andThen(Single.just(rows)))\n    .doFinally(sqlConnection::close);\n}).map(rows -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Transform DB rows into a client-friendly JSON object\"),`\n}).subscribe(json -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send JSON to the client\"),`\n}, t -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send error to the client\"),`\n});\n`)),mdx(\"p\",null,`That is a lot of boil\\xADer\\xADplate around the spe\\xADcific data\\xADbase queries\\u2026\nIt would be bet\\xADter to re\\xADlieve the de\\xADvel\\xADoper from main\\xADtain\\xADing it.`),mdx(\"h2\",e({},{id:\"vertx-36-tools-for-transaction-management\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#vertx-36-tools-for-transaction-management\"})),\"Vert.x 3.6 tools for transaction management\"),mdx(\"p\",null,\"That is why Vert.x 3.6 will pro\\xADvide \",mdx(\"em\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"em\"},\"Observable\"),\" trans\\xADform\\xADers\"),\" that can be ap\\xADplied to re\\xADac\\xADtive flows with \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://reactivex.io/RxJava/javadoc/io/reactivex/Flowable.html#compose-io.reactivex.FlowableTransformer-\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"compose\")),\" to make them trans\\xADac\\xADtional:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"SQLClientHelper#txFlowableTransformer\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"SQLClientHelper#txObservableTransformer\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"SQLClientHelper#txSingleTransformer\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"SQLClientHelper#txMaybeTransformer\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"SQLClientHelper#txCompletableTransformer\"))),mdx(\"p\",null,\"These \",mdx(\"em\",{parentName:\"p\"},\"trans\\xADform\\xADers\"),\" wrap the cor\\xADre\\xADspond\\xADing source of events with SQL trans\\xADac\\xADtion man\\xADage\\xADment.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),`dbClient.rxGetConnection().flatMap(sqlConnection -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" sqlConnection.rxExecute(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO albums (name) VALUES ('The Israelites')\"`),`)\n    .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Israelites')\"`),`))\n    .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Too Much Too Soon')\"`),`))\n    .andThen(sqlConnection.rxQuery(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"SELECT name FROM tracks WHERE album = 'The Israelites'\"`),`).map(ResultSet::getResults))\n    .compose(SQLClientHelper.txSingleTransformer(sqlConnection))\n    .doFinally(sqlConnection::close);\n}).map(rows -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Transform DB rows into a client-friendly JSON object\"),`\n}).subscribe(json -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send JSON to the client\"),`\n}, t -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send error to the client\"),`\n});\n`)),mdx(\"p\",null,\"Source \",mdx(\"em\",{parentName:\"p\"},\"trans\\xADform\\xADers\"),\" pro\\xADvide max\\xADi\\xADmum flex\\xADi\\xADbil\\xADity: you are still able to ex\\xADe\\xADcute op\\xADer\\xADa\\xADtions with the con\\xADnec\\xADtion after the trans\\xADac\\xADtion com\\xADpletes.\"),mdx(\"p\",null,\"How\\xADever, you usu\\xADally do not need the con\\xADnec\\xADtion after the changes are \",mdx(\"em\",{parentName:\"p\"},\"com\\xADmited\"),\" or \",mdx(\"em\",{parentName:\"p\"},\"roll\\xADbacked\"),`.\nIn this case, you may sim\\xADply cre\\xADate you source ob\\xADserv\\xADable with one of the trans\\xADac\\xADtional helper meth\\xADods in `,mdx(\"inlineCode\",{parentName:\"p\"},\"io.vertx.reactivex.ext.sql.SQLClientHelper\"),\".\"),mdx(\"p\",null,\"Let\\u2019s rewrite the pre\\xADvi\\xADous ex\\xADam\\xADple:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),`SQLClientHelper.inTransactionSingle(client, sqlConnection -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" sqlConnection.rxExecute(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO albums (name) VALUES ('The Israelites')\"`),`)\n    .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Israelites')\"`),`))\n    .andThen(sqlConnection.rxExecute(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"INSERT INTO tracks (album, name) VALUES ('The Israelites', 'Too Much Too Soon')\"`),`))\n    .andThen(sqlConnection.rxQuery(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),`\"SELECT name FROM tracks WHERE album = 'The Israelites'\"`),`).map(ResultSet::getResults))\n}).map(rows -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Transform DB rows into a client-friendly JSON object\"),`\n}).subscribe(json -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send JSON to the client\"),`\n}, t -> {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Send error to the client\"),`\n});\n`)),mdx(\"h2\",e({},{id:\"give-it-a-try\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#give-it-a-try\"})),\"Give it a try\"),mdx(\"p\",null,\"Vert.x 3.6 is ex\\xADpected around fall, but the code is al\\xADready in mas\\xADter and \",mdx(\"em\",{parentName:\"p\"},\"snap\\xADshots\"),\" are reg\\xADu\\xADlarly pub\\xADlished to Sonatype\\u2019s OSS repos.\"),mdx(\"p\",null,\"So give it a try and feel free to pro\\xADvide your fee\\xADback on our user or dev \",mdx(Link,{href:\"/community\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"chan\\xADnels\")),\".\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 3.5.3","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"We have just released Vert.x 3.5.3, a bug fix release of Vert.x 3.5.x."},"date":"2018-07-13","slug":"eclipse-vert-x-3-5-3"},"nextPost":{"meta":{"title":"Eclipse Vert.x 3.5.2","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"We have just released Vert.x 3.5.2, a bug fix release of Vert.x 3.5.x."},"date":"2018-06-08","slug":"eclipse-vert-x-3-5-2"},"relatedPosts":[{"meta":{"title":"Building services and APIs with AMQP 1.0","category":"guides","authors":[{"name":"Jakub Scholz","github_id":"scholzj"}],"summary":"Microservices and APIs are everywhere. Everyone talks about them, presentation slides are full of them ... some people are actually even building them."},"date":"2017-01-25","slug":"building-services-and-apis-with-amqp-1-0"},{"meta":{"title":"Eclipse Vert.x meets GraphQL","category":"guides","authors":[{"name":"Johannes Schüth","github_id":"jotschi"}],"summary":"In this blog post, we will look at an example application written in Vert.x that uses the new GraphQL API of Gentics Mesh."},"date":"2017-11-14","slug":"eclipse-vert-x-meets-graphql"},{"meta":{"title":"Contract Driven REST Services with Vert.x3","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"We see a new trend in development where we are shifting from developing applications to APIs. More and more we see services being offered as REST APIs that we are allowed to consume."},"date":"2015-09-17","slug":"contract-driven-rest-services-with-vert-x3"}]},"__N_SSG":true}