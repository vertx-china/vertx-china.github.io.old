{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"Eclipse Vert.x for Scala next steps","category":"news","authors":[{"name":"Jochen Mader","github_id":"codepitbull"}],"summary":"This blog post gives an overview of the current plans for the vertx-lang-scala module, in particular with respect to the upcoming Vert.x 4."},"date":"2019-08-30","slug":"eclipse-vert-x-for-scala-next-steps","readingTime":{"text":"6 min read","minutes":5.225,"time":313500,"words":1045},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TL;DR:\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"No Scala 2.13 in Eclipse Vert.x 3.x due to in\\xADcreased sup\\xADport bur\\xADden\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"New value classes based ap\\xADproach for Vert.x 4\")), mdx(\"h2\", {\n    \"id\": \"retrospective\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#retrospective\"\n  })), \"Retrospective\"), mdx(\"p\", null, \"It\\u2019s been more than two years since the in\\xADcep\\xADtion of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-lang-scala\"), \" to the Vert.x ecosys\\xADtem. And al\\xADmost as long since I wrote my first \", mdx(Link, {\n    href: \"/blog/scala-is-here/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"blog post\")), \" about it.\"), mdx(\"p\", null, \"A lot has hap\\xADpened since March 2017:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vertx-lang-scala\"), \" kept up with new ver\\xADsions of Scala\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"all Vert.x-\\u200Bmodules are sup\\xADported (35 so far)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"a Giter8 based \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-scala.g8\"\n  }), \"tem\\xADplate\"), \" was added for eas\\xADily boot\\xADstrap\\xADping a Vert.x-\\u200BScala-project\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bugs were squashed\")), mdx(\"p\", null, \"And most re\\xADcently we re\\xADceived a great con\\xADtri\\xADbu\\xADtion by \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/NikolajLeischner\"\n  }), \"Niko\\xADlaj Leis\\xADchner\"), \" who was kind enough to port the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/TechEmpower/FrameworkBenchmarks/tree/master/frameworks/Scala/vertx-web-scala\"\n  }), \"techempow\\xADered\"), \" bench\\xADmark to vert-\\u200Blang-scala. Which will be part of the next steps.\"), mdx(\"p\", null, \"The num\\xADbers pro\\xADduced by this bench\\xADmark were very promis\\xADing and and ad\\xADdi\\xADtional mo\\xADti\\xADva\\xADtion to move to the next phase of Scala sup\\xADport for Vert.x.\"), mdx(\"h2\", {\n    \"id\": \"old-idea\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#old-idea\"\n  })), \"Old idea\"), mdx(\"p\", null, \"Be\\xADfore get\\xADting to the new ideas I want to take a look at the \\u201Cold\\u201D one.\"), mdx(\"p\", null, \"The cur\\xADrent ver\\xADsion of vert-\\u200Blang-scala is based around the idea of wrap\\xADping the Vert.x-API with a ded\\xADi\\xADcated Scala-\\u200Blayer. That layer is cre\\xADated using a Freemarker-\\u200Bbased code gen\\xADer\\xADa\\xADtor. I took this idea from the first try by Tim Fox for build\\xADing that sup\\xADport.\"), mdx(\"p\", null, \"Wrap\\xADping the ex\\xADist\\xADing Java-\\u200BAPI was rather painful but gave me great flex\\xADi\\xADbil\\xADity to cre\\xADate an id\\xADiomatic Scala-\\u200BAPI.\"), mdx(\"p\", null, \"But an ap\\xADproach like that comes with a price:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"There are a lot of in\\xADter\\xADme\\xADdi\\xADate ob\\xADjects being cre\\xADated.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Many un\\xADnec\\xADces\\xADsary con\\xADver\\xADsions be\\xADtween Java/Scala types\")), mdx(\"p\", null, \"Both in\\xADcreased mem\\xADory con\\xADsump\\xADtion and garbage col\\xADlec\\xADtion ac\\xADtiv\\xADity quite a bit and has been bug\\xADging me from the be\\xADgin\\xADning.\"), mdx(\"h2\", {\n    \"id\": \"new-idea\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#new-idea\"\n  })), \"New idea\"), mdx(\"p\", null, \"With Vert.x 4 ap\\xADproach\\xADing I was fi\\xADnally able to in\\xADvest time into the re\\xADwork I had wanted to do for quite a while.\"), mdx(\"p\", null, \"The core idea is to re\\xADplace the cur\\xADrent wrap\\xADping based ap\\xADproach with some\\xADthing more light\\xADweight but na\\xADtive to the Scala-\\u200Bworld.\"), mdx(\"p\", null, \"And that\\u2019s where \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.scala-lang.org/overviews/core/value-classes.html\"\n  }), \"value classes\"), \" come in.\"), mdx(\"p\", null, \"Value classes allow the ex\\xADten\\xADsion of ex\\xADist\\xADing classes with ad\\xADdi\\xADtional meth\\xADods. They make it easy to con\\xADtrol \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"when\"), \" meth\\xADods be\\xADcome vis\\xADi\\xADble and do that with a min\\xADi\\xADmum of over\\xADhead. To be pre\\xADcise: A wrap\\xADping class is nor\\xADmally ever only in\\xADstan\\xADti\\xADated \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"once\"), \".\"), mdx(\"p\", null, \"A good ex\\xADam\\xADple is the ad\\xADdi\\xADtion of meth\\xADods for wrap\\xADping the Vert.x ap\\xADproach of Promises with Scala-\\u200BFutures. Each method re\\xADturn\\xADing a Vert.x-\\u200BPromise needs to re\\xADceive an al\\xADter\\xADna\\xADtive ver\\xADsion which re\\xADturns a Scala-\\u200BFuture.\"), mdx(\"p\", null, \"In Vert.x 3 I achieved that by adding meth\\xADods to the wrap\\xADper and giv\\xADing them a dis\\xADtinct name. A method called \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"lis\\xADten\"), \" re\\xADturn\\xADing a Promise would re\\xADceive a com\\xADpan\\xADion called \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"lis\\xADten\\xADFu\\xADture\"), \" in the Scala layer.\"), mdx(\"p\", null, \"Let\\u2019s look at how this looks in the new ap\\xADproach:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-scala\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"package\"), \" io.vertx.scala\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"package\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-class\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"object\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"core\")), \"{\\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"implicit\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-class\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"class\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"HttpServerScala\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"val asJava: io.vertx.core.http.\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"HttpServer\")), \") \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"extends\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"AnyVal\"), \" \"), \"{\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"def\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"listenFuture\")), \"(port: java.lang.\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Integer\"), \"): scala.concurrent.\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Future\"), \"[io.vertx.core.http.\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"HttpServer\"), \"] = {..}\\n      ..\\n}\\n\")), mdx(\"p\", null, \"The code above does the fol\\xADlow\\xADing things:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It cre\\xADates a pack\\xADage ob\\xADject for \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"io.vertx.scala.core\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"it adds an im\\xADplict class \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"HttpServer\\xADScala\"), \" to wrpa \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"HttpServer\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"it adds a \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"lis\\xADten\\xADFu\\xADture\"), \" method\")), mdx(\"p\", null, \"Using this method in code looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-scala\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"package\"), \" io.vertx.scala.demo\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"import\"), \" io.vertx.lang.scala.\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"VertxExecutionContext\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"import\"), \" io.vertx.scala.core._\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"import\"), \" scala.util.{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Failure\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Success\"), \"}\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-class\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"object\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"Main\"), \" \"), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"def\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"main\")), \"(args: \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Array\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"String\"), \"]): \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Unit\"), \" = {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"val\"), \" vertx = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Vertx\"), \".vertx()\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"implicit\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"val\"), \" ec = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"VertxExecutionContext\"), \"(vertx.getOrCreateContext())\\n    vertx\\n      .createHttpServer()\\n      .requestHandler(r => {\\n        r.response().end(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"bye\\\"\"), \")\\n      })\\n      .listenFuture(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"6667\"), \")\\n      .onComplete {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"case\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Success\"), \"(_) => println(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Started\\\"\"), \")\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"case\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-type\"\n  }), \"Failure\"), \"(exception) => println(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Failure\\\"\"), \")\\n      }\\n  }\\n}\\n\")), mdx(\"p\", null, \"Im\\xADport\\xADing the pack\\xADage ob\\xADject using \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"im\\xADport io.vertx.scala.core._\"), \" brings the ex\\xADten\\xADsion method into scope and makes them avail\\xADable on all in\\xADstances of \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"HttpServer\"), \". In the ex\\xADam\\xADple above \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"cre\\xADate\\xADHttpServer()\"), \" re\\xADturn such an in\\xADstance and we can now use the id\\xADiomatic Scala way of han\\xADdling a Fu\\xADture.\"), mdx(\"h3\", {\n    \"id\": \"even-more\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#even-more\"\n  })), \"Even more\"), mdx(\"p\", null, \"Ex\\xADtend\\xADing classes with Future-\\u200Bmethods is only one of the new things to come. On top of that the sup\\xADport for DataOb\\xADjects will be con\\xADsid\\xADer\\xADably im\\xADproved, both through ex\\xADtend\\xADing them and by pro\\xADvid\\xADing type aliases.\"), mdx(\"p\", null, \"I also switched from doing all con\\xADver\\xADsions for col\\xADlec\\xADtions au\\xADto\\xADmat\\xADi\\xADcally to hand\\xADing the con\\xADtrol back to the user. Some\\xADthing which gets even more im\\xADpor\\xADtant for Scala 2.13 and the new col\\xADlec\\xADtion API.\"), mdx(\"h3\", {\n    \"id\": \"the-downside\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#the-downside\"\n  })), \"The downside\"), mdx(\"p\", null, \"The clear down\\xADside of this ap\\xADproach is that the Java-\\u200Bmethods will stay vis\\xADi\\xADble since the java-\\u200Bclasses won\\u2019t be wrapped but ex\\xADtended. This might lead to some con\\xADfu\\xADsion but I am pretty sure the ben\\xADe\\xADfits out\\xADweight this down\\xADside.\"), mdx(\"p\", null, \"The big\\xADger change will be the re\\xADmoval of au\\xADto\\xADmatic von\\xADver\\xADsion be\\xADtween Scala types (Long/Int/String and  Col\\xADlec\\xADtions) and their Java coun\\xADter\\xADparts. I spent con\\xADsid\\xADer\\xADable time try\\xADing to tune that part in the cur\\xADrent ver\\xADsion bbut al\\xADways ended up hit\\xADting some edge\\xADcase. For now I\\u2019ve de\\xADcided to have the user pick the right time to con\\xADvert.\"), mdx(\"p\", null, \"I might still add this fea\\xADture in a later ver\\xADsion if user feed\\xADback points into that di\\xADrec\\xADtion.\"), mdx(\"h2\", {\n    \"id\": \"when-will-i-get-it\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#when-will-i-get-it\"\n  })), \"When will I get it?\"), mdx(\"p\", null, \"First for the good news: There is al\\xADready a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-lang-scala/tree/4.0\"\n  }), \"branch\"), \" with a full im\\xADple\\xADmen\\xADta\\xADtion.\"), mdx(\"p\", null, \"The bad news: It will break until Vert.x 4.0 is fi\\xADnally re\\xADleased.\"), mdx(\"p\", null, \"Vert.x 4 is in ac\\xADtive de\\xADvel\\xADop\\xADment with most APIs al\\xADready fi\\xADnal\\xADized but break\\xADing changes still hap\\xADpen. So use at your own risk!\"), mdx(\"h2\", {\n    \"id\": \"what-about-scala-213\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#what-about-scala-213\"\n  })), \"What about Scala 2.13?\"), mdx(\"p\", null, \"Scala 2.13 has been re\\xADleased re\\xADcently which prompted ques\\xADtions from the com\\xADmu\\xADnity about when it will be sup\\xADported by Vert.x.\"), mdx(\"p\", null, \"I haven\\u2019t done a good job pro\\xADvid\\xADing the re\\xADsults of our in\\xADter\\xADnal dis\\xADcus\\xADsions on that topic to the com\\xADmu\\xADnity. So here we go:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Vert.x 3 will stay on 2.12 for the fol\\xADlow\\xADing rea\\xADsons:\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Both are still ac\\xADtively sup\\xADported\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Scala ecosys\\xADtems takes some time to do the switch to 2.13\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We sim\\xADply don\\u2019t have the ca\\xADpac\\xADity to sup\\xADport both ver\\xADsions \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"AND\"), \" the up\\xADcom\\xADing new ver\\xADsion\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Vert.x 4 will re\\xADceive 2.13 sup\\xADport\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Scala ecosys\\xADtem will have moved closer to 2.13 adop\\xADtion when Vert.x 4 comes out\")))), mdx(\"h2\", {\n    \"id\": \"for-the-adventure-seaker\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#for-the-adventure-seaker\"\n  })), \"For the adventure seaker\"), mdx(\"p\", null, \"I ac\\xADtu\\xADally did a port of vertx-\\u200Blang-scala 3.8 to Scala 2.13 and you can grab the work in this \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-lang-scala/tree/3.8_2.13\"\n  }), \"branch\"), \".\"), mdx(\"p\", null, \"Don\\u2019t ex\\xADpect \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"ANY\"), \" sup\\xADport for this branch. This was only an ex\\xADper\\xADi\\xADment to see how much I had to change for ini\\xADtial 2.13 sup\\xADport.\"), mdx(\"h2\", {\n    \"id\": \"summary\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#summary\"\n  })), \"Summary\"), mdx(\"p\", null, \"Vert.x 4 will be an evo\\xADlu\\xADtion\\xADary step for vertx-\\u200Blang-scala. Value classes promise to re\\xADduce both com\\xADplex\\xADity and al\\xADlo\\xADca\\xADtion rate, two things which have been bug\\xADging me quite a bit with the cur\\xADrent ap\\xADproach.\"), mdx(\"p\", null, \"I am eager to hear from you all what you think about this new di\\xADrec\\xADtion.\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p><strong>TL;DR:</strong></p><ul><li>No Scala 2.13 in Eclipse Vert.x 3.x due to in­creased sup­port bur­den</li><li>New value classes based ap­proach for Vert.x 4</li></ul><h2 id=\"retrospective\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#retrospective\"></a>Retrospective</h2><p>It’s been more than two years since the in­cep­tion of <code>vertx-lang-scala</code> to the Vert.x ecosys­tem. And al­most as long since I wrote my first <a href=\"/blog/scala-is-here/\">blog post</a> about it.</p><p>A lot has hap­pened since March 2017:</p><ul><li><code>vertx-lang-scala</code> kept up with new ver­sions of Scala</li><li>all Vert.x-​modules are sup­ported (35 so far)</li><li>a Giter8 based <a href=\"https://github.com/vert-x3/vertx-scala.g8\">tem­plate</a> was added for eas­ily boot­strap­ping a Vert.x-​Scala-project</li><li>Bugs were squashed</li></ul><p>And most re­cently we re­ceived a great con­tri­bu­tion by <a href=\"https://github.com/NikolajLeischner\">Niko­laj Leis­chner</a> who was kind enough to port the <a href=\"https://github.com/TechEmpower/FrameworkBenchmarks/tree/master/frameworks/Scala/vertx-web-scala\">techempow­ered</a> bench­mark to vert-​lang-scala. Which will be part of the next steps.</p><p>The num­bers pro­duced by this bench­mark were very promis­ing and and ad­di­tional mo­ti­va­tion to move to the next phase of Scala sup­port for Vert.x.</p><h2 id=\"old-idea\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#old-idea\"></a>Old idea</h2><p>Be­fore get­ting to the new ideas I want to take a look at the “old” one.</p><p>The cur­rent ver­sion of vert-​lang-scala is based around the idea of wrap­ping the Vert.x-API with a ded­i­cated Scala-​layer. That layer is cre­ated using a Freemarker-​based code gen­er­a­tor. I took this idea from the first try by Tim Fox for build­ing that sup­port.</p><p>Wrap­ping the ex­ist­ing Java-​API was rather painful but gave me great flex­i­bil­ity to cre­ate an id­iomatic Scala-​API.</p><p>But an ap­proach like that comes with a price:</p><ul><li>There are a lot of in­ter­me­di­ate ob­jects being cre­ated.</li><li>Many un­nec­ces­sary con­ver­sions be­tween Java/Scala types</li></ul><p>Both in­creased mem­ory con­sump­tion and garbage col­lec­tion ac­tiv­ity quite a bit and has been bug­ging me from the be­gin­ning.</p><h2 id=\"new-idea\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#new-idea\"></a>New idea</h2><p>With Vert.x 4 ap­proach­ing I was fi­nally able to in­vest time into the re­work I had wanted to do for quite a while.</p><p>The core idea is to re­place the cur­rent wrap­ping based ap­proach with some­thing more light­weight but na­tive to the Scala-​world.</p><p>And that’s where <a href=\"https://docs.scala-lang.org/overviews/core/value-classes.html\">value classes</a> come in.</p><p>Value classes allow the ex­ten­sion of ex­ist­ing classes with ad­di­tional meth­ods. They make it easy to con­trol <strong>when</strong> meth­ods be­come vis­i­ble and do that with a min­i­mum of over­head. To be pre­cise: A wrap­ping class is nor­mally ever only in­stan­ti­ated <strong>once</strong>.</p><p>A good ex­am­ple is the ad­di­tion of meth­ods for wrap­ping the Vert.x ap­proach of Promises with Scala-​Futures. Each method re­turn­ing a Vert.x-​Promise needs to re­ceive an al­ter­na­tive ver­sion which re­turns a Scala-​Future.</p><p>In Vert.x 3 I achieved that by adding meth­ods to the wrap­per and giv­ing them a dis­tinct name. A method called <strong>lis­ten</strong> re­turn­ing a Promise would re­ceive a com­pan­ion called <strong>lis­ten­Fu­ture</strong> in the Scala layer.</p><p>Let’s look at how this looks in the new ap­proach:</p><pre><code class=\"hljs language-scala\"><span class=\"hljs-keyword\">package</span> io.vertx.scala\n<span class=\"hljs-keyword\">package</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">object</span> <span class=\"hljs-title\">core</span></span>{\n   <span class=\"hljs-keyword\">implicit</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HttpServerScala</span>(<span class=\"hljs-params\">val asJava: io.vertx.core.http.<span class=\"hljs-type\">HttpServer</span></span>) <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AnyVal</span> </span>{\n      <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">listenFuture</span></span>(port: java.lang.<span class=\"hljs-type\">Integer</span>): scala.concurrent.<span class=\"hljs-type\">Future</span>[io.vertx.core.http.<span class=\"hljs-type\">HttpServer</span>] = {..}\n      ..\n}\n</code></pre><p>The code above does the fol­low­ing things:</p><ul><li>It cre­ates a pack­age ob­ject for <strong>io.vertx.scala.core</strong></li><li>it adds an im­plict class <strong>HttpServer­Scala</strong> to wrpa <strong>HttpServer</strong></li><li>it adds a <strong>lis­ten­Fu­ture</strong> method</li></ul><p>Using this method in code looks like this:</p><pre><code class=\"hljs language-scala\"><span class=\"hljs-keyword\">package</span> io.vertx.scala.demo\n\n<span class=\"hljs-keyword\">import</span> io.vertx.lang.scala.<span class=\"hljs-type\">VertxExecutionContext</span>\n<span class=\"hljs-keyword\">import</span> io.vertx.scala.core._\n\n<span class=\"hljs-keyword\">import</span> scala.util.{<span class=\"hljs-type\">Failure</span>, <span class=\"hljs-type\">Success</span>}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">object</span> <span class=\"hljs-title\">Main</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">main</span></span>(args: <span class=\"hljs-type\">Array</span>[<span class=\"hljs-type\">String</span>]): <span class=\"hljs-type\">Unit</span> = {\n    <span class=\"hljs-keyword\">val</span> vertx = <span class=\"hljs-type\">Vertx</span>.vertx()\n    <span class=\"hljs-keyword\">implicit</span> <span class=\"hljs-keyword\">val</span> ec = <span class=\"hljs-type\">VertxExecutionContext</span>(vertx.getOrCreateContext())\n    vertx\n      .createHttpServer()\n      .requestHandler(r =&gt; {\n        r.response().end(<span class=\"hljs-string\">&quot;bye&quot;</span>)\n      })\n      .listenFuture(<span class=\"hljs-number\">6667</span>)\n      .onComplete {\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-type\">Success</span>(_) =&gt; println(<span class=\"hljs-string\">&quot;Started&quot;</span>)\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-type\">Failure</span>(exception) =&gt; println(<span class=\"hljs-string\">&quot;Failure&quot;</span>)\n      }\n  }\n}\n</code></pre><p>Im­port­ing the pack­age ob­ject using <strong>im­port io.vertx.scala.core._</strong> brings the ex­ten­sion method into scope and makes them avail­able on all in­stances of <strong>HttpServer</strong>. In the ex­am­ple above <strong>cre­ate­HttpServer()</strong> re­turn such an in­stance and we can now use the id­iomatic Scala way of han­dling a Fu­ture.</p><h3 id=\"even-more\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#even-more\"></a>Even more</h3><p>Ex­tend­ing classes with Future-​methods is only one of the new things to come. On top of that the sup­port for DataOb­jects will be con­sid­er­ably im­proved, both through ex­tend­ing them and by pro­vid­ing type aliases.</p><p>I also switched from doing all con­ver­sions for col­lec­tions au­to­mat­i­cally to hand­ing the con­trol back to the user. Some­thing which gets even more im­por­tant for Scala 2.13 and the new col­lec­tion API.</p><h3 id=\"the-downside\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#the-downside\"></a>The downside</h3><p>The clear down­side of this ap­proach is that the Java-​methods will stay vis­i­ble since the java-​classes won’t be wrapped but ex­tended. This might lead to some con­fu­sion but I am pretty sure the ben­e­fits out­weight this down­side.</p><p>The big­ger change will be the re­moval of au­to­matic von­ver­sion be­tween Scala types (Long/Int/String and  Col­lec­tions) and their Java coun­ter­parts. I spent con­sid­er­able time try­ing to tune that part in the cur­rent ver­sion bbut al­ways ended up hit­ting some edge­case. For now I’ve de­cided to have the user pick the right time to con­vert.</p><p>I might still add this fea­ture in a later ver­sion if user feed­back points into that di­rec­tion.</p><h2 id=\"when-will-i-get-it\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#when-will-i-get-it\"></a>When will I get it?</h2><p>First for the good news: There is al­ready a <a href=\"https://github.com/vert-x3/vertx-lang-scala/tree/4.0\">branch</a> with a full im­ple­men­ta­tion.</p><p>The bad news: It will break until Vert.x 4.0 is fi­nally re­leased.</p><p>Vert.x 4 is in ac­tive de­vel­op­ment with most APIs al­ready fi­nal­ized but break­ing changes still hap­pen. So use at your own risk!</p><h2 id=\"what-about-scala-213\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#what-about-scala-213\"></a>What about Scala 2.13?</h2><p>Scala 2.13 has been re­leased re­cently which prompted ques­tions from the com­mu­nity about when it will be sup­ported by Vert.x.</p><p>I haven’t done a good job pro­vid­ing the re­sults of our in­ter­nal dis­cus­sions on that topic to the com­mu­nity. So here we go:</p><ul><li>Vert.x 3 will stay on 2.12 for the fol­low­ing rea­sons:<ul><li>Both are still ac­tively sup­ported</li><li>Scala ecosys­tems takes some time to do the switch to 2.13</li><li>We sim­ply don’t have the ca­pac­ity to sup­port both ver­sions <strong>AND</strong> the up­com­ing new ver­sion</li></ul></li><li>Vert.x 4 will re­ceive 2.13 sup­port<ul><li>Scala ecosys­tem will have moved closer to 2.13 adop­tion when Vert.x 4 comes out</li></ul></li></ul><h2 id=\"for-the-adventure-seaker\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#for-the-adventure-seaker\"></a>For the adventure seaker</h2><p>I ac­tu­ally did a port of vertx-​lang-scala 3.8 to Scala 2.13 and you can grab the work in this <a href=\"https://github.com/vert-x3/vertx-lang-scala/tree/3.8_2.13\">branch</a>.</p><p>Don’t ex­pect <strong>ANY</strong> sup­port for this branch. This was only an ex­per­i­ment to see how much I had to change for ini­tial 2.13 sup­port.</p><h2 id=\"summary\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#summary\"></a>Summary</h2><p>Vert.x 4 will be an evo­lu­tion­ary step for vertx-​lang-scala. Value classes promise to re­duce both com­plex­ity and al­lo­ca­tion rate, two things which have been bug­ging me quite a bit with the cur­rent ap­proach.</p><p>I am eager to hear from you all what you think about this new di­rec­tion.</p>","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 4 milestone 3 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The next milestone release of Vert.x 4 aims to provide a reliable distribution of the current development for people who want to try it and provide feedback."},"date":"2019-09-19","slug":"eclipse-vert-x-4-milestone-3-released"},"nextPost":{"meta":{"title":"Eclipse Vert.x 4 milestone 2 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The new milestone release of Vert.x 4 includes progress on futurisation, tracing, and many other improvements."},"date":"2019-08-26","slug":"eclipse-vert-x-4-milestone-2-released"},"relatedPosts":[{"meta":{"title":"Scala is here","category":"guides","authors":[{"name":"Jochen Mader","github_id":"codepitbull"}],"summary":"The rise of Scala as one of the most important languages on the JVM caught many (me included) by surprise. This hybrid of functional and imperative paradigms struck a chord with many developers."},"date":"2017-03-20","slug":"scala-is-here"},{"meta":{"title":"Building services and APIs with AMQP 1.0","category":"guides","authors":[{"name":"Jakub Scholz","github_id":"scholzj"}],"summary":"Microservices and APIs are everywhere. Everyone talks about them, presentation slides are full of them ... some people are actually even building them."},"date":"2017-01-25","slug":"building-services-and-apis-with-amqp-1-0"},{"meta":{"title":"Some Rest with Vert.x","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This post is part of the Introduction to Vert.x series. Let’s go a bit further this time and develop a CRUD-ish application"},"date":"2015-07-27","slug":"some-rest-with-vert-x"}]},"__N_SSG":true}