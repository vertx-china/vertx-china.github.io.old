{"pageProps":{"slug":"4.0.0/vertx-ignite/java","title":"Vert.x 的 Apache Ignite 集群管理器","fallbackGitHubStars":null,"toc":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_using_ignite_cluster_manager\">使用 Ignite 集群管理器</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_using_vertx_from_command_line\">Vert.x 命令行模式</a></li>\n<li><a href=\"#_using_vertx_in_maven_or_gradle_project\">在 Maven 或 Gradle 项目中使用 Vert.x</a></li>\n<li><a href=\"#_programmatically_specifying_cluster_manager\">通过编程配置集群管理器</a></li>\n</ul>\n</li>\n<li><a href=\"#_configuring_cluster_manager\">配置集群管理器</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_using_configuration_file\">使用配置文件</a></li>\n<li><a href=\"#_configuring_programmatically\">通过编程配置</a></li>\n<li><a href=\"#_discovery_and_network_transport_configuration\">服务发现与网络传输配置</a></li>\n</ul>\n</li>\n<li><a href=\"#_trouble_shooting_clustering\">集群故障排除</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_multicast_not_enabled_on_the_machine\">机器禁用组播</a></li>\n<li><a href=\"#_using_wrong_network_interface\">使用了错误的网络接口</a></li>\n<li><a href=\"#_using_a_vpn\">使用VPN</a></li>\n<li><a href=\"#_when_multicast_is_not_available\">组播不可用</a></li>\n<li><a href=\"#_enabling_logging\">开启日志</a></li>\n</ul>\n</li>\n</ul>\n</div>","contents":"<h1>Vert.x 的 Apache Ignite 集群管理器</h1>\n\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>本项目基于 <a href=\"http://ignite.apache.org/index.html\">Apache Ignite</a> 实现了 Vert.x 的集群管理器。</p>\n</div>\n<div class=\"paragraph\">\n<p>Vert.x 集群管理器包含以下几项功能：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>发现并管理集群中的节点</p>\n</li>\n<li>\n<p>管理集群的 EventBus 地址订阅清单（这样就可以轻松得知集群中的哪些节点订阅了哪些\nEventBus 地址）</p>\n</li>\n<li>\n<p>分布式 Map 支持</p>\n</li>\n<li>\n<p>分布式锁</p>\n</li>\n<li>\n<p>分布式计数器</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Vert.x 集群器 <strong>并不</strong> 处理节点之间的通信。在 Vert.x 中，集群节点间通信是直接由\nTCP 连接处理的。</p>\n</div>\n<div class=\"paragraph\">\n<p>Vert.x 集群管理器是可插拔的组件，您可以选择您想用的或最适用于您的环境的集群管理器。\n因此可以用本项目的实现替代 Vert.x 的默认集群管理器（译者注：指 Hazelcast）。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_ignite_cluster_manager\"><a class=\"anchor\" href=\"#_using_ignite_cluster_manager\"></a>使用 Ignite 集群管理器</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>如果（集群管理器的）jar 包在 classpath 中，Vert.x将自动检测到并将其作为集群管理器。\n需要注意的是，要确保 Vert.x 的 classpath 中没有其它的集群管理器实现，否则会使用错误的集群管理器。</p>\n</div>\n<div class=\"paragraph\">\n<p>还可以通过配置以下系统属性来指定 Vert.x 集群管理器 为 Ignite：\n<code>-Dvertx.clusterManagerFactory=io.vertx.spi.cluster.ignite.IgniteClusterManager</code></p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_vertx_from_command_line\"><a class=\"anchor\" href=\"#_using_vertx_from_command_line\"></a>Vert.x 命令行模式</h3>\n<div class=\"paragraph\">\n<p>请将 <code>vertx-ignite-4.0.0.jar</code> 放入 Vert.x 中安装路径的 <code>lib</code> 目录中。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_vertx_in_maven_or_gradle_project\"><a class=\"anchor\" href=\"#_using_vertx_in_maven_or_gradle_project\"></a>在 Maven 或 Gradle 项目中使用 Vert.x</h3>\n<div class=\"paragraph\">\n<p>在项目配置文件中增加以下依赖：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven （位于 <code>pom.xml</code> ）：</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-ignite<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle （位于 <code>build.gradle</code> ）：</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">compile <span class=\"hljs-string\">'io.vertx:vertx-ignite:4.0.0'</span></code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_programmatically_specifying_cluster_manager\"><a class=\"anchor\" href=\"#_programmatically_specifying_cluster_manager\"></a>通过编程配置集群管理器</h3>\n<div class=\"paragraph\">\n<p>您也可以通过编程的形式配置集群管理器。\n在构建 Vert.x 实例时，可以通过配置（VertxOptions）指定集群管理器，如：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">ClusterManager clusterManager = <span class=\"hljs-keyword\">new</span> IgniteClusterManager();\n\nVertxOptions options = <span class=\"hljs-keyword\">new</span> VertxOptions().setClusterManager(clusterManager);\nVertx.clusteredVertx(options, res -&gt; {\n <span class=\"hljs-keyword\">if</span> (res.succeeded()) {\n   Vertx vertx = res.result();\n } <span class=\"hljs-keyword\">else</span> {\n   <span class=\"hljs-comment\">// 失败！</span>\n }\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_configuring_cluster_manager\"><a class=\"anchor\" href=\"#_configuring_cluster_manager\"></a>配置集群管理器</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>请注意：Apache Ignite 从2.0版本开始引入了新的堆外内存机制。\n所有缓存默认使用堆外内存。\n新的内存机制详情请参阅 <a href=\"https://apacheignite.readme.io/docs/page-memory\">Ignite 虚拟内存</a>。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_configuration_file\"><a class=\"anchor\" href=\"#_using_configuration_file\"></a>使用配置文件</h3>\n<div class=\"paragraph\">\n<p>Ignite 集群管理器通过 <code>default-ignite.json</code> 文件配置，该文件已经打包在依赖jar包中。</p>\n</div>\n<div class=\"paragraph\">\n<p>如果要覆盖此配置，可以在 classpath 中添加一个 <code>ignite.json</code> 文件。\n这个配置文件会被解析映射为 <code><a href=\"../../apidocs/io/vertx/spi/cluster/ignite/IgniteOptions.html\">IgniteOptions</a></code> 实例，\n在这个类里可以找到每个配置项的详细信息。</p>\n</div>\n<div class=\"paragraph\">\n<p>下面的例子在默认配置的基础上，启用了集群通信 TLS。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-json\" data-lang=\"json\">{\n <span class=\"hljs-attr\">\"cacheConfiguration\"</span>: [{\n   <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"__vertx.*\"</span>,\n   <span class=\"hljs-attr\">\"cacheMode\"</span>: <span class=\"hljs-string\">\"REPLICATED\"</span>,\n   <span class=\"hljs-attr\">\"readFromBackup\"</span>: <span class=\"hljs-literal\">false</span>,\n   <span class=\"hljs-attr\">\"atomicityMode\"</span>: <span class=\"hljs-string\">\"ATOMIC\"</span>,\n   <span class=\"hljs-attr\">\"writeSynchronizationMode\"</span>: <span class=\"hljs-string\">\"FULL_SYNC\"</span>\n }, {\n   <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"*\"</span>,\n   <span class=\"hljs-attr\">\"cacheMode\"</span>: <span class=\"hljs-string\">\"PARTITIONED\"</span>,\n   <span class=\"hljs-attr\">\"backups\"</span>: <span class=\"hljs-number\">1</span>,\n   <span class=\"hljs-attr\">\"readFromBackup\"</span>: <span class=\"hljs-literal\">false</span>,\n   <span class=\"hljs-attr\">\"atomicityMode\"</span>: <span class=\"hljs-string\">\"ATOMIC\"</span>,\n   <span class=\"hljs-attr\">\"writeSynchronizationMode\"</span>: <span class=\"hljs-string\">\"FULL_SYNC\"</span>\n }],\n <span class=\"hljs-attr\">\"sslContextFactory\"</span>: {\n   <span class=\"hljs-attr\">\"protocol\"</span>: <span class=\"hljs-string\">\"TLSv1.2\"</span>,\n   <span class=\"hljs-attr\">\"keyStoreFilePath\"</span>: <span class=\"hljs-string\">\"server.jks\"</span>,\n   <span class=\"hljs-attr\">\"keyStorePassword\"</span>: <span class=\"hljs-string\">\"changeme\"</span>,\n   <span class=\"hljs-attr\">\"trustStoreFilePath\"</span>: <span class=\"hljs-string\">\"server.jks\"</span>,\n   <span class=\"hljs-attr\">\"trustStorePassword\"</span>: <span class=\"hljs-string\">\"changeme\"</span>,\n   <span class=\"hljs-attr\">\"trustAll\"</span>: <span class=\"hljs-literal\">false</span>\n },\n <span class=\"hljs-attr\">\"includeEventTypes\"</span>: [<span class=\"hljs-string\">\"EVT_CACHE_OBJECT_PUT\"</span>, <span class=\"hljs-string\">\"EVT_CACHE_OBJECT_REMOVED\"</span>],\n <span class=\"hljs-attr\">\"metricsLogFrequency\"</span>: <span class=\"hljs-number\">0</span>,\n <span class=\"hljs-attr\">\"shutdownOnSegmentation\"</span>: <span class=\"hljs-literal\">true</span>\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Ignite 的配置除了上述的 json 格式，也可以选用 XML 格式。\n在 classpath 中添加 <code>ignite.xml</code> 文件，Ignite 将使用它作为配置文件。</p>\n</div>\n<div class=\"paragraph\">\n<p>首先，增加 <code>ignite-spring</code> 依赖。</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven （位于 <code>pom.xml</code> ）：</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.ignite<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ignite-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${ignite.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle （位于 `build.gradle `）：</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">compile <span class=\"hljs-string\">'org.apache.ignite:ignite-spring:${ignite.version}'</span></code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>然后新增一个 <code>ignite.xml</code> 文件，像这样：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n      <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n      <span class=\"hljs-attr\">xmlns:util</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/util\"</span>\n      <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\n                          http://www.springframework.org/schema/beans/spring-beans.xsd\n                          http://www.springframework.org/schema/util\n                          http://www.springframework.org/schema/util/spring-util.xsd\"</span>&gt;</span>\n\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.configuration.IgniteConfiguration\"</span>&gt;</span>\n\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"discoverySpi\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi\"</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"ipFinder\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.spi.discovery.tcp.ipfinder.multicast.TcpDiscoveryMulticastIpFinder\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cacheConfiguration\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">list</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.configuration.CacheConfiguration\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"name\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"__vertx.*\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cacheMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REPLICATED\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"readFromBackup\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"false\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"atomicityMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"ATOMIC\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"writeSynchronizationMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"FULL_SYNC\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.configuration.CacheConfiguration\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"name\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"*\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cacheMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"PARTITIONED\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"backups\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"1\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"readFromBackup\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"false\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"atomicityMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"ATOMIC\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"affinity\"</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.ignite.cache.affinity.rendezvous.RendezvousAffinityFunction\"</span>&gt;</span>\n             <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"partitions\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"128\"</span>/&gt;</span>\n           <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"writeSynchronizationMode\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"FULL_SYNC\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">list</span>&gt;</span>\n   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"includeEventTypes\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">list</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">util:constant</span> <span class=\"hljs-attr\">static-field</span>=<span class=\"hljs-string\">\"org.apache.ignite.events.EventType.EVT_CACHE_OBJECT_PUT\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">util:constant</span> <span class=\"hljs-attr\">static-field</span>=<span class=\"hljs-string\">\"org.apache.ignite.events.EventType.EVT_CACHE_OBJECT_REMOVED\"</span>/&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">list</span>&gt;</span>\n   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"gridLogger\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"io.vertx.spi.cluster.ignite.impl.VertxLogger\"</span>/&gt;</span>\n   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"metricsLogFrequency\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>json 格式的配置文件是 xml 配置文件的简化版，\n更多详情请参阅 <a href=\"https://apacheignite.readme.io/docs\">Apache Ignite 文档</a>。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_configuring_programmatically\"><a class=\"anchor\" href=\"#_configuring_programmatically\"></a>通过编程配置</h3>\n<div class=\"paragraph\">\n<p>您也可以通过编程的形式配置集群管理器：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">IgniteConfiguration cfg = <span class=\"hljs-keyword\">new</span> IgniteConfiguration();\n<span class=\"hljs-comment\">// 配置的代码（省略）</span>\n\nClusterManager clusterManager = <span class=\"hljs-keyword\">new</span> IgniteClusterManager(cfg);\n\nVertxOptions options = <span class=\"hljs-keyword\">new</span> VertxOptions().setClusterManager(clusterManager);\nVertx.clusteredVertx(options, res -&gt; {\n <span class=\"hljs-keyword\">if</span> (res.succeeded()) {\n   Vertx vertx = res.result();\n } <span class=\"hljs-keyword\">else</span> {\n   <span class=\"hljs-comment\">// 失败！</span>\n }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_discovery_and_network_transport_configuration\"><a class=\"anchor\" href=\"#_discovery_and_network_transport_configuration\"></a>服务发现与网络传输配置</h3>\n<div class=\"paragraph\">\n<p>Ignite 默认配置使用 <code>TcpDiscoveryMulticastIpFinder</code> ，因此您的网络必须保证组播可用。\n对于禁用组播的情况，应将 <code>TcpDiscoveryVmIpFinder</code> 与预先配置的IP地址列表一起使用。\n更多详细信息请参阅 Apache Ignite 文档的\n<a href=\"http://apacheignite.readme.io/docs/cluster-config\">集群配置</a> 章节。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_trouble_shooting_clustering\"><a class=\"anchor\" href=\"#_trouble_shooting_clustering\"></a>集群故障排除</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>如果默认的组播配置不能正常运行，通常有以下原因：</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_multicast_not_enabled_on_the_machine\"><a class=\"anchor\" href=\"#_multicast_not_enabled_on_the_machine\"></a>机器禁用组播</h3>\n<div class=\"paragraph\">\n<p>Ignite 集群管理器默认使用 <code>TcpDiscoveryMulticastIpFinder</code> ，因此需要IP组播。\n对于某些操作系统，需要将组播路由增加到路由表，否则会使用默认路由。</p>\n</div>\n<div class=\"paragraph\">\n<p>请注意，某些操作系统只为单播路由查询路由表，而不为IP组播路由查询路由表。</p>\n</div>\n<div class=\"paragraph\">\n<p>MacOS 可参考：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre># 为 224.0.0.1-231.255.255.254 增加组播路由\nsudo route add -net 224.0.0.0/5 127.0.0.1\n\n# 为 232.0.0.1-239.255.255.254 增加组播路由\nsudo route add -net 232.0.0.0/5 192.168.1.3</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>请自行Google搜索更多相关信息。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_wrong_network_interface\"><a class=\"anchor\" href=\"#_using_wrong_network_interface\"></a>使用了错误的网络接口</h3>\n<div class=\"paragraph\">\n<p>如果机器上有多个网络接口（也有可能是在运行 VPN 的情况下），\n那么 Apache Ignite 很有可能使用错误的网络接口。</p>\n</div>\n<div class=\"paragraph\">\n<p>为了确保 Ignite 使用正确的网络接口，\n可以在 <code>IgniteConfiguration</code> bean对象中将 <code>localHost</code> 属性设置为正确的网络接口IP地址，如：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>{\n \"localHost\": \"192.168.1.20\"\n}</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Vert.x 运行在集群模式时，必须确保 Vert.x 获取到正确的网络接口。\n在 Vert.x 命令行模式下，可以通过 <code>cluster-host</code> 选项指定集群的网络接口：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>vertx run myverticle.js -cluster -cluster-host your-ip-address</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>其中 <code>your-ip-address</code> 与 Apache Ignite 配置中指定的IP地址一致。</p>\n</div>\n<div class=\"paragraph\">\n<p>若使用编码的方式启动 Vert.x，可以通过 <code><a href=\"../../apidocs/io/vertx/core/VertxOptions.html#getEventBusOptions--\">.setHost(java.lang.String)</a></code> 设置集群的网络接口。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_a_vpn\"><a class=\"anchor\" href=\"#_using_a_vpn\"></a>使用VPN</h3>\n<div class=\"paragraph\">\n<p>使用VPN是上述问题的变种。\nVPN 软件工作时通常会创建虚拟网络接口，但往往不支持组播。\n在 VPN 环境中，如果 Ignite 与 Vert.x 没有配置正确的话，将会选择 VPN 创建的网络接口，而不是正确的网络接口。</p>\n</div>\n<div class=\"paragraph\">\n<p>所以，如果您的应用运行在 VPN 环境中，请参考上述章节，为 Ignite 和 Vert.x 设置正确的网络接口。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_when_multicast_is_not_available\"><a class=\"anchor\" href=\"#_when_multicast_is_not_available\"></a>组播不可用</h3>\n<div class=\"paragraph\">\n<p>在某些情况下，由于特殊的运行环境，可能无法使用组播。\n在这种情况下，应该配置 IP finder 以使用其他传输方式，例如配置 <code>TcpDiscoveryVmIpFinder</code> 以使用 TCP 套接字，或配置 <code>TcpDiscoveryS3IpFinder</code> 以使用亚马逊 S3。</p>\n</div>\n<div class=\"paragraph\">\n<p>有关可用的 Ignite 传输方式、以及如何配置启用传输方式的更多信息，\n请查阅 <a href=\"https://apacheignite.readme.io/docs/clustering\">Ignite集群</a> 文档。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_enabling_logging\"><a class=\"anchor\" href=\"#_enabling_logging\"></a>开启日志</h3>\n<div class=\"paragraph\">\n<p>在排除故障时，开启 Ignite 日志很有帮助，可以观察是否组成了集群。\n使用默认的 JUL 日志时，在 classpath 中添加 <code>vertx-default-jul-logging.properties</code> 文件可开启 Ignite 日志。\n这是一个标准 java.util.logging（JUL） 配置文件。\n具体配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>org.apache.ignite.level=INFO</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>以及</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>java.util.logging.ConsoleHandler.level=INFO\njava.util.logging.FileHandler.level=INFO</pre>\n</div>\n</div>\n</div>\n</div>\n</div>","version":"4.0.0"},"__N_SSG":true}