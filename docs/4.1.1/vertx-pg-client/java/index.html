<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>PostgreSQL 客户端 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/eclipse-vertx/vertx-sql-client" as="fetch" crossorigin="anonymous" class="jsx-d38685edc31911e0"/><meta name="next-head-count" content="14"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-f635b472c367d1c7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d7fe1c01d653763a.js" defer=""></script><script src="/_next/static/chunks/615-af27e2775b51966c.js" defer=""></script><script src="/_next/static/chunks/619-afdae842ceadd4b2.js" defer=""></script><script src="/_next/static/chunks/81-19fda51682297a85.js" defer=""></script><script src="/_next/static/chunks/536-73f48e3d0957cf20.js" defer=""></script><script src="/_next/static/chunks/434-02978711e0879a69.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-810f1ca9040e790a.js" defer=""></script><script src="/_next/static/9CgN7uHHZZ2w0yPW8PB89/_buildManifest.js" defer=""></script><script src="/_next/static/9CgN7uHHZZ2w0yPW8PB89/_ssgManifest.js" defer=""></script><script src="/_next/static/9CgN7uHHZZ2w0yPW8PB89/_middlewareManifest.js" defer=""></script><style id="__jsx-400ec7965926e858">.dropdown-item.jsx-400ec7965926e858{white-space:nowrap;
line-height:2;
width:100%;
padding:0 1.5rem;
cursor:pointer}
.dropdown-item.jsx-400ec7965926e858:hover{background-color:#e9ecef}
.dropdown-item.active.jsx-400ec7965926e858{font-weight:400;
padding-left:.75rem}
.dropdown-item.has-active-siblings.jsx-400ec7965926e858:not(.active){padding-left:calc(0.75rem + 16px + 0.5em)}
.dropdown-item.jsx-400ec7965926e858 .dropdown-check-icon.jsx-400ec7965926e858{width:16px;
margin-right:.5em;
margin-top:1px}</style><style id="__jsx-6650573c8f14945d">.dropdown.jsx-6650573c8f14945d{position:relative;
display:inline-block}
.dropdown.jsx-6650573c8f14945d .dropdown-title.jsx-6650573c8f14945d{margin-right:0;
cursor:pointer;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d{position:absolute;
background-color:#f8f9fa;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
border-radius:.8rem;
list-style-type:none;
padding:.6666666667rem 0;
margin:.25rem 0 0 0;
z-index:100;
display:none;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a{color:#4d4d4d;
-webkit-text-decoration:none;
text-decoration:none;
font-weight:300}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.align-right.jsx-6650573c8f14945d{right:0}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.visible.jsx-6650573c8f14945d{display:block}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a.jsx-6650573c8f14945d:hover{color:inherit}
.dropdown.jsx-6650573c8f14945d svg{margin-bottom:2px}</style><style id="__jsx-2203c38892fc1ef8">.navbar{position:absolute;
top:2.75rem;
width:100%}
.navbar a{color:#3c3c3b}
.navbar a.navbar-menu-item, .navbar .dropdown-title{text-transform:uppercase}
.navbar a.navbar-menu-item:hover, .navbar .dropdown-title:hover{-webkit-text-decoration:none;
text-decoration:none;
color:#898987;
-webkit-transition:color .15s ease-in-out;
transition:color .15s ease-in-out}
.navbar .navbar-content{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
position:relative}
.navbar .navbar-content .navbar-logo{-webkit-flex:1;
-ms-flex:1;
flex:1}
.navbar .navbar-content .navbar-logo img{width:8.3rem}
.navbar .navbar-content .navbar-collapse-button{display:none;
cursor:pointer}
@media (max-width:1000px) {.navbar .navbar-content .navbar-collapse-button{display:inline-block}}
.navbar .navbar-content .navbar-collapse-button span{display:block;
width:33px;
height:4px;
margin-bottom:5px;
position:relative;
background:#3c3c3b;
border-radius:3px;
z-index:1;
transform-origin:4px 0;
-webkit-transition:-webkit-transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease;
transition:transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease}
.navbar .navbar-content .navbar-collapse-button span:first-child{transform-origin:0% 0%}
.navbar .navbar-content .navbar-collapse-button span:nth-last-child(2){transform-origin:0% 100%}
.navbar .navbar-content .navbar-right{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline;
margin-bottom:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-right{max-height:0;
-webkit-transition:max-height 200ms ease-in-out;
transition:max-height 200ms ease-in-out;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:absolute;
top:2.75rem;
left:.8rem;
right:.8rem;
background-color:#f8f9fa;
overflow-x:auto;
overflow-y:hidden}}
.navbar .navbar-content .navbar-menu .navbar-menu-item{font-weight:400;
margin-right:2.5rem}
.navbar .navbar-content .navbar-menu .navbar-menu-item.with-drop-down{margin-right:1.8rem}
@media (max-width:1250px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{margin-right:1.5rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{display:block;
margin-bottom:1rem;
font-size:1.2rem}}
.navbar .navbar-content .navbar-menu .navbar-menu-item .external-link-icon{margin-left:.25em}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
padding:1rem}}
.navbar .navbar-content .navbar-social{margin-left:1.6rem;
font-size:.875rem}
.navbar .navbar-content .navbar-social svg{height:16px;
margin-bottom:2px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social svg{height:1rem}}
@media (max-width:1250px) {.navbar .navbar-content .navbar-social{margin-left:1rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social{margin-left:auto;
padding:0 1rem 1rem 0;
font-size:1rem}}
.navbar .navbar-content .navbar-social .qq-guild-parent{position:relative}
.navbar .navbar-content .navbar-social .qq-guild-parent .qq-guild{position:absolute;
right:0;
top:20px;
width:394.8px;
height:519.6px;
box-shadow:1px 1px 3px 0 #868686;
border-radius:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social .qq-guild-parent .qq-guild{display:none}}
.navbar .navbar-content .navbar-social .qq-guild-parent .qq-guild img{width:394.8px;
height:519.6px;
border-radius:15px}
@media (max-width:768px) {.navbar{top:1rem}}
.page .navbar{top:0;
padding-top:1.5rem;
padding-bottom:1rem;
position:fixed;
background-color:#fff;
z-index:2}</style><style id="__jsx-20d862052e50feff">.search input{color:#adb5bd;
border:1px solid #dee2e6;
border-radius:.4rem;
font-size:.875rem;
padding:.25rem 1.8rem .35rem 1.8rem;
width:100%;
-webkit-transition:color .15s ease-in-out, border-color .15s ease-in-out;
transition:color .15s ease-in-out, border-color .15s ease-in-out}
.search input:focus{border-color:#adb5bd;
color:#3c3c3b}
.search .search-icon, .search .search-icon-delete{position:absolute;
top:.55rem;
height:1rem;
stroke:#adb5bd;
-webkit-transition:stroke .15s ease-in-out;
transition:stroke .15s ease-in-out}
.search .search-icon{left:.4rem}
.search input:focus+.search-icon{stroke:#6f6970}
.search .search-icon-delete{stroke:#6f6970;
right:.4rem;
height:.75rem;
top:.7rem;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out;
cursor:text}
.search.has-content .search-icon-delete{opacity:1;
cursor:pointer}</style><style id="__jsx-117e429f22e394dc">.search-results, .search-results-none{font-size:.875rem;
overflow:auto;
list-style-type:none;
padding-left:0;
display:none}
.search-results.visible, .search-results-none.visible{display:block}
.search-results{list-style-type:none;
padding:0;
margin-bottom:0}
.search-results li{display:block;
padding:.5rem;
margin-bottom:1rem;
border-radius:.4rem;
border:1px solid transparent;
cursor:pointer}
.search-results li.active{background-color:#f8f9fa;
border:1px solid #e9ecef}
.search-results li h5{margin:0 0 .5rem 0;
font-size:1em}
.search-results li .search-results-highlight{background-color:#ff0}
.search-results-none{padding:1rem .5rem;
text-align:center;
width:100%}</style><style id="__jsx-d1843944f2d67b">.search-panel{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:relative}</style><style id="__jsx-d38685edc31911e0">.github-stars.jsx-d38685edc31911e0{display:inline-block}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0{margin-right:.25em}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0 svg{height:1rem}</style><style id="__jsx-aeedcf66895f49d7">footer{font-size:.875rem;
padding-top:3rem;
padding-bottom:4rem;
background-color:#f8f9fa;
border-top:1px solid #dee2e6;
margin-top:1rem;
color:#6f6970}
footer h5{font-size:1rem;
margin-top:0;
margin-bottom:1rem;
color:#3c3c3b;
text-transform:uppercase}
footer ul{padding:0;
list-style:none;
line-height:2}
footer a{color:#6f6970}
footer .footer-logo img, footer .footer-copyright-eclipse-logo img{-webkit-filter:grayscale(100);
filter:grayscale(100);
opacity:.5;
-webkit-transition:all .15s ease-in-out;
transition:all .15s ease-in-out}
footer .footer-logo img:hover, footer .footer-copyright-eclipse-logo img:hover{-webkit-filter:grayscale(0);
filter:grayscale(0);
opacity:1}
footer .footer-nav-section{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
margin-bottom:6rem}
footer .footer-nav-section .footer-logo{margin-top:.4rem}
footer .footer-nav-section .footer-logo img{width:8.3rem}
footer .footer-nav-section .footer-nav-list{width:20%}
footer .footer-copyright{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
footer .footer-copyright a{white-space:nowrap}
footer .footer-copyright .footer-copyright-eclipse-logo{width:17%;
margin-bottom:.5rem}
@media (max-width:1250px) {footer .footer-copyright .footer-copyright-break{display:none}
footer .footer-copyright .footer-copyright-eclipse-logo{width:30%}}
@media (max-width:1000px) {footer .footer-nav-section .footer-nav-list{width:25%}
footer .footer-copyright .footer-copyright-break{display:inline-block}
footer .footer-copyright .footer-copyright-eclipse-logo{width:40%}}
@media (max-width:768px) {footer .footer-nav-section{max-width:100%;
margin-left:auto;
margin-right:auto}}
@media (max-width:640px) {footer .footer-nav-section{max-width:80%;
margin-bottom:3rem;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
footer .footer-nav-section h5{cursor:pointer}
footer .footer-nav-section h5::after{display:inline-block;
content:"";
border-top:.4em solid;
border-right:.4em solid transparent;
border-bottom:0;
border-left:.4em solid transparent;
position:absolute;
top:.75rem;
right:0}
footer .footer-nav-section .footer-nav-list{width:100%;
position:relative}
footer .footer-nav-section .footer-nav-list ul{overflow-y:hidden;
max-height:0;
-webkit-transition:all 200ms ease-in-out;
transition:all 200ms ease-in-out}
footer .footer-nav-section .footer-nav-list ul.visible{margin-bottom:2rem}
footer .footer-nav-section .footer-logo{margin:0 auto 3rem auto;
width:auto}
footer .footer-copyright{max-width:80%;
text-align:center;
margin-left:auto;
margin-right:auto;
-webkit-flex-direction:column-reverse;
-ms-flex-direction:column-reverse;
flex-direction:column-reverse}
footer .footer-copyright .footer-copyright-eclipse-logo{width:7.6rem;
margin-bottom:1rem}}</style><style id="__jsx-efcc50be384cabc7">.page-content{margin-top:6em;
margin-bottom:8rem}
.docs .docs-content .docs-content-wrapper{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between}
.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 17rem;
-ms-flex:0 0 17rem;
flex:0 0 17rem}
.docs .docs-content .docs-content-wrapper aside .docs-content-wrapper-sidebar{position:-webkit-sticky;
position:sticky;
top:7em}
.docs .docs-content .docs-content-wrapper aside .search-panel{margin-top:1rem;
width:100%}
.docs .docs-content .docs-content-wrapper aside .search-panel .search-results{max-height:calc(100vh - 10rem - 1px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc{margin-top:1rem;
overflow-y:auto;
max-height:calc(100vh - 10rem - 3px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc #toctitle{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul{margin-top:0;
padding-left:0;
list-style-type:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul.sectlevel2{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul li{padding:.3333333333rem 0}
.docs .docs-content .docs-content-wrapper aside.docs-has-search-results .docs-content-toc{display:none}
@media (max-width:1250px) {.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 15rem;
-ms-flex:0 0 15rem;
flex:0 0 15rem}}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper aside{z-index:1;
position:fixed;
top:0;
right:0;
width:25rem;
height:100vh;
max-width:100%;
padding-top:6rem;
padding-left:2rem;
padding-right:2rem;
background-color:#fff;
border-left:1px solid #dee2e6;
-webkit-transform:translateX(100%);
-moz-transform:translateX(100%);
-ms-transform:translateX(100%);
transform:translateX(100%);
-webkit-transition:-webkit-transform 200ms ease-in-out;
transition:transform 200ms ease-in-out;
will-change:transform}
.docs .docs-content .docs-content-wrapper aside.collapse{-webkit-transform:translateX(0%);
-moz-transform:translateX(0%);
-ms-transform:translateX(0%);
transform:translateX(0%)}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper aside{min-width:100%;
border-left:none}}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{z-index:1000;
cursor:pointer;
display:none;
position:fixed;
-webkit-justify-content:center;
justify-content:center;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
right:2rem;
bottom:2rem;
color:#fff;
background-color:#4d4d4d;
padding:.5rem;
border-radius:.8rem;
-webkit-transition:background-color .15s ease-in-out;
transition:background-color .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-list, .docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{display:block}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{position:absolute;
left:0;
top:0;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle:hover{background-color:#3c3c3b}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-list{opacity:0}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-x{opacity:1}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{right:1rem;
bottom:1rem}}
.docs .docs-content .docs-content-inner{max-width:calc(100% - 19.5rem);
overflow:hidden}
.docs .docs-content .docs-content-inner .docs-content-metadata{margin-top:1.2rem;
margin-bottom:1.2rem;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
flex-wrap:wrap;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-repo{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-flex:1;
-ms-flex:1;
flex:1}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*{margin-right:2rem}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*:last-child{margin-right:0}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
color:#6f6970;
white-space:nowrap}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a:hover{color:#782b90}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a .feather{margin-right:.25em;
height:1rem}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{flex-wrap:wrap;
margin-bottom:1rem}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-flex:1;
-ms-flex:1;
flex:1;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
@media (min-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-box-pack:end;
-ms-flex-pack:end;
-webkit-justify-content:flex-end;
justify-content:flex-end}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:16px;
margin-bottom:-2px}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:1rem;
margin-bottom:-1px}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a{-webkit-text-decoration:none;
text-decoration:none}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a:hover{color:#6f6970}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-label{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-left:2rem}
.docs .docs-content .docs-content-inner h1{padding-top:0;
margin-top:.6rem;
line-height:1.2}
.docs .docs-content .docs-content-inner h1::after{content:"";
width:30%;
display:block;
border:2px solid #782b90;
border-radius:2px;
margin-top:1.1rem}
.docs .docs-content .docs-content-inner .ulist>ul{padding-left:1.1rem}
.docs .docs-content .docs-content-inner h2{border-top:1px solid #dee2e6;
margin-top:5rem;
padding-top:2rem}
.docs .docs-content .docs-content-inner h3, .docs .docs-content .docs-content-inner h4{margin-top:3rem}
@media (max-width:1250px) {.docs .docs-content .docs-content-inner{max-width:calc(100% - 17.5rem)}}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner{max-width:100%}}
.docs .docs-content .admonitionblock{border-top-right-radius:.8rem;
border-bottom-right-radius:.8rem;
background-color:#f8f9fa;
padding:1rem;
margin:1.5rem 0;
border-left:9px solid transparent}
.docs .docs-content .admonitionblock.note, .docs .docs-content .admonitionblock.tip{border-color:#6cb9f0}
.docs .docs-content .admonitionblock.important, .docs .docs-content .admonitionblock.warning, .docs .docs-content .admonitionblock.caution{border-color:#f0a46c}
.docs .docs-content .admonitionblock tr{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.docs .docs-content .admonitionblock .title{font-weight:400}
.docs .docs-content .admonitionblock .title::after{content:":"}
.docs .docs-content dt{font-weight:400}
.docs .docs-content .anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.docs .docs-content .anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.docs .docs-content .anchor:hover{opacity:1}
.docs .docs-content h2:hover .anchor, .docs .docs-content h3:hover .anchor, .docs .docs-content h4:hover .anchor, .docs .docs-content h5:hover .anchor, .docs .docs-content h6:hover .anchor{opacity:1}
.docs .docs-content h1 .anchor{display:none}
.docs .docs-content h4 .anchor::after, .docs .docs-content h5 .anchor::after, .docs .docs-content h6 .anchor::after{padding-right:.6rem}</style><style id="__jsx-7824b3ad3820c879">html{line-height:1.15;
-webkit-text-size-adjust:100%}
body{margin:0}
main{display:block}
h1{font-size:2em;
margin:.67em 0}
hr{box-sizing:content-box;
height:0;
overflow:visible}
pre{font-family:monospace, monospace;
font-size:1em}
a{background-color:transparent}
abbr[title]{border-bottom:none;
text-decoration:underline;
text-decoration:underline dotted}
b, strong{font-weight:bolder}
code, kbd, samp{font-family:monospace, monospace;
font-size:1em}
small{font-size:80%}
sub, sup{font-size:75%;
line-height:0;
position:relative;
vertical-align:baseline}
sub{bottom:-0.25em}
sup{top:-0.5em}
img{border-style:none}
button, input, optgroup, select, textarea{font-family:inherit;
font-size:100%;
line-height:1.15;
margin:0}
button, input{overflow:visible}
button, select{text-transform:none}
button, [type=button], [type=reset], [type=submit]{-webkit-appearance:button}
button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner{border-style:none;
padding:0}
button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring{outline:1px dotted ButtonText}
fieldset{padding:.35em .75em .625em}
legend{box-sizing:border-box;
color:inherit;
display:table;
max-width:100%;
padding:0;
white-space:normal}
progress{vertical-align:baseline}
textarea{overflow:auto}
[type=checkbox], [type=radio]{box-sizing:border-box;
padding:0}
[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button{height:auto}
[type=search]{-webkit-appearance:textfield;
outline-offset:-2px}
[type=search]::-webkit-search-decoration{-webkit-appearance:none}
::-webkit-file-upload-button{-webkit-appearance:button;
font:inherit}
details{display:block}
summary{display:list-item}
template{display:none}
[hidden]{display:none}
.hljs, pre{display:block;
overflow-x:auto;
padding:.5em;
background:#3a2840;
color:#fff}
.hljs.language-shell :not(.bash)+.bash, .hljs.language-better-shell :not(.bash)+.bash, pre.language-shell :not(.bash)+.bash, pre.language-better-shell :not(.bash)+.bash{color:#d2a8e0}
pre{border-radius:.8rem;
padding:1rem;
font-size:.875rem;
margin:1.5rem 0}
.hljs-keyword, .hljs-selector-tag, .hljs-tag{color:#d2a8e0}
.hljs-template-tag{color:red}
.hljs-number{color:#6cb9f0}
.hljs-variable, .hljs-template-variable, .hljs-attribute, .hljs-literal{color:#c9e5f9}
.hljs-subst{color:red}
.hljs-title, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-section, .hljs-type{color:#f0a46c}
.hljs-symbol, .hljs-bullet, .hljs-link{color:#d2a8e0}
.hljs-deletion, .hljs-string, .hljs-built_in, .hljs-builtin-name{color:#6cb9f0}
.hljs-addition, .hljs-comment, .hljs-quote, .hljs-meta{color:#adb5bd}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:bold}
#nprogress{pointer-events:none}
#nprogress .bar{background:#29d;
position:fixed;
z-index:1031;
top:0;
left:0;
width:100%;
height:2px}
#nprogress .peg{display:block;
position:absolute;
right:0px;
width:100px;
height:100%;
box-shadow:0 0 10px #29d, 0 0 5px #29d;
opacity:1;
-webkit-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
-webkit-transform:rotate(3deg) translate(0px, -4px);
-moz-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
transform:rotate(3deg) translate(0px, -4px)}
#nprogress .spinner{display:block;
position:fixed;
z-index:1031;
top:15px;
right:15px}
#nprogress .spinner-icon{width:18px;
height:18px;
box-sizing:border-box;
border:solid 2px transparent;
border-top-color:#29d;
border-left-color:#29d;
border-radius:50%;
-webkit-animation:nprogress-spinner 400ms linear infinite;
-webkit-animation:nprogress-spinner 400ms linear infinite;
animation:nprogress-spinner 400ms linear infinite}
.nprogress-custom-parent{overflow:hidden;
position:relative}
.nprogress-custom-parent #nprogress .spinner, .nprogress-custom-parent #nprogress .bar{position:absolute}
@keyframes nprogress-spinner {0% {-webkit-transform:rotate(0deg)}100% {-webkit-transform:rotate(360deg)}}
@keyframes nprogress-spinner {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}
#nprogress .bar{background:#782b90}
#nprogress .peg{box-shadow:0 0 10px #782b90, 0 0 5px #782b90}
#nprogress .spinner-icon{border-top-color:#782b90;
border-left-color:#782b90}
html{box-sizing:border-box}
*, *::before, *::after{box-sizing:inherit}
:root{font-size:18px}
@media (max-width:1000px) {:root{font-size:17.1px}}
@media (max-width:768px) {:root{font-size:16.2px}}
@media (max-width:640px) {:root{font-size:15.3px}}
body, input{font-family:Roboto, sans-serif;
font-weight:300;
line-height:1.7;
color:#3c3c3b}
input{outline:none}
h1, h2, h3, h4, h5, h6{font-weight:400}
h1{font-size:2.5rem}
h2{font-size:2rem}
h3{font-size:1.75rem}
h4{font-size:1.5rem}
h5{font-size:1.25rem}
h6{font-size:1.1rem}
.container{width:100%;
padding-right:.8rem;
padding-left:.8rem;
margin-right:auto;
margin-left:auto}
@media (min-width:640px) {.container{max-width:620px}}
@media (min-width:768px) {.container{max-width:738px}}
@media (min-width:1000px) {.container{max-width:950px}}
@media (min-width:1250px) {.container{max-width:1180px}}
@media (min-width:1250px) {.container-narrow{max-width:950px}}
.img-fluid{max-width:100%}
a{-webkit-text-decoration:none;
text-decoration:none;
color:#782b90}
a:hover{text-decoration:underline;
color:#571f69}
img{vertical-align:middle}
svg{overflow:hidden;
vertical-align:middle}
code, pre{font-family:"Roboto Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
p code{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
max-width:100%;
overflow:auto}
.heading-anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.heading-anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.heading-anchor:hover{opacity:1}
h2:hover .heading-anchor, h3:hover .heading-anchor, h4:hover .heading-anchor, h5:hover .heading-anchor, h6:hover .heading-anchor{opacity:1}
h1 .heading-anchor{display:none}
h4 .heading-anchor::after, h5 .heading-anchor::after, h6 .heading-anchor::after{padding-right:.6rem}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400&display=swap">@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZKCA.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-59Y.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCkYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCAYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCgYb9lecyVC4A.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCcYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCsYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCoYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCQYb9lecyU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19-7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19a7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1967DQk6YvNkeg.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19G7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1927DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19y7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19K7DQk6YvM.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body data-build-time="2022-02-23T03:15:06.208Z" data-build-commit-id="aea546634ec155fef8b8c6c4122f86e8dca9b7a8" data-build-run-id="1879211864"><div id="__next" data-reactroot=""><main class="jsx-efcc50be384cabc7 page docs"><header><div class="jsx-2203c38892fc1ef8 navbar"><div class="jsx-2203c38892fc1ef8 navbar-content container"><div class="jsx-2203c38892fc1ef8 navbar-logo"><a class="jsx-2203c38892fc1ef8" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-2203c38892fc1ef8"/></a></div><div class="jsx-2203c38892fc1ef8 navbar-collapse-button"><span class="jsx-2203c38892fc1ef8"></span><span class="jsx-2203c38892fc1ef8"></span><span class="jsx-2203c38892fc1ef8"></span></div><div class="jsx-2203c38892fc1ef8 navbar-right"><div class="jsx-2203c38892fc1ef8 navbar-menu"><span class="jsx-2203c38892fc1ef8 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-2203c38892fc1ef8" href="/introduction-to-vertx-and-reactive/"><li class="jsx-400ec7965926e858 dropdown-item">简介</li></a><a class="jsx-2203c38892fc1ef8" href="/get-started/"><li class="jsx-400ec7965926e858 dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer" class="jsx-2203c38892fc1ef8"><li class="jsx-400ec7965926e858 dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-2203c38892fc1ef8 navbar-menu-item" href="/docs/">文档</a><span class="jsx-2203c38892fc1ef8 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-2203c38892fc1ef8" href="/faq/"><li class="jsx-400ec7965926e858 dropdown-item">答疑</li></a><a class="jsx-2203c38892fc1ef8" href="/channels/"><li class="jsx-400ec7965926e858 dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer" class="jsx-2203c38892fc1ef8"><li class="jsx-400ec7965926e858 dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer" class="jsx-2203c38892fc1ef8"><li class="jsx-400ec7965926e858 dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/advanced-vertx-guide" target="_blank" rel="noreferrer" class="jsx-2203c38892fc1ef8"><li class="jsx-400ec7965926e858 dropdown-item">Advanced Vert.x Guide <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-2203c38892fc1ef8 navbar-menu-item" href="/blog/">博客</a><a class="jsx-2203c38892fc1ef8 navbar-menu-item" href="/community/">社区</a><a class="jsx-2203c38892fc1ef8 navbar-menu-item" href="/translation/">翻译团队</a></div><div class="jsx-2203c38892fc1ef8 navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" title="Stack Overflow" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>stackoverflow</title><path d="M15.725 0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725 0zm-3.94 3.418l-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465l-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86l-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154Z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" title="YouTube" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>youtube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a><a href="https://discord.gg/KzEMwP2" title="Discord" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://qm.qq.com/cgi-bin/qm/qr?k=QFrKfwIVTuShDdh7puvfJWjqOx4C014c&amp;jump_from=webapi" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a><a href="https://qun.qq.com/qqweb/qunpro/share?_wv=3&amp;_wwv=128&amp;inviteCode=ZT8jW&amp;from=246611" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer" class="jsx-2203c38892fc1ef8 navbar-social-link qq-guild-parent"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 200 200" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M13 73L16 49L52 49L58 14L82 14L77 49L135 49L141 14L166 14L160 49L195 49L192 73L157 73L148 124L184 124L181 149L144 149L137 193L90 149L61 149L55 185L31 185L36 149L0 149L6 124L100 124L120 144L131 75L72 75L64 124L40 124L48 73Z"></path></svg></a></div></div></div></div></header><div class="jsx-efcc50be384cabc7 page-content docs-content"><div class="jsx-efcc50be384cabc7 container"><div class="jsx-efcc50be384cabc7 docs-content-wrapper"><aside class="jsx-efcc50be384cabc7 "><div class="jsx-efcc50be384cabc7 docs-content-wrapper-sidebar"><div class="jsx-d1843944f2d67b search-panel"><div class="jsx-20d862052e50feff search"><input type="text" placeholder="Search..." value="" class="jsx-20d862052e50feff"/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="jsx-117e429f22e394dc search-results"></ul><div class="jsx-117e429f22e394dc search-results-none">No results.</div></div><div class="jsx-efcc50be384cabc7 docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_usage">用法</a></li>
<li><a href="#_getting_started">开始使用</a></li>
<li><a href="#_connecting_to_postgresql">连接PostgreSQL</a></li>
<li><a href="#_pool_versus_pooled_client">连接池与池化的客户端</a></li>
<li><a href="#_unix_domain_sockets">Unix domain sockets</a></li>
<li><a href="#_connect_retries">重连</a></li>
<li><a href="#_configuration">配置</a>
<ul class="sectlevel2">
<li><a href="#_data_object">data object</a></li>
<li><a href="#_connection_uri">连接uri</a></li>
<li><a href="#_environment_variables">环境变量</a></li>
<li><a href="#_sasl_scram_sha_256_authentication_mechanism">SASL SCRAM-SHA-256 鉴权机制。</a></li>
</ul>
</li>
<li><a href="#_running_queries">执行查询</a>
<ul class="sectlevel2">
<li><a href="#_prepared_queries">预查询</a></li>
<li><a href="#_batches">批处理</a></li>
</ul>
</li>
<li><a href="#_using_connections">使用连接</a>
<ul class="sectlevel2">
<li><a href="#_getting_a_connection">获取一条连接</a></li>
<li><a href="#_simplified_connection_api">简化的连接API</a></li>
</ul>
</li>
<li><a href="#_using_transactions">使用事务</a>
<ul class="sectlevel2">
<li><a href="#_transactions_with_connections">连接中使用事务操作</a></li>
<li><a href="#_simplified_transaction_api">简化版事务API</a></li>
</ul>
</li>
<li><a href="#_cursors_and_streaming">游标和流式操作</a></li>
<li><a href="#_tracing_queries">跟踪查询</a></li>
<li><a href="#_postgresql_type_mapping">PostgreSQL 类型映射</a>
<ul class="sectlevel2">
<li><a href="#_handling_json">JSON</a></li>
<li><a href="#_handling_numeric">数字类型（Numeric）</a></li>
</ul>
</li>
<li><a href="#_handling_arrays">数组</a></li>
<li><a href="#_handling_datetime_infinity">日期/时间类型（Date/Time）的最值</a></li>
<li><a href="#_handling_custom_types">自定义类型</a></li>
<li><a href="#_handling_text_search">文本检索</a></li>
<li><a href="#_handling_enumerated_types">枚举类型</a></li>
<li><a href="#_using_java_enum_types">使用Java枚举类型</a></li>
<li><a href="#_collector_queries">Collector式查询</a></li>
<li><a href="#_pubsub">发布/订阅</a></li>
<li><a href="#_cancelling_request">取消请求</a></li>
<li><a href="#_using_ssltls">使用 SSL/TLS</a></li>
<li><a href="#_using_a_proxy">使用代理</a></li>
<li><a href="#_advanced_pool_configuration">高级连接池配置</a>
<ul class="sectlevel2">
<li><a href="#_server_load_balancing">数据库服务负载均衡</a></li>
<li><a href="#_pool_connection_initialization">连接初始化</a></li>
</ul>
</li>
<li><a href="#_rxjava_3_api">RxJava 3 API</a>
<ul class="sectlevel2">
<li><a href="#_simple_query">简单的查询示例</a></li>
<li><a href="#_connection">连接</a></li>
<li><a href="#_transaction">事务</a></li>
<li><a href="#_streaming">流式操作</a></li>
</ul>
</li>
</ul>
</div></div></div></aside><div class="jsx-efcc50be384cabc7 docs-content-sidebar-toggle"><div style="position:relative" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="jsx-efcc50be384cabc7 docs-content-inner"><div class="jsx-efcc50be384cabc7 docs-content-metadata"><div class="jsx-efcc50be384cabc7 docs-content-metadata-left"><div class="jsx-efcc50be384cabc7 docs-content-metadata-repo"><div class="jsx-d38685edc31911e0 github-stars"><a href="https://github.com/eclipse-vertx/vertx-sql-client" class="jsx-d38685edc31911e0"><div class="jsx-d38685edc31911e0 icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div> <!-- -->null stars</a></div></div><div class="jsx-efcc50be384cabc7"><a href="https://vertx.io/docs/apidocs" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-examples"><a href="https://github.com/vert-x3/vertx-examples/tree/4.x/sql-client-examples"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Examples</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-pg-client/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="jsx-efcc50be384cabc7 docs-content-metadata-version"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">v4.2.5<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu align-right"><a href="/docs/vertx-pg-client/java/"><li class="jsx-400ec7965926e858 dropdown-item active has-active-siblings"><span class="jsx-400ec7965926e858 dropdown-check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></span>Latest (v<!-- -->4.2.5<!-- -->)</li></a><a href="/docs/4.1.8/vertx-pg-client/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.1.8</li></a><a href="/docs/4.0.3/vertx-pg-client/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a><a href="/docs/3.9.12/vertx-pg-client/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->3.9.12</li></a></ul></div></span></div></div><div class="jsx-efcc50be384cabc7"><h1>响应式（Reactive） PostgreSQL 客户端</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>响应式PostgreSQL客户端是一款以可扩展性和低开销为目标而专门为PostgreSQL数据库设计的
客户端。</p>
</div>
<div class="paragraph">
<p>客户端是响应式和非阻塞的，可以仅仅使用一条线程来处理大量的数据库连接。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>事件驱动</p>
</li>
<li>
<p>轻量级</p>
</li>
<li>
<p>内置连接池</p>
</li>
<li>
<p>预查询缓存</p>
</li>
<li>
<p>基于PostgreSQL的`NOTIFY/LISTEN`机制实现的发布/订阅</p>
</li>
<li>
<p>批处理和游标</p>
</li>
<li>
<p>支持原生流式操作</p>
</li>
<li>
<p>命令管道（pipeline）</p>
</li>
<li>
<p>RxJava API</p>
</li>
<li>
<p>支持内存直接映射到对象，避免了不必要的复制</p>
</li>
<li>
<p>支持Java 8 Date and Time</p>
</li>
<li>
<p>SSL/TLS</p>
</li>
<li>
<p>Unix domain socket</p>
</li>
<li>
<p>支持HTTP/1.x， SOCKS4a 或 SOCKS5 代理</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>用法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 <em>dependencies</em> 里添加如下依赖来引入响应式PostgreSQL客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件里）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-pg-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle（在您的 <code>build.gradle</code> 文件里）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
 compile <span class="hljs-string">&#x27;io.vertx:vertx-pg-client:4.1.1&#x27;</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>开始使用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如下是一种最为简单的连接、查询、关闭连接的方式</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the client pool</span>
SqlClient client = PgPool.client(connectOptions, poolOptions);

<span class="hljs-comment">// A simple query</span>
client
  .query(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)
  .execute(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; result = ar.result();
    System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + result.size() + <span class="hljs-string">&quot; rows &quot;</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }

  <span class="hljs-comment">// Now close the pool</span>
  client.close();
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connecting_to_postgresql"><a class="anchor" href="#_connecting_to_postgresql"></a>连接PostgreSQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>大多数时间，您将使用连接池连接到 PostgreSQL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
SqlClient client = PgPool.client(connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>池化PostgreSQL客户端使用连接池去执行数据库操作，
所有操作都会遵循从池里拿到连接、执行、释放连接到池里这三个步骤。</p>
</div>
<div class="paragraph">
<p>您可以传入一个连接池到正在运行的Vert.x实例里：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
SqlClient client = PgPool.client(vertx, connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果不再需要客户端，您需要将其释放：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>当您想要在同一条连接上执行多个操作时，您需要从连接池中获取
<code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html">connection</a></code> 连接。</p>
</div>
<div class="paragraph">
<p>您可以很方便地从连接池里拿到一条连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
PgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);

<span class="hljs-comment">// Get a connection from the pool</span>
pool.getConnection().compose(conn -&gt; {
  System.out.println(<span class="hljs-string">&quot;Got a connection from the pool&quot;</span>);

  <span class="hljs-comment">// All operations execute on the same connection</span>
  <span class="hljs-keyword">return</span> conn
    .query(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)
    .execute()
    .compose(res -&gt; conn
      .query(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;emad&#x27;&quot;</span>)
      .execute())
    .onComplete(ar -&gt; {
      <span class="hljs-comment">// Release the connection to the pool</span>
      conn.close();
    });
}).onComplete(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {

    System.out.println(<span class="hljs-string">&quot;Done&quot;</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Something went wrong &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了连接可以重用，一旦当前连接上的操作已经完成，您需要关闭并释放连接到连接池里。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pool_versus_pooled_client"><a class="anchor" href="#_pool_versus_pooled_client"></a>连接池与池化的客户端</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code><a href="../../apidocs/io/vertx/pgclient/PgPool.html">PgPool</a></code> 允许您创建连接池或池化客户端</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SqlClient pooledClient = PgPool.client(vertx, connectOptions, poolOptions);

<span class="hljs-comment">// 流水线操作（Pipelined）</span>
Future&lt;RowSet&lt;Row&gt;&gt; res1 = pooledClient.query(sql).execute();

<span class="hljs-comment">// 连接池</span>
PgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);

<span class="hljs-comment">// 不是流水线操作</span>
Future&lt;RowSet&lt;Row&gt;&gt; res2 = pool.query(sql).execute();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>连接池操作并非流水线操作（pipelined），只有连接客户端是流水线操作</p>
</li>
<li>
<p>池化的客户端操作是流水线操作</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unix_domain_sockets"><a class="anchor" href="#_unix_domain_sockets"></a>Unix domain sockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>某些情况下您希望通过Unix domain socket类型的连接来提升性能，我们通过Vert.x本机传输支持了这种方式。</p>
</div>
<div class="paragraph">
<p>首先确保您已经在classpath下添加了 <code>netty-transport-native</code> 这个必须的依赖，同时开启了Unix domain socket功能（pg）选项。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setHost(<span class="hljs-string">&quot;/var/run/postgresql&quot;</span>)
  .setPort(<span class="hljs-number">5432</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
PgPool client = PgPool.pool(connectOptions, poolOptions);

<span class="hljs-comment">// Create the pooled client with a vertx instance</span>
<span class="hljs-comment">// Make sure the vertx instance has enabled native transports</span>
PgPool client2 = PgPool.pool(vertx, connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>更多详情可以在这里找到 <a href="https://vertx.io/docs/vertx-core/java/#_native_transports">Vert.x 文档</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_retries"><a class="anchor" href="#_connect_retries"></a>重连</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以配置客户端在建立连接失败的时候的重试策略</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">options
  .setReconnectAttempts(<span class="hljs-number">2</span>)
  .setReconnectInterval(<span class="hljs-number">1000</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>配置</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有如下几种配置客户端的可选方案。</p>
</div>
<div class="sect2">
<h3 id="_data_object"><a class="anchor" href="#_data_object"></a>data object</h3>
<div class="paragraph">
<p>通过指定 <code>PgConnectOptions</code> 数据对象是一种简单的客户端的配置方式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>);

<span class="hljs-comment">// Pool Options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions().setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pool from the data object</span>
PgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);

pool.getConnection(ar -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用 <code>setProperties`或 `addProperty`方法配置通用属性。注意 `setProperties</code> 将覆盖默认的客户端属性。</p>
</div>
<div class="paragraph">
<p>例如，您可以通过添加 <code>search_path</code> 属性来配置一个默认的schema。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions();

<span class="hljs-comment">// Set the default schema</span>
Map&lt;String, String&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
props.put(<span class="hljs-string">&quot;search_path&quot;</span>, <span class="hljs-string">&quot;myschema&quot;</span>);
connectOptions.setProperties(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>关于可用属性的更多信息可以在这里找到 <a href="https://www.postgresql.org/docs/current/runtime-config-client.html">PostgreSQL Manuals</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_connection_uri"><a class="anchor" href="#_connection_uri"></a>连接uri</h3>
<div class="paragraph">
<p>除了使用 <code>PgConnectionOptions</code> 对象，我们也提供了另一种基于URI的可选配置方案：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String connectionUri = <span class="hljs-string">&quot;postgresql://dbuser:secretpassword@database.server.com:3211/mydb&quot;</span>;

<span class="hljs-comment">// Create the pool from the connection URI</span>
PgPool pool = PgPool.pool(connectionUri);

<span class="hljs-comment">// Create the connection from the connection URI</span>
PgConnection.connect(vertx, connectionUri, res -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>关于连接uri字符串格式的更多信息可以在这里找到 <a href="https://www.postgresql.org/docs/9.6/static/libpq-connect.html#LIBPQ-CONNSTRING">PostgreSQL 手册</a>。</p>
</div>
<div class="paragraph">
<p>当前版本的客户端支持在连接uri里使用如下参数</p>
</div>
<div class="ulist">
<ul>
<li>
<p>host</p>
</li>
<li>
<p>hostaddr</p>
</li>
<li>
<p>port</p>
</li>
<li>
<p>user</p>
</li>
<li>
<p>password</p>
</li>
<li>
<p>dbname</p>
</li>
<li>
<p>sslmode</p>
</li>
<li>
<p>properties including(application_name, fallback_application_name, search_path)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
通过URI配置的属性将会覆盖默认的配置属性。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>环境变量</h3>
<div class="paragraph">
<p>您也可以使用环境变量来设置连接的属性值，以此来避免硬编码数据库连接信息。
您可以参考 <a href="https://www.postgresql.org/docs/9.6/static/libpq-envars.html">官方文档</a>来了解更多详情。
目前支持下列这些配置参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PGHOST</code></p>
</li>
<li>
<p><code>PGHOSTADDR</code></p>
</li>
<li>
<p><code>PGPORT</code></p>
</li>
<li>
<p><code>PGDATABASE</code></p>
</li>
<li>
<p><code>PGUSER</code></p>
</li>
<li>
<p><code>PGPASSWORD</code></p>
</li>
<li>
<p><code>PGSSLMODE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果您没有在连接时指定连接对象或者URI字符串，此时将会使用环境变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ PGUSER=user \
 PGHOST=the-host \
 PGPASSWORD=secret \
 PGDATABASE=the-db \
 PGPORT=<span class="hljs-number">5432</span> \
 PGSSLMODE=DISABLE</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgPool pool = PgPool.pool();

<span class="hljs-comment">// Create the connection from the environment variables</span>
PgConnection.connect(vertx, res -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sasl_scram_sha_256_authentication_mechanism"><a class="anchor" href="#_sasl_scram_sha_256_authentication_mechanism"></a>SASL SCRAM-SHA-256 鉴权机制。</h3>
<div class="paragraph">
<p>为了使用 sasl SCRAM-SHA-256鉴权，需要在 <em>dependencies</em> 里添加如下依赖：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件里）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.ongres.scram<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle（在您的 <code>build.gradle</code> 文件里）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
 compile <span class="hljs-string">&#x27;com.ongres.scram:client:2.1&#x27;</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
SCRAM-SHA-256-PLUS（在Postgresql 11中加入）当前版本客户端暂不支持。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_queries"><a class="anchor" href="#_running_queries"></a>执行查询</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当您不需要事务或者只是执行一个单次查询操作，您可以直接在连接池里执行查询；
连接池会使用某一条连接执行并给您返回结果。
下边是如何执行一个简单的查询的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .query(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)
  .execute(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; result = ar.result();
    System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + result.size() + <span class="hljs-string">&quot; rows &quot;</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_prepared_queries"><a class="anchor" href="#_prepared_queries"></a>预查询</h3>
<div class="paragraph">
<p>执行预查询也是一样的操作。</p>
</div>
<div class="paragraph">
<p>SQL字符通过位置引用实际的参数，并使用数据库的语法 `$1`, `$2`, etc…​</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=$1&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + rows.size() + <span class="hljs-string">&quot; rows &quot;</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>查询相关的方法为 <em>SELECT</em> 类型的操作提供了异步的 <code><a href="../../apidocs/io/vertx/sqlclient/RowSet.html">RowSet</a></code> 实例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;SELECT first_name, last_name FROM users&quot;</span>)
  .execute(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">&quot;User &quot;</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">&quot; &quot;</span> + row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者 <em>UPDATE</em>/<em>INSERT</em> 类型的查询：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO users (first_name, last_name) VALUES ($1, $2)&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;Julien&quot;</span>, <span class="hljs-string">&quot;Viet&quot;</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row对象（<code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code>）可以让您通过索引位置获取相应的数据</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.out.println(<span class="hljs-string">&quot;User &quot;</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">&quot; &quot;</span> + row.getString(<span class="hljs-number">1</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者通过名称</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.out.println(<span class="hljs-string">&quot;User &quot;</span> + row.getString(<span class="hljs-string">&quot;first_name&quot;</span>) + <span class="hljs-string">&quot; &quot;</span> + row.getString(<span class="hljs-string">&quot;last_name&quot;</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>客户端在此处没有做特殊处理，无论您的SQL文本时什么，列名都将使用数据库表中的名称标识。</p>
</div>
<div class="paragraph">
<p>您也可以直接访问得到多种类型</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String firstName = row.getString(<span class="hljs-string">&quot;first_name&quot;</span>);
Boolean male = row.getBoolean(<span class="hljs-string">&quot;male&quot;</span>);
Integer age = row.getInteger(<span class="hljs-string">&quot;age&quot;</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用缓存过的预处理语句去执行一次性的预查询：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connectOptions.setCachePreparedStatements(<span class="hljs-keyword">true</span>);
client
  .preparedQuery(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = $1&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>), ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      RowSet&lt;Row&gt; rows = ar.result();
      System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + rows.size() + <span class="hljs-string">&quot; rows &quot;</span>);
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以创建 <code>PreparedStatement</code> 并自主地管理它的生命周期。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">sqlConnection
  .prepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = $1&quot;</span>, ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      PreparedStatement preparedStatement = ar.result();
      preparedStatement.query()
        .execute(Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>), ar2 -&gt; {
          <span class="hljs-keyword">if</span> (ar2.succeeded()) {
            RowSet&lt;Row&gt; rows = ar2.result();
            System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + rows.size() + <span class="hljs-string">&quot; rows &quot;</span>);
            preparedStatement.close();
          } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar2.cause().getMessage());
          }
        });
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_batches"><a class="anchor" href="#_batches"></a>批处理</h3>
<div class="paragraph">
<p>您可以在预查询中执行批处理操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Tuple&gt; batch = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
batch.add(Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>, <span class="hljs-string">&quot;Julien Viet&quot;</span>));
batch.add(Tuple.of(<span class="hljs-string">&quot;emad&quot;</span>, <span class="hljs-string">&quot;Emad Alblueshi&quot;</span>));

<span class="hljs-comment">// Execute the prepared batch</span>
client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO USERS (id, name) VALUES ($1, $2)&quot;</span>)
  .executeBatch(batch, res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {

    <span class="hljs-comment">// Process rows</span>
    RowSet&lt;Row&gt; rows = res.result();
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Batch failed &quot;</span> + res.cause());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 'RETURNING' 从查询里拿到生成的key：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO color (color_name) VALUES ($1), ($2), ($3) RETURNING color_id&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;white&quot;</span>, <span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-string">&quot;blue&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">&quot;generated key: &quot;</span> + row.getInteger(<span class="hljs-string">&quot;color_id&quot;</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>带有 <code>RETURNING</code> 语句的批量查询创建了一个 <code><a href="../../apidocs/io/vertx/sqlclient/RowSet.html">RowSet</a></code> ，
这个RowSet包含了该批量查询中的每一个元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO color (color_name) VALUES ($1) RETURNING color_id&quot;</span>)
  .executeBatch(Arrays.asList(Tuple.of(<span class="hljs-string">&quot;white&quot;</span>), Tuple.of(<span class="hljs-string">&quot;red&quot;</span>), Tuple.of(<span class="hljs-string">&quot;blue&quot;</span>)),ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      <span class="hljs-keyword">for</span> (RowSet&lt;Row&gt; rows = ar.result();rows.next() != <span class="hljs-keyword">null</span>;rows = rows.next()) {
        Integer colorId = rows.iterator().next().getInteger(<span class="hljs-string">&quot;color_id&quot;</span>);
        System.out.println(<span class="hljs-string">&quot;generated key: &quot;</span> + colorId);
      }
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_connections"><a class="anchor" href="#_using_connections"></a>使用连接</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_a_connection"><a class="anchor" href="#_getting_a_connection"></a>获取一条连接</h3>
<div class="paragraph">
<p>当您要执行查询（无事务）操作时，您可以创建一条或者从连接池里拿到一条连接。
请注意在从拿到连接到将连接释放回连接池这之间的连接状态，服务端可能由于某些原因比如空闲时间超时，而关闭这条连接。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool
  .getConnection()
  .compose(connection -&gt;
    connection
      .preparedQuery(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES ($1, $2)&quot;</span>)
      .executeBatch(Arrays.asList(
        Tuple.of(<span class="hljs-string">&quot;Julien&quot;</span>, <span class="hljs-string">&quot;Viet&quot;</span>),
        Tuple.of(<span class="hljs-string">&quot;Emad&quot;</span>, <span class="hljs-string">&quot;Alblueshi&quot;</span>)
      ))
      .compose(res -&gt; connection
        <span class="hljs-comment">// Do something with rows</span>
        .query(<span class="hljs-string">&quot;SELECT COUNT(*) FROM Users&quot;</span>)
        .execute()
        .map(rows -&gt; rows.iterator().next().getInteger(<span class="hljs-number">0</span>)))
      <span class="hljs-comment">// Return the connection to the pool</span>
      .eventually(v -&gt; connection.close())
  ).onSuccess(count -&gt; {
  System.out.println(<span class="hljs-string">&quot;Insert users, now the number of users is &quot;</span> + count);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以通过连接对象创建预查询:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection
  .prepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE first_name LIKE $1&quot;</span>)
  .compose(pq -&gt;
    pq.query()
      .execute(Tuple.of(<span class="hljs-string">&quot;Julien&quot;</span>))
      .eventually(v -&gt; pq.close())
  ).onSuccess(rows -&gt; {
  <span class="hljs-comment">// All rows</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simplified_connection_api"><a class="anchor" href="#_simplified_connection_api"></a>简化的连接API</h3>
<div class="paragraph">
<p>当您使用连接池时，您可以调用 <code><a href="../../apidocs/io/vertx/sqlclient/Pool.html#withConnection-java.util.function.Function-io.vertx.core.Handler-">withConnection</a></code>
并以当前连接要执行的操作作为参数。</p>
</div>
<div class="paragraph">
<p>这样会从连接池里拿到一条连接，并使用当前连接执行目标操作。</p>
</div>
<div class="paragraph">
<p>这种方式需要返回一个future对象来表示操作结果。</p>
</div>
<div class="paragraph">
<p>当这个future操作完成后，当前连接会被释放会连接池同时您也可能拿到最终的执行结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.withConnection(connection -&gt;
  connection
    .preparedQuery(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES ($1, $2)&quot;</span>)
    .executeBatch(Arrays.asList(
      Tuple.of(<span class="hljs-string">&quot;Julien&quot;</span>, <span class="hljs-string">&quot;Viet&quot;</span>),
      Tuple.of(<span class="hljs-string">&quot;Emad&quot;</span>, <span class="hljs-string">&quot;Alblueshi&quot;</span>)
    ))
    .compose(res -&gt; connection
      <span class="hljs-comment">// Do something with rows</span>
      .query(<span class="hljs-string">&quot;SELECT COUNT(*) FROM Users&quot;</span>)
      .execute()
      .map(rows -&gt; rows.iterator().next().getInteger(<span class="hljs-number">0</span>)))
).onSuccess(count -&gt; {
  System.out.println(<span class="hljs-string">&quot;Insert users, now the number of users is &quot;</span> + count);
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_transactions"><a class="anchor" href="#_using_transactions"></a>使用事务</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_transactions_with_connections"><a class="anchor" href="#_transactions_with_connections"></a>连接中使用事务操作</h3>
<div class="paragraph">
<p>您可以使用SQL语法 <code>BEGIN</code>/<code>COMMIT</code>/<code>ROLLBACK</code> 来执行事务操作，同时您必须使用
<code><a href="../../apidocs/io/vertx/sqlclient/SqlConnection.html">SqlConnection</a></code> 并自己管理当前连接。</p>
</div>
<div class="paragraph">
<p>或者您也可以使用 <code><a href="../../apidocs/io/vertx/sqlclient/SqlConnection.html">SqlConnection</a></code> 的事务API：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.getConnection()
  <span class="hljs-comment">// Transaction must use a connection</span>
  .onSuccess(conn -&gt; {
  <span class="hljs-comment">// Begin the transaction</span>
  conn.begin()
    .compose(tx -&gt; conn
      <span class="hljs-comment">// Various statements</span>
      .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)
      .execute()
      .compose(res2 -&gt; conn
        .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Emad&#x27;,&#x27;Alblueshi&#x27;)&quot;</span>)
        .execute())
      <span class="hljs-comment">// Commit the transaction</span>
      .compose(res3 -&gt; tx.commit()))
    <span class="hljs-comment">// Return the connection to the pool</span>
    .eventually(v -&gt; conn.close())
    .onSuccess(v -&gt; System.out.println(<span class="hljs-string">&quot;Transaction succeeded&quot;</span>))
    .onFailure(err -&gt; System.out.println(<span class="hljs-string">&quot;Transaction failed: &quot;</span> + err.getMessage()));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>当数据库服务端返回当前事务已失败（比如常见的 <em>current transaction is aborted, commands ignored until end of transaction block</em>）
，事务已回滚和 <code><a href="../../apidocs/io/vertx/sqlclient/Transaction.html#completion--">completion</a></code> 方法的返回值future返回了
<code><a href="../../apidocs/io/vertx/sqlclient/TransactionRollbackException.html">TransactionRollbackException</a></code> 异常时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">tx.completion()
  .onFailure(err -&gt; {
  System.out.println(<span class="hljs-string">&quot;Transaction failed =&gt; rolled back&quot;</span>);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simplified_transaction_api"><a class="anchor" href="#_simplified_transaction_api"></a>简化版事务API</h3>
<div class="paragraph">
<p>当您使用连接池时，您可以调用 <code><a href="../../apidocs/io/vertx/sqlclient/Pool.html#withTransaction-java.util.function.Function-io.vertx.core.Handler-">withTransaction</a></code> 方法
并传递待执行的事务操作作为参数。</p>
</div>
<div class="paragraph">
<p>这将会从连接池里拿到一条连接，开启事务并调用待执行操作，配合客户端一起执行该事务范围内
的所有操作。</p>
</div>
<div class="paragraph">
<p>待执行操作需要返回一个future来表示可能产生的结果：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当future成功时，客户端提交该事务</p>
</li>
<li>
<p>当future失败时，客户端回滚该事务</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>事务操作完成后，连接会被释放回连接池，并且可以获取到最终的操作结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.withTransaction(client -&gt; client
  .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)
  .execute()
  .flatMap(res -&gt; client
    .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Emad&#x27;,&#x27;Alblueshi&#x27;)&quot;</span>)
    .execute()
    <span class="hljs-comment">// Map to a message result</span>
    .map(<span class="hljs-string">&quot;Users inserted&quot;</span>)))
  .onSuccess(v -&gt; System.out.println(<span class="hljs-string">&quot;Transaction succeeded&quot;</span>))
  .onFailure(err -&gt; System.out.println(<span class="hljs-string">&quot;Transaction failed: &quot;</span> + err.getMessage()));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cursors_and_streaming"><a class="anchor" href="#_cursors_and_streaming"></a>游标和流式操作</h2>
<div class="sectionbody">
<div class="paragraph">
<p>默认情况下预查询操作会拉去所有的行记录，您可以使用
<code><a href="../../apidocs/io/vertx/sqlclient/Cursor.html">游标</a></code> 来控制您想要读取的行数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE first_name LIKE $1&quot;</span>, ar0 -&gt; {
  <span class="hljs-keyword">if</span> (ar0.succeeded()) {
    PreparedStatement pq = ar0.result();

    <span class="hljs-comment">// Cursors require to run within a transaction</span>
    connection.begin(ar1 -&gt; {
      <span class="hljs-keyword">if</span> (ar1.succeeded()) {
        Transaction tx = ar1.result();

        <span class="hljs-comment">// Create a cursor</span>
        Cursor cursor = pq.cursor(Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>));

        <span class="hljs-comment">// Read 50 rows</span>
        cursor.read(<span class="hljs-number">50</span>, ar2 -&gt; {
          <span class="hljs-keyword">if</span> (ar2.succeeded()) {
            RowSet&lt;Row&gt; rows = ar2.result();

            <span class="hljs-comment">// Check for more ?</span>
            <span class="hljs-keyword">if</span> (cursor.hasMore()) {
              <span class="hljs-comment">// Repeat the process...</span>
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-comment">// No more rows - commit the transaction</span>
              tx.commit();
            }
          }
        });
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>游标释放时需要同时执行关闭操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">cursor.read(<span class="hljs-number">50</span>, ar2 -&gt; {
  <span class="hljs-keyword">if</span> (ar2.succeeded()) {
    <span class="hljs-comment">// Close the cursor</span>
    cursor.close();
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>stream API也可以用于游标，尤其是在Rx版的客户端，可能更为方便。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE first_name LIKE $1&quot;</span>, ar0 -&gt; {
  <span class="hljs-keyword">if</span> (ar0.succeeded()) {
    PreparedStatement pq = ar0.result();

    <span class="hljs-comment">// Streams require to run within a transaction</span>
    connection.begin(ar1 -&gt; {
      <span class="hljs-keyword">if</span> (ar1.succeeded()) {
        Transaction tx = ar1.result();

        <span class="hljs-comment">// Fetch 50 rows at a time</span>
        RowStream&lt;Row&gt; stream = pq.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>));

        <span class="hljs-comment">// Use the stream</span>
        stream.exceptionHandler(err -&gt; {
          System.out.println(<span class="hljs-string">&quot;Error: &quot;</span> + err.getMessage());
        });
        stream.endHandler(v -&gt; {
          tx.commit();
          System.out.println(<span class="hljs-string">&quot;End of stream&quot;</span>);
        });
        stream.handler(row -&gt; {
          System.out.println(<span class="hljs-string">&quot;User: &quot;</span> + row.getString(<span class="hljs-string">&quot;last_name&quot;</span>));
        });
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>上边的stream会批量读取 <code>50</code> 行并同时将其转换为流，当这些行记录被传递给处理器时，
会以此类推地读取下一批的 <code>50</code> 行记录。</p>
</div>
<div class="paragraph">
<p>stream支持重启或暂停，已经加载到的行记录将会被保留在内存里直到被传递给处理器，此时
游标也将终止遍历。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
PostreSQL会在事务结束后销毁游标，因而游标API应该在事务内使用，
否则您将可能收到 <code>34000</code> PostgreSQL错误码。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_queries"><a class="anchor" href="#_tracing_queries"></a>跟踪查询</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当Vert.x启用tracing功能时，SQL客户端可以跟踪查询的执行情况。</p>
</div>
<div class="paragraph">
<p>客户端会上报下列这些 <em>client</em> spans：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Query</code> 操作名称</p>
</li>
<li>
<p>tags</p>
</li>
<li>
<p><code>db.user</code> ：数据库用户名</p>
</li>
<li>
<p><code>db.instance</code> ：数据库实例</p>
</li>
<li>
<p><code>db.statement</code> ：SQL语句</p>
</li>
<li>
<p><code>db.type</code> ：<em>sql</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认的 tracing 策略时 <code><a href="../../apidocs/io/vertx/core/tracing/TracingPolicy.html#PROPAGATE">PROPAGATE</a></code>，客户端
在一个活跃trace里只创建一个span。</p>
</div>
<div class="paragraph">
<p>您可以通过 <code><a href="../../apidocs/io/vertx/sqlclient/SqlConnectOptions.html#setTracingPolicy-io.vertx.core.tracing.TracingPolicy-">setTracingPolicy</a></code> 方法来调整tracing策略，
例如您可以设置为 <code><a href="../../apidocs/io/vertx/core/tracing/TracingPolicy.html#ALWAYS">ALWAYS</a></code>，
客户端将始终上报span：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">options.setTracingPolicy(TracingPolicy.ALWAYS);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_postgresql_type_mapping"><a class="anchor" href="#_postgresql_type_mapping"></a>PostgreSQL 类型映射</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当前版本客户端支持下列的PostgreSQL类型</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BOOLEAN (<code>java.lang.Boolean</code>)</p>
</li>
<li>
<p>INT2 (<code>java.lang.Short</code>)</p>
</li>
<li>
<p>INT4 (<code>java.lang.Integer</code>)</p>
</li>
<li>
<p>INT8 (<code>java.lang.Long</code>)</p>
</li>
<li>
<p>FLOAT4 (<code>java.lang.Float</code>)</p>
</li>
<li>
<p>FLOAT8 (<code>java.lang.Double</code>)</p>
</li>
<li>
<p>CHAR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>VARCHAR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>TEXT (<code>java.lang.String</code>)</p>
</li>
<li>
<p>ENUM (<code>java.lang.String</code>)</p>
</li>
<li>
<p>NAME (<code>java.lang.String</code>)</p>
</li>
<li>
<p>SERIAL2 (<code>java.lang.Short</code>)</p>
</li>
<li>
<p>SERIAL4 (<code>java.lang.Integer</code>)</p>
</li>
<li>
<p>SERIAL8 (<code>java.lang.Long</code>)</p>
</li>
<li>
<p>NUMERIC (<code>io.vertx.sqlclient.data.Numeric</code>)</p>
</li>
<li>
<p>UUID (<code>java.util.UUID</code>)</p>
</li>
<li>
<p>DATE (<code>java.time.LocalDate</code>)</p>
</li>
<li>
<p>TIME (<code>java.time.LocalTime</code>)</p>
</li>
<li>
<p>TIMETZ (<code>java.time.OffsetTime</code>)</p>
</li>
<li>
<p>TIMESTAMP (<code>java.time.LocalDateTime</code>)</p>
</li>
<li>
<p>TIMESTAMPTZ (<code>java.time.OffsetDateTime</code>)</p>
</li>
<li>
<p>INTERVAL (<code>io.vertx.pgclient.data.Interval</code>)</p>
</li>
<li>
<p>BYTEA (<code>io.vertx.core.buffer.Buffer</code>)</p>
</li>
<li>
<p>JSON (<code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>, <code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p>
</li>
<li>
<p>JSONB (<code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>, <code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p>
</li>
<li>
<p>POINT (<code>io.vertx.pgclient.data.Point</code>)</p>
</li>
<li>
<p>LINE (<code>io.vertx.pgclient.data.Line</code>)</p>
</li>
<li>
<p>LSEG (<code>io.vertx.pgclient.data.LineSegment</code>)</p>
</li>
<li>
<p>BOX (<code>io.vertx.pgclient.data.Box</code>)</p>
</li>
<li>
<p>PATH (<code>io.vertx.pgclient.data.Path</code>)</p>
</li>
<li>
<p>POLYGON (<code>io.vertx.pgclient.data.Polygon</code>)</p>
</li>
<li>
<p>CIRCLE (<code>io.vertx.pgclient.data.Circle</code>)</p>
</li>
<li>
<p>TSVECTOR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>TSQUERY (<code>java.lang.String</code>)</p>
</li>
<li>
<p>INET (<code>io.vertx.pgclient.data.Inet</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tuple（元组）在解码时使用上述类型映射关系存储解码出的值，并且在合法的条件下可以动态转换为实际类型的值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool
  .query(<span class="hljs-string">&quot;SELECT 1::BIGINT \&quot;VAL\&quot;&quot;</span>)
  .execute(ar -&gt; {
  RowSet&lt;Row&gt; rowSet = ar.result();
  Row row = rowSet.iterator().next();

  <span class="hljs-comment">// Stored as java.lang.Long</span>
  Object value = row.getValue(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// Convert to java.lang.Integer</span>
  Integer intValue = row.getInteger(<span class="hljs-number">0</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tuple（元组）编码时使用上述关系作为类型间的映射关系，除非类型为数字，在这种情况下将会使用 <code>java.lang.Number</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool
  .query(<span class="hljs-string">&quot;SELECT 1::BIGINT \&quot;VAL\&quot;&quot;</span>)
  .execute(ar -&gt; {
  RowSet&lt;Row&gt; rowSet = ar.result();
  Row row = rowSet.iterator().next();

  <span class="hljs-comment">// Stored as java.lang.Long</span>
  Object value = row.getValue(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// Convert to java.lang.Integer</span>
  Integer intValue = row.getInteger(<span class="hljs-number">0</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>上述类型的数组形式也是支持的。</p>
</div>
<div class="sect2">
<h3 id="_handling_json"><a class="anchor" href="#_handling_json"></a>JSON</h3>
<div class="paragraph">
<p>PostgreSQL的 <code>JSON</code> 和 <code>JSONB</code>  用下列的java类型表示：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>Number</code></p>
</li>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>io.vertx.core.json.JsonObject</code></p>
</li>
<li>
<p><code>io.vertx.core.json.JsonArray</code></p>
</li>
<li>
<p><code>io.vertx.sqlclient.Tuple#JSON_NULL</code> for representing the JSON null literal</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tuple tuple = Tuple.of(
  Tuple.JSON_NULL,
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>),
  <span class="hljs-number">3</span>);

<span class="hljs-comment">// Retrieving json</span>
Object value = tuple.getValue(<span class="hljs-number">0</span>); <span class="hljs-comment">// Expect JSON_NULL</span>

<span class="hljs-comment">//</span>
value = tuple.get(JsonObject.class, <span class="hljs-number">1</span>); <span class="hljs-comment">// Expect JSON object</span>

<span class="hljs-comment">//</span>
value = tuple.get(Integer.class, <span class="hljs-number">2</span>); <span class="hljs-comment">// Expect 3</span>
value = tuple.getInteger(<span class="hljs-number">2</span>); <span class="hljs-comment">// Expect 3</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_numeric"><a class="anchor" href="#_handling_numeric"></a>数字类型（Numeric）</h3>
<div class="paragraph">
<p>java的 <code><a href="../../apidocs/io/vertx/sqlclient/data/Numeric.html">Numeric</a></code> 用来表示PostgreSQL的 <code>NUMERIC</code> 类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Numeric numeric = row.get(Numeric.class, <span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (numeric.isNaN()) {
  <span class="hljs-comment">// Handle NaN</span>
} <span class="hljs-keyword">else</span> {
  BigDecimal value = numeric.bigDecimalValue();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_arrays"><a class="anchor" href="#_handling_arrays"></a>数组</h2>
<div class="sectionbody">
<div class="paragraph">
<p>数组可以用在 <code><a href="../../apidocs/io/vertx/sqlclient/Tuple.html">Tuple</a></code> 和 <code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tuple tuple = Tuple.of(<span class="hljs-keyword">new</span> String[]{ <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;tuple&quot;</span>, <span class="hljs-string">&quot;with&quot;</span>, <span class="hljs-string">&quot;arrays&quot;</span> });

<span class="hljs-comment">// Add a string array to the tuple</span>
tuple.addArrayOfString(<span class="hljs-keyword">new</span> String[]{<span class="hljs-string">&quot;another&quot;</span>, <span class="hljs-string">&quot;array&quot;</span>});

<span class="hljs-comment">// Get the first array of string</span>
String[] array = tuple.getArrayOfStrings(<span class="hljs-number">0</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_datetime_infinity"><a class="anchor" href="#_handling_datetime_infinity"></a>日期/时间类型（Date/Time）的最值</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL定义了几个特殊的值用来表示这些最值。</p>
</div>
<div class="paragraph">
<p>相应类型的最大/最小值由这些常量 <a href="https://www.postgresql.org/docs/9.0/datatype-datetime.html">特殊值</a> 表示。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OffsetDateTime.MAX</code>/OffsetDateTime.MIN`</p>
</li>
<li>
<p><code>LocalDateTime.MAX</code>/LocalDateTime.MIN`</p>
</li>
<li>
<p><code>LocalDate.MAX</code>/LocalDate.MIN`</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .query(<span class="hljs-string">&quot;SELECT &#x27;infinity&#x27;::DATE \&quot;LocalDate\&quot;&quot;</span>)
  .execute(ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      Row row = ar.result().iterator().next();
      System.out.println(row.getLocalDate(<span class="hljs-string">&quot;LocalDate&quot;</span>).equals(LocalDate.MAX));
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_custom_types"><a class="anchor" href="#_handling_custom_types"></a>自定义类型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>发送和从Postgres接收的自定义类型都由字符串来表示。</p>
</div>
<div class="paragraph">
<p>您可以读取PostgreSQL并以字符串的形式得到自定义的类型值</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;SELECT address, (address).city FROM address_book WHERE id=$1&quot;</span>)
  .execute(Tuple.of(<span class="hljs-number">3</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">&quot;Full Address &quot;</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">&quot;, City &quot;</span> + row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以向PostgreSQL写入字符串</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO address_book (id, address) VALUES ($1, $2)&quot;</span>)
  .execute(Tuple.of(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;(&#x27;Anytown&#x27;, &#x27;Second Ave&#x27;, false)&quot;</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_text_search"><a class="anchor" href="#_handling_text_search"></a>文本检索</h2>
<div class="sectionbody">
<div class="paragraph">
<p>文本检索使用的是java的 <code>String</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;SELECT to_tsvector( $1 ) @@ to_tsquery( $2 )&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;fat cats ate fat rats&quot;</span>, <span class="hljs-string">&quot;fat &amp; rat&quot;</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">&quot;Match : &quot;</span> + row.getBoolean(<span class="hljs-number">0</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tsvector</code> 和 <code>tsquery</code> 可以使用java的 <code>String</code> 类型来从数据库中获取</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;SELECT to_tsvector( $1 ), to_tsquery( $2 )&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;fat cats ate fat rats&quot;</span>, <span class="hljs-string">&quot;fat &amp; rat&quot;</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">&quot;Vector : &quot;</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">&quot;, query : &quot;</span>+row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_enumerated_types"><a class="anchor" href="#_handling_enumerated_types"></a>枚举类型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL的 <a href="https://www.postgresql.org/docs/9.1/datatype-enum.html">枚举类型</a> 被映射为java的字符串。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO colors VALUES ($2)&quot;</span>)
  .execute(Tuple.of(<span class="hljs-string">&quot;red&quot;</span>),  res -&gt; {
    <span class="hljs-comment">// ...</span>
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_java_enum_types"><a class="anchor" href="#_using_java_enum_types"></a>使用Java枚举类型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以将Java的 <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/enum.html">枚举类型</a>
映射为下列这些列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Strings (VARCHAR, TEXT)</p>
</li>
<li>
<p>PosgreSQL enumerated types</p>
</li>
<li>
<p>Numbers (INT2, INT4, INT8)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .preparedQuery(<span class="hljs-string">&quot;INSERT INTO colors VALUES ($1)&quot;</span>)
  .execute(Tuple.of(Color.red))
  .flatMap(res -&gt;
    client
      .preparedQuery(<span class="hljs-string">&quot;SELECT color FROM colors&quot;</span>)
      .execute()
  ).onComplete(res -&gt; {
    <span class="hljs-keyword">if</span> (res.succeeded()) {
      RowSet&lt;Row&gt; rows = res.result();
      <span class="hljs-keyword">for</span> (Row row : rows) {
        System.out.println(row.get(Color.class, <span class="hljs-string">&quot;color&quot;</span>));
      }
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>String and PostgreSQL enumerated types 对应Java枚举类的 <code>name()</code> 方法的返回值。</p>
</div>
<div class="paragraph">
<p>Numbers类型对应Java枚举类的 <code>ordinal()</code> 方法的返回值。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collector_queries"><a class="anchor" href="#_collector_queries"></a>Collector式查询</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以将Java collector与查询API结合使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Collector&lt;Row, ?, Map&lt;Long, String&gt;&gt; collector = Collectors.toMap(
  row -&gt; row.getLong(<span class="hljs-string">&quot;id&quot;</span>),
  row -&gt; row.getString(<span class="hljs-string">&quot;last_name&quot;</span>));

<span class="hljs-comment">// Run the query with the collector</span>
client.query(<span class="hljs-string">&quot;SELECT * FROM users&quot;</span>)
  .collecting(collector)
  .execute(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    SqlResult&lt;Map&lt;Long, String&gt;&gt; result = ar.result();

    <span class="hljs-comment">// Get the map created by the collector</span>
    Map&lt;Long, String&gt; map = result.value();
    System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + map);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>collector式查询的结果集处理过程中不能再拿到 <code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code> 的引用，因为
pg客户端在处理collector时，只会用一个row用于处理整个集合。</p>
</div>
<div class="paragraph">
<p>Java的 <code>Collectors</code> 类提供了很多很有趣的预定义的collector，比如您可以很容易
从row集合里得到一个字符串：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Collector&lt;Row, ?, String&gt; collector = Collectors.mapping(
  row -&gt; row.getString(<span class="hljs-string">&quot;last_name&quot;</span>),
  Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;(&quot;</span>, <span class="hljs-string">&quot;)&quot;</span>)
);

<span class="hljs-comment">// Run the query with the collector</span>
client.query(<span class="hljs-string">&quot;SELECT * FROM users&quot;</span>).collecting(collector).execute(ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      SqlResult&lt;String&gt; result = ar.result();

      <span class="hljs-comment">// Get the string created by the collector</span>
      String list = result.value();
      System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + list);
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pubsub"><a class="anchor" href="#_pubsub"></a>发布/订阅</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL支持发布/订阅式的通信方式。</p>
</div>
<div class="paragraph">
<p>您可以设置一个 <code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html#notificationHandler-io.vertx.core.Handler-">notificationHandler</a></code> 用于
接收PostgreSQL的通知消息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.notificationHandler(notification -&gt; {
  System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + notification.getPayload() + <span class="hljs-string">&quot; on channel &quot;</span> + notification.getChannel());
});

connection
  .query(<span class="hljs-string">&quot;LISTEN some-channel&quot;</span>)
  .execute(ar -&gt; {
  System.out.println(<span class="hljs-string">&quot;Subscribed to channel&quot;</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>PgSubscriber (<code><a href="../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html">PgSubscriber</a></code>) 是一种用作
处理单条连接上的订阅的通道（channel）管理器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>)
);

<span class="hljs-comment">// You can set the channel before connect</span>
subscriber.channel(<span class="hljs-string">&quot;channel1&quot;</span>).handler(payload -&gt; {
  System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + payload);
});

subscriber.connect(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {

    <span class="hljs-comment">// Or you can set the channel after connect</span>
    subscriber.channel(<span class="hljs-string">&quot;channel2&quot;</span>).handler(payload -&gt; {
      System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + payload);
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>channel（通道）方法的参数即通道名称（接收端）需要和PostgreSQL发送通知时的通道名称保持一致。
注意这里和SQL中的通道名称的形式不同，在 <code><a href="../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html">PgSubscriber</a></code>
内部会把待提交的通道名称预处理为带引号的形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>)
);

subscriber.connect(ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      <span class="hljs-comment">// Complex channel name - name in PostgreSQL requires a quoted ID</span>
      subscriber.channel(<span class="hljs-string">&quot;Complex.Channel.Name&quot;</span>).handler(payload -&gt; {
        System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + payload);
      });
      subscriber.channel(<span class="hljs-string">&quot;Complex.Channel.Name&quot;</span>).subscribeHandler(subscribed -&gt; {
        subscriber.actualConnection()
          .query(<span class="hljs-string">&quot;NOTIFY \&quot;Complex.Channel.Name\&quot;, &#x27;msg&#x27;&quot;</span>)
          .execute(notified -&gt; {
            System.out.println(<span class="hljs-string">&quot;Notified \&quot;Complex.Channel.Name\&quot;&quot;</span>);
          });
      });

      <span class="hljs-comment">// PostgreSQL simple ID&#x27;s are forced lower-case</span>
      subscriber.channel(<span class="hljs-string">&quot;simple_channel&quot;</span>).handler(payload -&gt; {
          System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + payload);
      });
      subscriber.channel(<span class="hljs-string">&quot;simple_channel&quot;</span>).subscribeHandler(subscribed -&gt; {
        <span class="hljs-comment">// The following simple channel identifier is forced to lower case</span>
        subscriber.actualConnection()
          .query(<span class="hljs-string">&quot;NOTIFY Simple_CHANNEL, &#x27;msg&#x27;&quot;</span>)
          .execute(notified -&gt; {
            System.out.println(<span class="hljs-string">&quot;Notified simple_channel&quot;</span>);
          });
      });

      <span class="hljs-comment">// The following channel name is longer than the current</span>
      <span class="hljs-comment">// (NAMEDATALEN = 64) - 1 == 63 character limit and will be truncated</span>
      subscriber.channel(<span class="hljs-string">&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb&quot;</span>)
        .handler(payload -&gt; {
        System.out.println(<span class="hljs-string">&quot;Received &quot;</span> + payload);
      });
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以自定义一个方法来实现重连，该方法的参数为 <code>retries</code> （重试次数），
返回值为 <code>amountOfTime</code>（重试间隔）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当 <code>amountOfTime &lt; 0</code> ： 不重试，并关闭订阅</p>
</li>
<li>
<p>当 <code>amountOfTime = 0</code> ： 立即重试</p>
</li>
<li>
<p>当 <code>amountOfTime &gt; 0</code> ： 在 <code>amountOfTime</code> 毫秒之后发起重试</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>)
);

<span class="hljs-comment">// Reconnect at most 10 times after 100 ms each</span>
subscriber.reconnectPolicy(retries -&gt; {
  <span class="hljs-keyword">if</span> (retries &lt; <span class="hljs-number">10</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">100L</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1L</span>;
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认的策略是不重连。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cancelling_request"><a class="anchor" href="#_cancelling_request"></a>取消请求</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL 支持取消正在运行的请求. 您可以使用 <code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html#cancelRequest-io.vertx.core.Handler-">cancelRequest</a></code> 正在运行的请求. 取消请求的操作在执行时将和PostgreSQL服务端新建一条连接、执行取消请求、关闭这条连接。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection
  .query(<span class="hljs-string">&quot;SELECT pg_sleep(20)&quot;</span>)
  .execute(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-comment">// imagine this is a long query and is still running</span>
    System.out.println(<span class="hljs-string">&quot;Query success&quot;</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// the server will abort the current query after cancelling request</span>
    System.out.println(<span class="hljs-string">&quot;Failed to query due to &quot;</span> + ar.cause().getMessage());
  }
});
connection.cancelRequest(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    System.out.println(<span class="hljs-string">&quot;Cancelling request has been sent&quot;</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Failed to send cancelling request&quot;</span>);
  }
});</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>取消请求可能不会起作用——如果请求到达时，服务端已经处理完了当前查询请求，此时取消操作不会起作用。反之，取消请求得以执行，目标命令执行提前终止并返回一条错误消息。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>更多详细信息可以在这里找到 <a href="https://www.postgresql.org/docs/11/protocol-flow.html#id-1.10.5.7.9">official documentation</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_ssltls"><a class="anchor" href="#_using_ssltls"></a>使用 SSL/TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>为客户端连接添加SSL的操作，您可以参考Vert.x的
<code>NetClient</code> 的 <code><a href="../../apidocs/io/vertx/pgclient/PgConnectOptions.html">PgConnectOptions</a></code> 配置操作。
当前版本客户端支持全部的PostgreSql <a href="https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-PROTECTION">SSL模式</a>配置，您可以通过 <code>sslmode</code> 配置它们。客户端默认不启用SSL模式。
<code>ssl</code> 参数仅作为一种设置 <code>sslmode</code> 的快捷方式。 <code>setSsl(true)</code> 等价于 <code>setSslMode(VERIFY_CA)</code>，<code>setSsl(false)</code> 等价于 <code>setSslMode(DISABLE)</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions options = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">&quot;the-host&quot;</span>)
  .setDatabase(<span class="hljs-string">&quot;the-db&quot;</span>)
  .setUser(<span class="hljs-string">&quot;user&quot;</span>)
  .setPassword(<span class="hljs-string">&quot;secret&quot;</span>)
  .setSslMode(SslMode.VERIFY_CA)
  .setPemTrustOptions(<span class="hljs-keyword">new</span> PemTrustOptions().addCertPath(<span class="hljs-string">&quot;/path/to/cert.pem&quot;</span>));

PgConnection.connect(vertx, options, res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {
    <span class="hljs-comment">// Connected with SSL</span>
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">&quot;Could not connect &quot;</span> + res.cause());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>更多详细信息可以在这里找到 <a href="http://vertx.io/docs/vertx-core/java/#ssl">Vert.x documentation</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_proxy"><a class="anchor" href="#_using_a_proxy"></a>使用代理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以配置客户端使用HTTP/1.x 连接，SOCKS4a 或 SOCKS5 代理。</p>
</div>
<div class="paragraph">
<p>更多信息可以在这里找到 <a href="http://vertx.io/docs/vertx-core/java/#_using_a_proxy_for_client_connections">Vert.x documentation</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_pool_configuration"><a class="anchor" href="#_advanced_pool_configuration"></a>高级连接池配置</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_server_load_balancing"><a class="anchor" href="#_server_load_balancing"></a>数据库服务负载均衡</h3>
<div class="paragraph">
<p>您可以使用包含多个数据库服务的列表来配置连接池而不是单个数据库服务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgPool pool = PgPool.pool(Arrays.asList(server1, server2, server3), options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>当一个连接创建时，连接池使用(round-robin)轮询调度算法做负载均衡以选择不同的数据库服务</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
负载均衡是在创建连接时提供的，而不是在从连接池中获取连接时提供
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_pool_connection_initialization"><a class="anchor" href="#_pool_connection_initialization"></a>连接初始化</h3>
<div class="paragraph">
<p>您可以使用 <code><a href="../../apidocs/io/vertx/sqlclient/Pool.html#connectHandler-io.vertx.core.Handler-">connectHandler</a></code>
方法在连接创建后和连接释放回连接池之前来与数据库连接交互</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.connectHandler(conn -&gt; {
  conn.query(sql).execute().onSuccess(res -&gt; {
    <span class="hljs-comment">//  将连接释放回连接池，以被该应用程序复用</span>
    conn.close();
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>连接完成后，您应该释放该连接以通知连接池该数据库连接可以被使用</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rxjava_3_api"><a class="anchor" href="#_rxjava_3_api"></a>RxJava 3 API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>客户端提供了原生 API 的响应式版本
以下示例使用RxJava3</p>
</div>
<div class="sect2">
<h3 id="_simple_query"><a class="anchor" href="#_simple_query"></a>简单的查询示例</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Single&lt;RowSet&lt;Row&gt;&gt; single = pool.query(<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>).rxExecute();

<span class="hljs-comment">// Execute the query</span>
single.subscribe(result -&gt; {
  System.out.println(<span class="hljs-string">&quot;Got &quot;</span> + result.size() + <span class="hljs-string">&quot; rows &quot;</span>);
}, err -&gt; {
  System.out.println(<span class="hljs-string">&quot;Failure: &quot;</span> + err.getMessage());
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connection"><a class="anchor" href="#_connection"></a>连接</h3>
<div class="paragraph">
<p>简化版的连接API可以让您很容易地使用connection对象，<code>withConnection</code>
方法会从连接池里获取到一条连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Maybe&lt;RowSet&lt;Row&gt;&gt; maybe = pool.withConnection(conn -&gt;
  conn
    .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)
    .rxExecute()
    .flatMap(result -&gt; conn
      .query(<span class="hljs-string">&quot;SELECT * FROM Users&quot;</span>)
      .rxExecute())
    .toMaybe());

maybe.subscribe(rows -&gt; {
  <span class="hljs-comment">// Success</span>
}, err -&gt; {
  <span class="hljs-comment">// Failed</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transaction"><a class="anchor" href="#_transaction"></a>事务</h3>
<div class="paragraph">
<p>简化版的事务API可以让您很容易地编写异步事务处理流，<code>withTransaction</code>
方法会为您启动和提交事务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Completable completable = pool.withTransaction(conn -&gt;
  conn
    .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)
    .rxExecute()
    .flatMap(result -&gt; conn
      .query(<span class="hljs-string">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Emad&#x27;,&#x27;Alblueshi&#x27;)&quot;</span>)
      .rxExecute())
    .toMaybe())
  .ignoreElement();

completable.subscribe(() -&gt; {
  <span class="hljs-comment">// Transaction succeeded</span>
}, err -&gt; {
  <span class="hljs-comment">// Transaction failed</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streaming"><a class="anchor" href="#_streaming"></a>流式操作</h3>
<div class="paragraph">
<p>RxJava 支持 <code>Observable</code> 和 <code>Flowable</code> 类型，这些类型可以从 <code><a href="../../apidocs/io/vertx/rxjava3/sqlclient/PreparedQuery.html">PreparedQuery</a></code>
产生的 <code><a href="../../apidocs/io/vertx/rxjava3/sqlclient/RowStream.html">RowStream</a></code>
里获取到：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Observable&lt;Row&gt; observable = pool.rxGetConnection().flatMapObservable(conn -&gt; conn
  .rxBegin()
  .flatMapObservable(tx -&gt;
    conn
      .rxPrepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE first_name LIKE $1&quot;</span>)
      .flatMapObservable(preparedQuery -&gt; {
        <span class="hljs-comment">// Fetch 50 rows at a time</span>
        RowStream&lt;Row&gt; stream = preparedQuery.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>));
        <span class="hljs-keyword">return</span> stream.toObservable();
      })
      .doAfterTerminate(tx::commit)));

<span class="hljs-comment">// Then subscribe</span>
observable.subscribe(row -&gt; {
  System.out.println(<span class="hljs-string">&quot;User: &quot;</span> + row.getString(<span class="hljs-string">&quot;last_name&quot;</span>));
}, err -&gt; {
  System.out.println(<span class="hljs-string">&quot;Error: &quot;</span> + err.getMessage());
}, () -&gt; {
  System.out.println(<span class="hljs-string">&quot;End of stream&quot;</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>下边是使用 <code>Flowable</code> 的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Flowable&lt;Row&gt; flowable = pool.rxGetConnection().flatMapPublisher(conn -&gt; conn
  .rxBegin()
  .flatMapPublisher(tx -&gt;
    conn
      .rxPrepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE first_name LIKE $1&quot;</span>)
      .flatMapPublisher(preparedQuery -&gt; {
        <span class="hljs-comment">// Fetch 50 rows at a time</span>
        RowStream&lt;Row&gt; stream = preparedQuery.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">&quot;julien&quot;</span>));
        <span class="hljs-keyword">return</span> stream.toFlowable();
      })
      .doAfterTerminate(tx::commit)));

<span class="hljs-comment">// Then subscribe</span>
flowable.subscribe(<span class="hljs-keyword">new</span> Subscriber&lt;Row&gt;() {

  <span class="hljs-keyword">private</span> Subscription sub;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">(Subscription subscription)</span> </span>{
    sub = subscription;
    subscription.request(<span class="hljs-number">1</span>);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNext</span><span class="hljs-params">(Row row)</span> </span>{
    sub.request(<span class="hljs-number">1</span>);
    System.out.println(<span class="hljs-string">&quot;User: &quot;</span> + row.getString(<span class="hljs-string">&quot;last_name&quot;</span>));
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(Throwable err)</span> </span>{
    System.out.println(<span class="hljs-string">&quot;Error: &quot;</span> + err.getMessage());
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">&quot;End of stream&quot;</span>);
  }
});</code></pre>
</div>
</div>
</div>
</div>
</div></div></div></div></div></div><footer class="jsx-aeedcf66895f49d7"><div class="jsx-aeedcf66895f49d7 container"><div class="jsx-aeedcf66895f49d7 footer-nav-section"><div class="jsx-aeedcf66895f49d7 footer-nav-list footer-logo"><a class="jsx-aeedcf66895f49d7" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-aeedcf66895f49d7"/></a></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse Vert.x</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7 navbar-menu-item" href="/docs/">文档</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/download/">下载</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/blog/">博客</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/community/">社区</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/translation/">翻译团队</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/eclipse-vertx/vert.x" class="jsx-aeedcf66895f49d7">GitHub</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/vertx-china/vertx-web-site" class="jsx-aeedcf66895f49d7">翻译GitHub</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">资源</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/faq/">答疑</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/channels/">联系渠道</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://how-to.vertx.io/" class="jsx-aeedcf66895f49d7">操作指南</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://start.vertx.io/" class="jsx-aeedcf66895f49d7">应用生成器</a></li><li class="jsx-aeedcf66895f49d7"><a href="/.well-known/security.txt" class="jsx-aeedcf66895f49d7">security.txt</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/" class="jsx-aeedcf66895f49d7">Eclipse 基金会</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/privacy.php" class="jsx-aeedcf66895f49d7">隐私政策</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/termsofuse.php" class="jsx-aeedcf66895f49d7">使用条款</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/copyright.php" class="jsx-aeedcf66895f49d7">版权代理</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/" class="jsx-aeedcf66895f49d7">法律资源</a></li></ul></div></div><div class="jsx-aeedcf66895f49d7 footer-copyright"><div class="jsx-aeedcf66895f49d7 footer-copyright-remarks">© <!-- -->2022<!-- --> Eclipse Vert.x™<br class="jsx-aeedcf66895f49d7"/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Apache License 2.0</a>协议下获得了双重许可。<br class="jsx-aeedcf66895f49d7 footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Michel Krämer</a> 设计。</div><div class="jsx-aeedcf66895f49d7 footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 281.3 91.1&#x27; style=&#x27;enable-background:new 0 0 281.3 91.1&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23f79422%7d.st1%7bfill:%233d3c3b%7d%3c/style%3e%3cg id=&#x27;Layer_1_1_&#x27;%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M265.7 84 257 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zm-32.4-8.3c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3 0 4.7 2.9 9.1 9.1 9.1s9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-21.2 18V73h-3.3v17.7h3.3zm-23.6 0h3.3V76h5.6v-3h-14.6v3h5.6l.1 14.7zm-18.9-6.5H163l3.3-7.6 3.3 7.6zm2.8 6.5h3.6L168.2 73h-3.6l-8 17.7h3.6l1.5-3.3h9.3l1.4 3.3zm-38-14.6h3.6c3.9 0 5.5 2.8 5.5 5.5.1 2.8-1.5 5.8-5.5 5.8h-3.6V76.1zm3.7-3.1h-6.9v17.7h6.9c6.2 0 8.9-4.5 8.9-9s-2.8-8.7-8.9-8.7zm-22.4 11L107 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zM88.2 73v10.2c0 3-1.6 4.9-4.3 4.9s-4.6-1.7-4.6-4.9V73H76v10.1c0 5.3 3.6 7.9 7.9 7.9 4.4 0 7.7-2.7 7.7-7.9V73h-3.4zm-33 2.7c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3s2.9 9.1 9.1 9.1 9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-29.7 18v-6.5h8.9v-3.1h-8.9v-4.8h9.4V73H22.2v17.6h3.3z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M269.4 54.4h-22.2v-8.9h21.4v-6.9h-21.4v-9.1h22.2v-7.2h-29.6v39.5h29.6v-7.4zm-40-25.6c-3-6.1-9.4-7.8-15.5-7.8-7.3 0-15.3 3.4-15.3 11.5 0 8.9 7.4 11 15.5 12 5.2.6 9.1 2.1 9.1 5.8 0 4.3-4.4 5.9-9.1 5.9s-9.4-1.9-11.1-6.3l-6.2 3.2c2.9 7.2 9.1 9.7 17.2 9.7 8.8 0 16.6-3.8 16.6-12.6 0-9.4-7.7-11.6-15.9-12.6-4.7-.6-8.8-1.5-8.8-5 0-2.9 2.6-5.2 8.2-5.2 4.3 0 8 2.2 9.4 4.4l5.9-3zM176 22.2c-6.2-.1-12.4 0-18.6 0v39.5h7.4V50.1H176c19.4 0 19.4-27.9 0-27.9zm-11.1 7.1H176c9.5 0 9.5 14 0 14h-11.2l.1-14zm-18 32.5V22.2h-7.4v39.5l7.4.1zm-44-39.6v39.5h27.7v-6.9h-20.3V22.2h-7.4zM90.7 51.7c-2.7 2.5-6.2 4-9.9 4-9.8 0-13.5-6.8-13.6-13.4s4.1-13.7 13.6-13.7c3.5-.1 7 1.3 9.5 3.7l5-4.8c-3.8-3.9-9.1-6-14.5-6-14.3 0-21 10.5-20.9 20.8s6.3 20.3 20.9 20.3c5.6.1 11-2 15-5.9l-5.1-5zm-39 2.7H29.5v-8.9h21.4v-6.9H29.5v-9.1h22.2v-7.2H22.2v39.5h29.6l-.1-7.4z&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M9.8 18.2C18.8 4.1 36.9-.8 52.1 6l-1-.7C35.7-4.6 15.2-.1 5.3 15.3s-5.4 35.9 10 45.8l1.1.6C3.8 50.8.8 32.3 9.8 18.2z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M272.2 26.1c0-2.5 2.1-4.6 4.6-4.6 2.5 0 4.6 2.1 4.6 4.6 0 2.5-2.1 4.6-4.6 4.6-2.6 0-4.6-2.1-4.6-4.6zm8.6 0c0-2.2-1.8-4.1-4-4.1s-4.1 1.8-4.1 4.1c0 2.2 1.7 4 3.9 4.1h.1c2.3 0 4.1-1.8 4.1-4.1zm-6-2.5h2.3c1.1 0 1.9.5 1.9 1.6 0 .7-.4 1.3-1.1 1.5l1.2 1.7h-1.4l-1-1.5h-.7v1.5h-1.1l-.1-4.8zm2.2 2.3c.5 0 .8-.3.8-.7s-.3-.7-.8-.7h-1v1.3l1 .1z&#x27;/%3e%3c/g%3e%3c/svg%3e" alt="Eclipse foundation Logo" class="jsx-aeedcf66895f49d7"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.1.1/vertx-pg-client/java","title":"响应式（Reactive） PostgreSQL 客户端","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_usage\"\u003e用法\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_getting_started\"\u003e开始使用\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connecting_to_postgresql\"\u003e连接PostgreSQL\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_pool_versus_pooled_client\"\u003e连接池与池化的客户端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_unix_domain_sockets\"\u003eUnix domain sockets\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connect_retries\"\u003e重连\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_configuration\"\u003e配置\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_data_object\"\u003edata object\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connection_uri\"\u003e连接uri\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_environment_variables\"\u003e环境变量\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_sasl_scram_sha_256_authentication_mechanism\"\u003eSASL SCRAM-SHA-256 鉴权机制。\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_running_queries\"\u003e执行查询\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_prepared_queries\"\u003e预查询\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_batches\"\u003e批处理\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_connections\"\u003e使用连接\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_getting_a_connection\"\u003e获取一条连接\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_simplified_connection_api\"\u003e简化的连接API\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_transactions\"\u003e使用事务\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_transactions_with_connections\"\u003e连接中使用事务操作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_simplified_transaction_api\"\u003e简化版事务API\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_cursors_and_streaming\"\u003e游标和流式操作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_tracing_queries\"\u003e跟踪查询\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_postgresql_type_mapping\"\u003ePostgreSQL 类型映射\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_handling_json\"\u003eJSON\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_numeric\"\u003e数字类型（Numeric）\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_arrays\"\u003e数组\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_datetime_infinity\"\u003e日期/时间类型（Date/Time）的最值\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_custom_types\"\u003e自定义类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_text_search\"\u003e文本检索\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_enumerated_types\"\u003e枚举类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_java_enum_types\"\u003e使用Java枚举类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_collector_queries\"\u003eCollector式查询\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_pubsub\"\u003e发布/订阅\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_cancelling_request\"\u003e取消请求\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_ssltls\"\u003e使用 SSL/TLS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_a_proxy\"\u003e使用代理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_advanced_pool_configuration\"\u003e高级连接池配置\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_server_load_balancing\"\u003e数据库服务负载均衡\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_pool_connection_initialization\"\u003e连接初始化\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_rxjava_3_api\"\u003eRxJava 3 API\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_simple_query\"\u003e简单的查询示例\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connection\"\u003e连接\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_transaction\"\u003e事务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_streaming\"\u003e流式操作\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003e响应式（Reactive） PostgreSQL 客户端\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e响应式PostgreSQL客户端是一款以可扩展性和低开销为目标而专门为PostgreSQL数据库设计的\n客户端。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e客户端是响应式和非阻塞的，可以仅仅使用一条线程来处理大量的数据库连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e事件驱动\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e轻量级\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e内置连接池\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e预查询缓存\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e基于PostgreSQL的`NOTIFY/LISTEN`机制实现的发布/订阅\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e批处理和游标\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e支持原生流式操作\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e命令管道（pipeline）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRxJava API\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e支持内存直接映射到对象，避免了不必要的复制\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e支持Java 8 Date and Time\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSSL/TLS\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUnix domain socket\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e支持HTTP/1.x， SOCKS4a 或 SOCKS5 代理\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_usage\"\u003e\u003ca class=\"anchor\" href=\"#_usage\"\u003e\u003c/a\u003e用法\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在 \u003cem\u003edependencies\u003c/em\u003e 里添加如下依赖来引入响应式PostgreSQL客户端：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件里）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-pg-client\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.1\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件里）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003edependencies {\n compile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-pg-client:4.1.1\u0026#x27;\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_getting_started\"\u003e\u003ca class=\"anchor\" href=\"#_getting_started\"\u003e\u003c/a\u003e开始使用\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如下是一种最为简单的连接、查询、关闭连接的方式\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the client pool\u003c/span\u003e\nSqlClient client = PgPool.client(connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// A simple query\u003c/span\u003e\nclient\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=\u0026#x27;julien\u0026#x27;\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; result = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// Now close the pool\u003c/span\u003e\n  client.close();\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_connecting_to_postgresql\"\u003e\u003ca class=\"anchor\" href=\"#_connecting_to_postgresql\"\u003e\u003c/a\u003e连接PostgreSQL\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e大多数时间，您将使用连接池连接到 PostgreSQL：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nSqlClient client = PgPool.client(connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e池化PostgreSQL客户端使用连接池去执行数据库操作，\n所有操作都会遵循从池里拿到连接、执行、释放连接到池里这三个步骤。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以传入一个连接池到正在运行的Vert.x实例里：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nSqlClient client = PgPool.client(vertx, connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果不再需要客户端，您需要将其释放：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.close();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您想要在同一条连接上执行多个操作时，您需要从连接池中获取\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html\"\u003econnection\u003c/a\u003e\u003c/code\u003e 连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以很方便地从连接池里拿到一条连接：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// Get a connection from the pool\u003c/span\u003e\npool.getConnection().compose(conn -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got a connection from the pool\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// All operations execute on the same connection\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e conn\n    .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=\u0026#x27;julien\u0026#x27;\u0026quot;\u003c/span\u003e)\n    .execute()\n    .compose(res -\u0026gt; conn\n      .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=\u0026#x27;emad\u0026#x27;\u0026quot;\u003c/span\u003e)\n      .execute())\n    .onComplete(ar -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// Release the connection to the pool\u003c/span\u003e\n      conn.close();\n    });\n}).onComplete(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Done\u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Something went wrong \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了连接可以重用，一旦当前连接上的操作已经完成，您需要关闭并释放连接到连接池里。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_pool_versus_pooled_client\"\u003e\u003ca class=\"anchor\" href=\"#_pool_versus_pooled_client\"\u003e\u003c/a\u003e连接池与池化的客户端\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgPool.html\"\u003ePgPool\u003c/a\u003e\u003c/code\u003e 允许您创建连接池或池化客户端\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSqlClient pooledClient = PgPool.client(vertx, connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// 流水线操作（Pipelined）\u003c/span\u003e\nFuture\u0026lt;RowSet\u0026lt;Row\u0026gt;\u0026gt; res1 = pooledClient.query(sql).execute();\n\n\u003cspan class=\"hljs-comment\"\u003e// 连接池\u003c/span\u003e\nPgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// 不是流水线操作\u003c/span\u003e\nFuture\u0026lt;RowSet\u0026lt;Row\u0026gt;\u0026gt; res2 = pool.query(sql).execute();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e连接池操作并非流水线操作（pipelined），只有连接客户端是流水线操作\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e池化的客户端操作是流水线操作\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_unix_domain_sockets\"\u003e\u003ca class=\"anchor\" href=\"#_unix_domain_sockets\"\u003e\u003c/a\u003eUnix domain sockets\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e某些情况下您希望通过Unix domain socket类型的连接来提升性能，我们通过Vert.x本机传输支持了这种方式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e首先确保您已经在classpath下添加了 \u003ccode\u003enetty-transport-native\u003c/code\u003e 这个必须的依赖，同时开启了Unix domain socket功能（pg）选项。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/var/run/postgresql\u0026quot;\u003c/span\u003e)\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool client = PgPool.pool(connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client with a vertx instance\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Make sure the vertx instance has enabled native transports\u003c/span\u003e\nPgPool client2 = PgPool.pool(vertx, connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多详情可以在这里找到 \u003ca href=\"https://vertx.io/docs/vertx-core/java/#_native_transports\"\u003eVert.x 文档\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_connect_retries\"\u003e\u003ca class=\"anchor\" href=\"#_connect_retries\"\u003e\u003c/a\u003e重连\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以配置客户端在建立连接失败的时候的重试策略\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoptions\n  .setReconnectAttempts(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n  .setReconnectInterval(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_configuration\"\u003e\u003c/a\u003e配置\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e有如下几种配置客户端的可选方案。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_data_object\"\u003e\u003ca class=\"anchor\" href=\"#_data_object\"\u003e\u003c/a\u003edata object\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e通过指定 \u003ccode\u003ePgConnectOptions\u003c/code\u003e 数据对象是一种简单的客户端的配置方式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool Options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions().setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pool from the data object\u003c/span\u003e\nPgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);\n\npool.getConnection(ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以使用 \u003ccode\u003esetProperties`或 `addProperty`方法配置通用属性。注意 `setProperties\u003c/code\u003e 将覆盖默认的客户端属性。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e例如，您可以通过添加 \u003ccode\u003esearch_path\u003c/code\u003e 属性来配置一个默认的schema。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions();\n\n\u003cspan class=\"hljs-comment\"\u003e// Set the default schema\u003c/span\u003e\nMap\u0026lt;String, String\u0026gt; props = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HashMap\u0026lt;\u0026gt;();\nprops.put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;search_path\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;myschema\u0026quot;\u003c/span\u003e);\nconnectOptions.setProperties(props);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e关于可用属性的更多信息可以在这里找到 \u003ca href=\"https://www.postgresql.org/docs/current/runtime-config-client.html\"\u003ePostgreSQL Manuals\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_connection_uri\"\u003e\u003ca class=\"anchor\" href=\"#_connection_uri\"\u003e\u003c/a\u003e连接uri\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e除了使用 \u003ccode\u003ePgConnectionOptions\u003c/code\u003e 对象，我们也提供了另一种基于URI的可选配置方案：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eString connectionUri = \u003cspan class=\"hljs-string\"\u003e\u0026quot;postgresql://dbuser:secretpassword@database.server.com:3211/mydb\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pool from the connection URI\u003c/span\u003e\nPgPool pool = PgPool.pool(connectionUri);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the connection from the connection URI\u003c/span\u003e\nPgConnection.connect(vertx, connectionUri, res -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e关于连接uri字符串格式的更多信息可以在这里找到 \u003ca href=\"https://www.postgresql.org/docs/9.6/static/libpq-connect.html#LIBPQ-CONNSTRING\"\u003ePostgreSQL 手册\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当前版本的客户端支持在连接uri里使用如下参数\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ehost\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehostaddr\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eport\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003euser\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epassword\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edbname\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003esslmode\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eproperties including(application_name, fallback_application_name, search_path)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n通过URI配置的属性将会覆盖默认的配置属性。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_environment_variables\"\u003e\u003ca class=\"anchor\" href=\"#_environment_variables\"\u003e\u003c/a\u003e环境变量\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以使用环境变量来设置连接的属性值，以此来避免硬编码数据库连接信息。\n您可以参考 \u003ca href=\"https://www.postgresql.org/docs/9.6/static/libpq-envars.html\"\u003e官方文档\u003c/a\u003e来了解更多详情。\n目前支持下列这些配置参数：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGHOST\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGHOSTADDR\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGPORT\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGDATABASE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGUSER\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGPASSWORD\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGSSLMODE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您没有在连接时指定连接对象或者URI字符串，此时将会使用环境变量。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e$ PGUSER=user \\\n PGHOST=the-host \\\n PGPASSWORD=secret \\\n PGDATABASE=the-db \\\n PGPORT=\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e \\\n PGSSLMODE=DISABLE\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgPool pool = PgPool.pool();\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the connection from the environment variables\u003c/span\u003e\nPgConnection.connect(vertx, res -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_sasl_scram_sha_256_authentication_mechanism\"\u003e\u003ca class=\"anchor\" href=\"#_sasl_scram_sha_256_authentication_mechanism\"\u003e\u003c/a\u003eSASL SCRAM-SHA-256 鉴权机制。\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了使用 sasl SCRAM-SHA-256鉴权，需要在 \u003cem\u003edependencies\u003c/em\u003e 里添加如下依赖：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件里）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003ecom.ongres.scram\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eclient\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e2.1\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件里）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003edependencies {\n compile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;com.ongres.scram:client:2.1\u0026#x27;\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSCRAM-SHA-256-PLUS（在Postgresql 11中加入）当前版本客户端暂不支持。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_running_queries\"\u003e\u003ca class=\"anchor\" href=\"#_running_queries\"\u003e\u003c/a\u003e执行查询\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您不需要事务或者只是执行一个单次查询操作，您可以直接在连接池里执行查询；\n连接池会使用某一条连接执行并给您返回结果。\n下边是如何执行一个简单的查询的例子：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=\u0026#x27;julien\u0026#x27;\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; result = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prepared_queries\"\u003e\u003ca class=\"anchor\" href=\"#_prepared_queries\"\u003e\u003c/a\u003e预查询\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e执行预查询也是一样的操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSQL字符通过位置引用实际的参数，并使用数据库的语法 `$1`, `$2`, etc…​\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=$1\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + rows.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e查询相关的方法为 \u003cem\u003eSELECT\u003c/em\u003e 类型的操作提供了异步的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/RowSet.html\"\u003eRowSet\u003c/a\u003e\u003c/code\u003e 实例\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT first_name, last_name FROM users\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者 \u003cem\u003eUPDATE\u003c/em\u003e/\u003cem\u003eINSERT\u003c/em\u003e 类型的查询：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO users (first_name, last_name) VALUES ($1, $2)\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Julien\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Viet\u0026quot;\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRow对象（\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e）可以让您通过索引位置获取相应的数据\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSystem.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者通过名称\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSystem.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;first_name\u0026quot;\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e客户端在此处没有做特殊处理，无论您的SQL文本时什么，列名都将使用数据库表中的名称标识。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以直接访问得到多种类型\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eString firstName = row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;first_name\u0026quot;\u003c/span\u003e);\nBoolean male = row.getBoolean(\u003cspan class=\"hljs-string\"\u003e\u0026quot;male\u0026quot;\u003c/span\u003e);\nInteger age = row.getInteger(\u003cspan class=\"hljs-string\"\u003e\u0026quot;age\u0026quot;\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用缓存过的预处理语句去执行一次性的预查询：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnectOptions.setCachePreparedStatements(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e);\nclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id = $1\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + rows.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以创建 \u003ccode\u003ePreparedStatement\u003c/code\u003e 并自主地管理它的生命周期。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003esqlConnection\n  .prepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id = $1\u0026quot;\u003c/span\u003e, ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      PreparedStatement preparedStatement = ar.result();\n      preparedStatement.query()\n        .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e), ar2 -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n            RowSet\u0026lt;Row\u0026gt; rows = ar2.result();\n            System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + rows.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n            preparedStatement.close();\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar2.cause().getMessage());\n          }\n        });\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_batches\"\u003e\u003ca class=\"anchor\" href=\"#_batches\"\u003e\u003c/a\u003e批处理\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以在预查询中执行批处理操作\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eList\u0026lt;Tuple\u0026gt; batch = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ArrayList\u0026lt;\u0026gt;();\nbatch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Julien Viet\u0026quot;\u003c/span\u003e));\nbatch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;emad\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Emad Alblueshi\u0026quot;\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Execute the prepared batch\u003c/span\u003e\nclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO USERS (id, name) VALUES ($1, $2)\u0026quot;\u003c/span\u003e)\n  .executeBatch(batch, res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Process rows\u003c/span\u003e\n    RowSet\u0026lt;Row\u0026gt; rows = res.result();\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Batch failed \u0026quot;\u003c/span\u003e + res.cause());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用 'RETURNING' 从查询里拿到生成的key：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO color (color_name) VALUES ($1), ($2), ($3) RETURNING color_id\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;white\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;red\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;blue\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;generated key: \u0026quot;\u003c/span\u003e + row.getInteger(\u003cspan class=\"hljs-string\"\u003e\u0026quot;color_id\u0026quot;\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e带有 \u003ccode\u003eRETURNING\u003c/code\u003e 语句的批量查询创建了一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/RowSet.html\"\u003eRowSet\u003c/a\u003e\u003c/code\u003e ，\n这个RowSet包含了该批量查询中的每一个元素。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO color (color_name) VALUES ($1) RETURNING color_id\u0026quot;\u003c/span\u003e)\n  .executeBatch(Arrays.asList(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;white\u0026quot;\u003c/span\u003e), Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;red\u0026quot;\u003c/span\u003e), Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;blue\u0026quot;\u003c/span\u003e)),ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (RowSet\u0026lt;Row\u0026gt; rows = ar.result();rows.next() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e;rows = rows.next()) {\n        Integer colorId = rows.iterator().next().getInteger(\u003cspan class=\"hljs-string\"\u003e\u0026quot;color_id\u0026quot;\u003c/span\u003e);\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;generated key: \u0026quot;\u003c/span\u003e + colorId);\n      }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_connections\"\u003e\u003ca class=\"anchor\" href=\"#_using_connections\"\u003e\u003c/a\u003e使用连接\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_getting_a_connection\"\u003e\u003ca class=\"anchor\" href=\"#_getting_a_connection\"\u003e\u003c/a\u003e获取一条连接\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您要执行查询（无事务）操作时，您可以创建一条或者从连接池里拿到一条连接。\n请注意在从拿到连接到将连接释放回连接池这之间的连接状态，服务端可能由于某些原因比如空闲时间超时，而关闭这条连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool\n  .getConnection()\n  .compose(connection -\u0026gt;\n    connection\n      .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES ($1, $2)\u0026quot;\u003c/span\u003e)\n      .executeBatch(Arrays.asList(\n        Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Julien\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Viet\u0026quot;\u003c/span\u003e),\n        Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Emad\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Alblueshi\u0026quot;\u003c/span\u003e)\n      ))\n      .compose(res -\u0026gt; connection\n        \u003cspan class=\"hljs-comment\"\u003e// Do something with rows\u003c/span\u003e\n        .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT COUNT(*) FROM Users\u0026quot;\u003c/span\u003e)\n        .execute()\n        .map(rows -\u0026gt; rows.iterator().next().getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)))\n      \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n      .eventually(v -\u0026gt; connection.close())\n  ).onSuccess(count -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Insert users, now the number of users is \u0026quot;\u003c/span\u003e + count);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e也可以通过连接对象创建预查询:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection\n  .prepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE first_name LIKE $1\u0026quot;\u003c/span\u003e)\n  .compose(pq -\u0026gt;\n    pq.query()\n      .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Julien\u0026quot;\u003c/span\u003e))\n      .eventually(v -\u0026gt; pq.close())\n  ).onSuccess(rows -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// All rows\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_simplified_connection_api\"\u003e\u003ca class=\"anchor\" href=\"#_simplified_connection_api\"\u003e\u003c/a\u003e简化的连接API\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您使用连接池时，您可以调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Pool.html#withConnection-java.util.function.Function-io.vertx.core.Handler-\"\u003ewithConnection\u003c/a\u003e\u003c/code\u003e\n并以当前连接要执行的操作作为参数。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这样会从连接池里拿到一条连接，并使用当前连接执行目标操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这种方式需要返回一个future对象来表示操作结果。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当这个future操作完成后，当前连接会被释放会连接池同时您也可能拿到最终的执行结果。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.withConnection(connection -\u0026gt;\n  connection\n    .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES ($1, $2)\u0026quot;\u003c/span\u003e)\n    .executeBatch(Arrays.asList(\n      Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Julien\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Viet\u0026quot;\u003c/span\u003e),\n      Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Emad\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Alblueshi\u0026quot;\u003c/span\u003e)\n    ))\n    .compose(res -\u0026gt; connection\n      \u003cspan class=\"hljs-comment\"\u003e// Do something with rows\u003c/span\u003e\n      .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT COUNT(*) FROM Users\u0026quot;\u003c/span\u003e)\n      .execute()\n      .map(rows -\u0026gt; rows.iterator().next().getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)))\n).onSuccess(count -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Insert users, now the number of users is \u0026quot;\u003c/span\u003e + count);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_transactions\"\u003e\u003ca class=\"anchor\" href=\"#_using_transactions\"\u003e\u003c/a\u003e使用事务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_transactions_with_connections\"\u003e\u003ca class=\"anchor\" href=\"#_transactions_with_connections\"\u003e\u003c/a\u003e连接中使用事务操作\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用SQL语法 \u003ccode\u003eBEGIN\u003c/code\u003e/\u003ccode\u003eCOMMIT\u003c/code\u003e/\u003ccode\u003eROLLBACK\u003c/code\u003e 来执行事务操作，同时您必须使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\"\u003eSqlConnection\u003c/a\u003e\u003c/code\u003e 并自己管理当前连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者您也可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\"\u003eSqlConnection\u003c/a\u003e\u003c/code\u003e 的事务API：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.getConnection()\n  \u003cspan class=\"hljs-comment\"\u003e// Transaction must use a connection\u003c/span\u003e\n  .onSuccess(conn -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Begin the transaction\u003c/span\u003e\n  conn.begin()\n    .compose(tx -\u0026gt; conn\n      \u003cspan class=\"hljs-comment\"\u003e// Various statements\u003c/span\u003e\n      .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Julien\u0026#x27;,\u0026#x27;Viet\u0026#x27;)\u0026quot;\u003c/span\u003e)\n      .execute()\n      .compose(res2 -\u0026gt; conn\n        .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Emad\u0026#x27;,\u0026#x27;Alblueshi\u0026#x27;)\u0026quot;\u003c/span\u003e)\n        .execute())\n      \u003cspan class=\"hljs-comment\"\u003e// Commit the transaction\u003c/span\u003e\n      .compose(res3 -\u0026gt; tx.commit()))\n    \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n    .eventually(v -\u0026gt; conn.close())\n    .onSuccess(v -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Transaction succeeded\u0026quot;\u003c/span\u003e))\n    .onFailure(err -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Transaction failed: \u0026quot;\u003c/span\u003e + err.getMessage()));\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当数据库服务端返回当前事务已失败（比如常见的 \u003cem\u003ecurrent transaction is aborted, commands ignored until end of transaction block\u003c/em\u003e）\n，事务已回滚和 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Transaction.html#completion--\"\u003ecompletion\u003c/a\u003e\u003c/code\u003e 方法的返回值future返回了\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/TransactionRollbackException.html\"\u003eTransactionRollbackException\u003c/a\u003e\u003c/code\u003e 异常时：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003etx.completion()\n  .onFailure(err -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Transaction failed =\u0026gt; rolled back\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_simplified_transaction_api\"\u003e\u003ca class=\"anchor\" href=\"#_simplified_transaction_api\"\u003e\u003c/a\u003e简化版事务API\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您使用连接池时，您可以调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Pool.html#withTransaction-java.util.function.Function-io.vertx.core.Handler-\"\u003ewithTransaction\u003c/a\u003e\u003c/code\u003e 方法\n并传递待执行的事务操作作为参数。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这将会从连接池里拿到一条连接，开启事务并调用待执行操作，配合客户端一起执行该事务范围内\n的所有操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e待执行操作需要返回一个future来表示可能产生的结果：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e当future成功时，客户端提交该事务\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当future失败时，客户端回滚该事务\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e事务操作完成后，连接会被释放回连接池，并且可以获取到最终的操作结果。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.withTransaction(client -\u0026gt; client\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Julien\u0026#x27;,\u0026#x27;Viet\u0026#x27;)\u0026quot;\u003c/span\u003e)\n  .execute()\n  .flatMap(res -\u0026gt; client\n    .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Emad\u0026#x27;,\u0026#x27;Alblueshi\u0026#x27;)\u0026quot;\u003c/span\u003e)\n    .execute()\n    \u003cspan class=\"hljs-comment\"\u003e// Map to a message result\u003c/span\u003e\n    .map(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Users inserted\u0026quot;\u003c/span\u003e)))\n  .onSuccess(v -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Transaction succeeded\u0026quot;\u003c/span\u003e))\n  .onFailure(err -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Transaction failed: \u0026quot;\u003c/span\u003e + err.getMessage()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cursors_and_streaming\"\u003e\u003ca class=\"anchor\" href=\"#_cursors_and_streaming\"\u003e\u003c/a\u003e游标和流式操作\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认情况下预查询操作会拉去所有的行记录，您可以使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Cursor.html\"\u003e游标\u003c/a\u003e\u003c/code\u003e 来控制您想要读取的行数：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE first_name LIKE $1\u0026quot;\u003c/span\u003e, ar0 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar0.succeeded()) {\n    PreparedStatement pq = ar0.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Cursors require to run within a transaction\u003c/span\u003e\n    connection.begin(ar1 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n        Transaction tx = ar1.result();\n\n        \u003cspan class=\"hljs-comment\"\u003e// Create a cursor\u003c/span\u003e\n        Cursor cursor = pq.cursor(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e));\n\n        \u003cspan class=\"hljs-comment\"\u003e// Read 50 rows\u003c/span\u003e\n        cursor.read(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, ar2 -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n            RowSet\u0026lt;Row\u0026gt; rows = ar2.result();\n\n            \u003cspan class=\"hljs-comment\"\u003e// Check for more ?\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cursor.hasMore()) {\n              \u003cspan class=\"hljs-comment\"\u003e// Repeat the process...\u003c/span\u003e\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n              \u003cspan class=\"hljs-comment\"\u003e// No more rows - commit the transaction\u003c/span\u003e\n              tx.commit();\n            }\n          }\n        });\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e游标释放时需要同时执行关闭操作：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ecursor.read(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, ar2 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// Close the cursor\u003c/span\u003e\n    cursor.close();\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003estream API也可以用于游标，尤其是在Rx版的客户端，可能更为方便。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE first_name LIKE $1\u0026quot;\u003c/span\u003e, ar0 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar0.succeeded()) {\n    PreparedStatement pq = ar0.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Streams require to run within a transaction\u003c/span\u003e\n    connection.begin(ar1 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n        Transaction tx = ar1.result();\n\n        \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n        RowStream\u0026lt;Row\u0026gt; stream = pq.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e));\n\n        \u003cspan class=\"hljs-comment\"\u003e// Use the stream\u003c/span\u003e\n        stream.exceptionHandler(err -\u0026gt; {\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error: \u0026quot;\u003c/span\u003e + err.getMessage());\n        });\n        stream.endHandler(v -\u0026gt; {\n          tx.commit();\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;End of stream\u0026quot;\u003c/span\u003e);\n        });\n        stream.handler(row -\u0026gt; {\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User: \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e));\n        });\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e上边的stream会批量读取 \u003ccode\u003e50\u003c/code\u003e 行并同时将其转换为流，当这些行记录被传递给处理器时，\n会以此类推地读取下一批的 \u003ccode\u003e50\u003c/code\u003e 行记录。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003estream支持重启或暂停，已经加载到的行记录将会被保留在内存里直到被传递给处理器，此时\n游标也将终止遍历。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nPostreSQL会在事务结束后销毁游标，因而游标API应该在事务内使用，\n否则您将可能收到 \u003ccode\u003e34000\u003c/code\u003e PostgreSQL错误码。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_tracing_queries\"\u003e\u003ca class=\"anchor\" href=\"#_tracing_queries\"\u003e\u003c/a\u003e跟踪查询\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当Vert.x启用tracing功能时，SQL客户端可以跟踪查询的执行情况。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e客户端会上报下列这些 \u003cem\u003eclient\u003c/em\u003e spans：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eQuery\u003c/code\u003e 操作名称\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etags\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edb.user\u003c/code\u003e ：数据库用户名\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edb.instance\u003c/code\u003e ：数据库实例\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edb.statement\u003c/code\u003e ：SQL语句\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edb.type\u003c/code\u003e ：\u003cem\u003esql\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认的 tracing 策略时 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/tracing/TracingPolicy.html#PROPAGATE\"\u003ePROPAGATE\u003c/a\u003e\u003c/code\u003e，客户端\n在一个活跃trace里只创建一个span。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnectOptions.html#setTracingPolicy-io.vertx.core.tracing.TracingPolicy-\"\u003esetTracingPolicy\u003c/a\u003e\u003c/code\u003e 方法来调整tracing策略，\n例如您可以设置为 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/tracing/TracingPolicy.html#ALWAYS\"\u003eALWAYS\u003c/a\u003e\u003c/code\u003e，\n客户端将始终上报span：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoptions.setTracingPolicy(TracingPolicy.ALWAYS);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_postgresql_type_mapping\"\u003e\u003ca class=\"anchor\" href=\"#_postgresql_type_mapping\"\u003e\u003c/a\u003ePostgreSQL 类型映射\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当前版本客户端支持下列的PostgreSQL类型\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eBOOLEAN (\u003ccode\u003ejava.lang.Boolean\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT2 (\u003ccode\u003ejava.lang.Short\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT4 (\u003ccode\u003ejava.lang.Integer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT8 (\u003ccode\u003ejava.lang.Long\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFLOAT4 (\u003ccode\u003ejava.lang.Float\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFLOAT8 (\u003ccode\u003ejava.lang.Double\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCHAR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eVARCHAR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTEXT (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eENUM (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNAME (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL2 (\u003ccode\u003ejava.lang.Short\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL4 (\u003ccode\u003ejava.lang.Integer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL8 (\u003ccode\u003ejava.lang.Long\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNUMERIC (\u003ccode\u003eio.vertx.sqlclient.data.Numeric\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUUID (\u003ccode\u003ejava.util.UUID\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDATE (\u003ccode\u003ejava.time.LocalDate\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIME (\u003ccode\u003ejava.time.LocalTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMETZ (\u003ccode\u003ejava.time.OffsetTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMESTAMP (\u003ccode\u003ejava.time.LocalDateTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMESTAMPTZ (\u003ccode\u003ejava.time.OffsetDateTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINTERVAL (\u003ccode\u003eio.vertx.pgclient.data.Interval\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBYTEA (\u003ccode\u003eio.vertx.core.buffer.Buffer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJSON (\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e, \u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e, \u003ccode\u003eNumber\u003c/code\u003e, \u003ccode\u003eBoolean\u003c/code\u003e, \u003ccode\u003eString\u003c/code\u003e, \u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJSONB (\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e, \u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e, \u003ccode\u003eNumber\u003c/code\u003e, \u003ccode\u003eBoolean\u003c/code\u003e, \u003ccode\u003eString\u003c/code\u003e, \u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePOINT (\u003ccode\u003eio.vertx.pgclient.data.Point\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLINE (\u003ccode\u003eio.vertx.pgclient.data.Line\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLSEG (\u003ccode\u003eio.vertx.pgclient.data.LineSegment\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBOX (\u003ccode\u003eio.vertx.pgclient.data.Box\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePATH (\u003ccode\u003eio.vertx.pgclient.data.Path\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePOLYGON (\u003ccode\u003eio.vertx.pgclient.data.Polygon\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCIRCLE (\u003ccode\u003eio.vertx.pgclient.data.Circle\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTSVECTOR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTSQUERY (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINET (\u003ccode\u003eio.vertx.pgclient.data.Inet\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTuple（元组）在解码时使用上述类型映射关系存储解码出的值，并且在合法的条件下可以动态转换为实际类型的值：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT 1::BIGINT \\\u0026quot;VAL\\\u0026quot;\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  RowSet\u0026lt;Row\u0026gt; rowSet = ar.result();\n  Row row = rowSet.iterator().next();\n\n  \u003cspan class=\"hljs-comment\"\u003e// Stored as java.lang.Long\u003c/span\u003e\n  Object value = row.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Convert to java.lang.Integer\u003c/span\u003e\n  Integer intValue = row.getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTuple（元组）编码时使用上述关系作为类型间的映射关系，除非类型为数字，在这种情况下将会使用 \u003ccode\u003ejava.lang.Number\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT 1::BIGINT \\\u0026quot;VAL\\\u0026quot;\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  RowSet\u0026lt;Row\u0026gt; rowSet = ar.result();\n  Row row = rowSet.iterator().next();\n\n  \u003cspan class=\"hljs-comment\"\u003e// Stored as java.lang.Long\u003c/span\u003e\n  Object value = row.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Convert to java.lang.Integer\u003c/span\u003e\n  Integer intValue = row.getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e上述类型的数组形式也是支持的。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_json\"\u003e\u003ca class=\"anchor\" href=\"#_handling_json\"\u003e\u003c/a\u003eJSON\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL的 \u003ccode\u003eJSON\u003c/code\u003e 和 \u003ccode\u003eJSONB\u003c/code\u003e  用下列的java类型表示：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eString\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eNumber\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eBoolean\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e for representing the JSON null literal\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eTuple tuple = Tuple.of(\n  Tuple.JSON_NULL,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;foo\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;bar\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Retrieving json\u003c/span\u003e\nObject value = tuple.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect JSON_NULL\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\nvalue = tuple.get(JsonObject.class, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect JSON object\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\nvalue = tuple.get(Integer.class, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect 3\u003c/span\u003e\nvalue = tuple.getInteger(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_numeric\"\u003e\u003ca class=\"anchor\" href=\"#_handling_numeric\"\u003e\u003c/a\u003e数字类型（Numeric）\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ejava的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/data/Numeric.html\"\u003eNumeric\u003c/a\u003e\u003c/code\u003e 用来表示PostgreSQL的 \u003ccode\u003eNUMERIC\u003c/code\u003e 类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eNumeric numeric = row.get(Numeric.class, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (numeric.isNaN()) {\n  \u003cspan class=\"hljs-comment\"\u003e// Handle NaN\u003c/span\u003e\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  BigDecimal value = numeric.bigDecimalValue();\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_arrays\"\u003e\u003ca class=\"anchor\" href=\"#_handling_arrays\"\u003e\u003c/a\u003e数组\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e数组可以用在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Tuple.html\"\u003eTuple\u003c/a\u003e\u003c/code\u003e 和 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eTuple tuple = Tuple.of(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e String[]{ \u003cspan class=\"hljs-string\"\u003e\u0026quot;a\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;tuple\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;with\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;arrays\u0026quot;\u003c/span\u003e });\n\n\u003cspan class=\"hljs-comment\"\u003e// Add a string array to the tuple\u003c/span\u003e\ntuple.addArrayOfString(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e String[]{\u003cspan class=\"hljs-string\"\u003e\u0026quot;another\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;array\u0026quot;\u003c/span\u003e});\n\n\u003cspan class=\"hljs-comment\"\u003e// Get the first array of string\u003c/span\u003e\nString[] array = tuple.getArrayOfStrings(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_datetime_infinity\"\u003e\u003ca class=\"anchor\" href=\"#_handling_datetime_infinity\"\u003e\u003c/a\u003e日期/时间类型（Date/Time）的最值\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL定义了几个特殊的值用来表示这些最值。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e相应类型的最大/最小值由这些常量 \u003ca href=\"https://www.postgresql.org/docs/9.0/datatype-datetime.html\"\u003e特殊值\u003c/a\u003e 表示。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eOffsetDateTime.MAX\u003c/code\u003e/OffsetDateTime.MIN`\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eLocalDateTime.MAX\u003c/code\u003e/LocalDateTime.MIN`\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eLocalDate.MAX\u003c/code\u003e/LocalDate.MIN`\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT \u0026#x27;infinity\u0026#x27;::DATE \\\u0026quot;LocalDate\\\u0026quot;\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      Row row = ar.result().iterator().next();\n      System.out.println(row.getLocalDate(\u003cspan class=\"hljs-string\"\u003e\u0026quot;LocalDate\u0026quot;\u003c/span\u003e).equals(LocalDate.MAX));\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_custom_types\"\u003e\u003ca class=\"anchor\" href=\"#_handling_custom_types\"\u003e\u003c/a\u003e自定义类型\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e发送和从Postgres接收的自定义类型都由字符串来表示。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以读取PostgreSQL并以字符串的形式得到自定义的类型值\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT address, (address).city FROM address_book WHERE id=$1\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Full Address \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\u0026quot;, City \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以向PostgreSQL写入字符串\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO address_book (id, address) VALUES ($1, $2)\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;(\u0026#x27;Anytown\u0026#x27;, \u0026#x27;Second Ave\u0026#x27;, false)\u0026quot;\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_text_search\"\u003e\u003ca class=\"anchor\" href=\"#_handling_text_search\"\u003e\u003c/a\u003e文本检索\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e文本检索使用的是java的 \u003ccode\u003eString\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT to_tsvector( $1 ) @@ to_tsquery( $2 )\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;fat cats ate fat rats\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;fat \u0026amp; rat\u0026quot;\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Match : \u0026quot;\u003c/span\u003e + row.getBoolean(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etsvector\u003c/code\u003e 和 \u003ccode\u003etsquery\u003c/code\u003e 可以使用java的 \u003ccode\u003eString\u003c/code\u003e 类型来从数据库中获取\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT to_tsvector( $1 ), to_tsquery( $2 )\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;fat cats ate fat rats\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;fat \u0026amp; rat\u0026quot;\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Vector : \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\u0026quot;, query : \u0026quot;\u003c/span\u003e+row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_enumerated_types\"\u003e\u003ca class=\"anchor\" href=\"#_handling_enumerated_types\"\u003e\u003c/a\u003e枚举类型\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL的 \u003ca href=\"https://www.postgresql.org/docs/9.1/datatype-enum.html\"\u003e枚举类型\u003c/a\u003e 被映射为java的字符串。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO colors VALUES ($2)\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;red\u0026quot;\u003c/span\u003e),  res -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_java_enum_types\"\u003e\u003ca class=\"anchor\" href=\"#_using_java_enum_types\"\u003e\u003c/a\u003e使用Java枚举类型\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以将Java的 \u003ca href=\"https://docs.oracle.com/javase/tutorial/java/javaOO/enum.html\"\u003e枚举类型\u003c/a\u003e\n映射为下列这些列类型：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eStrings (VARCHAR, TEXT)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePosgreSQL enumerated types\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNumbers (INT2, INT4, INT8)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO colors VALUES ($1)\u0026quot;\u003c/span\u003e)\n  .execute(Tuple.of(Color.red))\n  .flatMap(res -\u0026gt;\n    client\n      .preparedQuery(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT color FROM colors\u0026quot;\u003c/span\u003e)\n      .execute()\n  ).onComplete(res -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n      RowSet\u0026lt;Row\u0026gt; rows = res.result();\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n        System.out.println(row.get(Color.class, \u003cspan class=\"hljs-string\"\u003e\u0026quot;color\u0026quot;\u003c/span\u003e));\n      }\n    }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eString and PostgreSQL enumerated types 对应Java枚举类的 \u003ccode\u003ename()\u003c/code\u003e 方法的返回值。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNumbers类型对应Java枚举类的 \u003ccode\u003eordinal()\u003c/code\u003e 方法的返回值。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_collector_queries\"\u003e\u003ca class=\"anchor\" href=\"#_collector_queries\"\u003e\u003c/a\u003eCollector式查询\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以将Java collector与查询API结合使用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCollector\u0026lt;Row, ?, Map\u0026lt;Long, String\u0026gt;\u0026gt; collector = Collectors.toMap(\n  row -\u0026gt; row.getLong(\u003cspan class=\"hljs-string\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e),\n  row -\u0026gt; row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Run the query with the collector\u003c/span\u003e\nclient.query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users\u0026quot;\u003c/span\u003e)\n  .collecting(collector)\n  .execute(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    SqlResult\u0026lt;Map\u0026lt;Long, String\u0026gt;\u0026gt; result = ar.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Get the map created by the collector\u003c/span\u003e\n    Map\u0026lt;Long, String\u0026gt; map = result.value();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + map);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ecollector式查询的结果集处理过程中不能再拿到 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e 的引用，因为\npg客户端在处理collector时，只会用一个row用于处理整个集合。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eJava的 \u003ccode\u003eCollectors\u003c/code\u003e 类提供了很多很有趣的预定义的collector，比如您可以很容易\n从row集合里得到一个字符串：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCollector\u0026lt;Row, ?, String\u0026gt; collector = Collectors.mapping(\n  row -\u0026gt; row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e),\n  Collectors.joining(\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;(\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;)\u0026quot;\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// Run the query with the collector\u003c/span\u003e\nclient.query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users\u0026quot;\u003c/span\u003e).collecting(collector).execute(ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      SqlResult\u0026lt;String\u0026gt; result = ar.result();\n\n      \u003cspan class=\"hljs-comment\"\u003e// Get the string created by the collector\u003c/span\u003e\n      String list = result.value();\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + list);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_pubsub\"\u003e\u003ca class=\"anchor\" href=\"#_pubsub\"\u003e\u003c/a\u003e发布/订阅\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL支持发布/订阅式的通信方式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以设置一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html#notificationHandler-io.vertx.core.Handler-\"\u003enotificationHandler\u003c/a\u003e\u003c/code\u003e 用于\n接收PostgreSQL的通知消息：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.notificationHandler(notification -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + notification.getPayload() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; on channel \u0026quot;\u003c/span\u003e + notification.getChannel());\n});\n\nconnection\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;LISTEN some-channel\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Subscribed to channel\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePgSubscriber (\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html\"\u003ePgSubscriber\u003c/a\u003e\u003c/code\u003e) 是一种用作\n处理单条连接上的订阅的通道（channel）管理器：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// You can set the channel before connect\u003c/span\u003e\nsubscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;channel1\u0026quot;\u003c/span\u003e).handler(payload -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + payload);\n});\n\nsubscriber.connect(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Or you can set the channel after connect\u003c/span\u003e\n    subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;channel2\u0026quot;\u003c/span\u003e).handler(payload -\u0026gt; {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + payload);\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003echannel（通道）方法的参数即通道名称（接收端）需要和PostgreSQL发送通知时的通道名称保持一致。\n注意这里和SQL中的通道名称的形式不同，在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html\"\u003ePgSubscriber\u003c/a\u003e\u003c/code\u003e\n内部会把待提交的通道名称预处理为带引号的形式：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e)\n);\n\nsubscriber.connect(ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      \u003cspan class=\"hljs-comment\"\u003e// Complex channel name - name in PostgreSQL requires a quoted ID\u003c/span\u003e\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Complex.Channel.Name\u0026quot;\u003c/span\u003e).handler(payload -\u0026gt; {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + payload);\n      });\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Complex.Channel.Name\u0026quot;\u003c/span\u003e).subscribeHandler(subscribed -\u0026gt; {\n        subscriber.actualConnection()\n          .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;NOTIFY \\\u0026quot;Complex.Channel.Name\\\u0026quot;, \u0026#x27;msg\u0026#x27;\u0026quot;\u003c/span\u003e)\n          .execute(notified -\u0026gt; {\n            System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Notified \\\u0026quot;Complex.Channel.Name\\\u0026quot;\u0026quot;\u003c/span\u003e);\n          });\n      });\n\n      \u003cspan class=\"hljs-comment\"\u003e// PostgreSQL simple ID\u0026#x27;s are forced lower-case\u003c/span\u003e\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;simple_channel\u0026quot;\u003c/span\u003e).handler(payload -\u0026gt; {\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + payload);\n      });\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;simple_channel\u0026quot;\u003c/span\u003e).subscribeHandler(subscribed -\u0026gt; {\n        \u003cspan class=\"hljs-comment\"\u003e// The following simple channel identifier is forced to lower case\u003c/span\u003e\n        subscriber.actualConnection()\n          .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;NOTIFY Simple_CHANNEL, \u0026#x27;msg\u0026#x27;\u0026quot;\u003c/span\u003e)\n          .execute(notified -\u0026gt; {\n            System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Notified simple_channel\u0026quot;\u003c/span\u003e);\n          });\n      });\n\n      \u003cspan class=\"hljs-comment\"\u003e// The following channel name is longer than the current\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// (NAMEDATALEN = 64) - 1 == 63 character limit and will be truncated\u003c/span\u003e\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\u0026quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb\u0026quot;\u003c/span\u003e)\n        .handler(payload -\u0026gt; {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received \u0026quot;\u003c/span\u003e + payload);\n      });\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以自定义一个方法来实现重连，该方法的参数为 \u003ccode\u003eretries\u003c/code\u003e （重试次数），\n返回值为 \u003ccode\u003eamountOfTime\u003c/code\u003e（重试间隔）：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e当 \u003ccode\u003eamountOfTime \u0026lt; 0\u003c/code\u003e ： 不重试，并关闭订阅\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当 \u003ccode\u003eamountOfTime = 0\u003c/code\u003e ： 立即重试\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当 \u003ccode\u003eamountOfTime \u0026gt; 0\u003c/code\u003e ： 在 \u003ccode\u003eamountOfTime\u003c/code\u003e 毫秒之后发起重试\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// Reconnect at most 10 times after 100 ms each\u003c/span\u003e\nsubscriber.reconnectPolicy(retries -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (retries \u0026lt; \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100L\u003c/span\u003e;\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e -\u003cspan class=\"hljs-number\"\u003e1L\u003c/span\u003e;\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认的策略是不重连。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cancelling_request\"\u003e\u003ca class=\"anchor\" href=\"#_cancelling_request\"\u003e\u003c/a\u003e取消请求\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL 支持取消正在运行的请求. 您可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html#cancelRequest-io.vertx.core.Handler-\"\u003ecancelRequest\u003c/a\u003e\u003c/code\u003e 正在运行的请求. 取消请求的操作在执行时将和PostgreSQL服务端新建一条连接、执行取消请求、关闭这条连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection\n  .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT pg_sleep(20)\u0026quot;\u003c/span\u003e)\n  .execute(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// imagine this is a long query and is still running\u003c/span\u003e\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Query success\u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// the server will abort the current query after cancelling request\u003c/span\u003e\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failed to query due to \u0026quot;\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\nconnection.cancelRequest(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Cancelling request has been sent\u0026quot;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failed to send cancelling request\u0026quot;\u003c/span\u003e);\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"quoteblock\"\u003e\n\u003cblockquote\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e取消请求可能不会起作用——如果请求到达时，服务端已经处理完了当前查询请求，此时取消操作不会起作用。反之，取消请求得以执行，目标命令执行提前终止并返回一条错误消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/blockquote\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多详细信息可以在这里找到 \u003ca href=\"https://www.postgresql.org/docs/11/protocol-flow.html#id-1.10.5.7.9\"\u003eofficial documentation\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_ssltls\"\u003e\u003ca class=\"anchor\" href=\"#_using_ssltls\"\u003e\u003c/a\u003e使用 SSL/TLS\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为客户端连接添加SSL的操作，您可以参考Vert.x的\n\u003ccode\u003eNetClient\u003c/code\u003e 的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnectOptions.html\"\u003ePgConnectOptions\u003c/a\u003e\u003c/code\u003e 配置操作。\n当前版本客户端支持全部的PostgreSql \u003ca href=\"https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-PROTECTION\"\u003eSSL模式\u003c/a\u003e配置，您可以通过 \u003ccode\u003esslmode\u003c/code\u003e 配置它们。客户端默认不启用SSL模式。\n\u003ccode\u003essl\u003c/code\u003e 参数仅作为一种设置 \u003ccode\u003esslmode\u003c/code\u003e 的快捷方式。 \u003ccode\u003esetSsl(true)\u003c/code\u003e 等价于 \u003ccode\u003esetSslMode(VERIFY_CA)\u003c/code\u003e，\u003ccode\u003esetSsl(false)\u003c/code\u003e 等价于 \u003ccode\u003esetSslMode(DISABLE)\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions options = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-host\u0026quot;\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\u0026quot;the-db\u0026quot;\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e)\n  .setSslMode(SslMode.VERIFY_CA)\n  .setPemTrustOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PemTrustOptions().addCertPath(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/path/to/cert.pem\u0026quot;\u003c/span\u003e));\n\nPgConnection.connect(vertx, options, res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// Connected with SSL\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Could not connect \u0026quot;\u003c/span\u003e + res.cause());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多详细信息可以在这里找到 \u003ca href=\"http://vertx.io/docs/vertx-core/java/#ssl\"\u003eVert.x documentation\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_a_proxy\"\u003e\u003ca class=\"anchor\" href=\"#_using_a_proxy\"\u003e\u003c/a\u003e使用代理\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以配置客户端使用HTTP/1.x 连接，SOCKS4a 或 SOCKS5 代理。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多信息可以在这里找到 \u003ca href=\"http://vertx.io/docs/vertx-core/java/#_using_a_proxy_for_client_connections\"\u003eVert.x documentation\u003c/a\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_advanced_pool_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_advanced_pool_configuration\"\u003e\u003c/a\u003e高级连接池配置\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_server_load_balancing\"\u003e\u003ca class=\"anchor\" href=\"#_server_load_balancing\"\u003e\u003c/a\u003e数据库服务负载均衡\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用包含多个数据库服务的列表来配置连接池而不是单个数据库服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgPool pool = PgPool.pool(Arrays.asList(server1, server2, server3), options);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当一个连接创建时，连接池使用(round-robin)轮询调度算法做负载均衡以选择不同的数据库服务\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n负载均衡是在创建连接时提供的，而不是在从连接池中获取连接时提供\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_pool_connection_initialization\"\u003e\u003ca class=\"anchor\" href=\"#_pool_connection_initialization\"\u003e\u003c/a\u003e连接初始化\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Pool.html#connectHandler-io.vertx.core.Handler-\"\u003econnectHandler\u003c/a\u003e\u003c/code\u003e\n方法在连接创建后和连接释放回连接池之前来与数据库连接交互\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.connectHandler(conn -\u0026gt; {\n  conn.query(sql).execute().onSuccess(res -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e//  将连接释放回连接池，以被该应用程序复用\u003c/span\u003e\n    conn.close();\n  });\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e连接完成后，您应该释放该连接以通知连接池该数据库连接可以被使用\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_rxjava_3_api\"\u003e\u003ca class=\"anchor\" href=\"#_rxjava_3_api\"\u003e\u003c/a\u003eRxJava 3 API\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e客户端提供了原生 API 的响应式版本\n以下示例使用RxJava3\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_simple_query\"\u003e\u003ca class=\"anchor\" href=\"#_simple_query\"\u003e\u003c/a\u003e简单的查询示例\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSingle\u0026lt;RowSet\u0026lt;Row\u0026gt;\u0026gt; single = pool.query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE id=\u0026#x27;julien\u0026#x27;\u0026quot;\u003c/span\u003e).rxExecute();\n\n\u003cspan class=\"hljs-comment\"\u003e// Execute the query\u003c/span\u003e\nsingle.subscribe(result -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Got \u0026quot;\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; rows \u0026quot;\u003c/span\u003e);\n}, err -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure: \u0026quot;\u003c/span\u003e + err.getMessage());\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_connection\"\u003e\u003ca class=\"anchor\" href=\"#_connection\"\u003e\u003c/a\u003e连接\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e简化版的连接API可以让您很容易地使用connection对象，\u003ccode\u003ewithConnection\u003c/code\u003e\n方法会从连接池里获取到一条连接：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eMaybe\u0026lt;RowSet\u0026lt;Row\u0026gt;\u0026gt; maybe = pool.withConnection(conn -\u0026gt;\n  conn\n    .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Julien\u0026#x27;,\u0026#x27;Viet\u0026#x27;)\u0026quot;\u003c/span\u003e)\n    .rxExecute()\n    .flatMap(result -\u0026gt; conn\n      .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM Users\u0026quot;\u003c/span\u003e)\n      .rxExecute())\n    .toMaybe());\n\nmaybe.subscribe(rows -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Success\u003c/span\u003e\n}, err -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Failed\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_transaction\"\u003e\u003ca class=\"anchor\" href=\"#_transaction\"\u003e\u003c/a\u003e事务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e简化版的事务API可以让您很容易地编写异步事务处理流，\u003ccode\u003ewithTransaction\u003c/code\u003e\n方法会为您启动和提交事务：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCompletable completable = pool.withTransaction(conn -\u0026gt;\n  conn\n    .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Julien\u0026#x27;,\u0026#x27;Viet\u0026#x27;)\u0026quot;\u003c/span\u003e)\n    .rxExecute()\n    .flatMap(result -\u0026gt; conn\n      .query(\u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO Users (first_name,last_name) VALUES (\u0026#x27;Emad\u0026#x27;,\u0026#x27;Alblueshi\u0026#x27;)\u0026quot;\u003c/span\u003e)\n      .rxExecute())\n    .toMaybe())\n  .ignoreElement();\n\ncompletable.subscribe(() -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Transaction succeeded\u003c/span\u003e\n}, err -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Transaction failed\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_streaming\"\u003e\u003ca class=\"anchor\" href=\"#_streaming\"\u003e\u003c/a\u003e流式操作\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRxJava 支持 \u003ccode\u003eObservable\u003c/code\u003e 和 \u003ccode\u003eFlowable\u003c/code\u003e 类型，这些类型可以从 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/rxjava3/sqlclient/PreparedQuery.html\"\u003ePreparedQuery\u003c/a\u003e\u003c/code\u003e\n产生的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/rxjava3/sqlclient/RowStream.html\"\u003eRowStream\u003c/a\u003e\u003c/code\u003e\n里获取到：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eObservable\u0026lt;Row\u0026gt; observable = pool.rxGetConnection().flatMapObservable(conn -\u0026gt; conn\n  .rxBegin()\n  .flatMapObservable(tx -\u0026gt;\n    conn\n      .rxPrepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE first_name LIKE $1\u0026quot;\u003c/span\u003e)\n      .flatMapObservable(preparedQuery -\u0026gt; {\n        \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n        RowStream\u0026lt;Row\u0026gt; stream = preparedQuery.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e));\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e stream.toObservable();\n      })\n      .doAfterTerminate(tx::commit)));\n\n\u003cspan class=\"hljs-comment\"\u003e// Then subscribe\u003c/span\u003e\nobservable.subscribe(row -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User: \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e));\n}, err -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error: \u0026quot;\u003c/span\u003e + err.getMessage());\n}, () -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;End of stream\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e下边是使用 \u003ccode\u003eFlowable\u003c/code\u003e 的例子：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFlowable\u0026lt;Row\u0026gt; flowable = pool.rxGetConnection().flatMapPublisher(conn -\u0026gt; conn\n  .rxBegin()\n  .flatMapPublisher(tx -\u0026gt;\n    conn\n      .rxPrepare(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users WHERE first_name LIKE $1\u0026quot;\u003c/span\u003e)\n      .flatMapPublisher(preparedQuery -\u0026gt; {\n        \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n        RowStream\u0026lt;Row\u0026gt; stream = preparedQuery.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\u0026quot;julien\u0026quot;\u003c/span\u003e));\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e stream.toFlowable();\n      })\n      .doAfterTerminate(tx::commit)));\n\n\u003cspan class=\"hljs-comment\"\u003e// Then subscribe\u003c/span\u003e\nflowable.subscribe(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Subscriber\u0026lt;Row\u0026gt;() {\n\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e Subscription sub;\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonSubscribe\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Subscription subscription)\u003c/span\u003e \u003c/span\u003e{\n    sub = subscription;\n    subscription.request(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonNext\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Row row)\u003c/span\u003e \u003c/span\u003e{\n    sub.request(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;User: \u0026quot;\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;last_name\u0026quot;\u003c/span\u003e));\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonError\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Throwable err)\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error: \u0026quot;\u003c/span\u003e + err.getMessage());\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonComplete\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;End of stream\u0026quot;\u003c/span\u003e);\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.1.1"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.1.1","vertx-pg-client","java"]},"buildId":"9CgN7uHHZZ2w0yPW8PB89","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>