<!DOCTYPE html><html lang="en"><head><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>服务发现 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-service-discovery" as="fetch" crossorigin="anonymous" class="jsx-d38685edc31911e0"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-378e68e29c265886.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-950829b7c220163d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7b206233943f98f9.js" defer=""></script><script src="/_next/static/chunks/615-7e003fd583a96500.js" defer=""></script><script src="/_next/static/chunks/619-c3b8e8451221d93e.js" defer=""></script><script src="/_next/static/chunks/81-b150334e379339f6.js" defer=""></script><script src="/_next/static/chunks/4-de615ee773d3f25e.js" defer=""></script><script src="/_next/static/chunks/434-4fb00eb04aae2efb.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f74b5d222b77c81d.js" defer=""></script><script src="/_next/static/4ZJENDoVUUSScrN3ohD4w/_buildManifest.js" defer=""></script><script src="/_next/static/4ZJENDoVUUSScrN3ohD4w/_ssgManifest.js" defer=""></script><script src="/_next/static/4ZJENDoVUUSScrN3ohD4w/_middlewareManifest.js" defer=""></script><style id="__jsx-400ec7965926e858">.dropdown-item.jsx-400ec7965926e858 {white-space:nowrap;
line-height:2;
width:100%;
padding:0 1.5rem;
cursor:pointer}
.dropdown-item.jsx-400ec7965926e858:hover {background-color:#e9ecef}
.dropdown-item.active.jsx-400ec7965926e858 {font-weight:400;
padding-left:.75rem}
.dropdown-item.has-active-siblings.jsx-400ec7965926e858:not(.active) {padding-left:calc(0.75rem + 16px + 0.5em)}
.dropdown-item.jsx-400ec7965926e858 .dropdown-check-icon.jsx-400ec7965926e858 {width:16px;
margin-right:.5em;
margin-top:1px}</style><style id="__jsx-6650573c8f14945d">.dropdown.jsx-6650573c8f14945d {position:relative;
display:inline-block}
.dropdown.jsx-6650573c8f14945d .dropdown-title.jsx-6650573c8f14945d {margin-right:0;
cursor:pointer;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d {position:absolute;
background-color:#f8f9fa;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
border-radius:.8rem;
list-style-type:none;
padding:.6666666667rem 0;
margin:.25rem 0 0 0;
z-index:100;
display:none;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a {color:#4d4d4d;
-webkit-text-decoration:none;
text-decoration:none;
font-weight:300}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.align-right.jsx-6650573c8f14945d {right:0}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.visible.jsx-6650573c8f14945d {display:block}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a.jsx-6650573c8f14945d:hover {color:inherit}
.dropdown.jsx-6650573c8f14945d svg {margin-bottom:2px}</style><style id="__jsx-f705e145f931f504">.navbar {position:absolute;
top:2.75rem;
width:100%}
.navbar a {color:#3c3c3b}
.navbar a.navbar-menu-item, .navbar .dropdown-title {text-transform:uppercase}
.navbar a.navbar-menu-item:hover, .navbar .dropdown-title:hover {-webkit-text-decoration:none;
text-decoration:none;
color:#898987;
-webkit-transition:color .15s ease-in-out;
transition:color .15s ease-in-out}
.navbar .navbar-content {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
position:relative}
.navbar .navbar-content .navbar-logo {-webkit-flex:1;
-ms-flex:1;
flex:1}
.navbar .navbar-content .navbar-logo img {width:8.3rem}
.navbar .navbar-content .navbar-collapse-button {display:none;
cursor:pointer}
@media (max-width:1000px) {.navbar .navbar-content .navbar-collapse-button {display:inline-block}}
.navbar .navbar-content .navbar-collapse-button span {display:block;
width:33px;
height:4px;
margin-bottom:5px;
position:relative;
background:#3c3c3b;
border-radius:3px;
z-index:1;
transform-origin:4px 0;
-webkit-transition:-webkit-transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease;
transition:transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease}
.navbar .navbar-content .navbar-collapse-button span:first-child {transform-origin:0% 0%}
.navbar .navbar-content .navbar-collapse-button span:nth-last-child(2) {transform-origin:0% 100%}
.navbar .navbar-content .navbar-right {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline;
margin-bottom:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-right {max-height:0;
-webkit-transition:max-height 200ms ease-in-out;
transition:max-height 200ms ease-in-out;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:absolute;
top:2.75rem;
left:.8rem;
right:.8rem;
background-color:#f8f9fa;
overflow-x:auto;
overflow-y:hidden}}
.navbar .navbar-content .navbar-menu .navbar-menu-item {font-weight:400;
margin-right:2.5rem}
.navbar .navbar-content .navbar-menu .navbar-menu-item.with-drop-down {margin-right:1.8rem}
@media (max-width:1250px) {.navbar .navbar-content .navbar-menu .navbar-menu-item {margin-right:1.5rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu .navbar-menu-item {display:block;
margin-bottom:1rem;
font-size:1.2rem}}
.navbar .navbar-content .navbar-menu .navbar-menu-item .external-link-icon {margin-left:.25em}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu {-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
padding:1rem}}
.navbar .navbar-content .navbar-social {margin-left:1.6rem;
font-size:.875rem}
.navbar .navbar-content .navbar-social svg {height:16px;
margin-bottom:2px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social svg {height:1rem}}
@media (max-width:1250px) {.navbar .navbar-content .navbar-social {margin-left:1rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social {margin-left:auto;
padding:0 1rem 1rem 0;
font-size:1rem}}
@media (max-width:768px) {.navbar {top:1rem}}
.page .navbar {top:0;
padding-top:1.5rem;
padding-bottom:1rem;
position:fixed;
background-color:#fff;
z-index:2}</style><style id="__jsx-20d862052e50feff">.search input {color:#adb5bd;
border:1px solid #dee2e6;
border-radius:.4rem;
font-size:.875rem;
padding:.25rem 1.8rem .35rem 1.8rem;
width:100%;
-webkit-transition:color .15s ease-in-out, border-color .15s ease-in-out;
transition:color .15s ease-in-out, border-color .15s ease-in-out}
.search input:focus {border-color:#adb5bd;
color:#3c3c3b}
.search .search-icon, .search .search-icon-delete {position:absolute;
top:.55rem;
height:1rem;
stroke:#adb5bd;
-webkit-transition:stroke .15s ease-in-out;
transition:stroke .15s ease-in-out}
.search .search-icon {left:.4rem}
.search input:focus +.search-icon {stroke:#6f6970}
.search .search-icon-delete {stroke:#6f6970;
right:.4rem;
height:.75rem;
top:.7rem;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out;
cursor:text}
.search.has-content .search-icon-delete {opacity:1;
cursor:pointer}</style><style id="__jsx-117e429f22e394dc">.search-results, .search-results-none {font-size:.875rem;
overflow:auto;
list-style-type:none;
padding-left:0;
display:none}
.search-results.visible, .search-results-none.visible {display:block}
.search-results {list-style-type:none;
padding:0;
margin-bottom:0}
.search-results li {display:block;
padding:.5rem;
margin-bottom:1rem;
border-radius:.4rem;
border:1px solid transparent;
cursor:pointer}
.search-results li.active {background-color:#f8f9fa;
border:1px solid #e9ecef}
.search-results li h5 {margin:0 0 .5rem 0;
font-size:1em}
.search-results li .search-results-highlight {background-color:#ff0}
.search-results-none {padding:1rem .5rem;
text-align:center;
width:100%}</style><style id="__jsx-d1843944f2d67b">.search-panel {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:relative}</style><style id="__jsx-d38685edc31911e0">.github-stars.jsx-d38685edc31911e0 {display:inline-block}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0 {margin-right:.25em}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0 svg {height:1rem}</style><style id="__jsx-aeedcf66895f49d7">footer {font-size:.875rem;
padding-top:3rem;
padding-bottom:4rem;
background-color:#f8f9fa;
border-top:1px solid #dee2e6;
margin-top:1rem;
color:#6f6970}
footer h5 {font-size:1rem;
margin-top:0;
margin-bottom:1rem;
color:#3c3c3b;
text-transform:uppercase}
footer ul {padding:0;
list-style:none;
line-height:2}
footer a {color:#6f6970}
footer .footer-logo img, footer .footer-copyright-eclipse-logo img {-webkit-filter:grayscale(100);
filter:grayscale(100);
opacity:.5;
-webkit-transition:all .15s ease-in-out;
transition:all .15s ease-in-out}
footer .footer-logo img:hover, footer .footer-copyright-eclipse-logo img:hover {-webkit-filter:grayscale(0);
filter:grayscale(0);
opacity:1}
footer .footer-nav-section {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
margin-bottom:6rem}
footer .footer-nav-section .footer-logo {margin-top:.4rem}
footer .footer-nav-section .footer-logo img {width:8.3rem}
footer .footer-nav-section .footer-nav-list {width:20%}
footer .footer-copyright {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
footer .footer-copyright a {white-space:nowrap}
footer .footer-copyright .footer-copyright-eclipse-logo {width:17%;
margin-bottom:.5rem}
@media (max-width:1250px) {footer .footer-copyright .footer-copyright-break {display:none}
footer .footer-copyright .footer-copyright-eclipse-logo {width:30%}}
@media (max-width:1000px) {footer .footer-nav-section .footer-nav-list {width:25%}
footer .footer-copyright .footer-copyright-break {display:inline-block}
footer .footer-copyright .footer-copyright-eclipse-logo {width:40%}}
@media (max-width:768px) {footer .footer-nav-section {max-width:100%;
margin-left:auto;
margin-right:auto}}
@media (max-width:640px) {footer .footer-nav-section {max-width:80%;
margin-bottom:3rem;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
footer .footer-nav-section h5 {cursor:pointer}
footer .footer-nav-section h5::after {display:inline-block;
content:"";
border-top:.4em solid;
border-right:.4em solid transparent;
border-bottom:0;
border-left:.4em solid transparent;
position:absolute;
top:.75rem;
right:0}
footer .footer-nav-section .footer-nav-list {width:100%;
position:relative}
footer .footer-nav-section .footer-nav-list ul {overflow-y:hidden;
max-height:0;
-webkit-transition:all 200ms ease-in-out;
transition:all 200ms ease-in-out}
footer .footer-nav-section .footer-nav-list ul.visible {margin-bottom:2rem}
footer .footer-nav-section .footer-logo {margin:0 auto 3rem auto;
width:auto}
footer .footer-copyright {max-width:80%;
text-align:center;
margin-left:auto;
margin-right:auto;
-webkit-flex-direction:column-reverse;
-ms-flex-direction:column-reverse;
flex-direction:column-reverse}
footer .footer-copyright .footer-copyright-eclipse-logo {width:7.6rem;
margin-bottom:1rem}}</style><style id="__jsx-efcc50be384cabc7">.page-content {margin-top:6em;
margin-bottom:8rem}
.docs .docs-content .docs-content-wrapper {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between}
.docs .docs-content .docs-content-wrapper aside {-webkit-flex:0 0 17rem;
-ms-flex:0 0 17rem;
flex:0 0 17rem}
.docs .docs-content .docs-content-wrapper aside .docs-content-wrapper-sidebar {position:-webkit-sticky;
position:sticky;
top:7em}
.docs .docs-content .docs-content-wrapper aside .search-panel {margin-top:1rem;
width:100%}
.docs .docs-content .docs-content-wrapper aside .search-panel .search-results {max-height:calc(100vh - 10rem - 1px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc {margin-top:1rem;
overflow-y:auto;
max-height:calc(100vh - 10rem - 3px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc #toctitle {display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul {margin-top:0;
padding-left:0;
list-style-type:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul.sectlevel2 {display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul li {padding:.3333333333rem 0}
.docs .docs-content .docs-content-wrapper aside.docs-has-search-results .docs-content-toc {display:none}
@media (max-width:1250px) {.docs .docs-content .docs-content-wrapper aside {-webkit-flex:0 0 15rem;
-ms-flex:0 0 15rem;
flex:0 0 15rem}}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper aside {z-index:1;
position:fixed;
top:0;
right:0;
width:25rem;
height:100vh;
max-width:100%;
padding-top:6rem;
padding-left:2rem;
padding-right:2rem;
background-color:#fff;
border-left:1px solid #dee2e6;
-webkit-transform:translateX(100%);
-moz-transform:translateX(100%);
-ms-transform:translateX(100%);
transform:translateX(100%);
-webkit-transition:-webkit-transform 200ms ease-in-out;
transition:transform 200ms ease-in-out;
will-change:transform}
.docs .docs-content .docs-content-wrapper aside.collapse {-webkit-transform:translateX(0%);
-moz-transform:translateX(0%);
-ms-transform:translateX(0%);
transform:translateX(0%)}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper aside {min-width:100%;
border-left:none}}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle {z-index:1000;
cursor:pointer;
display:none;
position:fixed;
-webkit-justify-content:center;
justify-content:center;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
right:2rem;
bottom:2rem;
color:#fff;
background-color:#4d4d4d;
padding:.5rem;
border-radius:.8rem;
-webkit-transition:background-color .15s ease-in-out;
transition:background-color .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-list, .docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x {display:block}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x {position:absolute;
left:0;
top:0;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle:hover {background-color:#3c3c3b}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-list {opacity:0}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-x {opacity:1}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle {right:1rem;
bottom:1rem}}
.docs .docs-content .docs-content-inner {max-width:calc(100% - 19.5rem);
overflow:hidden}
.docs .docs-content .docs-content-inner .docs-content-metadata {margin-top:1.2rem;
margin-bottom:1.2rem;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
flex-wrap:wrap;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata {-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-repo {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-flex:1;
-ms-flex:1;
flex:1}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left >* {margin-right:2rem}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left >*:last-child {margin-right:0}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
color:#6f6970;
white-space:nowrap}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a:hover {color:#782b90}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a .feather {margin-right:.25em;
height:1rem}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left {flex-wrap:wrap;
margin-bottom:1rem}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version {-webkit-flex:1;
-ms-flex:1;
flex:1;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
@media (min-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version {-webkit-box-pack:end;
-ms-flex-pack:end;
-webkit-justify-content:flex-end;
justify-content:flex-end}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg {height:16px;
margin-bottom:-2px}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg {height:1rem;
margin-bottom:-1px}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a {-webkit-text-decoration:none;
text-decoration:none}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a:hover {color:#6f6970}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-label {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-left:2rem}
.docs .docs-content .docs-content-inner h1 {padding-top:0;
margin-top:.6rem;
line-height:1.2}
.docs .docs-content .docs-content-inner h1::after {content:"";
width:30%;
display:block;
border:2px solid #782b90;
border-radius:2px;
margin-top:1.1rem}
.docs .docs-content .docs-content-inner .ulist >ul {padding-left:1.1rem}
.docs .docs-content .docs-content-inner h2 {border-top:1px solid #dee2e6;
margin-top:5rem;
padding-top:2rem}
.docs .docs-content .docs-content-inner h3, .docs .docs-content .docs-content-inner h4 {margin-top:3rem}
@media (max-width:1250px) {.docs .docs-content .docs-content-inner {max-width:calc(100% - 17.5rem)}}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner {max-width:100%}}
.docs .docs-content .admonitionblock {border-top-right-radius:.8rem;
border-bottom-right-radius:.8rem;
background-color:#f8f9fa;
padding:1rem;
margin:1.5rem 0;
border-left:9px solid transparent}
.docs .docs-content .admonitionblock.note, .docs .docs-content .admonitionblock.tip {border-color:#6cb9f0}
.docs .docs-content .admonitionblock.important, .docs .docs-content .admonitionblock.warning, .docs .docs-content .admonitionblock.caution {border-color:#f0a46c}
.docs .docs-content .admonitionblock tr {display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.docs .docs-content .admonitionblock .title {font-weight:400}
.docs .docs-content .admonitionblock .title::after {content:":"}
.docs .docs-content dt {font-weight:400}
.docs .docs-content .anchor {opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.docs .docs-content .anchor::after {content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.docs .docs-content .anchor:hover {opacity:1}
.docs .docs-content h2:hover .anchor, .docs .docs-content h3:hover .anchor, .docs .docs-content h4:hover .anchor, .docs .docs-content h5:hover .anchor, .docs .docs-content h6:hover .anchor {opacity:1}
.docs .docs-content h1 .anchor {display:none}
.docs .docs-content h4 .anchor::after, .docs .docs-content h5 .anchor::after, .docs .docs-content h6 .anchor::after {padding-right:.6rem}</style><style id="__jsx-7824b3ad3820c879">html {line-height:1.15;
-webkit-text-size-adjust:100%}
body {margin:0}
main {display:block}
h1 {font-size:2em;
margin:.67em 0}
hr {box-sizing:content-box;
height:0;
overflow:visible}
pre {font-family:monospace, monospace;
font-size:1em}
a {background-color:transparent}
abbr[title] {border-bottom:none;
text-decoration:underline;
text-decoration:underline dotted}
b, strong {font-weight:bolder}
code, kbd, samp {font-family:monospace, monospace;
font-size:1em}
small {font-size:80%}
sub, sup {font-size:75%;
line-height:0;
position:relative;
vertical-align:baseline}
sub {bottom:-0.25em}
sup {top:-0.5em}
img {border-style:none}
button, input, optgroup, select, textarea {font-family:inherit;
font-size:100%;
line-height:1.15;
margin:0}
button, input {overflow:visible}
button, select {text-transform:none}
button, [type=button], [type=reset], [type=submit] {-webkit-appearance:button}
button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner {border-style:none;
padding:0}
button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring {outline:1px dotted ButtonText}
fieldset {padding:.35em .75em .625em}
legend {box-sizing:border-box;
color:inherit;
display:table;
max-width:100%;
padding:0;
white-space:normal}
progress {vertical-align:baseline}
textarea {overflow:auto}
[type=checkbox], [type=radio] {box-sizing:border-box;
padding:0}
[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button {height:auto}
[type=search] {-webkit-appearance:textfield;
outline-offset:-2px}
[type=search]::-webkit-search-decoration {-webkit-appearance:none}
::-webkit-file-upload-button {-webkit-appearance:button;
font:inherit}
details {display:block}
summary {display:list-item}
template {display:none}
[hidden] {display:none}
.hljs, pre {display:block;
overflow-x:auto;
padding:.5em;
background:#3a2840;
color:#fff}
.hljs.language-shell :not(.bash) +.bash, .hljs.language-better-shell :not(.bash) +.bash, pre.language-shell :not(.bash) +.bash, pre.language-better-shell :not(.bash) +.bash {color:#d2a8e0}
pre {border-radius:.8rem;
padding:1rem;
font-size:.875rem;
margin:1.5rem 0}
.hljs-keyword, .hljs-selector-tag, .hljs-tag {color:#d2a8e0}
.hljs-template-tag {color:red}
.hljs-number {color:#6cb9f0}
.hljs-variable, .hljs-template-variable, .hljs-attribute, .hljs-literal {color:#c9e5f9}
.hljs-subst {color:red}
.hljs-title, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-section, .hljs-type {color:#f0a46c}
.hljs-symbol, .hljs-bullet, .hljs-link {color:#d2a8e0}
.hljs-deletion, .hljs-string, .hljs-built_in, .hljs-builtin-name {color:#6cb9f0}
.hljs-addition, .hljs-comment, .hljs-quote, .hljs-meta {color:#adb5bd}
.hljs-emphasis {font-style:italic}
.hljs-strong {font-weight:bold}
#nprogress {pointer-events:none}
#nprogress .bar {background:#29d;
position:fixed;
z-index:1031;
top:0;
left:0;
width:100%;
height:2px}
#nprogress .peg {display:block;
position:absolute;
right:0px;
width:100px;
height:100%;
box-shadow:0 0 10px #29d, 0 0 5px #29d;
opacity:1;
-webkit-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
-webkit-transform:rotate(3deg) translate(0px, -4px);
-moz-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
transform:rotate(3deg) translate(0px, -4px)}
#nprogress .spinner {display:block;
position:fixed;
z-index:1031;
top:15px;
right:15px}
#nprogress .spinner-icon {width:18px;
height:18px;
box-sizing:border-box;
border:solid 2px transparent;
border-top-color:#29d;
border-left-color:#29d;
border-radius:50%;
-webkit-animation:nprogress-spinner 400ms linear infinite;
-webkit-animation:nprogress-spinner 400ms linear infinite;
animation:nprogress-spinner 400ms linear infinite}
.nprogress-custom-parent {overflow:hidden;
position:relative}
.nprogress-custom-parent #nprogress .spinner, .nprogress-custom-parent #nprogress .bar {position:absolute}
@keyframes nprogress-spinner {0% {-webkit-transform:rotate(0deg)}100% {-webkit-transform:rotate(360deg)}}
@keyframes nprogress-spinner {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}
#nprogress .bar {background:#782b90}
#nprogress .peg {box-shadow:0 0 10px #782b90, 0 0 5px #782b90}
#nprogress .spinner-icon {border-top-color:#782b90;
border-left-color:#782b90}
html {box-sizing:border-box}
*, *::before, *::after {box-sizing:inherit}
:root {font-size:18px}
@media (max-width:1000px) {:root {font-size:17.1px}}
@media (max-width:768px) {:root {font-size:16.2px}}
@media (max-width:640px) {:root {font-size:15.3px}}
body, input {font-family:Roboto, sans-serif;
font-weight:300;
line-height:1.7;
color:#3c3c3b}
input {outline:none}
h1, h2, h3, h4, h5, h6 {font-weight:400}
h1 {font-size:2.5rem}
h2 {font-size:2rem}
h3 {font-size:1.75rem}
h4 {font-size:1.5rem}
h5 {font-size:1.25rem}
h6 {font-size:1.1rem}
.container {width:100%;
padding-right:.8rem;
padding-left:.8rem;
margin-right:auto;
margin-left:auto}
@media (min-width:640px) {.container {max-width:620px}}
@media (min-width:768px) {.container {max-width:738px}}
@media (min-width:1000px) {.container {max-width:950px}}
@media (min-width:1250px) {.container {max-width:1180px}}
@media (min-width:1250px) {.container-narrow {max-width:950px}}
.img-fluid {max-width:100%}
a {-webkit-text-decoration:none;
text-decoration:none;
color:#782b90}
a:hover {text-decoration:underline;
color:#571f69}
img {vertical-align:middle}
svg {overflow:hidden;
vertical-align:middle}
code, pre {font-family:"Roboto Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
p code {display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
max-width:100%;
overflow:auto}
.heading-anchor {opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.heading-anchor::after {content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.heading-anchor:hover {opacity:1}
h2:hover .heading-anchor, h3:hover .heading-anchor, h4:hover .heading-anchor, h5:hover .heading-anchor, h6:hover .heading-anchor {opacity:1}
h1 .heading-anchor {display:none}
h4 .heading-anchor::after, h5 .heading-anchor::after, h6 .heading-anchor::after {padding-right:.6rem}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400&display=swap">@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZKCA.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-59Y.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCkYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCAYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCgYb9lecyVC4A.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCcYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCsYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCoYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCQYb9lecyU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-19-7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-19a7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-1967DQk6YvNkeg.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-19G7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-1927DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-19y7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v19/ieVl2ZhZI2eCN5jzbjEETS9weq8-19K7DQk6YvM.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body data-build-time="2021-12-24T02:32:59.457Z" data-build-commit-id="83123ca8957c24a0d2d8d0911bbd33d72d4f6795" data-build-run-id="1617817981"><div id="__next" data-reactroot=""><main class="jsx-efcc50be384cabc7 page docs"><header><div class="jsx-f705e145f931f504 navbar"><div class="jsx-f705e145f931f504 navbar-content container"><div class="jsx-f705e145f931f504 navbar-logo"><a class="jsx-f705e145f931f504" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-f705e145f931f504"/></a></div><div class="jsx-f705e145f931f504 navbar-collapse-button"><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span></div><div class="jsx-f705e145f931f504 navbar-right"><div class="jsx-f705e145f931f504 navbar-menu"><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/introduction-to-vertx-and-reactive/"><li class="jsx-400ec7965926e858 dropdown-item">简介</li></a><a class="jsx-f705e145f931f504" href="/get-started/"><li class="jsx-400ec7965926e858 dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/docs/">文档</a><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/faq/"><li class="jsx-400ec7965926e858 dropdown-item">答疑</li></a><a class="jsx-f705e145f931f504" href="/channels/"><li class="jsx-400ec7965926e858 dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/advanced-vertx-guide" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">Advanced Vert.x Guide <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/blog/">博客</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/community/">社区</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/translation/">翻译团队</a></div><div class="jsx-f705e145f931f504 navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" title="Stack Overflow" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>stackoverflow</title><path d="M15.725 0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725 0zm-3.94 3.418l-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465l-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86l-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154Z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" title="YouTube" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>youtube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a><a href="https://discord.gg/KzEMwP2" title="Discord" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="jsx-efcc50be384cabc7 page-content docs-content"><div class="jsx-efcc50be384cabc7 container"><div class="jsx-efcc50be384cabc7 docs-content-wrapper"><aside class="jsx-efcc50be384cabc7 "><div class="jsx-efcc50be384cabc7 docs-content-wrapper-sidebar"><div class="jsx-d1843944f2d67b search-panel"><div class="jsx-20d862052e50feff search"><input type="text" placeholder="Search..." value="" class="jsx-20d862052e50feff"/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="jsx-117e429f22e394dc search-results"></ul><div class="jsx-117e429f22e394dc search-results-none">No results.</div></div><div class="jsx-efcc50be384cabc7 docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_the_service_discovery">使用服务发现</a></li>
<li><a href="#_overall_concepts">概念总览</a>
<ul class="sectlevel2">
<li><a href="#_service_records">服务记录</a></li>
<li><a href="#_service_provider_and_publisher">提供者和发布者</a></li>
<li><a href="#_service_consumer">服务消费者</a></li>
<li><a href="#_service_object">服务对象</a></li>
<li><a href="#_service_types">服务类型</a></li>
<li><a href="#_service_events">服务事件</a></li>
<li><a href="#_backend">后台</a></li>
</ul>
</li>
<li><a href="#_creating_a_service_discovery_instance">创建服务发现实例</a></li>
<li><a href="#_publishing_services">发布服务</a></li>
<li><a href="#_withdrawing_services">回收服务</a></li>
<li><a href="#_looking_for_services">寻找服务</a></li>
<li><a href="#_retrieving_a_service_reference">获取服务引用</a></li>
<li><a href="#_types_of_services">服务类型</a>
<ul class="sectlevel2">
<li><a href="#_services_with_no_type">无类型的服务</a></li>
<li><a href="#_implementing_your_own_service_type">实现您自己的服务类型</a></li>
<li><a href="#_http_endpoints">HTTP 节点</a></li>
<li><a href="#_event_bus_services">Event bus 服务</a></li>
<li><a href="#_message_source">消息源服务</a></li>
<li><a href="#_jdbc_data_source">JDBC数据源</a></li>
<li><a href="#_redis_data_source">Redis 数据源</a></li>
<li><a href="#_mongo_data_source">Mongo数据源</a></li>
</ul>
</li>
<li><a href="#_listening_for_service_arrivals_and_departures">监听服务的注册和注销</a></li>
<li><a href="#_listening_for_service_usage">监听服务使用状况</a></li>
<li><a href="#_service_discovery_bridges">服务发现桥接器</a></li>
<li><a href="#_additional_bridges">其他的桥接器支持</a>
<ul class="sectlevel2">
<li><a href="#_consul_bridge">Consul 网桥</a></li>
<li><a href="#_kubernetes_bridge">Kubernetes 桥接器</a></li>
<li><a href="#_docker_links_bridge">Docker Links 桥接器</a></li>
</ul>
</li>
<li><a href="#_additional_backends">其他的后台支持</a>
<ul class="sectlevel2">
<li><a href="#_redis_backend">Redis backend</a></li>
</ul>
</li>
</ul>
</div></div></div></aside><div class="jsx-efcc50be384cabc7 docs-content-sidebar-toggle"><div style="position:relative" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="jsx-efcc50be384cabc7 docs-content-inner"><div class="jsx-efcc50be384cabc7 docs-content-metadata"><div class="jsx-efcc50be384cabc7 docs-content-metadata-left"><div class="jsx-efcc50be384cabc7 docs-content-metadata-repo"><div class="jsx-d38685edc31911e0 github-stars"><a href="https://github.com/vert-x3/vertx-service-discovery" class="jsx-d38685edc31911e0"><div class="jsx-d38685edc31911e0 icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div> <!-- -->null stars</a></div></div><div class="jsx-efcc50be384cabc7"><a href="https://vertx.io/docs/apidocs" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-service-discovery/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="jsx-efcc50be384cabc7 docs-content-metadata-version"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">v4.2.3<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu align-right"><a href="/docs/vertx-service-discovery/java/"><li class="jsx-400ec7965926e858 dropdown-item active has-active-siblings"><span class="jsx-400ec7965926e858 dropdown-check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></span>Latest (v<!-- -->4.2.3<!-- -->)</li></a><a href="/docs/4.1.8/vertx-service-discovery/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.1.8</li></a><a href="/docs/4.0.3/vertx-service-discovery/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a><a href="/docs/3.9.12/vertx-service-discovery/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->3.9.12</li></a></ul></div></span></div></div><div class="jsx-efcc50be384cabc7"><h1>Vert.x 服务发现</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x 服务发现组件提供了一套用于对各种资源服务的发布、发现的基础组件，例如 服务代理、HTTP服务节点（HTTP endpoint）、数据源（data source）&#8230;&#8203; 这些资源统称为 <code>服务</code> 。一个 <code>服务</code> 即是一个可被发现的功能性模块。它可以用类型、元数据、位置来区分，所以一个 <code>服务</code> 可以是一个数据库、服务代理、HTTP节点或者其他任何您能够描述、发现、交互的服务资源。它不一定是一个vert.x对象，它可以是任何组件。每个 <code>服务</code> 都被描述成一个 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> （即：下述 <code>服务记录</code> ）。</p>
</div>
<div class="paragraph">
<p><code>服务发现</code> 组件实现了面向服务计算中定义的服务交互。此外，在某种程度上，还提供了动态的面向服务计算交互，这样应用程序可以对各种服务的上线、下线作出处理。</p>
</div>
<div class="paragraph">
<p>一个服务提供者可以做如下事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>发布一个服务的 <code>服务记录</code></p>
</li>
<li>
<p>下线一个已发布的 <code>服务记录</code></p>
</li>
<li>
<p>更新线上服务的状态 (下线、暂停服务&#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个服务消费者可以做如下事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>寻找服务</p>
</li>
<li>
<p>选择绑定到某个服务（获取一个 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html">ServiceReference</a></code>) 并使用）</p>
</li>
<li>
<p>当服务消费者停止后立即释放服务提供者资源</p>
</li>
<li>
<p>监听服务的注册、注销、更新</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>服务消费者将：1)寻找符合自己需求的 <code>服务记录</code>； 2) 接收提供访问入口的 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html">ServiceReference</a></code> ；3) 获得一个提供访问入口的 <code>服务</code> 对象；4) 停止后立即释放服务对象</p>
</div>
<div class="paragraph">
<p>这个过程可以用 <em>服务类型</em> （service type） 来简化，如果你知道服务的类型(JDBC client, Http client&#8230;&#8203;)，那么你可以直接获取到这个服务对象。</p>
</div>
<div class="paragraph">
<p>综上所述，服务提供者和消费者之间共享的核心信息都存放在 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">records</a></code> 当中。</p>
</div>
<div class="paragraph">
<p>提供者和消费者必须创建自己的 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html">ServiceDiscovery</a></code> 实例。这些实例在后台（分布式架构）进行协作，以使服务之间信息保持同步。</p>
</div>
<div class="paragraph">
<p>vert.x的服务发现通过桥接方式 支持对其他服务发现技术的导入和导出。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_service_discovery"><a class="anchor" href="#_using_the_service_discovery"></a>使用服务发现</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要使用Vert.x 服务发现组件，需要将下列依赖加入到依赖配置中文件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (<code>pom.xml</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (<code>build.gradle</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-discovery:4.0.2&#x27;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_concepts"><a class="anchor" href="#_overall_concepts"></a>概念总览</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务发现机制基于以下章节的几个概念。</p>
</div>
<div class="sect2">
<h3 id="_service_records"><a class="anchor" href="#_service_records"></a>服务记录</h3>
<div class="paragraph">
<p>一个服务 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> 是服务提供者发布的一个服务描述对象。它包含了名称、元数据、位置对象（描述服务发布在哪里）。这个 <code>服务记录</code> 是提供者（发布 <code>服务记录</code> ）和消费者（寻找服务时获取 <code>服务记录</code> ）之间仅有的共享对象。</p>
</div>
<div class="paragraph">
<p>元数据和位置格式由 <code>服务类型（service type）</code> 决定（见下述）。</p>
</div>
<div class="paragraph">
<p>服务提供方准备好之后，一个 <code>服务记录</code> 就被发布了，服务停止时 <code>服务记录</code> 被回收</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_provider_and_publisher"><a class="anchor" href="#_service_provider_and_publisher"></a>提供者和发布者</h3>
<div class="paragraph">
<p>服务提供者是一个提供 <em>服务</em> 的对象。发布者负责发布描述提供者的 <code>服务记录</code> 。它可能是同一个对象（提供者仅仅发布自己）也可能是个不同的对象。</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_consumer"><a class="anchor" href="#_service_consumer"></a>服务消费者</h3>
<div class="paragraph">
<p>服务消费者在服务发现模块中检索服务。每次检索都会得到 <code>0..n</code> 个
<code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> ，从这些 <code>服务记录</code> 当中，服务消费者可以获取到 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html">ServiceReference</a></code> ，这个 <code>服务引用</code> 绑定了提供方和消费方，它允许消费方获取到 <em>服务对象（service object）</em> （用来使用服务）或释放服务。</p>
</div>
<div class="paragraph">
<p>释放 <code>服务引用</code> 是一件很重要的事情，这清除了 <code>服务引用</code> 对象并更新了服务的使用状态</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_object"><a class="anchor" href="#_service_object"></a>服务对象</h3>
<div class="paragraph">
<p><code>服务对象</code> 是一个提供了服务入口的对象。它可以是各种形式，例如 代理、客户端、甚至是一些不存在的服务类型。服务对象的性质取决于服务类型。</p>
</div>
<div class="paragraph">
<p>注意：因为Vert.x多语言的性质，所以如果你在java、groovy或其他语言获取的 <code>服务对象</code> 会不一样。</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_types"><a class="anchor" href="#_service_types"></a>服务类型</h3>
<div class="paragraph">
<p>服务仅仅是一些 <code>资源（resource）</code> 或不同类型的 <code>服务</code>。他们可以是功能服务组件、数据库、REST-Api等等。Vert.x服务发现模块定义 <code>服务类型</code> 来处理各类型的差异。每个类型定义了：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>服务是如何定位的（URI, event bus address, IP / DNS&#8230;&#8203;）- <em>location</em></p>
</li>
<li>
<p>服务对象的性质（service proxy, HTTP client, message consumer&#8230;&#8203;）<em>client</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>服务发现组件提供了一些现成的服务类型，但是你可以添加你自己的类型。</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_events"><a class="anchor" href="#_service_events"></a>服务事件</h3>
<div class="paragraph">
<p>每当发布或注销一个服务，event-bus上就会触发一个事件(event),这个事件包含了被更新的服务记录。</p>
</div>
<div class="paragraph">
<p>另外，为了追踪谁调用谁，每当调用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getReference-io.vertx.servicediscovery.Record-">getReference</a></code> 则获取reference或者 调用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html#release--">release</a></code> 释放reference的时候，事件都在event-bus上被发出 用以跟踪服务的使用情况。</p>
</div>
<div class="paragraph">
<p>关于事件的更多详细信息如下。</p>
</div>
</div>
<div class="sect2">
<h3 id="_backend"><a class="anchor" href="#_backend"></a>后台</h3>
<div class="paragraph">
<p>服务发现模块使用了Vert.x的分布式数据结构来存储 <code>服务记录</code> 。所以所有的集群成员都能获取到所有的 <code>服务记录</code> 。这是后台默认的实现。你可以实现 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceDiscoveryBackend.html">ServiceDiscoveryBackend</a></code> SPI 来实现自己的Backend。例如，Vert.x提供了一个基于Redis的基础实现。</p>
</div>
<div class="paragraph">
<p>注意：服务发现不要求必须是Vert.x集群。在单节点模式下，这个数据结构存储于本地。它可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html">ServiceImporter</a></code> 实现。从3.5.0版本开始，你可以在集群模式下用本地结构的event，这可以设置系统参数 <code>vertx-service-discovery-backend-local</code> 为 <code>true</code> (或者设置环境变量 <code>VERTX-SERVICE-DISCOVERY-BACKEND-LOCAL</code> 为 <code>true</code>) 来实现。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_service_discovery_instance"><a class="anchor" href="#_creating_a_service_discovery_instance"></a>创建服务发现实例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>提供者和消费者必须创建他们自己的 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html">ServiceDiscovery</a></code> 实例来使用服务发现组件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceDiscovery discovery = ServiceDiscovery.create(vertx);

<span class="hljs-comment">// 自定义配置</span>
discovery = ServiceDiscovery.create(vertx,
    <span class="hljs-keyword">new</span> ServiceDiscoveryOptions()
        .setAnnounceAddress(<span class="hljs-string">&quot;service-announce&quot;</span>)
        .setName(<span class="hljs-string">&quot;my-name&quot;</span>));

<span class="hljs-comment">// Do something...</span>

discovery.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，公告地址(发送事件的event-bus地址)是 <code>vertx.discovery.announce</code>。你也可以为service usage（见service usage章节）配置一个名称。</p>
</div>
<div class="paragraph">
<p>当你再也不需要服务发现对象时，不要忘记去关闭它。它关闭了您已配置的发现导入器和导出器，并释放服务引用。</p>
</div>
<div class="paragraph">
<p>您应该避免共享服务发现实例，因此service usage 将代表正确的“usage”</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_services"><a class="anchor" href="#_publishing_services"></a>发布服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一旦你拥有了服务发现实例，你可以发布服务。步骤如下：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>为这个服务提供者创建一个服务记录</p>
</li>
<li>
<p>发布这个服务记录</p>
</li>
<li>
<p>持有这个服务记录，以便于后续的注销和更改操作</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>为了创建服务记录，你可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> 类，或者用不同服务类型提供的便捷方式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = <span class="hljs-keyword">new</span> Record()
    .setType(<span class="hljs-string">&quot;eventbus-service-proxy&quot;</span>)
    .setLocation(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;endpoint&quot;</span>, <span class="hljs-string">&quot;the-service-address&quot;</span>))
    .setName(<span class="hljs-string">&quot;my-service&quot;</span>)
    .setMetadata(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-label&quot;</span>, <span class="hljs-string">&quot;some-value&quot;</span>));

discovery.publish(record, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-comment">// 发布成功</span>
    Record publishedRecord = ar.result();
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 发布失败</span>
  }
});

<span class="hljs-comment">// 由一个类型创建的record</span>
record = HttpEndpoint.createRecord(<span class="hljs-string">&quot;some-rest-api&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>, <span class="hljs-string">&quot;/api&quot;</span>);
discovery.publish(record, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-comment">// 发布成功</span>
    Record publishedRecord = ar.result();
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 发布失败</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>持有服务记录的引用是很重要的事情，因为服务记录中拥有一个 <code>注册 id</code>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_withdrawing_services"><a class="anchor" href="#_withdrawing_services"></a>回收服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要回收(下线)一个record，使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.unpublish(record.getRegistration(), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-comment">// Ok</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 无法下线服务，可能是因为已经被移除或者 record根本没有被发布</span>
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_looking_for_services"><a class="anchor" href="#_looking_for_services"></a>寻找服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>本章解释了获取服务的底层原理，每个服务类型都提供了便捷的方式来整合各个的步骤</em></p>
</div>
<div class="paragraph">
<p>在消费方，第一件事就是要寻找服务记录。您可以检索单个服务记录或者所有符合条件的服务记录。第一种情况，第一个符合条件的服务记录被返回。</p>
</div>
<div class="paragraph">
<p>消费方可以提供一个过滤器(filter)来选择服务。有两种方式来描述过滤器：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>一个以 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> 为参数并以布尔类型（这是一个断言）作为返回值的函数</p>
</li>
<li>
<p>这个过滤器是一个JSON-obejct。每一个给出的filter过滤条件都会检查record，所有的过滤条件都必须满足record。过滤条件可以用 <code>*</code> 通配符来表示对key的要求，而不是精准匹配。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>我们来看看JSON过滤器的一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{ "name" = "a" } =&gt; 筛选出名称是"a"的record
{ "color" = "*" } =&gt; 筛选出存在"color"字段的record
{ "color" = "red" } =&gt; 筛选出"color"字段是"red"的record
{ "color" = "red", "name" = "a"} =&gt; 筛选出"color"字段是"red" 且 "name"字段是"a"的record</pre>
</div>
</div>
<div class="paragraph">
<p>如果没有设置JSON过滤器(<code>null</code> 或 empty) ，则筛选出所有的服务记录。当用函数来过滤时，如果你想获取到所有的服务记录，那无论是什么样的服务记录，你必须要返回 <em>true</em></p>
</div>
<div class="paragraph">
<p>示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(r -&gt; <span class="hljs-keyword">true</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-keyword">if</span> (ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取到一个record</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 寻找成功但是没有符合条件的服务</span>
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});

discovery.getRecord((JsonObject) <span class="hljs-keyword">null</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-keyword">if</span> (ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取到一个record</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 寻找成功但是没有符合条件的服务</span>
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});


<span class="hljs-comment">// 通过名称获取record</span>
discovery.getRecord(r -&gt; r.getName().equals(<span class="hljs-string">&quot;some-name&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-keyword">if</span> (ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取到一个record</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 寻找成功但是没有符合条件的服务</span>
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});

discovery.getRecord(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-keyword">if</span> (ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取到一个record</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 寻找成功但是没有符合条件的服务</span>
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});

<span class="hljs-comment">// 获取所有符合过滤器条件的record</span>
discovery.getRecords(r -&gt; <span class="hljs-string">&quot;some-value&quot;</span>.equals(r.getMetadata().getString(<span class="hljs-string">&quot;some-label&quot;</span>)), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    List&lt;Record&gt; results = ar.result();
    <span class="hljs-comment">// 如果获取到非空list，那么我们获取到了record</span>
    <span class="hljs-comment">// 否则说明寻找成功但是没有符合条件的服务</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});


discovery.getRecords(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-label&quot;</span>, <span class="hljs-string">&quot;some-value&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    List&lt;Record&gt; results = ar.result();
    <span class="hljs-comment">// 如果获取到非空list，那么我们获取到了record</span>
    <span class="hljs-comment">// 否则说明寻找成功但是没有符合条件的服务</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 查找失败</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getRecords-io.vertx.core.json.JsonObject-io.vertx.core.Handler-">getRecords</a></code> 来获取单条服务记录或者所有符合条件的服务记录。默认情况下，对于服务记录的查找仅仅包含 <code>status</code> 是 <code>UP</code> 的情况。这可以被重写：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当使用JSON过滤器时，设置 <code>status</code> 为你的期望值（或者 <code>*</code> 来接收所有的状态）</p>
</li>
<li>
<p>当使用函数时，在 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getRecords-java.util.function.Function-boolean-io.vertx.core.Handler-">getRecords</a></code> 函数 设置 <code>includeOutOfService</code> 参数为 <code>true</code>。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrieving_a_service_reference"><a class="anchor" href="#_retrieving_a_service_reference"></a>获取服务引用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一旦你选择了 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> ，你可以获取一个 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html">ServiceReference</a></code> 和 <code>服务对象</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceReference reference1 = discovery.getReference(record1);
ServiceReference reference2 = discovery.getReference(record2);

<span class="hljs-comment">// 获取到service object，返回服务引用的类型取决于 service type</span>
<span class="hljs-comment">// Http 节点</span>
HttpClient client = reference1.getAs(HttpClient.class);
<span class="hljs-comment">// 消息源</span>
MessageConsumer consumer = reference2.getAs(MessageConsumer.class);

<span class="hljs-comment">// 当服务使用完毕</span>
reference1.release();
reference2.release();</code></pre>
</div>
</div>
<div class="paragraph">
<p>切记处理完毕之后释放服务引用资源</p>
</div>
<div class="paragraph">
<p>一个服务引用代表了一个对服务提供者的绑定关系。</p>
</div>
<div class="paragraph">
<p>获取服务引用时，你可以传一个包含了各种数据的 <code><a href="../../apidocs/io/vertx/core/json/JsonObject.html">JsonObject</a></code> 用来配置 <code>服务对象</code> 。某些服务类型不需要额外的配置，如下是一些必要的配置（数据源为例）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceReference reference = discovery.getReferenceWithConfiguration(record, conf);

<span class="hljs-comment">// 获取到service object，返回服务引用的类型取决于 service type</span>
<span class="hljs-comment">// JDBC 节点</span>
JDBCClient client = reference.getAs(JDBCClient.class);

<span class="hljs-comment">// Do something with the client...</span>

<span class="hljs-comment">// 当服务使用完毕</span>
reference.release();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在前述例子当中，代码用了 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html#getAs-java.lang.Class-">getAs</a></code> 函数，其参数是你期望得到的服务类型。如果你用java语言，你可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html#get--">get</a></code> 函数。然而其他语言 你必须传一个你期望的类型值。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types_of_services"><a class="anchor" href="#_types_of_services"></a>服务类型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如上所述，服务发现有 <code>服务类型</code> 的概念来管理不同类型的服务。</p>
</div>
<div class="paragraph">
<p>这些类型默认通过如下方式提供：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html">HttpEndpoint</a></code> - 对于 REST API&#8217;来讲, 服务对象是一个由 <code>host</code>、<code>port</code>（位置是 <code>url</code> 参数）配置的
<code><a href="../../apidocs/io/vertx/core/http/HttpClient.html">HttpClient</a></code> .</p>
</li>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/EventBusService.html">EventBusService</a></code> - 对于服务代理，服务对象是一个proxy。它的类型是`proxies interface`（服务所在位置是地址）</p>
</li>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/MessageSource.html">MessageSource</a></code> - 对于消息源（发送者），服务对象是一个 <code><a href="../../apidocs/io/vertx/core/eventbus/MessageConsumer.html">MessageConsumer</a></code> （服务所在位置是地址）。</p>
</li>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/JDBCDataSource.html">JDBCDataSource</a></code> - 对于 JDBC 数据源, 服务对象是一个 <code><a href="../../apidocs/io/vertx/ext/jdbc/JDBCClient.html">JDBCClient</a></code> （客户端配置从 location，metadata和消费方配置来解析）。</p>
</li>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html">RedisDataSource</a></code> - 对于 Redis 数据源, 服务对象是一个 <code><a href="../../apidocs/io/vertx/redis/client/Redis.html">Redis</a></code> (客户端配置从 location，metadata和消费方配置来解析).</p>
</li>
<li>
<p><code><a href="../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html">MongoDataSource</a></code> - 对于 Mongo 数据源, 服务对象是一个 <code><a href="../../apidocs/io/vertx/ext/mongo/MongoClient.html">MongoClient</a></code> (客户端配置从 location，metadata和消费方配置来解析).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本节总体上给出有关服务类型的详细信息，并介绍如何使用默认服务类型。</p>
</div>
<div class="sect2">
<h3 id="_services_with_no_type"><a class="anchor" href="#_services_with_no_type"></a>无类型的服务</h3>
<div class="paragraph">
<p>一些record也许没有类型(<code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html#UNKNOWN">ServiceType.UNKNOWN</a></code>)。所以不可能从这些record里面获取到服务对象，但是你可以通过 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> 对象的 <code>location</code> 和 <code>metadata</code> 来构建连接的具体信息。</p>
</div>
<div class="paragraph">
<p>使用这些服务不会触发 <code>service usage</code> 事件</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_your_own_service_type"><a class="anchor" href="#_implementing_your_own_service_type"></a>实现您自己的服务类型</h3>
<div class="paragraph">
<p>你可以通过实现 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html">ServiceType</a></code> SPI 的方式来创建你自己的服务类型:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(可选) 创建一个public interface 继承 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html">ServiceType</a></code> 。这个interface仅仅用来提供辅助函数来简化你自定义类型的用法，例如 <code>createRecord</code> 函数, <code>getX</code> ， <code>X</code> 是你获取到的服务对象的类型。可以查看 <code><a href="../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html">HttpEndpoint</a></code> 或者 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MessageSource.html">MessageSource</a></code> 等接口例子来了解这种设计</p>
</li>
<li>
<p>创建一个类来实现 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html">ServiceType</a></code> ，或者实现你在第一步创建的类型。 这个类型有 <code>name</code> 和一个为这个类型创建 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceReference.html">ServiceReference</a></code> 的函数。这个name必须匹配 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> 类的 <code>type</code> 字段，这个record的type就是您自己定义的服务类型。</p>
</li>
<li>
<p>创建一个类继承 <code>io.vertx.ext.discovery.types.AbstractServiceReference</code> ，您可以参数化您将要返回的带有服务对象类型的类，你必须实现 <code>AbstractServiceReference#retrieve()</code> 函数来创建服务对象。这个函数只能被调用一次。如果需要清除服务对象，也要重写 <code>AbstractServiceReference#onClose()</code> 函数</p>
</li>
<li>
<p>在打包jar时在jar内创建一个 <code>META-INF/services/io.vertx.servicediscovery.spi.ServiceType</code> 文件。这个文件仅仅包含您在第二步创建的类的全名。</p>
</li>
<li>
<p>创建一个包含service type interface（步骤1）的jar，实现类（步骤2，步骤3）和服务描述文件（步骤4）。把这个jar放在你应用的classpath下，然后您的服务类型现在就已经可用了。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_http_endpoints"><a class="anchor" href="#_http_endpoints"></a>HTTP 节点</h3>
<div class="paragraph">
<p>一个HTTP节点代表一个REST API或者可用HTTP请求访问的服务。HTTP节点服务对象是一个由host、port、ssl所配置的 <code><a href="../../apidocs/io/vertx/core/http/HttpClient.html">HttpClient</a></code> 对象</p>
</div>
<div class="sect3">
<h4 id="_publishing_a_http_endpoint"><a class="anchor" href="#_publishing_a_http_endpoint"></a>发布一个HTTP节点</h4>
<div class="paragraph">
<p>要发布一个HTTP节点，你需要一个 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> ，你可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html#createRecord-java.lang.String-java.lang.String-int-java.lang.String-io.vertx.core.json.JsonObject-">HttpEndpoint.createRecord</a></code> 来创建服务记录。</p>
</div>
<div class="paragraph">
<p>下面一段阐述如何用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html">HttpEndpoint</a></code> 创建 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record1 = HttpEndpoint.createRecord(
  <span class="hljs-string">&quot;some-http-service&quot;</span>, <span class="hljs-comment">// 服务名称</span>
  <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-comment">//  host</span>
  <span class="hljs-number">8433</span>, <span class="hljs-comment">// port</span>
  <span class="hljs-string">&quot;/api&quot;</span> <span class="hljs-comment">// 服务的根路由</span>
);

discovery.publish(record1, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});

Record record2 = HttpEndpoint.createRecord(
  <span class="hljs-string">&quot;some-other-name&quot;</span>, <span class="hljs-comment">// 服务名称</span>
  <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 是否要求 HTTPs</span>
  <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-comment">// host</span>
  <span class="hljs-number">8433</span>, <span class="hljs-comment">// port</span>
  <span class="hljs-string">&quot;/api&quot;</span>, <span class="hljs-comment">// 服务的根路由</span>
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some value&quot;</span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>当你在容器或者云启动你的服务时，也许并不知道服务的公网IP和端口，所以发布操作必须要通过另一个对象来获取这个信息，通常它是一个 <em>桥接对象</em> （ <code>bridge</code> ）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_a_http_endpoint"><a class="anchor" href="#_consuming_a_http_endpoint"></a>消费一个HTTP服务节点</h4>
<div class="paragraph">
<p>一旦HTTP节点发布，一个消费者可以获取到它。这个服务对象是一个配置了host和port的 <code><a href="../../apidocs/io/vertx/core/http/HttpClient.html">HttpClient</a></code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-http-service&quot;</span>), ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded() &amp;&amp; ar1.result() != <span class="hljs-keyword">null</span>) {
    <span class="hljs-comment">// 获取服务引用</span>
    ServiceReference reference = discovery.getReference(ar1.result());
    <span class="hljs-comment">// 获取服务对象</span>
    HttpClient client = reference.getAs(HttpClient.class);

    <span class="hljs-comment">// 定义完整的path</span>
    client.request(HttpMethod.GET, <span class="hljs-string">&quot;/api/persons&quot;</span>).compose(request -&gt;
      request
        .send()
        .compose(HttpClientResponse::body))
      .onComplete(ar2 -&gt; {
      <span class="hljs-comment">// 不要忘记释放服务资源</span>
      reference.release();
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html#getClient-io.vertx.servicediscovery.ServiceDiscovery-io.vertx.core.json.JsonObject-io.vertx.core.Handler-">HttpEndpoint.getClient</a></code> 函数，通过一次函数调用来同时完成服务查找和服务对象获取的操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HttpEndpoint.getClient(discovery, <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-http-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    HttpClient client = ar.result();

    <span class="hljs-comment">// 你需要提供完整的path</span>
    client.request(HttpMethod.GET, <span class="hljs-string">&quot;/api/persons&quot;</span>).compose(request -&gt;
      request
        .send()
        .compose(HttpClientResponse::body))
      .onComplete(ar2 -&gt; {
        <span class="hljs-comment">// 不要忘记释放服务资源</span>
        ServiceDiscovery.releaseServiceObject(discovery, client);
      });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这第二个写法里，用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#releaseServiceObject-io.vertx.servicediscovery.ServiceDiscovery-java.lang.Object-">ServiceDiscovery.releaseServiceObject</a></code> 来释放服务对象，所以你不需要持有服务引用。</p>
</div>
<div class="paragraph">
<p>从Vert.x 3.4.0开始，提供了另一个客户端。这个更高层次封装的客户端名字叫 <code><a href="../../apidocs/io/vertx/ext/web/client/WebClient.html">WebClient</a></code>，这个客户端用起来更容易。你可以通过如下方式获取 <code><a href="../../apidocs/io/vertx/ext/web/client/WebClient.html">WebClient</a></code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-http-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
    <span class="hljs-comment">// 获取服务引用</span>
    ServiceReference reference = discovery.getReference(ar.result());
    <span class="hljs-comment">// 获取服务对象</span>
    WebClient client = reference.getAs(WebClient.class);

    <span class="hljs-comment">// 你需要提供完整的path</span>
    client.get(<span class="hljs-string">&quot;/api/persons&quot;</span>).send(
      response -&gt; {

        <span class="hljs-comment">// ...</span>

        <span class="hljs-comment">// 不要忘记释放服务资源</span>
        reference.release();

      });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，如果你更倾向于用服务类型的方式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HttpEndpoint.getWebClient(discovery, <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-http-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    WebClient client = ar.result();

    <span class="hljs-comment">// 你需要提供完整的path</span>
    client.get(<span class="hljs-string">&quot;/api/persons&quot;</span>)
      .send(response -&gt; {

        <span class="hljs-comment">// ...</span>

        <span class="hljs-comment">// 不要忘记释放服务资源</span>
        ServiceDiscovery.releaseServiceObject(discovery, client);

      });
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_bus_services"><a class="anchor" href="#_event_bus_services"></a>Event bus 服务</h3>
<div class="paragraph">
<p>Event bus服务是服务代理，它基于event bus实现了异步RPC服务。当从event bus服务获取一个服务对象，你获取到对应类型的服务代理。你可以从 <code><a href="../../apidocs/io/vertx/servicediscovery/types/EventBusService.html">EventBusService</a></code> 获取辅助函数。</p>
</div>
<div class="paragraph">
<p>注意：服务代理（服务的实现和服务接口）是由java实现的</p>
</div>
<div class="sect3">
<h4 id="_publishing_an_event_bus_service"><a class="anchor" href="#_publishing_an_event_bus_service"></a>发布一个event bus服务</h4>
<div class="paragraph">
<p>发布event bus服务，你需要创建一个 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = EventBusService.createRecord(
    <span class="hljs-string">&quot;some-eventbus-service&quot;</span>, <span class="hljs-comment">// 服务名称</span>
    <span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-comment">// 服务地址,</span>
    <span class="hljs-string">&quot;examples.MyService&quot;</span>, <span class="hljs-comment">// 字符串格式的服务接口类名</span>
    <span class="hljs-keyword">new</span> JsonObject()
        .put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some value&quot;</span>)
);

discovery.publish(record, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以传服务接口类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = EventBusService.createRecord(
<span class="hljs-string">&quot;some-eventbus-service&quot;</span>, <span class="hljs-comment">// 服务名称</span>
<span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-comment">// 服务地址,</span>
MyService.class <span class="hljs-comment">// 接口类</span>
);

discovery.publish(record, ar -&gt; {
<span class="hljs-comment">// ...</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_an_event_bus_service"><a class="anchor" href="#_consuming_an_event_bus_service"></a>消费event bus服务</h4>
<div class="paragraph">
<p>要消费一个event bus服务，你可以先获取服务记录，再通过服务记录获取服务引用；或者用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/EventBusService.html">EventBusService</a></code> 接口通过一次调用来完成这两个操作。</p>
</div>
<div class="paragraph">
<p>当使用服务引用是，你应该这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-eventbus-service&quot;</span>), ar -&gt; {
<span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
<span class="hljs-comment">// 获取服务引用</span>
ServiceReference reference = discovery.getReference(ar.result());
<span class="hljs-comment">// 获取服务对象</span>
MyService service = reference.getAs(MyService.class);

<span class="hljs-comment">// 不要忘记释放服务资源</span>
reference.release();
}
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/EventBusService.html">EventBusService</a></code> 类，你可以像下述获取代理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">EventBusService.getProxy(discovery, MyService.class, ar -&gt; {
<span class="hljs-keyword">if</span> (ar.succeeded()) {
MyService service = ar.result();

<span class="hljs-comment">// 不要忘记释放服务资源</span>
ServiceDiscovery.releaseServiceObject(discovery, service);
}
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_message_source"><a class="anchor" href="#_message_source"></a>消息源服务</h3>
<div class="paragraph">
<p>消息源是一个往event bus地址发送消息的组件，消息源客户端是 `<a href="../../apidocs/io/vertx/core/eventbus/MessageConsumer.html">MessageConsumer</a>`类。</p>
</div>
<div class="paragraph">
<p>消息被发送给到eventBus的 <em>location</em> 或 消息源服务上。</p>
</div>
<div class="sect3">
<h4 id="_publishing_a_message_source"><a class="anchor" href="#_publishing_a_message_source"></a>推送消息</h4>
<div class="paragraph">
<p>就像其他类型的服务，推送一个消息分2步走：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MessageSource.html">MessageSource</a></code> 创建一个服务对象。</p>
</li>
<li>
<p>推送消息</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = MessageSource.createRecord(
    <span class="hljs-string">&quot;some-message-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
    <span class="hljs-string">&quot;some-address&quot;</span> <span class="hljs-comment">// event bus 地址</span>
);

discovery.publish(record, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});

record = MessageSource.createRecord(
    <span class="hljs-string">&quot;some-other-message-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
    <span class="hljs-string">&quot;some-address&quot;</span>, <span class="hljs-comment">// event bus 地址</span>
    <span class="hljs-string">&quot;examples.MyData&quot;</span> <span class="hljs-comment">// 消息体类型</span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上述第二个record当中，我们同时指明了消息体（payload）的类型，这个参数是可选的。</p>
</div>
<div class="paragraph">
<p>在Java当中，你可以用 <code><a href="../../apidocs/java/lang/Class.html">Class</a></code> 参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record1 = MessageSource.createRecord(
<span class="hljs-string">&quot;some-message-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
<span class="hljs-string">&quot;some-address&quot;</span>, <span class="hljs-comment">// 服务地址</span>
JsonObject.class <span class="hljs-comment">// 消息体类型</span>
);

Record record2 = MessageSource.createRecord(
<span class="hljs-string">&quot;some-other-message-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
<span class="hljs-string">&quot;some-address&quot;</span>, <span class="hljs-comment">// 服务地址</span>
JsonObject.class, <span class="hljs-comment">// 消息体类型</span>
<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some value&quot;</span>)
);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_a_message_source"><a class="anchor" href="#_consuming_a_message_source"></a>消费消息服务</h4>
<div class="paragraph">
<p>在消费者端，你可以获取服务记录从而获取服务引用，或者用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MessageSource.html">MessageSource</a></code> 通过一次调用合两步为一。</p>
</div>
<div class="paragraph">
<p>通过第一种方式，代码如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-message-source-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
    <span class="hljs-comment">// 获取服务引用</span>
    ServiceReference reference = discovery.getReference(ar.result());
    <span class="hljs-comment">// 获取服务对象</span>
    MessageConsumer&lt;JsonObject&gt; consumer = reference.getAs(MessageConsumer.class);

    <span class="hljs-comment">// 指定消息处理器</span>
    consumer.handler(message -&gt; {
      <span class="hljs-comment">// 消息处理器逻辑</span>
      JsonObject payload = message.body();
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MessageSource.html">MessageSource</a></code> 时，代码就变成了如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">MessageSource.&lt;JsonObject&gt;getConsumer(discovery, <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-message-source-service&quot;</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    MessageConsumer&lt;JsonObject&gt; consumer = ar.result();

    <span class="hljs-comment">// 指定消息处理器</span>
    consumer.handler(message -&gt; {
      <span class="hljs-comment">// 消息处理器逻辑</span>
      JsonObject payload = message.body();
    });
    <span class="hljs-comment">// ...</span>
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc_data_source"><a class="anchor" href="#_jdbc_data_source"></a>JDBC数据源</h3>
<div class="paragraph">
<p>数据源代表数据库或数据仓储。而JDBC数据源特指用JDBC驱动访问数据库。JDBC数据源客户端是 <code><a href="../../apidocs/io/vertx/ext/jdbc/JDBCClient.html">JDBCClient</a></code> 类。</p>
</div>
<div class="sect3">
<h4 id="_publishing_a_jdbc_service"><a class="anchor" href="#_publishing_a_jdbc_service"></a>发布JDBC服务</h4>
<div class="paragraph">
<p>类似其他类型的服务，发布JDBC服务需要2步：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/JDBCDataSource.html">JDBCDataSource</a></code> 创建record</p>
</li>
<li>
<p>推送record</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = JDBCDataSource.createRecord(
    <span class="hljs-string">&quot;some-data-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;url&quot;</span>, <span class="hljs-string">&quot;some jdbc url&quot;</span>), <span class="hljs-comment">// 服务地址</span>
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some-value&quot;</span>) <span class="hljs-comment">// 元数据</span>
);

discovery.publish(record, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为JDBC数据源可以使用很多数据库，并且访问方式经常不一样，所以服务记录是没有标准结构定义的，<code>location</code> 是访问数据库配置而提供的一个通用JSONObject属性，用于访问数据源(JDBC url，username&#8230;&#8203;)。其他字段的定义依赖于数据库以及所用连接池决定。</p>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_a_jdbc_service"><a class="anchor" href="#_consuming_a_jdbc_service"></a>消费一个JDBC服务</h4>
<div class="paragraph">
<p>由前所述，如何获取数据源取决于数据源本身。要创建 <code><a href="../../apidocs/io/vertx/ext/jdbc/JDBCClient.html">JDBCClient</a></code> ，你可以同时提供：<code>record location</code>，元数据和一个有消费方提供的一个Json object：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-data-source-service&quot;</span>),
    ar -&gt; {
      <span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
        <span class="hljs-comment">// 获取服务引用</span>
        ServiceReference reference = discovery.getReferenceWithConfiguration(
            ar.result(), <span class="hljs-comment">// record</span>
            <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;clement&quot;</span>).put(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;*****&quot;</span>)); <span class="hljs-comment">// 一些额外的元数据</span>

        <span class="hljs-comment">// 获取service object</span>
        JDBCClient client = reference.getAs(JDBCClient.class);

        <span class="hljs-comment">// ...</span>

        <span class="hljs-comment">// 完毕</span>
        reference.release();
      }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以用 <code><a href="../../apidocs/io/vertx/ext/jdbc/JDBCClient.html">JDBCClient</a></code> 通过一次调用来发现和获取服务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">JDBCDataSource.&lt;JsonObject&gt;getJDBCClient(discovery,
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-data-source-service&quot;</span>),
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;clement&quot;</span>).put(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;*****&quot;</span>), <span class="hljs-comment">// 一些额外的元数据</span>
    ar -&gt; {
      <span class="hljs-keyword">if</span> (ar.succeeded()) {
        JDBCClient client = ar.result();

        <span class="hljs-comment">// ...</span>

        <span class="hljs-comment">// 不要忘记释放服务资源</span>
        ServiceDiscovery.releaseServiceObject(discovery, client);

      }
    });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redis_data_source"><a class="anchor" href="#_redis_data_source"></a>Redis 数据源</h3>
<div class="paragraph">
<p>Redis数据源是Redis持久性数据库的一种特殊实现。</p>
</div>
<div class="paragraph">
<p>Redis数据源客户端是 <code><a href="../../apidocs/io/vertx/redis/client/Redis.html">Redis</a></code> 类</p>
</div>
<div class="sect3">
<h4 id="_publishing_a_redis_service"><a class="anchor" href="#_publishing_a_redis_service"></a>发布Redis服务</h4>
<div class="paragraph">
<p>发布Redis服务需要2步：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html">RedisDataSource</a></code> 创建服务记录</p>
</li>
<li>
<p>推送record</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = RedisDataSource.createRecord(
  <span class="hljs-string">&quot;some-redis-data-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;url&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>), <span class="hljs-comment">// 服务地址</span>
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some-value&quot;</span>) <span class="hljs-comment">// 一些元数据</span>
);

discovery.publish(record, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>location</code> 是一个简单的JSON对象，应提供用于访问Redis数据源的字段(url,port&#8230;&#8203;.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_a_redis_service"><a class="anchor" href="#_consuming_a_redis_service"></a>消费Redis服务</h4>
<div class="paragraph">
<p>由前所述，如何访问数据源决定于数据源本身。创建一个 <code><a href="../../apidocs/io/vertx/redis/client/Redis.html">Redis</a></code> 对象，你可以同时提供：record地址，元数据和由消费方提供的Json object。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-redis-data-source-service&quot;</span>), ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取服务引用</span>
      ServiceReference reference = discovery.getReference(ar.result());

      <span class="hljs-comment">// 获取服务实例</span>
      Redis client = reference.getAs(Redis.class);

      <span class="hljs-comment">// ...</span>

      <span class="hljs-comment">// 完毕 释放资源</span>
      reference.release();
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html">RedisDataSource</a></code> 通过一次调用完成服务发现和获取。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RedisDataSource.getRedisClient(discovery,
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-redis-data-source-service&quot;</span>),
  ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      Redis client = ar.result();

      <span class="hljs-comment">// ...</span>

      <span class="hljs-comment">// 不要忘记释放服务资源</span>
      ServiceDiscovery.releaseServiceObject(discovery, client);

    }
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mongo_data_source"><a class="anchor" href="#_mongo_data_source"></a>Mongo数据源</h3>
<div class="paragraph">
<p>Mongo数据源是MongoDB数据库的专用化实现。
Mongo数据源服务的客户端是 <code><a href="../../apidocs/io/vertx/ext/mongo/MongoClient.html">MongoClient</a></code> 类</p>
</div>
<div class="sect3">
<h4 id="_publishing_a_mongo_service"><a class="anchor" href="#_publishing_a_mongo_service"></a>发布Mongo服务</h4>
<div class="paragraph">
<p>发布Mongo服务需要2步：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html">MongoDataSource</a></code> 创建服务记录</p>
</li>
<li>
<p>推送record</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Record record = MongoDataSource.createRecord(
  <span class="hljs-string">&quot;some-data-source-service&quot;</span>, <span class="hljs-comment">// 服务名</span>
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;connection_string&quot;</span>, <span class="hljs-string">&quot;some mongo connection&quot;</span>), <span class="hljs-comment">// 服务地址</span>
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;some-metadata&quot;</span>, <span class="hljs-string">&quot;some-value&quot;</span>) <span class="hljs-comment">// 元数据</span>
);

discovery.publish(record, ar -&gt; {
  <span class="hljs-comment">// ...</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>location</code> 是一个简单的JSON对象，应提供用于访问Mongo数据源的字段(url, port&#8230;&#8203;)</p>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_a_mongo_service"><a class="anchor" href="#_consuming_a_mongo_service"></a>消费Mongo服务</h4>
<div class="paragraph">
<p>由前所述，如何访问数据源取决于数据源本身。创建 <code><a href="../../apidocs/io/vertx/ext/mongo/MongoClient.html">MongoClient</a></code> ，你可以同时提供：<code>record location</code> ,元数据和consumer提供的json object：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">discovery.getRecord(
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-data-source-service&quot;</span>),
  ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded() &amp;&amp; ar.result() != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// 获取服务引用</span>
      ServiceReference reference = discovery.getReferenceWithConfiguration(
        ar.result(), <span class="hljs-comment">// record</span>
        <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;clement&quot;</span>).put(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;*****&quot;</span>)); <span class="hljs-comment">// 额外的元数据</span>

      <span class="hljs-comment">// 获取服务对象</span>
      MongoClient client = reference.get();

      <span class="hljs-comment">// ...</span>

      <span class="hljs-comment">// 完毕 释放资源</span>
      reference.release();
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以用 <code><a href="../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html">MongoDataSource</a></code> 类通过一次调用来完成服务查找和获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">MongoDataSource.&lt;JsonObject&gt;getMongoClient(discovery,
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;some-data-source-service&quot;</span>),
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;clement&quot;</span>).put(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;*****&quot;</span>), <span class="hljs-comment">// 一些额外的元数据</span>
  ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      MongoClient client = ar.result();

      <span class="hljs-comment">// ...</span>

      <span class="hljs-comment">// 不要忘记释放服务资源</span>
      ServiceDiscovery.releaseServiceObject(discovery, client);

    }
  });</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_listening_for_service_arrivals_and_departures"><a class="anchor" href="#_listening_for_service_arrivals_and_departures"></a>监听服务的注册和注销</h2>
<div class="sectionbody">
<div class="paragraph">
<p>每当服务提供方被发布或移除， <em>vertx.discovery.announce</em> 地址上会推送一个事件。
这个地址可以在 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html">ServiceDiscoveryOptions</a></code> 配置</p>
</div>
<div class="paragraph">
<p>收到的record会有一个 <code>status</code> 字段，它描述了record的新状态：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UP</code> : 服务可获取，您可以开启并使用它</p>
</li>
<li>
<p><code>DOWN</code> : 服务不可获取，你不应该再使用它</p>
</li>
<li>
<p><code>OUT_OF_SERVICE</code> : 服务不在运行状态，你不该再用它，但是可能过一会可能会恢复</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_listening_for_service_usage"><a class="anchor" href="#_listening_for_service_usage"></a>监听服务使用状况</h2>
<div class="sectionbody">
<div class="paragraph">
<p>每当获取或释放服务引用时 <em>vertx.discovery.usage</em> 地址上会推送一个event。这个地址可以由 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html">ServiceDiscoveryOptions</a></code> 配置。</p>
</div>
<div class="paragraph">
<p>这会让您监听服务的使用情况并映射服务的绑定情况。</p>
</div>
<div class="paragraph">
<p>收到的消息是一个包含如下信息的 <code><a href="../../apidocs/io/vertx/core/json/JsonObject.html">JsonObject</a></code> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>record</code> 属性指服务记录对象</p>
</li>
<li>
<p><code>type</code> 属性是事件的类型，它有两个值：<code>bind</code> ，<code>release</code></p>
</li>
<li>
<p><code>id</code> 属性是服务发现的id（名称或者node id）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这个 <code>id</code> 可以通过 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html">ServiceDiscoveryOptions</a></code> 配置。默认情况下 单节点是"localhost"，集群模式下是node id。</p>
</div>
<div class="paragraph">
<p>你可以禁用服务使用情况的功能，这可以通过 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html#setUsageAddress-java.lang.String-">setUsageAddress</a></code> 设置 <code>usage address</code> 为 <code>null</code> 来实现。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_discovery_bridges"><a class="anchor" href="#_service_discovery_bridges"></a>服务发现桥接器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>桥接器 可以让你从其他服务发现机制(Docker，Kubernetes，Consul&#8230;&#8203;)里导入导出服务
每个桥接器决定了服务如何导入导出。这不一定是双向操作。</p>
</div>
<div class="paragraph">
<p>您可以实现 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html">ServiceImporter</a></code> 接口，并用 <code><a href="../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#registerServiceImporter-io.vertx.servicediscovery.spi.ServiceImporter-io.vertx.core.json.JsonObject-">registerServiceImporter</a></code> 来注册的方式，为自己提供桥接器。</p>
</div>
<div class="paragraph">
<p>第二个参数是可选的，它可以配置桥接器。</p>
</div>
<div class="paragraph">
<p>当桥接器被注册时，<code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html#start-io.vertx.core.Vertx-io.vertx.servicediscovery.spi.ServicePublisher-io.vertx.core.json.JsonObject-io.vertx.core.Promise-">start</a></code> 函数被调用。
它让您可以配置桥接器。当桥接器被配置时，准备就绪并导入/导出初始服务后，它让给定的 <code><a href="../../apidocs/io/vertx/core/Future.html">Future</a></code> 处于 <code>completed</code> 状态；如果bridge starts函数正在阻塞，则它必须使用 <code><a href="../../apidocs/io/vertx/core/Vertx.html#executeBlocking-io.vertx.core.Handler-boolean-io.vertx.core.Handler-">executeBlocking</a></code> 构造，并设置给定的future对象为 <code>completed</code> 状态。</p>
</div>
<div class="paragraph">
<p>当服务发现组件停止，桥接器也随即停止。</p>
</div>
<div class="paragraph">
<p>调用 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html#close-io.vertx.core.Handler-">close</a></code> 函数会清除资源，移除已经导入/导出的服务。这个函数必须设置返回的 <code><a href="../../apidocs/io/vertx/core/Future.html">Future</a></code> 对象为 <code>completed</code> 状态,目的在于提醒调用者处理完成事件。</p>
</div>
<div class="paragraph">
<p>注意：在集群当中，只需要注册服务记录当中一个成员的桥接器即可，因为所有的服务记录都是互通的。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_bridges"><a class="anchor" href="#_additional_bridges"></a>其他的桥接器支持</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x 服务发现组件除了支持桥接器机制以外，还提供了一些现成的桥接器。</p>
</div>
<div class="sect2">
<h3 id="_consul_bridge"><a class="anchor" href="#_consul_bridge"></a>Consul 网桥</h3>
<div class="paragraph">
<p>Consul服务发现网桥从 <a href="http://consul.io">Consul</a> 导入服务到Vert.x服务发现。这个网桥链接了 Consul agent 服务 并周期性扫描以下服务：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新导入的服务</p>
</li>
<li>
<p>移除 处于 <code>maintenance</code> 模式的服务或已经从consul中被移除的服务</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这个桥接器使用的是 Consul 的HTTP API接口。它不能将服务导出到Consul，并且也不支持服务的修改。</p>
</div>
<div class="paragraph">
<p>服务的类型是通过 <code>tags</code> 推断出来的，如果有一个 <code>tag</code> 和已知的服务类型一样，那么就使用这种服务类型，如果没有匹配的，那么服务导入后将标记为unknown类型。目前暂时只支持http-endpoint类型。</p>
</div>
<div class="sect3">
<h4 id="_using_the_bridge"><a class="anchor" href="#_using_the_bridge"></a>桥接器的使用</h4>
<div class="paragraph">
<p>要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (<code>pom.xml</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-discovery-bridge-consul<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (<code>build.gradle</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-discovery-bridge-consul:4.0.2&#x27;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，在创建服务发现对象的时候，像下面这样注册桥接器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceDiscovery.create(vertx)
    .registerServiceImporter(<span class="hljs-keyword">new</span> ConsulServiceImporter(),
        <span class="hljs-keyword">new</span> JsonObject()
            .put(<span class="hljs-string">&quot;host&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>)
            .put(<span class="hljs-string">&quot;port&quot;</span>, <span class="hljs-number">8500</span>)
            .put(<span class="hljs-string">&quot;scan-period&quot;</span>, <span class="hljs-number">2000</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以做一些配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>host</code> 属性，配置 agent 的地址，默认是 <code>localhost</code></p>
</li>
<li>
<p><code>port</code> 属性，配置 agent 的端口，默认的端口是 8500</p>
</li>
<li>
<p><code>acl_token</code> 属性，配置 agent 的访问控制令牌，默认值是 null</p>
</li>
<li>
<p><code>scan-period</code> 属性，配置扫描的频率，扫描的单位是毫秒（ms），默认是 2000 ms</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kubernetes_bridge"><a class="anchor" href="#_kubernetes_bridge"></a>Kubernetes 桥接器</h3>
<div class="paragraph">
<p>Kubernetes 桥接器可以从Kubernetes（或者 Openshift v3）中导入服务到Vert.x的服务发现组件中。
Kubernetes的所有服务，都将映射为一条 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> ，目前桥接器只支持将服务从Kubernetes中导入到Vert.x中（反过来不行）。</p>
</div>
<div class="paragraph">
<p>Kubernetes中的服务，在导入到Vert.x后都会创建对应的 <code><a href="../../apidocs/io/vertx/servicediscovery/Record.html">Record</a></code> ，服务类型是通过 <code>service-type</code> 标签推断出来，或者通过服务暴露的端口推断出来。</p>
</div>
<div class="sect3">
<h4 id="_using_the_bridge_2"><a class="anchor" href="#_using_the_bridge_2"></a>桥接器的使用</h4>
<div class="paragraph">
<p>要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (<code>pom.xml</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-discovery-bridge-kubernetes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle ( <code>build.gradle</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-discovery-bridge-kubernetes:4.0.2&#x27;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_bridge"><a class="anchor" href="#_configuring_the_bridge"></a>桥接器的配置</h4>
<div class="paragraph">
<p>桥接器的配置项有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OAuth token（默认是使用 <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code> 中的内容）</p>
</li>
<li>
<p>服务搜索的命名空间（默认是`default`）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，应用程序必须能够访问 Kubernetes 并且能够读取所选择的命名空间。</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_service_to_record_mapping"><a class="anchor" href="#_the_service_to_record_mapping"></a>服务记录的映射</h4>
<div class="paragraph">
<p>服务记录按照如下的步骤进行创建：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从 <code>service.type</code> 中推断出服务类型；如果没有设置，那么服务类型被设置为 <code>unknown</code></p>
</li>
<li>
<p>服务记录的名称就是服务的名称</p>
</li>
<li>
<p>服务的标签（label）都被映射为服务记录的元数据</p>
</li>
<li>
<p>此外还会加上：<code>kubernetes.uuid</code> , <code>kubernetes.namespace</code> , <code>kubernetes.name</code></p>
</li>
<li>
<p><code>location</code> 信息将从服务的第一个端口推断出来</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于 HTTP 端点，如果服务带有值为 <code>true</code> 的 <code>ssl</code> (<code>https</code>) 标签的话，那么服务记录的 <code>ssl</code> (<code>https</code>)属性将被设置为 <code>true</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dynamics"><a class="anchor" href="#_dynamics"></a>动态性</h4>
<div class="paragraph">
<p>Kubernetes 桥接器将会在启动(<code>start</code>)的时候导入所有的服务，在停止(<code>stop</code>)的时候移除所有的服务。在运行期间，它将监听 Kubernetes 的服务，并且动态地导入新加入的服务，移除被删除的服务。</p>
</div>
</div>
<div class="sect3">
<h4 id="_supported_types"><a class="anchor" href="#_supported_types"></a>支持的类型</h4>
<div class="paragraph">
<p>桥接器使用 <code>service-type</code> 标签来指定类型。另外，它还检查服务的端口，支持如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>80，443，8080-9000： HTTP端点</p>
</li>
<li>
<p>5432，5433：JDBC数据源（PostGreSQL）</p>
</li>
<li>
<p>3306，13306：JDBC数据源（MySql）</p>
</li>
<li>
<p>6379: Redis 数据源</p>
</li>
<li>
<p>ports 27017, 27018 和 27019: MongoDB 数据源</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果 <code>service-type</code> 存在，那么将覆盖端口的默认配置</p>
</div>
<div class="paragraph">
<p>Unresolved directive in index.adoc - include::zookeeper-bridge.adoc[]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker_links_bridge"><a class="anchor" href="#_docker_links_bridge"></a>Docker Links 桥接器</h3>
<div class="paragraph">
<p>Docker Links 桥接器可以从 Docker Links 中导入服务到 Vert.x 的服务发现组件中。当你将一个Docker容器与另外一个Docker容器链接在一起(link)的时候，Docker将会注入一组环境变量。该桥接器将分析这些环境变量，并且针对每个链接(link)，生成一个服务记录。服务记录的类型从 <code>service.type</code> 属性中推断；如果没有设置，那么服务类型将被设置为 <code>unknown</code> 。目前暂时只支持 <code>http-endpoint</code> 服务类型。</p>
</div>
<div class="paragraph">
<p>由于Docker容器只在启动的时候创建链接，所以这个桥接器只会在启动的时候导入服务记录，然后此后就都不改变了。</p>
</div>
<div class="sect3">
<h4 id="_using_the_bridge_3"><a class="anchor" href="#_using_the_bridge_3"></a>桥接器的使用</h4>
<div class="paragraph">
<p>要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (<code>pom.xml</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-discovery-bridge-docker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle ( <code>build.gradle</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-discovery-bridge-docker:4.0.2&#x27;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>创建服务发现对象时，注册桥接器的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceDiscovery.create(vertx)
    .registerServiceImporter(<span class="hljs-keyword">new</span> DockerLinksServiceImporter(), <span class="hljs-keyword">new</span> JsonObject());</code></pre>
</div>
</div>
<div class="paragraph">
<p>这种桥接器不需要进一步的配置。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_backends"><a class="anchor" href="#_additional_backends"></a>其他的后台支持</h2>
<div class="sectionbody">
<div class="paragraph">
<p>除了此库支持的后台之外，Vert.x服务发现还提供了其他后台以供您在自己的应用程序中使用。</p>
</div>
<div class="sect2">
<h3 id="_redis_backend"><a class="anchor" href="#_redis_backend"></a>Redis backend</h3>
<div class="paragraph">
<p>服务发现组件通过实现 <code><a href="../../apidocs/io/vertx/servicediscovery/spi/ServiceDiscoveryBackend.html">ServiceDiscoveryBackend</a></code> SPI提供了一种可插拔的存储后端扩展机制，这是以Redis为基础的SPI的实现。</p>
</div>
<div class="sect3">
<h4 id="_using_the_redis_backend"><a class="anchor" href="#_using_the_redis_backend"></a>使用 Redis 存储后端</h4>
<div class="paragraph">
<p>要使用 Redis 存储后端，需要将如下的依赖包加入到依赖配置文件中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven ( <code>pom.xml</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-discovery-backend-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle ( <code>build.gradle</code> 文件):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-discovery-backend-redis:4.0.2&#x27;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要注意的是，你只能在 <code>classpath</code> 中指定一个SPI的实现；如果没有指定，那么将使用默认的存储后端。</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a>配置</h4>
<div class="paragraph">
<p>Redis存储后端是基于 <a href="http://vertx.io/docs/vertx-redis-client/java">vertx-redis-client</a> 实现的，这个配置是客户端配置以及在Redis上 <code>key</code> 的存储记录</p>
</div>
<div class="paragraph">
<p>下面是一个示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceDiscovery.create(vertx, <span class="hljs-keyword">new</span> ServiceDiscoveryOptions()
    .setBackendConfiguration(
        <span class="hljs-keyword">new</span> JsonObject()
            .put(<span class="hljs-string">&quot;connectionString&quot;</span>, <span class="hljs-string">&quot;redis://localhost:6379&quot;</span>)
            .put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;records&quot;</span>)
    ));</code></pre>
</div>
</div>
<div class="paragraph">
<p>值得注意的一点是，配置是在 <code>setBackendConfiguration</code> 方法中传入的（如果使用JSON，则传递给 <code>backendConfiguration</code> 对象:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceDiscovery.create(vertx,
  <span class="hljs-keyword">new</span> ServiceDiscoveryOptions(<span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">&quot;backendConfiguration&quot;</span>,
      <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">&quot;connectionString&quot;</span>, <span class="hljs-string">&quot;redis://localhost:6379&quot;</span>).put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;my-records&quot;</span>)
)));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div></div></div></div></div></div><footer class="jsx-aeedcf66895f49d7"><div class="jsx-aeedcf66895f49d7 container"><div class="jsx-aeedcf66895f49d7 footer-nav-section"><div class="jsx-aeedcf66895f49d7 footer-nav-list footer-logo"><a class="jsx-aeedcf66895f49d7" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-aeedcf66895f49d7"/></a></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse Vert.x</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7 navbar-menu-item" href="/docs/">文档</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/download/">下载</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/blog/">博客</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/community/">社区</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/translation/">翻译团队</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/eclipse-vertx/vert.x" class="jsx-aeedcf66895f49d7">GitHub</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/vertx-china/vertx-web-site" class="jsx-aeedcf66895f49d7">翻译GitHub</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">资源</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/faq/">答疑</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/channels/">联系渠道</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://how-to.vertx.io/" class="jsx-aeedcf66895f49d7">操作指南</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://start.vertx.io/" class="jsx-aeedcf66895f49d7">应用生成器</a></li><li class="jsx-aeedcf66895f49d7"><a href="/.well-known/security.txt" class="jsx-aeedcf66895f49d7">security.txt</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/" class="jsx-aeedcf66895f49d7">Eclipse 基金会</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/privacy.php" class="jsx-aeedcf66895f49d7">隐私政策</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/termsofuse.php" class="jsx-aeedcf66895f49d7">使用条款</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/copyright.php" class="jsx-aeedcf66895f49d7">版权代理</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/" class="jsx-aeedcf66895f49d7">法律资源</a></li></ul></div></div><div class="jsx-aeedcf66895f49d7 footer-copyright"><div class="jsx-aeedcf66895f49d7 footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x™<br class="jsx-aeedcf66895f49d7"/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Apache License 2.0</a>协议下获得了双重许可。<br class="jsx-aeedcf66895f49d7 footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Michel Krämer</a> 设计。</div><div class="jsx-aeedcf66895f49d7 footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 281.3 91.1&#x27; style=&#x27;enable-background:new 0 0 281.3 91.1&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23f79422%7d.st1%7bfill:%233d3c3b%7d%3c/style%3e%3cg id=&#x27;Layer_1_1_&#x27;%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M265.7 84 257 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zm-32.4-8.3c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3 0 4.7 2.9 9.1 9.1 9.1s9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-21.2 18V73h-3.3v17.7h3.3zm-23.6 0h3.3V76h5.6v-3h-14.6v3h5.6l.1 14.7zm-18.9-6.5H163l3.3-7.6 3.3 7.6zm2.8 6.5h3.6L168.2 73h-3.6l-8 17.7h3.6l1.5-3.3h9.3l1.4 3.3zm-38-14.6h3.6c3.9 0 5.5 2.8 5.5 5.5.1 2.8-1.5 5.8-5.5 5.8h-3.6V76.1zm3.7-3.1h-6.9v17.7h6.9c6.2 0 8.9-4.5 8.9-9s-2.8-8.7-8.9-8.7zm-22.4 11L107 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zM88.2 73v10.2c0 3-1.6 4.9-4.3 4.9s-4.6-1.7-4.6-4.9V73H76v10.1c0 5.3 3.6 7.9 7.9 7.9 4.4 0 7.7-2.7 7.7-7.9V73h-3.4zm-33 2.7c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3s2.9 9.1 9.1 9.1 9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-29.7 18v-6.5h8.9v-3.1h-8.9v-4.8h9.4V73H22.2v17.6h3.3z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M269.4 54.4h-22.2v-8.9h21.4v-6.9h-21.4v-9.1h22.2v-7.2h-29.6v39.5h29.6v-7.4zm-40-25.6c-3-6.1-9.4-7.8-15.5-7.8-7.3 0-15.3 3.4-15.3 11.5 0 8.9 7.4 11 15.5 12 5.2.6 9.1 2.1 9.1 5.8 0 4.3-4.4 5.9-9.1 5.9s-9.4-1.9-11.1-6.3l-6.2 3.2c2.9 7.2 9.1 9.7 17.2 9.7 8.8 0 16.6-3.8 16.6-12.6 0-9.4-7.7-11.6-15.9-12.6-4.7-.6-8.8-1.5-8.8-5 0-2.9 2.6-5.2 8.2-5.2 4.3 0 8 2.2 9.4 4.4l5.9-3zM176 22.2c-6.2-.1-12.4 0-18.6 0v39.5h7.4V50.1H176c19.4 0 19.4-27.9 0-27.9zm-11.1 7.1H176c9.5 0 9.5 14 0 14h-11.2l.1-14zm-18 32.5V22.2h-7.4v39.5l7.4.1zm-44-39.6v39.5h27.7v-6.9h-20.3V22.2h-7.4zM90.7 51.7c-2.7 2.5-6.2 4-9.9 4-9.8 0-13.5-6.8-13.6-13.4s4.1-13.7 13.6-13.7c3.5-.1 7 1.3 9.5 3.7l5-4.8c-3.8-3.9-9.1-6-14.5-6-14.3 0-21 10.5-20.9 20.8s6.3 20.3 20.9 20.3c5.6.1 11-2 15-5.9l-5.1-5zm-39 2.7H29.5v-8.9h21.4v-6.9H29.5v-9.1h22.2v-7.2H22.2v39.5h29.6l-.1-7.4z&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M9.8 18.2C18.8 4.1 36.9-.8 52.1 6l-1-.7C35.7-4.6 15.2-.1 5.3 15.3s-5.4 35.9 10 45.8l1.1.6C3.8 50.8.8 32.3 9.8 18.2z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M272.2 26.1c0-2.5 2.1-4.6 4.6-4.6 2.5 0 4.6 2.1 4.6 4.6 0 2.5-2.1 4.6-4.6 4.6-2.6 0-4.6-2.1-4.6-4.6zm8.6 0c0-2.2-1.8-4.1-4-4.1s-4.1 1.8-4.1 4.1c0 2.2 1.7 4 3.9 4.1h.1c2.3 0 4.1-1.8 4.1-4.1zm-6-2.5h2.3c1.1 0 1.9.5 1.9 1.6 0 .7-.4 1.3-1.1 1.5l1.2 1.7h-1.4l-1-1.5h-.7v1.5h-1.1l-.1-4.8zm2.2 2.3c.5 0 .8-.3.8-.7s-.3-.7-.8-.7h-1v1.3l1 .1z&#x27;/%3e%3c/g%3e%3c/svg%3e" alt="Eclipse foundation Logo" class="jsx-aeedcf66895f49d7"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.0.2/vertx-service-discovery/java","title":"Vert.x 服务发现","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_using_the_service_discovery\"\u003e使用服务发现\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_overall_concepts\"\u003e概念总览\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_service_records\"\u003e服务记录\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_provider_and_publisher\"\u003e提供者和发布者\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_consumer\"\u003e服务消费者\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_object\"\u003e服务对象\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_types\"\u003e服务类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_events\"\u003e服务事件\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_backend\"\u003e后台\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_creating_a_service_discovery_instance\"\u003e创建服务发现实例\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_publishing_services\"\u003e发布服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_withdrawing_services\"\u003e回收服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_looking_for_services\"\u003e寻找服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_retrieving_a_service_reference\"\u003e获取服务引用\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_types_of_services\"\u003e服务类型\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_services_with_no_type\"\u003e无类型的服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_implementing_your_own_service_type\"\u003e实现您自己的服务类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_http_endpoints\"\u003eHTTP 节点\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_event_bus_services\"\u003eEvent bus 服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_message_source\"\u003e消息源服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_jdbc_data_source\"\u003eJDBC数据源\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_redis_data_source\"\u003eRedis 数据源\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_mongo_data_source\"\u003eMongo数据源\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_listening_for_service_arrivals_and_departures\"\u003e监听服务的注册和注销\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_listening_for_service_usage\"\u003e监听服务使用状况\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_service_discovery_bridges\"\u003e服务发现桥接器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_additional_bridges\"\u003e其他的桥接器支持\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_consul_bridge\"\u003eConsul 网桥\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_kubernetes_bridge\"\u003eKubernetes 桥接器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_docker_links_bridge\"\u003eDocker Links 桥接器\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_additional_backends\"\u003e其他的后台支持\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_redis_backend\"\u003eRedis backend\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x 服务发现\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x 服务发现组件提供了一套用于对各种资源服务的发布、发现的基础组件，例如 服务代理、HTTP服务节点（HTTP endpoint）、数据源（data source）\u0026#8230;\u0026#8203; 这些资源统称为 \u003ccode\u003e服务\u003c/code\u003e 。一个 \u003ccode\u003e服务\u003c/code\u003e 即是一个可被发现的功能性模块。它可以用类型、元数据、位置来区分，所以一个 \u003ccode\u003e服务\u003c/code\u003e 可以是一个数据库、服务代理、HTTP节点或者其他任何您能够描述、发现、交互的服务资源。它不一定是一个vert.x对象，它可以是任何组件。每个 \u003ccode\u003e服务\u003c/code\u003e 都被描述成一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e （即：下述 \u003ccode\u003e服务记录\u003c/code\u003e ）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e服务发现\u003c/code\u003e 组件实现了面向服务计算中定义的服务交互。此外，在某种程度上，还提供了动态的面向服务计算交互，这样应用程序可以对各种服务的上线、下线作出处理。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个服务提供者可以做如下事情：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e发布一个服务的 \u003ccode\u003e服务记录\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e下线一个已发布的 \u003ccode\u003e服务记录\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e更新线上服务的状态 (下线、暂停服务\u0026#8230;\u0026#8203;)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个服务消费者可以做如下事情：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e寻找服务\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e选择绑定到某个服务（获取一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html\"\u003eServiceReference\u003c/a\u003e\u003c/code\u003e) 并使用）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当服务消费者停止后立即释放服务提供者资源\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e监听服务的注册、注销、更新\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务消费者将：1)寻找符合自己需求的 \u003ccode\u003e服务记录\u003c/code\u003e； 2) 接收提供访问入口的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html\"\u003eServiceReference\u003c/a\u003e\u003c/code\u003e ；3) 获得一个提供访问入口的 \u003ccode\u003e服务\u003c/code\u003e 对象；4) 停止后立即释放服务对象\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个过程可以用 \u003cem\u003e服务类型\u003c/em\u003e （service type） 来简化，如果你知道服务的类型(JDBC client, Http client\u0026#8230;\u0026#8203;)，那么你可以直接获取到这个服务对象。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e综上所述，服务提供者和消费者之间共享的核心信息都存放在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003erecords\u003c/a\u003e\u003c/code\u003e 当中。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e提供者和消费者必须创建自己的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html\"\u003eServiceDiscovery\u003c/a\u003e\u003c/code\u003e 实例。这些实例在后台（分布式架构）进行协作，以使服务之间信息保持同步。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003evert.x的服务发现通过桥接方式 支持对其他服务发现技术的导入和导出。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_the_service_discovery\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_service_discovery\"\u003e\u003c/a\u003e使用服务发现\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用Vert.x 服务发现组件，需要将下列依赖加入到依赖配置中文件：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (\u003ccode\u003epom.xml\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-discovery\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (\u003ccode\u003ebuild.gradle\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-discovery:4.0.2\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_overall_concepts\"\u003e\u003ca class=\"anchor\" href=\"#_overall_concepts\"\u003e\u003c/a\u003e概念总览\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务发现机制基于以下章节的几个概念。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_records\"\u003e\u003ca class=\"anchor\" href=\"#_service_records\"\u003e\u003c/a\u003e服务记录\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个服务 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e 是服务提供者发布的一个服务描述对象。它包含了名称、元数据、位置对象（描述服务发布在哪里）。这个 \u003ccode\u003e服务记录\u003c/code\u003e 是提供者（发布 \u003ccode\u003e服务记录\u003c/code\u003e ）和消费者（寻找服务时获取 \u003ccode\u003e服务记录\u003c/code\u003e ）之间仅有的共享对象。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e元数据和位置格式由 \u003ccode\u003e服务类型（service type）\u003c/code\u003e 决定（见下述）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务提供方准备好之后，一个 \u003ccode\u003e服务记录\u003c/code\u003e 就被发布了，服务停止时 \u003ccode\u003e服务记录\u003c/code\u003e 被回收\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_provider_and_publisher\"\u003e\u003ca class=\"anchor\" href=\"#_service_provider_and_publisher\"\u003e\u003c/a\u003e提供者和发布者\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务提供者是一个提供 \u003cem\u003e服务\u003c/em\u003e 的对象。发布者负责发布描述提供者的 \u003ccode\u003e服务记录\u003c/code\u003e 。它可能是同一个对象（提供者仅仅发布自己）也可能是个不同的对象。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_consumer\"\u003e\u003ca class=\"anchor\" href=\"#_service_consumer\"\u003e\u003c/a\u003e服务消费者\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务消费者在服务发现模块中检索服务。每次检索都会得到 \u003ccode\u003e0..n\u003c/code\u003e 个\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e ，从这些 \u003ccode\u003e服务记录\u003c/code\u003e 当中，服务消费者可以获取到 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html\"\u003eServiceReference\u003c/a\u003e\u003c/code\u003e ，这个 \u003ccode\u003e服务引用\u003c/code\u003e 绑定了提供方和消费方，它允许消费方获取到 \u003cem\u003e服务对象（service object）\u003c/em\u003e （用来使用服务）或释放服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e释放 \u003ccode\u003e服务引用\u003c/code\u003e 是一件很重要的事情，这清除了 \u003ccode\u003e服务引用\u003c/code\u003e 对象并更新了服务的使用状态\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_object\"\u003e\u003ca class=\"anchor\" href=\"#_service_object\"\u003e\u003c/a\u003e服务对象\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e服务对象\u003c/code\u003e 是一个提供了服务入口的对象。它可以是各种形式，例如 代理、客户端、甚至是一些不存在的服务类型。服务对象的性质取决于服务类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：因为Vert.x多语言的性质，所以如果你在java、groovy或其他语言获取的 \u003ccode\u003e服务对象\u003c/code\u003e 会不一样。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_types\"\u003e\u003ca class=\"anchor\" href=\"#_service_types\"\u003e\u003c/a\u003e服务类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务仅仅是一些 \u003ccode\u003e资源（resource）\u003c/code\u003e 或不同类型的 \u003ccode\u003e服务\u003c/code\u003e。他们可以是功能服务组件、数据库、REST-Api等等。Vert.x服务发现模块定义 \u003ccode\u003e服务类型\u003c/code\u003e 来处理各类型的差异。每个类型定义了：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e服务是如何定位的（URI, event bus address, IP / DNS\u0026#8230;\u0026#8203;）- \u003cem\u003elocation\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务对象的性质（service proxy, HTTP client, message consumer\u0026#8230;\u0026#8203;）\u003cem\u003eclient\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务发现组件提供了一些现成的服务类型，但是你可以添加你自己的类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_service_events\"\u003e\u003ca class=\"anchor\" href=\"#_service_events\"\u003e\u003c/a\u003e服务事件\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e每当发布或注销一个服务，event-bus上就会触发一个事件(event),这个事件包含了被更新的服务记录。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e另外，为了追踪谁调用谁，每当调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getReference-io.vertx.servicediscovery.Record-\"\u003egetReference\u003c/a\u003e\u003c/code\u003e 则获取reference或者 调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html#release--\"\u003erelease\u003c/a\u003e\u003c/code\u003e 释放reference的时候，事件都在event-bus上被发出 用以跟踪服务的使用情况。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e关于事件的更多详细信息如下。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_backend\"\u003e\u003ca class=\"anchor\" href=\"#_backend\"\u003e\u003c/a\u003e后台\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务发现模块使用了Vert.x的分布式数据结构来存储 \u003ccode\u003e服务记录\u003c/code\u003e 。所以所有的集群成员都能获取到所有的 \u003ccode\u003e服务记录\u003c/code\u003e 。这是后台默认的实现。你可以实现 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceDiscoveryBackend.html\"\u003eServiceDiscoveryBackend\u003c/a\u003e\u003c/code\u003e SPI 来实现自己的Backend。例如，Vert.x提供了一个基于Redis的基础实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：服务发现不要求必须是Vert.x集群。在单节点模式下，这个数据结构存储于本地。它可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html\"\u003eServiceImporter\u003c/a\u003e\u003c/code\u003e 实现。从3.5.0版本开始，你可以在集群模式下用本地结构的event，这可以设置系统参数 \u003ccode\u003evertx-service-discovery-backend-local\u003c/code\u003e 为 \u003ccode\u003etrue\u003c/code\u003e (或者设置环境变量 \u003ccode\u003eVERTX-SERVICE-DISCOVERY-BACKEND-LOCAL\u003c/code\u003e 为 \u003ccode\u003etrue\u003c/code\u003e) 来实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_creating_a_service_discovery_instance\"\u003e\u003ca class=\"anchor\" href=\"#_creating_a_service_discovery_instance\"\u003e\u003c/a\u003e创建服务发现实例\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e提供者和消费者必须创建他们自己的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html\"\u003eServiceDiscovery\u003c/a\u003e\u003c/code\u003e 实例来使用服务发现组件：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceDiscovery discovery = ServiceDiscovery.create(vertx);\n\n\u003cspan class=\"hljs-comment\"\u003e// 自定义配置\u003c/span\u003e\ndiscovery = ServiceDiscovery.create(vertx,\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceDiscoveryOptions()\n        .setAnnounceAddress(\u003cspan class=\"hljs-string\"\u003e\u0026quot;service-announce\u0026quot;\u003c/span\u003e)\n        .setName(\u003cspan class=\"hljs-string\"\u003e\u0026quot;my-name\u0026quot;\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Do something...\u003c/span\u003e\n\ndiscovery.close();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认情况下，公告地址(发送事件的event-bus地址)是 \u003ccode\u003evertx.discovery.announce\u003c/code\u003e。你也可以为service usage（见service usage章节）配置一个名称。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当你再也不需要服务发现对象时，不要忘记去关闭它。它关闭了您已配置的发现导入器和导出器，并释放服务引用。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您应该避免共享服务发现实例，因此service usage 将代表正确的“usage”\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_publishing_services\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_services\"\u003e\u003c/a\u003e发布服务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦你拥有了服务发现实例，你可以发布服务。步骤如下：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e为这个服务提供者创建一个服务记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e发布这个服务记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e持有这个服务记录，以便于后续的注销和更改操作\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了创建服务记录，你可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e 类，或者用不同服务类型提供的便捷方式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Record()\n    .setType(\u003cspan class=\"hljs-string\"\u003e\u0026quot;eventbus-service-proxy\u0026quot;\u003c/span\u003e)\n    .setLocation(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;endpoint\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;the-service-address\u0026quot;\u003c/span\u003e))\n    .setName(\u003cspan class=\"hljs-string\"\u003e\u0026quot;my-service\u0026quot;\u003c/span\u003e)\n    .setMetadata(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-label\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e));\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// 发布成功\u003c/span\u003e\n    Record publishedRecord = ar.result();\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 发布失败\u003c/span\u003e\n  }\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// 由一个类型创建的record\u003c/span\u003e\nrecord = HttpEndpoint.createRecord(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-rest-api\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api\u0026quot;\u003c/span\u003e);\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// 发布成功\u003c/span\u003e\n    Record publishedRecord = ar.result();\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 发布失败\u003c/span\u003e\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e持有服务记录的引用是很重要的事情，因为服务记录中拥有一个 \u003ccode\u003e注册 id\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_withdrawing_services\"\u003e\u003ca class=\"anchor\" href=\"#_withdrawing_services\"\u003e\u003c/a\u003e回收服务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要回收(下线)一个record，使用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.unpublish(record.getRegistration(), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// Ok\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 无法下线服务，可能是因为已经被移除或者 record根本没有被发布\u003c/span\u003e\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_looking_for_services\"\u003e\u003ca class=\"anchor\" href=\"#_looking_for_services\"\u003e\u003c/a\u003e寻找服务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003cem\u003e本章解释了获取服务的底层原理，每个服务类型都提供了便捷的方式来整合各个的步骤\u003c/em\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在消费方，第一件事就是要寻找服务记录。您可以检索单个服务记录或者所有符合条件的服务记录。第一种情况，第一个符合条件的服务记录被返回。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e消费方可以提供一个过滤器(filter)来选择服务。有两种方式来描述过滤器：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e一个以 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e 为参数并以布尔类型（这是一个断言）作为返回值的函数\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e这个过滤器是一个JSON-obejct。每一个给出的filter过滤条件都会检查record，所有的过滤条件都必须满足record。过滤条件可以用 \u003ccode\u003e*\u003c/code\u003e 通配符来表示对key的要求，而不是精准匹配。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e我们来看看JSON过滤器的一个例子：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre\u003e{ \"name\" = \"a\" } =\u0026gt; 筛选出名称是\"a\"的record\n{ \"color\" = \"*\" } =\u0026gt; 筛选出存在\"color\"字段的record\n{ \"color\" = \"red\" } =\u0026gt; 筛选出\"color\"字段是\"red\"的record\n{ \"color\" = \"red\", \"name\" = \"a\"} =\u0026gt; 筛选出\"color\"字段是\"red\" 且 \"name\"字段是\"a\"的record\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果没有设置JSON过滤器(\u003ccode\u003enull\u003c/code\u003e 或 empty) ，则筛选出所有的服务记录。当用函数来过滤时，如果你想获取到所有的服务记录，那无论是什么样的服务记录，你必须要返回 \u003cem\u003etrue\u003c/em\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e示例如下：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(r -\u0026gt; \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取到一个record\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 寻找成功但是没有符合条件的服务\u003c/span\u003e\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\n\ndiscovery.getRecord((JsonObject) \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取到一个record\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 寻找成功但是没有符合条件的服务\u003c/span\u003e\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\n\n\n\u003cspan class=\"hljs-comment\"\u003e// 通过名称获取record\u003c/span\u003e\ndiscovery.getRecord(r -\u0026gt; r.getName().equals(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-name\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取到一个record\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 寻找成功但是没有符合条件的服务\u003c/span\u003e\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\n\ndiscovery.getRecord(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取到一个record\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 寻找成功但是没有符合条件的服务\u003c/span\u003e\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// 获取所有符合过滤器条件的record\u003c/span\u003e\ndiscovery.getRecords(r -\u0026gt; \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e.equals(r.getMetadata().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-label\u0026quot;\u003c/span\u003e)), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    List\u0026lt;Record\u0026gt; results = ar.result();\n    \u003cspan class=\"hljs-comment\"\u003e// 如果获取到非空list，那么我们获取到了record\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 否则说明寻找成功但是没有符合条件的服务\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\n\n\ndiscovery.getRecords(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-label\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    List\u0026lt;Record\u0026gt; results = ar.result();\n    \u003cspan class=\"hljs-comment\"\u003e// 如果获取到非空list，那么我们获取到了record\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 否则说明寻找成功但是没有符合条件的服务\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 查找失败\u003c/span\u003e\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e我们可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getRecords-io.vertx.core.json.JsonObject-io.vertx.core.Handler-\"\u003egetRecords\u003c/a\u003e\u003c/code\u003e 来获取单条服务记录或者所有符合条件的服务记录。默认情况下，对于服务记录的查找仅仅包含 \u003ccode\u003estatus\u003c/code\u003e 是 \u003ccode\u003eUP\u003c/code\u003e 的情况。这可以被重写：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e当使用JSON过滤器时，设置 \u003ccode\u003estatus\u003c/code\u003e 为你的期望值（或者 \u003ccode\u003e*\u003c/code\u003e 来接收所有的状态）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当使用函数时，在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#getRecords-java.util.function.Function-boolean-io.vertx.core.Handler-\"\u003egetRecords\u003c/a\u003e\u003c/code\u003e 函数 设置 \u003ccode\u003eincludeOutOfService\u003c/code\u003e 参数为 \u003ccode\u003etrue\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_retrieving_a_service_reference\"\u003e\u003ca class=\"anchor\" href=\"#_retrieving_a_service_reference\"\u003e\u003c/a\u003e获取服务引用\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦你选择了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e ，你可以获取一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html\"\u003eServiceReference\u003c/a\u003e\u003c/code\u003e 和 \u003ccode\u003e服务对象\u003c/code\u003e :\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceReference reference1 = discovery.getReference(record1);\nServiceReference reference2 = discovery.getReference(record2);\n\n\u003cspan class=\"hljs-comment\"\u003e// 获取到service object，返回服务引用的类型取决于 service type\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Http 节点\u003c/span\u003e\nHttpClient client = reference1.getAs(HttpClient.class);\n\u003cspan class=\"hljs-comment\"\u003e// 消息源\u003c/span\u003e\nMessageConsumer consumer = reference2.getAs(MessageConsumer.class);\n\n\u003cspan class=\"hljs-comment\"\u003e// 当服务使用完毕\u003c/span\u003e\nreference1.release();\nreference2.release();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e切记处理完毕之后释放服务引用资源\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个服务引用代表了一个对服务提供者的绑定关系。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e获取服务引用时，你可以传一个包含了各种数据的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/json/JsonObject.html\"\u003eJsonObject\u003c/a\u003e\u003c/code\u003e 用来配置 \u003ccode\u003e服务对象\u003c/code\u003e 。某些服务类型不需要额外的配置，如下是一些必要的配置（数据源为例）：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceReference reference = discovery.getReferenceWithConfiguration(record, conf);\n\n\u003cspan class=\"hljs-comment\"\u003e// 获取到service object，返回服务引用的类型取决于 service type\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// JDBC 节点\u003c/span\u003e\nJDBCClient client = reference.getAs(JDBCClient.class);\n\n\u003cspan class=\"hljs-comment\"\u003e// Do something with the client...\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 当服务使用完毕\u003c/span\u003e\nreference.release();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在前述例子当中，代码用了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html#getAs-java.lang.Class-\"\u003egetAs\u003c/a\u003e\u003c/code\u003e 函数，其参数是你期望得到的服务类型。如果你用java语言，你可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html#get--\"\u003eget\u003c/a\u003e\u003c/code\u003e 函数。然而其他语言 你必须传一个你期望的类型值。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_types_of_services\"\u003e\u003ca class=\"anchor\" href=\"#_types_of_services\"\u003e\u003c/a\u003e服务类型\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如上所述，服务发现有 \u003ccode\u003e服务类型\u003c/code\u003e 的概念来管理不同类型的服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这些类型默认通过如下方式提供：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html\"\u003eHttpEndpoint\u003c/a\u003e\u003c/code\u003e - 对于 REST API\u0026#8217;来讲, 服务对象是一个由 \u003ccode\u003ehost\u003c/code\u003e、\u003ccode\u003eport\u003c/code\u003e（位置是 \u003ccode\u003eurl\u003c/code\u003e 参数）配置的\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/http/HttpClient.html\"\u003eHttpClient\u003c/a\u003e\u003c/code\u003e .\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/EventBusService.html\"\u003eEventBusService\u003c/a\u003e\u003c/code\u003e - 对于服务代理，服务对象是一个proxy。它的类型是`proxies interface`（服务所在位置是地址）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MessageSource.html\"\u003eMessageSource\u003c/a\u003e\u003c/code\u003e - 对于消息源（发送者），服务对象是一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/eventbus/MessageConsumer.html\"\u003eMessageConsumer\u003c/a\u003e\u003c/code\u003e （服务所在位置是地址）。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/JDBCDataSource.html\"\u003eJDBCDataSource\u003c/a\u003e\u003c/code\u003e - 对于 JDBC 数据源, 服务对象是一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/jdbc/JDBCClient.html\"\u003eJDBCClient\u003c/a\u003e\u003c/code\u003e （客户端配置从 location，metadata和消费方配置来解析）。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html\"\u003eRedisDataSource\u003c/a\u003e\u003c/code\u003e - 对于 Redis 数据源, 服务对象是一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/redis/client/Redis.html\"\u003eRedis\u003c/a\u003e\u003c/code\u003e (客户端配置从 location，metadata和消费方配置来解析).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html\"\u003eMongoDataSource\u003c/a\u003e\u003c/code\u003e - 对于 Mongo 数据源, 服务对象是一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/mongo/MongoClient.html\"\u003eMongoClient\u003c/a\u003e\u003c/code\u003e (客户端配置从 location，metadata和消费方配置来解析).\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e本节总体上给出有关服务类型的详细信息，并介绍如何使用默认服务类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_services_with_no_type\"\u003e\u003ca class=\"anchor\" href=\"#_services_with_no_type\"\u003e\u003c/a\u003e无类型的服务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一些record也许没有类型(\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html#UNKNOWN\"\u003eServiceType.UNKNOWN\u003c/a\u003e\u003c/code\u003e)。所以不可能从这些record里面获取到服务对象，但是你可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e 对象的 \u003ccode\u003elocation\u003c/code\u003e 和 \u003ccode\u003emetadata\u003c/code\u003e 来构建连接的具体信息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用这些服务不会触发 \u003ccode\u003eservice usage\u003c/code\u003e 事件\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_implementing_your_own_service_type\"\u003e\u003ca class=\"anchor\" href=\"#_implementing_your_own_service_type\"\u003e\u003c/a\u003e实现您自己的服务类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你可以通过实现 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html\"\u003eServiceType\u003c/a\u003e\u003c/code\u003e SPI 的方式来创建你自己的服务类型:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e(可选) 创建一个public interface 继承 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html\"\u003eServiceType\u003c/a\u003e\u003c/code\u003e 。这个interface仅仅用来提供辅助函数来简化你自定义类型的用法，例如 \u003ccode\u003ecreateRecord\u003c/code\u003e 函数, \u003ccode\u003egetX\u003c/code\u003e ， \u003ccode\u003eX\u003c/code\u003e 是你获取到的服务对象的类型。可以查看 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html\"\u003eHttpEndpoint\u003c/a\u003e\u003c/code\u003e 或者 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MessageSource.html\"\u003eMessageSource\u003c/a\u003e\u003c/code\u003e 等接口例子来了解这种设计\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e创建一个类来实现 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceType.html\"\u003eServiceType\u003c/a\u003e\u003c/code\u003e ，或者实现你在第一步创建的类型。 这个类型有 \u003ccode\u003ename\u003c/code\u003e 和一个为这个类型创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceReference.html\"\u003eServiceReference\u003c/a\u003e\u003c/code\u003e 的函数。这个name必须匹配 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e 类的 \u003ccode\u003etype\u003c/code\u003e 字段，这个record的type就是您自己定义的服务类型。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e创建一个类继承 \u003ccode\u003eio.vertx.ext.discovery.types.AbstractServiceReference\u003c/code\u003e ，您可以参数化您将要返回的带有服务对象类型的类，你必须实现 \u003ccode\u003eAbstractServiceReference#retrieve()\u003c/code\u003e 函数来创建服务对象。这个函数只能被调用一次。如果需要清除服务对象，也要重写 \u003ccode\u003eAbstractServiceReference#onClose()\u003c/code\u003e 函数\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在打包jar时在jar内创建一个 \u003ccode\u003eMETA-INF/services/io.vertx.servicediscovery.spi.ServiceType\u003c/code\u003e 文件。这个文件仅仅包含您在第二步创建的类的全名。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e创建一个包含service type interface（步骤1）的jar，实现类（步骤2，步骤3）和服务描述文件（步骤4）。把这个jar放在你应用的classpath下，然后您的服务类型现在就已经可用了。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_http_endpoints\"\u003e\u003ca class=\"anchor\" href=\"#_http_endpoints\"\u003e\u003c/a\u003eHTTP 节点\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个HTTP节点代表一个REST API或者可用HTTP请求访问的服务。HTTP节点服务对象是一个由host、port、ssl所配置的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/http/HttpClient.html\"\u003eHttpClient\u003c/a\u003e\u003c/code\u003e 对象\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_a_http_endpoint\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_a_http_endpoint\"\u003e\u003c/a\u003e发布一个HTTP节点\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要发布一个HTTP节点，你需要一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e ，你可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html#createRecord-java.lang.String-java.lang.String-int-java.lang.String-io.vertx.core.json.JsonObject-\"\u003eHttpEndpoint.createRecord\u003c/a\u003e\u003c/code\u003e 来创建服务记录。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e下面一段阐述如何用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html\"\u003eHttpEndpoint\u003c/a\u003e\u003c/code\u003e 创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record1 = HttpEndpoint.createRecord(\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-http-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名称\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//  host\u003c/span\u003e\n  \u003cspan class=\"hljs-number\"\u003e8433\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// port\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 服务的根路由\u003c/span\u003e\n);\n\ndiscovery.publish(record1, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\n\nRecord record2 = HttpEndpoint.createRecord(\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-other-name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名称\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 是否要求 HTTPs\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// host\u003c/span\u003e\n  \u003cspan class=\"hljs-number\"\u003e8433\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// port\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务的根路由\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some value\u0026quot;\u003c/span\u003e)\n);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当你在容器或者云启动你的服务时，也许并不知道服务的公网IP和端口，所以发布操作必须要通过另一个对象来获取这个信息，通常它是一个 \u003cem\u003e桥接对象\u003c/em\u003e （ \u003ccode\u003ebridge\u003c/code\u003e ）。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_a_http_endpoint\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_a_http_endpoint\"\u003e\u003c/a\u003e消费一个HTTP服务节点\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦HTTP节点发布，一个消费者可以获取到它。这个服务对象是一个配置了host和port的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/http/HttpClient.html\"\u003eHttpClient\u003c/a\u003e\u003c/code\u003e ：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-http-service\u0026quot;\u003c/span\u003e), ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded() \u0026amp;\u0026amp; ar1.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n    ServiceReference reference = discovery.getReference(ar1.result());\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务对象\u003c/span\u003e\n    HttpClient client = reference.getAs(HttpClient.class);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 定义完整的path\u003c/span\u003e\n    client.request(HttpMethod.GET, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/persons\u0026quot;\u003c/span\u003e).compose(request -\u0026gt;\n      request\n        .send()\n        .compose(HttpClientResponse::body))\n      .onComplete(ar2 -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n      reference.release();\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你也可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/HttpEndpoint.html#getClient-io.vertx.servicediscovery.ServiceDiscovery-io.vertx.core.json.JsonObject-io.vertx.core.Handler-\"\u003eHttpEndpoint.getClient\u003c/a\u003e\u003c/code\u003e 函数，通过一次函数调用来同时完成服务查找和服务对象获取的操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eHttpEndpoint.getClient(discovery, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-http-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    HttpClient client = ar.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// 你需要提供完整的path\u003c/span\u003e\n    client.request(HttpMethod.GET, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/persons\u0026quot;\u003c/span\u003e).compose(request -\u0026gt;\n      request\n        .send()\n        .compose(HttpClientResponse::body))\n      .onComplete(ar2 -\u0026gt; {\n        \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n        ServiceDiscovery.releaseServiceObject(discovery, client);\n      });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在这第二个写法里，用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#releaseServiceObject-io.vertx.servicediscovery.ServiceDiscovery-java.lang.Object-\"\u003eServiceDiscovery.releaseServiceObject\u003c/a\u003e\u003c/code\u003e 来释放服务对象，所以你不需要持有服务引用。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e从Vert.x 3.4.0开始，提供了另一个客户端。这个更高层次封装的客户端名字叫 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/web/client/WebClient.html\"\u003eWebClient\u003c/a\u003e\u003c/code\u003e，这个客户端用起来更容易。你可以通过如下方式获取 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/web/client/WebClient.html\"\u003eWebClient\u003c/a\u003e\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-http-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n    ServiceReference reference = discovery.getReference(ar.result());\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务对象\u003c/span\u003e\n    WebClient client = reference.getAs(WebClient.class);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 你需要提供完整的path\u003c/span\u003e\n    client.get(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/persons\u0026quot;\u003c/span\u003e).send(\n      response -\u0026gt; {\n\n        \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n        reference.release();\n\n      });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e另外，如果你更倾向于用服务类型的方式：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eHttpEndpoint.getWebClient(discovery, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-http-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    WebClient client = ar.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// 你需要提供完整的path\u003c/span\u003e\n    client.get(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/api/persons\u0026quot;\u003c/span\u003e)\n      .send(response -\u0026gt; {\n\n        \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n        ServiceDiscovery.releaseServiceObject(discovery, client);\n\n      });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_event_bus_services\"\u003e\u003ca class=\"anchor\" href=\"#_event_bus_services\"\u003e\u003c/a\u003eEvent bus 服务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEvent bus服务是服务代理，它基于event bus实现了异步RPC服务。当从event bus服务获取一个服务对象，你获取到对应类型的服务代理。你可以从 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/EventBusService.html\"\u003eEventBusService\u003c/a\u003e\u003c/code\u003e 获取辅助函数。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：服务代理（服务的实现和服务接口）是由java实现的\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_an_event_bus_service\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_an_event_bus_service\"\u003e\u003c/a\u003e发布一个event bus服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e发布event bus服务，你需要创建一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = EventBusService.createRecord(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-eventbus-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名称\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;address\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务地址,\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;examples.MyService\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 字符串格式的服务接口类名\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n        .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some value\u0026quot;\u003c/span\u003e)\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你也可以传服务接口类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = EventBusService.createRecord(\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-eventbus-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名称\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;address\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务地址,\u003c/span\u003e\nMyService.class \u003cspan class=\"hljs-comment\"\u003e// 接口类\u003c/span\u003e\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_an_event_bus_service\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_an_event_bus_service\"\u003e\u003c/a\u003e消费event bus服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要消费一个event bus服务，你可以先获取服务记录，再通过服务记录获取服务引用；或者用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/EventBusService.html\"\u003eEventBusService\u003c/a\u003e\u003c/code\u003e 接口通过一次调用来完成这两个操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当使用服务引用是，你应该这样做：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-eventbus-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n\u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\nServiceReference reference = discovery.getReference(ar.result());\n\u003cspan class=\"hljs-comment\"\u003e// 获取服务对象\u003c/span\u003e\nMyService service = reference.getAs(MyService.class);\n\n\u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\nreference.release();\n}\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/EventBusService.html\"\u003eEventBusService\u003c/a\u003e\u003c/code\u003e 类，你可以像下述获取代理：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eEventBusService.getProxy(discovery, MyService.class, ar -\u0026gt; {\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\nMyService service = ar.result();\n\n\u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\nServiceDiscovery.releaseServiceObject(discovery, service);\n}\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_message_source\"\u003e\u003ca class=\"anchor\" href=\"#_message_source\"\u003e\u003c/a\u003e消息源服务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e消息源是一个往event bus地址发送消息的组件，消息源客户端是 `\u003ca href=\"../../apidocs/io/vertx/core/eventbus/MessageConsumer.html\"\u003eMessageConsumer\u003c/a\u003e`类。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e消息被发送给到eventBus的 \u003cem\u003elocation\u003c/em\u003e 或 消息源服务上。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_a_message_source\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_a_message_source\"\u003e\u003c/a\u003e推送消息\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e就像其他类型的服务，推送一个消息分2步走：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MessageSource.html\"\u003eMessageSource\u003c/a\u003e\u003c/code\u003e 创建一个服务对象。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e推送消息\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = MessageSource.createRecord(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-message-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-address\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// event bus 地址\u003c/span\u003e\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\n\nrecord = MessageSource.createRecord(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-other-message-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-address\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// event bus 地址\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;examples.MyData\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 消息体类型\u003c/span\u003e\n);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在上述第二个record当中，我们同时指明了消息体（payload）的类型，这个参数是可选的。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在Java当中，你可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/java/lang/Class.html\"\u003eClass\u003c/a\u003e\u003c/code\u003e 参数：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record1 = MessageSource.createRecord(\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-message-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-address\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务地址\u003c/span\u003e\nJsonObject.class \u003cspan class=\"hljs-comment\"\u003e// 消息体类型\u003c/span\u003e\n);\n\nRecord record2 = MessageSource.createRecord(\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-other-message-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-address\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务地址\u003c/span\u003e\nJsonObject.class, \u003cspan class=\"hljs-comment\"\u003e// 消息体类型\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some value\u0026quot;\u003c/span\u003e)\n);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_a_message_source\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_a_message_source\"\u003e\u003c/a\u003e消费消息服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在消费者端，你可以获取服务记录从而获取服务引用，或者用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MessageSource.html\"\u003eMessageSource\u003c/a\u003e\u003c/code\u003e 通过一次调用合两步为一。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e通过第一种方式，代码如下：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-message-source-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n    ServiceReference reference = discovery.getReference(ar.result());\n    \u003cspan class=\"hljs-comment\"\u003e// 获取服务对象\u003c/span\u003e\n    MessageConsumer\u0026lt;JsonObject\u0026gt; consumer = reference.getAs(MessageConsumer.class);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 指定消息处理器\u003c/span\u003e\n    consumer.handler(message -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// 消息处理器逻辑\u003c/span\u003e\n      JsonObject payload = message.body();\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MessageSource.html\"\u003eMessageSource\u003c/a\u003e\u003c/code\u003e 时，代码就变成了如下：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eMessageSource.\u0026lt;JsonObject\u0026gt;getConsumer(discovery, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-message-source-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    MessageConsumer\u0026lt;JsonObject\u0026gt; consumer = ar.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// 指定消息处理器\u003c/span\u003e\n    consumer.handler(message -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// 消息处理器逻辑\u003c/span\u003e\n      JsonObject payload = message.body();\n    });\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_jdbc_data_source\"\u003e\u003ca class=\"anchor\" href=\"#_jdbc_data_source\"\u003e\u003c/a\u003eJDBC数据源\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e数据源代表数据库或数据仓储。而JDBC数据源特指用JDBC驱动访问数据库。JDBC数据源客户端是 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/jdbc/JDBCClient.html\"\u003eJDBCClient\u003c/a\u003e\u003c/code\u003e 类。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_a_jdbc_service\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_a_jdbc_service\"\u003e\u003c/a\u003e发布JDBC服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e类似其他类型的服务，发布JDBC服务需要2步：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/JDBCDataSource.html\"\u003eJDBCDataSource\u003c/a\u003e\u003c/code\u003e 创建record\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e推送record\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = JDBCDataSource.createRecord(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;url\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some jdbc url\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 服务地址\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 元数据\u003c/span\u003e\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e因为JDBC数据源可以使用很多数据库，并且访问方式经常不一样，所以服务记录是没有标准结构定义的，\u003ccode\u003elocation\u003c/code\u003e 是访问数据库配置而提供的一个通用JSONObject属性，用于访问数据源(JDBC url，username\u0026#8230;\u0026#8203;)。其他字段的定义依赖于数据库以及所用连接池决定。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_a_jdbc_service\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_a_jdbc_service\"\u003e\u003c/a\u003e消费一个JDBC服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e由前所述，如何获取数据源取决于数据源本身。要创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/jdbc/JDBCClient.html\"\u003eJDBCClient\u003c/a\u003e\u003c/code\u003e ，你可以同时提供：\u003ccode\u003erecord location\u003c/code\u003e，元数据和一个有消费方提供的一个Json object：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e),\n    ar -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n        ServiceReference reference = discovery.getReferenceWithConfiguration(\n            ar.result(), \u003cspan class=\"hljs-comment\"\u003e// record\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;clement\u0026quot;\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;password\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;*****\u0026quot;\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// 一些额外的元数据\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e// 获取service object\u003c/span\u003e\n        JDBCClient client = reference.getAs(JDBCClient.class);\n\n        \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e// 完毕\u003c/span\u003e\n        reference.release();\n      }\n    });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/jdbc/JDBCClient.html\"\u003eJDBCClient\u003c/a\u003e\u003c/code\u003e 通过一次调用来发现和获取服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eJDBCDataSource.\u0026lt;JsonObject\u0026gt;getJDBCClient(discovery,\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e),\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;clement\u0026quot;\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;password\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;*****\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 一些额外的元数据\u003c/span\u003e\n    ar -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n        JDBCClient client = ar.result();\n\n        \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n        ServiceDiscovery.releaseServiceObject(discovery, client);\n\n      }\n    });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_redis_data_source\"\u003e\u003ca class=\"anchor\" href=\"#_redis_data_source\"\u003e\u003c/a\u003eRedis 数据源\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRedis数据源是Redis持久性数据库的一种特殊实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRedis数据源客户端是 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/redis/client/Redis.html\"\u003eRedis\u003c/a\u003e\u003c/code\u003e 类\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_a_redis_service\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_a_redis_service\"\u003e\u003c/a\u003e发布Redis服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e发布Redis服务需要2步：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html\"\u003eRedisDataSource\u003c/a\u003e\u003c/code\u003e 创建服务记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e推送record\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = RedisDataSource.createRecord(\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-redis-data-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;url\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 服务地址\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 一些元数据\u003c/span\u003e\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003elocation\u003c/code\u003e 是一个简单的JSON对象，应提供用于访问Redis数据源的字段(url,port\u0026#8230;\u0026#8203;.)\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_a_redis_service\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_a_redis_service\"\u003e\u003c/a\u003e消费Redis服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e由前所述，如何访问数据源决定于数据源本身。创建一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/redis/client/Redis.html\"\u003eRedis\u003c/a\u003e\u003c/code\u003e 对象，你可以同时提供：record地址，元数据和由消费方提供的Json object。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-redis-data-source-service\u0026quot;\u003c/span\u003e), ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n      ServiceReference reference = discovery.getReference(ar.result());\n\n      \u003cspan class=\"hljs-comment\"\u003e// 获取服务实例\u003c/span\u003e\n      Redis client = reference.getAs(Redis.class);\n\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 完毕 释放资源\u003c/span\u003e\n      reference.release();\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你也可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/RedisDataSource.html\"\u003eRedisDataSource\u003c/a\u003e\u003c/code\u003e 通过一次调用完成服务发现和获取。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRedisDataSource.getRedisClient(discovery,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-redis-data-source-service\u0026quot;\u003c/span\u003e),\n  ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      Redis client = ar.result();\n\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n      ServiceDiscovery.releaseServiceObject(discovery, client);\n\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_mongo_data_source\"\u003e\u003ca class=\"anchor\" href=\"#_mongo_data_source\"\u003e\u003c/a\u003eMongo数据源\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMongo数据源是MongoDB数据库的专用化实现。\nMongo数据源服务的客户端是 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/mongo/MongoClient.html\"\u003eMongoClient\u003c/a\u003e\u003c/code\u003e 类\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_publishing_a_mongo_service\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_a_mongo_service\"\u003e\u003c/a\u003e发布Mongo服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e发布Mongo服务需要2步：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html\"\u003eMongoDataSource\u003c/a\u003e\u003c/code\u003e 创建服务记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e推送record\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eRecord record = MongoDataSource.createRecord(\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 服务名\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;connection_string\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some mongo connection\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 服务地址\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;some-metadata\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-value\u0026quot;\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 元数据\u003c/span\u003e\n);\n\ndiscovery.publish(record, ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003elocation\u003c/code\u003e 是一个简单的JSON对象，应提供用于访问Mongo数据源的字段(url, port\u0026#8230;\u0026#8203;)\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_consuming_a_mongo_service\"\u003e\u003ca class=\"anchor\" href=\"#_consuming_a_mongo_service\"\u003e\u003c/a\u003e消费Mongo服务\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e由前所述，如何访问数据源取决于数据源本身。创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/mongo/MongoClient.html\"\u003eMongoClient\u003c/a\u003e\u003c/code\u003e ，你可以同时提供：\u003ccode\u003erecord location\u003c/code\u003e ,元数据和consumer提供的json object：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ediscovery.getRecord(\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e),\n  ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded() \u0026amp;\u0026amp; ar.result() != \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 获取服务引用\u003c/span\u003e\n      ServiceReference reference = discovery.getReferenceWithConfiguration(\n        ar.result(), \u003cspan class=\"hljs-comment\"\u003e// record\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;clement\u0026quot;\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;password\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;*****\u0026quot;\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// 额外的元数据\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 获取服务对象\u003c/span\u003e\n      MongoClient client = reference.get();\n\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 完毕 释放资源\u003c/span\u003e\n      reference.release();\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你也可以用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/types/MongoDataSource.html\"\u003eMongoDataSource\u003c/a\u003e\u003c/code\u003e 类通过一次调用来完成服务查找和获取：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eMongoDataSource.\u0026lt;JsonObject\u0026gt;getMongoClient(discovery,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;some-data-source-service\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;clement\u0026quot;\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;password\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;*****\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 一些额外的元数据\u003c/span\u003e\n  ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      MongoClient client = ar.result();\n\n      \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 不要忘记释放服务资源\u003c/span\u003e\n      ServiceDiscovery.releaseServiceObject(discovery, client);\n\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_listening_for_service_arrivals_and_departures\"\u003e\u003ca class=\"anchor\" href=\"#_listening_for_service_arrivals_and_departures\"\u003e\u003c/a\u003e监听服务的注册和注销\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e每当服务提供方被发布或移除， \u003cem\u003evertx.discovery.announce\u003c/em\u003e 地址上会推送一个事件。\n这个地址可以在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html\"\u003eServiceDiscoveryOptions\u003c/a\u003e\u003c/code\u003e 配置\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e收到的record会有一个 \u003ccode\u003estatus\u003c/code\u003e 字段，它描述了record的新状态：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eUP\u003c/code\u003e : 服务可获取，您可以开启并使用它\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eDOWN\u003c/code\u003e : 服务不可获取，你不应该再使用它\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eOUT_OF_SERVICE\u003c/code\u003e : 服务不在运行状态，你不该再用它，但是可能过一会可能会恢复\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_listening_for_service_usage\"\u003e\u003ca class=\"anchor\" href=\"#_listening_for_service_usage\"\u003e\u003c/a\u003e监听服务使用状况\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e每当获取或释放服务引用时 \u003cem\u003evertx.discovery.usage\u003c/em\u003e 地址上会推送一个event。这个地址可以由 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html\"\u003eServiceDiscoveryOptions\u003c/a\u003e\u003c/code\u003e 配置。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这会让您监听服务的使用情况并映射服务的绑定情况。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e收到的消息是一个包含如下信息的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/json/JsonObject.html\"\u003eJsonObject\u003c/a\u003e\u003c/code\u003e ：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003erecord\u003c/code\u003e 属性指服务记录对象\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e 属性是事件的类型，它有两个值：\u003ccode\u003ebind\u003c/code\u003e ，\u003ccode\u003erelease\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eid\u003c/code\u003e 属性是服务发现的id（名称或者node id）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个 \u003ccode\u003eid\u003c/code\u003e 可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html\"\u003eServiceDiscoveryOptions\u003c/a\u003e\u003c/code\u003e 配置。默认情况下 单节点是\"localhost\"，集群模式下是node id。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你可以禁用服务使用情况的功能，这可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscoveryOptions.html#setUsageAddress-java.lang.String-\"\u003esetUsageAddress\u003c/a\u003e\u003c/code\u003e 设置 \u003ccode\u003eusage address\u003c/code\u003e 为 \u003ccode\u003enull\u003c/code\u003e 来实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_service_discovery_bridges\"\u003e\u003ca class=\"anchor\" href=\"#_service_discovery_bridges\"\u003e\u003c/a\u003e服务发现桥接器\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e桥接器 可以让你从其他服务发现机制(Docker，Kubernetes，Consul\u0026#8230;\u0026#8203;)里导入导出服务\n每个桥接器决定了服务如何导入导出。这不一定是双向操作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以实现 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html\"\u003eServiceImporter\u003c/a\u003e\u003c/code\u003e 接口，并用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/ServiceDiscovery.html#registerServiceImporter-io.vertx.servicediscovery.spi.ServiceImporter-io.vertx.core.json.JsonObject-\"\u003eregisterServiceImporter\u003c/a\u003e\u003c/code\u003e 来注册的方式，为自己提供桥接器。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e第二个参数是可选的，它可以配置桥接器。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当桥接器被注册时，\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html#start-io.vertx.core.Vertx-io.vertx.servicediscovery.spi.ServicePublisher-io.vertx.core.json.JsonObject-io.vertx.core.Promise-\"\u003estart\u003c/a\u003e\u003c/code\u003e 函数被调用。\n它让您可以配置桥接器。当桥接器被配置时，准备就绪并导入/导出初始服务后，它让给定的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/Future.html\"\u003eFuture\u003c/a\u003e\u003c/code\u003e 处于 \u003ccode\u003ecompleted\u003c/code\u003e 状态；如果bridge starts函数正在阻塞，则它必须使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/Vertx.html#executeBlocking-io.vertx.core.Handler-boolean-io.vertx.core.Handler-\"\u003eexecuteBlocking\u003c/a\u003e\u003c/code\u003e 构造，并设置给定的future对象为 \u003ccode\u003ecompleted\u003c/code\u003e 状态。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当服务发现组件停止，桥接器也随即停止。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceImporter.html#close-io.vertx.core.Handler-\"\u003eclose\u003c/a\u003e\u003c/code\u003e 函数会清除资源，移除已经导入/导出的服务。这个函数必须设置返回的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/Future.html\"\u003eFuture\u003c/a\u003e\u003c/code\u003e 对象为 \u003ccode\u003ecompleted\u003c/code\u003e 状态,目的在于提醒调用者处理完成事件。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：在集群当中，只需要注册服务记录当中一个成员的桥接器即可，因为所有的服务记录都是互通的。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_additional_bridges\"\u003e\u003ca class=\"anchor\" href=\"#_additional_bridges\"\u003e\u003c/a\u003e其他的桥接器支持\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x 服务发现组件除了支持桥接器机制以外，还提供了一些现成的桥接器。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_consul_bridge\"\u003e\u003ca class=\"anchor\" href=\"#_consul_bridge\"\u003e\u003c/a\u003eConsul 网桥\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConsul服务发现网桥从 \u003ca href=\"http://consul.io\"\u003eConsul\u003c/a\u003e 导入服务到Vert.x服务发现。这个网桥链接了 Consul agent 服务 并周期性扫描以下服务：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e新导入的服务\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e移除 处于 \u003ccode\u003emaintenance\u003c/code\u003e 模式的服务或已经从consul中被移除的服务\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个桥接器使用的是 Consul 的HTTP API接口。它不能将服务导出到Consul，并且也不支持服务的修改。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务的类型是通过 \u003ccode\u003etags\u003c/code\u003e 推断出来的，如果有一个 \u003ccode\u003etag\u003c/code\u003e 和已知的服务类型一样，那么就使用这种服务类型，如果没有匹配的，那么服务导入后将标记为unknown类型。目前暂时只支持http-endpoint类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_the_bridge\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_bridge\"\u003e\u003c/a\u003e桥接器的使用\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (\u003ccode\u003epom.xml\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-discovery-bridge-consul\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (\u003ccode\u003ebuild.gradle\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-discovery-bridge-consul:4.0.2\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e然后，在创建服务发现对象的时候，像下面这样注册桥接器：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceDiscovery.create(vertx)\n    .registerServiceImporter(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ConsulServiceImporter(),\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n            .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;host\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e)\n            .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;port\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8500\u003c/span\u003e)\n            .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;scan-period\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e你可以做一些配置：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehost\u003c/code\u003e 属性，配置 agent 的地址，默认是 \u003ccode\u003elocalhost\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eport\u003c/code\u003e 属性，配置 agent 的端口，默认的端口是 8500\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eacl_token\u003c/code\u003e 属性，配置 agent 的访问控制令牌，默认值是 null\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003escan-period\u003c/code\u003e 属性，配置扫描的频率，扫描的单位是毫秒（ms），默认是 2000 ms\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_kubernetes_bridge\"\u003e\u003ca class=\"anchor\" href=\"#_kubernetes_bridge\"\u003e\u003c/a\u003eKubernetes 桥接器\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eKubernetes 桥接器可以从Kubernetes（或者 Openshift v3）中导入服务到Vert.x的服务发现组件中。\nKubernetes的所有服务，都将映射为一条 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e ，目前桥接器只支持将服务从Kubernetes中导入到Vert.x中（反过来不行）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eKubernetes中的服务，在导入到Vert.x后都会创建对应的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/Record.html\"\u003eRecord\u003c/a\u003e\u003c/code\u003e ，服务类型是通过 \u003ccode\u003eservice-type\u003c/code\u003e 标签推断出来，或者通过服务暴露的端口推断出来。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_the_bridge_2\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_bridge_2\"\u003e\u003c/a\u003e桥接器的使用\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (\u003ccode\u003epom.xml\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-discovery-bridge-kubernetes\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle ( \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-discovery-bridge-kubernetes:4.0.2\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_configuring_the_bridge\"\u003e\u003ca class=\"anchor\" href=\"#_configuring_the_bridge\"\u003e\u003c/a\u003e桥接器的配置\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e桥接器的配置项有：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eOAuth token（默认是使用 \u003ccode\u003e/var/run/secrets/kubernetes.io/serviceaccount/token\u003c/code\u003e 中的内容）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务搜索的命名空间（默认是`default`）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e请注意，应用程序必须能够访问 Kubernetes 并且能够读取所选择的命名空间。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_the_service_to_record_mapping\"\u003e\u003ca class=\"anchor\" href=\"#_the_service_to_record_mapping\"\u003e\u003c/a\u003e服务记录的映射\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务记录按照如下的步骤进行创建：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e从 \u003ccode\u003eservice.type\u003c/code\u003e 中推断出服务类型；如果没有设置，那么服务类型被设置为 \u003ccode\u003eunknown\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务记录的名称就是服务的名称\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务的标签（label）都被映射为服务记录的元数据\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e此外还会加上：\u003ccode\u003ekubernetes.uuid\u003c/code\u003e , \u003ccode\u003ekubernetes.namespace\u003c/code\u003e , \u003ccode\u003ekubernetes.name\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elocation\u003c/code\u003e 信息将从服务的第一个端口推断出来\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e对于 HTTP 端点，如果服务带有值为 \u003ccode\u003etrue\u003c/code\u003e 的 \u003ccode\u003essl\u003c/code\u003e (\u003ccode\u003ehttps\u003c/code\u003e) 标签的话，那么服务记录的 \u003ccode\u003essl\u003c/code\u003e (\u003ccode\u003ehttps\u003c/code\u003e)属性将被设置为 \u003ccode\u003etrue\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_dynamics\"\u003e\u003ca class=\"anchor\" href=\"#_dynamics\"\u003e\u003c/a\u003e动态性\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eKubernetes 桥接器将会在启动(\u003ccode\u003estart\u003c/code\u003e)的时候导入所有的服务，在停止(\u003ccode\u003estop\u003c/code\u003e)的时候移除所有的服务。在运行期间，它将监听 Kubernetes 的服务，并且动态地导入新加入的服务，移除被删除的服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_supported_types\"\u003e\u003ca class=\"anchor\" href=\"#_supported_types\"\u003e\u003c/a\u003e支持的类型\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e桥接器使用 \u003ccode\u003eservice-type\u003c/code\u003e 标签来指定类型。另外，它还检查服务的端口，支持如下：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e80，443，8080-9000： HTTP端点\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e5432，5433：JDBC数据源（PostGreSQL）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e3306，13306：JDBC数据源（MySql）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e6379: Redis 数据源\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eports 27017, 27018 和 27019: MongoDB 数据源\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 \u003ccode\u003eservice-type\u003c/code\u003e 存在，那么将覆盖端口的默认配置\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUnresolved directive in index.adoc - include::zookeeper-bridge.adoc[]\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_docker_links_bridge\"\u003e\u003ca class=\"anchor\" href=\"#_docker_links_bridge\"\u003e\u003c/a\u003eDocker Links 桥接器\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDocker Links 桥接器可以从 Docker Links 中导入服务到 Vert.x 的服务发现组件中。当你将一个Docker容器与另外一个Docker容器链接在一起(link)的时候，Docker将会注入一组环境变量。该桥接器将分析这些环境变量，并且针对每个链接(link)，生成一个服务记录。服务记录的类型从 \u003ccode\u003eservice.type\u003c/code\u003e 属性中推断；如果没有设置，那么服务类型将被设置为 \u003ccode\u003eunknown\u003c/code\u003e 。目前暂时只支持 \u003ccode\u003ehttp-endpoint\u003c/code\u003e 服务类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e由于Docker容器只在启动的时候创建链接，所以这个桥接器只会在启动的时候导入服务记录，然后此后就都不改变了。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_the_bridge_3\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_bridge_3\"\u003e\u003c/a\u003e桥接器的使用\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用该服务发现桥接器，需要将如下的依赖包加入到依赖配置文件中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (\u003ccode\u003epom.xml\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-discovery-bridge-docker\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle ( \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-discovery-bridge-docker:4.0.2\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e创建服务发现对象时，注册桥接器的示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceDiscovery.create(vertx)\n    .registerServiceImporter(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e DockerLinksServiceImporter(), \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject());\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这种桥接器不需要进一步的配置。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_additional_backends\"\u003e\u003ca class=\"anchor\" href=\"#_additional_backends\"\u003e\u003c/a\u003e其他的后台支持\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e除了此库支持的后台之外，Vert.x服务发现还提供了其他后台以供您在自己的应用程序中使用。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_redis_backend\"\u003e\u003ca class=\"anchor\" href=\"#_redis_backend\"\u003e\u003c/a\u003eRedis backend\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务发现组件通过实现 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/servicediscovery/spi/ServiceDiscoveryBackend.html\"\u003eServiceDiscoveryBackend\u003c/a\u003e\u003c/code\u003e SPI提供了一种可插拔的存储后端扩展机制，这是以Redis为基础的SPI的实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_the_redis_backend\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_redis_backend\"\u003e\u003c/a\u003e使用 Redis 存储后端\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用 Redis 存储后端，需要将如下的依赖包加入到依赖配置文件中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven ( \u003ccode\u003epom.xml\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-discovery-backend-redis\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle ( \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-discovery-backend-redis:4.0.2\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e需要注意的是，你只能在 \u003ccode\u003eclasspath\u003c/code\u003e 中指定一个SPI的实现；如果没有指定，那么将使用默认的存储后端。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_configuration\"\u003e\u003c/a\u003e配置\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRedis存储后端是基于 \u003ca href=\"http://vertx.io/docs/vertx-redis-client/java\"\u003evertx-redis-client\u003c/a\u003e 实现的，这个配置是客户端配置以及在Redis上 \u003ccode\u003ekey\u003c/code\u003e 的存储记录\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e下面是一个示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceDiscovery.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceDiscoveryOptions()\n    .setBackendConfiguration(\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n            .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;connectionString\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;redis://localhost:6379\u0026quot;\u003c/span\u003e)\n            .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;key\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;records\u0026quot;\u003c/span\u003e)\n    ));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e值得注意的一点是，配置是在 \u003ccode\u003esetBackendConfiguration\u003c/code\u003e 方法中传入的（如果使用JSON，则传递给 \u003ccode\u003ebackendConfiguration\u003c/code\u003e 对象:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceDiscovery.create(vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceDiscoveryOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;backendConfiguration\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;connectionString\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;redis://localhost:6379\u0026quot;\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;key\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;my-records\u0026quot;\u003c/span\u003e)\n)));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.0.2"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.0.2","vertx-service-discovery","java"]},"buildId":"4ZJENDoVUUSScrN3ohD4w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>