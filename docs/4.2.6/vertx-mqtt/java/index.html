<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>MQTT | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-mqtt" as="fetch" crossorigin="anonymous" class="jsx-d38685edc31911e0"/><meta name="next-head-count" content="14"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-6853d859ade043b9.js" defer=""></script><script src="/_next/static/chunks/framework-01395af778c6fb71.js" defer=""></script><script src="/_next/static/chunks/main-2ea7ab41ab691905.js" defer=""></script><script src="/_next/static/chunks/pages/_app-155bbedc7d6c4b74.js" defer=""></script><script src="/_next/static/chunks/778-5eaf13e353ab0b06.js" defer=""></script><script src="/_next/static/chunks/619-34d9218a66d5b123.js" defer=""></script><script src="/_next/static/chunks/629-5a87bb724d19315e.js" defer=""></script><script src="/_next/static/chunks/923-26bd63943b4b6bb4.js" defer=""></script><script src="/_next/static/chunks/434-be9324d6e5b718aa.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-b6a025bc5d4ae207.js" defer=""></script><script src="/_next/static/spiwwP79yF1AQ-wr254ci/_buildManifest.js" defer=""></script><script src="/_next/static/spiwwP79yF1AQ-wr254ci/_ssgManifest.js" defer=""></script><script src="/_next/static/spiwwP79yF1AQ-wr254ci/_middlewareManifest.js" defer=""></script><style id="__jsx-400ec7965926e858">.dropdown-item.jsx-400ec7965926e858{white-space:nowrap;
line-height:2;
width:100%;
padding:0 1.5rem;
cursor:pointer}
.dropdown-item.jsx-400ec7965926e858:hover{background-color:#e9ecef}
.dropdown-item.active.jsx-400ec7965926e858{font-weight:400;
padding-left:.75rem}
.dropdown-item.has-active-siblings.jsx-400ec7965926e858:not(.active){padding-left:calc(0.75rem + 16px + 0.5em)}
.dropdown-item.jsx-400ec7965926e858 .dropdown-check-icon.jsx-400ec7965926e858{width:16px;
margin-right:.5em;
margin-top:1px}</style><style id="__jsx-6650573c8f14945d">.dropdown.jsx-6650573c8f14945d{position:relative;
display:inline-block}
.dropdown.jsx-6650573c8f14945d .dropdown-title.jsx-6650573c8f14945d{margin-right:0;
cursor:pointer;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d{position:absolute;
background-color:#f8f9fa;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
border-radius:.8rem;
list-style-type:none;
padding:.6666666667rem 0;
margin:.25rem 0 0 0;
z-index:100;
display:none;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a{color:#4d4d4d;
-webkit-text-decoration:none;
text-decoration:none;
font-weight:300}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.align-right.jsx-6650573c8f14945d{right:0}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.visible.jsx-6650573c8f14945d{display:block}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a.jsx-6650573c8f14945d:hover{color:inherit}
.dropdown.jsx-6650573c8f14945d svg{margin-bottom:2px}</style><style id="__jsx-75cbc16d79a176fb">.tooltip.jsx-75cbc16d79a176fb{font-size:.75rem;
color:#4d4d4d;
background-color:#f8f9fa;
border-radius:.4rem;
padding:0 .4rem;
box-shadow:0 0 5px rgba(0, 0, 0, .3);
display:none;
white-space:nowrap;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.tooltip.visible.jsx-75cbc16d79a176fb{display:block}
.tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb, .tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb::before{position:absolute;
width:8px;
height:8px;
z-index:-1}
.tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb::before{content:"";
-webkit-transform:rotate(45deg);
-moz-transform:rotate(45deg);
-ms-transform:rotate(45deg);
transform:rotate(45deg);
background:#f8f9fa;
box-shadow:-2px -2px 2px rgba(0, 0, 0, .1)}
.tooltip[data-popper-placement^=top].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{bottom:-4px}
.tooltip[data-popper-placement^=top].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(225deg);
-moz-transform:rotate(225deg);
-ms-transform:rotate(225deg);
transform:rotate(225deg)}
.tooltip[data-popper-placement^=bottom].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{top:-4px}
.tooltip[data-popper-placement^=left].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{right:-4px}
.tooltip[data-popper-placement^=left].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(135deg);
-moz-transform:rotate(135deg);
-ms-transform:rotate(135deg);
transform:rotate(135deg)}
.tooltip[data-popper-placement^=right].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{left:-4px}
.tooltip[data-popper-placement^=right].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(315deg);
-moz-transform:rotate(315deg);
-ms-transform:rotate(315deg);
transform:rotate(315deg)}</style><style id="__jsx-f705e145f931f504">.navbar{position:absolute;
top:2.75rem;
width:100%}
.navbar a{color:#3c3c3b}
.navbar a.navbar-menu-item, .navbar .dropdown-title{text-transform:uppercase}
.navbar a.navbar-menu-item:hover, .navbar .dropdown-title:hover{-webkit-text-decoration:none;
text-decoration:none;
color:#898987;
-webkit-transition:color .15s ease-in-out;
transition:color .15s ease-in-out}
.navbar .navbar-content{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
position:relative}
.navbar .navbar-content .navbar-logo{-webkit-flex:1;
-ms-flex:1;
flex:1}
.navbar .navbar-content .navbar-logo img{width:8.3rem}
.navbar .navbar-content .navbar-collapse-button{display:none;
cursor:pointer}
@media (max-width:1000px) {.navbar .navbar-content .navbar-collapse-button{display:inline-block}}
.navbar .navbar-content .navbar-collapse-button span{display:block;
width:33px;
height:4px;
margin-bottom:5px;
position:relative;
background:#3c3c3b;
border-radius:3px;
z-index:1;
transform-origin:4px 0;
-webkit-transition:-webkit-transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease;
transition:transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease}
.navbar .navbar-content .navbar-collapse-button span:first-child{transform-origin:0% 0%}
.navbar .navbar-content .navbar-collapse-button span:nth-last-child(2){transform-origin:0% 100%}
.navbar .navbar-content .navbar-right{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline;
margin-bottom:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-right{max-height:0;
-webkit-transition:max-height 200ms ease-in-out;
transition:max-height 200ms ease-in-out;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:absolute;
top:2.75rem;
left:.8rem;
right:.8rem;
background-color:#f8f9fa;
overflow-x:auto;
overflow-y:hidden}}
.navbar .navbar-content .navbar-menu .navbar-menu-item{font-weight:400;
margin-right:2.5rem}
.navbar .navbar-content .navbar-menu .navbar-menu-item.with-drop-down{margin-right:1.8rem}
@media (max-width:1250px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{margin-right:1.5rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{display:block;
margin-bottom:1rem;
font-size:1.2rem}}
.navbar .navbar-content .navbar-menu .navbar-menu-item .external-link-icon{margin-left:.25em}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
padding:1rem}}
.navbar .navbar-content .navbar-social{margin-left:1.6rem;
font-size:.875rem}
.navbar .navbar-content .navbar-social svg{height:16px;
margin-bottom:2px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social svg{height:1rem}}
@media (max-width:1250px) {.navbar .navbar-content .navbar-social{margin-left:1rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social{margin-left:auto;
padding:0 1rem 1rem 0;
font-size:1rem}}
@media (max-width:768px) {.navbar{top:1rem}}
.page .navbar{top:0;
padding-top:1.5rem;
padding-bottom:1rem;
position:fixed;
background-color:#fff;
z-index:2}</style><style id="__jsx-bf3edc7191e82cb">.search{position:relative}
.search input{color:#adb5bd;
border:1px solid #dee2e6;
border-radius:.4rem;
font-size:.875rem;
padding:.25rem 1.8rem .35rem 1.8rem;
width:100%;
-webkit-transition:color .15s ease-in-out, border-color .15s ease-in-out;
transition:color .15s ease-in-out, border-color .15s ease-in-out;
background-color:transparent}
.search input:focus{border-color:#adb5bd;
color:#3c3c3b}
.search .autosuggest{position:absolute;
top:0;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none;
z-index:-100;
opacity:.5}
.search .search-icon, .search .search-icon-delete{position:absolute;
top:.55rem;
height:1rem;
stroke:#adb5bd;
-webkit-transition:stroke .15s ease-in-out;
transition:stroke .15s ease-in-out}
.search .search-icon{left:.4rem}
.search input:focus+.search-icon{stroke:#6f6970}
.search .search-icon-delete{stroke:#6f6970;
right:.4rem;
height:.75rem;
top:.7rem;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out;
cursor:text}
.search.has-content .search-icon-delete{opacity:1;
cursor:pointer}</style><style id="__jsx-9ece789f808ef724">.search-results, .search-results-none{font-size:.875rem;
overflow:auto;
list-style-type:none;
padding-left:0;
display:none}
.search-results.visible, .search-results-none.visible{display:block}
.search-results{list-style-type:none;
padding:0;
margin-bottom:0}
.search-results li{display:block;
padding:.5rem;
margin-bottom:1rem;
border-radius:.4rem;
border:1px solid transparent;
cursor:pointer;
max-width:17rem;
overflow-x:hidden}
.search-results li.active{background-color:#f8f9fa;
border:1px solid #e9ecef}
.search-results li h5{margin:0 0 .5rem 0;
font-size:1em}
.search-results li .search-results-highlight{background-color:#ff0}
.search-results-none{padding:1rem .5rem;
text-align:center;
width:100%}</style><style id="__jsx-d1843944f2d67b">.search-panel{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:relative}</style><style id="__jsx-d38685edc31911e0">.github-stars.jsx-d38685edc31911e0{display:inline-block}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0{margin-right:.25em}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0 svg{height:1rem}</style><style id="__jsx-aeedcf66895f49d7">footer{font-size:.875rem;
padding-top:3rem;
padding-bottom:4rem;
background-color:#f8f9fa;
border-top:1px solid #dee2e6;
margin-top:1rem;
color:#6f6970}
footer h5{font-size:1rem;
margin-top:0;
margin-bottom:1rem;
color:#3c3c3b;
text-transform:uppercase}
footer ul{padding:0;
list-style:none;
line-height:2}
footer a{color:#6f6970}
footer .footer-logo img, footer .footer-copyright-eclipse-logo img{-webkit-filter:grayscale(100);
filter:grayscale(100);
opacity:.5;
-webkit-transition:all .15s ease-in-out;
transition:all .15s ease-in-out}
footer .footer-logo img:hover, footer .footer-copyright-eclipse-logo img:hover{-webkit-filter:grayscale(0);
filter:grayscale(0);
opacity:1}
footer .footer-nav-section{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
margin-bottom:6rem}
footer .footer-nav-section .footer-logo{margin-top:.4rem}
footer .footer-nav-section .footer-logo img{width:8.3rem}
footer .footer-nav-section .footer-nav-list{width:20%}
footer .footer-copyright{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
footer .footer-copyright a{white-space:nowrap}
footer .footer-copyright .footer-copyright-eclipse-logo{width:17%;
margin-bottom:.5rem}
@media (max-width:1250px) {footer .footer-copyright .footer-copyright-break{display:none}
footer .footer-copyright .footer-copyright-eclipse-logo{width:30%}}
@media (max-width:1000px) {footer .footer-nav-section .footer-nav-list{width:25%}
footer .footer-copyright .footer-copyright-break{display:inline-block}
footer .footer-copyright .footer-copyright-eclipse-logo{width:40%}}
@media (max-width:768px) {footer .footer-nav-section{max-width:100%;
margin-left:auto;
margin-right:auto}}
@media (max-width:640px) {footer .footer-nav-section{max-width:80%;
margin-bottom:3rem;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
footer .footer-nav-section h5{cursor:pointer}
footer .footer-nav-section h5::after{display:inline-block;
content:"";
border-top:.4em solid;
border-right:.4em solid transparent;
border-bottom:0;
border-left:.4em solid transparent;
position:absolute;
top:.75rem;
right:0}
footer .footer-nav-section .footer-nav-list{width:100%;
position:relative}
footer .footer-nav-section .footer-nav-list ul{overflow-y:hidden;
max-height:0;
-webkit-transition:all 200ms ease-in-out;
transition:all 200ms ease-in-out}
footer .footer-nav-section .footer-nav-list ul.visible{margin-bottom:2rem}
footer .footer-nav-section .footer-logo{margin:0 auto 3rem auto;
width:auto}
footer .footer-copyright{max-width:80%;
text-align:center;
margin-left:auto;
margin-right:auto;
-webkit-flex-direction:column-reverse;
-ms-flex-direction:column-reverse;
flex-direction:column-reverse}
footer .footer-copyright .footer-copyright-eclipse-logo{width:7.6rem;
margin-bottom:1rem}}</style><style id="__jsx-efcc50be384cabc7">.page-content{margin-top:6em;
margin-bottom:8rem}
.docs .docs-content .docs-content-wrapper{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between}
.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 17rem;
-ms-flex:0 0 17rem;
flex:0 0 17rem}
.docs .docs-content .docs-content-wrapper aside .docs-content-wrapper-sidebar{position:-webkit-sticky;
position:sticky;
top:7em}
.docs .docs-content .docs-content-wrapper aside .search-panel{margin-top:1rem;
width:100%}
.docs .docs-content .docs-content-wrapper aside .search-panel .search-results{max-height:calc(100vh - 10rem - 1px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc{margin-top:1rem;
overflow-y:auto;
max-height:calc(100vh - 10rem - 3px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc #toctitle{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul{margin-top:0;
padding-left:0;
list-style-type:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul.sectlevel2{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul li{padding:.3333333333rem 0}
.docs .docs-content .docs-content-wrapper aside.docs-has-search-results .docs-content-toc{display:none}
@media (max-width:1250px) {.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 15rem;
-ms-flex:0 0 15rem;
flex:0 0 15rem}}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper aside{z-index:1;
position:fixed;
top:0;
right:0;
width:25rem;
height:100vh;
max-width:100%;
padding-top:6rem;
padding-left:2rem;
padding-right:2rem;
background-color:#fff;
border-left:1px solid #dee2e6;
-webkit-transform:translateX(100%);
-moz-transform:translateX(100%);
-ms-transform:translateX(100%);
transform:translateX(100%);
-webkit-transition:-webkit-transform 200ms ease-in-out;
transition:transform 200ms ease-in-out;
will-change:transform}
.docs .docs-content .docs-content-wrapper aside.collapse{-webkit-transform:translateX(0%);
-moz-transform:translateX(0%);
-ms-transform:translateX(0%);
transform:translateX(0%)}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper aside{min-width:100%;
border-left:none}}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{z-index:1000;
cursor:pointer;
display:none;
position:fixed;
-webkit-justify-content:center;
justify-content:center;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
right:2rem;
bottom:2rem;
color:#fff;
background-color:#4d4d4d;
padding:.5rem;
border-radius:.8rem;
-webkit-transition:background-color .15s ease-in-out;
transition:background-color .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-list, .docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{display:block}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{position:absolute;
left:0;
top:0;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle:hover{background-color:#3c3c3b}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-list{opacity:0}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-x{opacity:1}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{right:1rem;
bottom:1rem}}
.docs .docs-content .docs-content-inner{max-width:calc(100% - 19.5rem);
overflow:hidden}
.docs .docs-content .docs-content-inner .docs-content-metadata{margin-top:1.2rem;
margin-bottom:1.2rem;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
flex-wrap:wrap;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-repo{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-flex:1;
-ms-flex:1;
flex:1}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*{margin-right:2rem}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*:last-child{margin-right:0}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
color:#6f6970;
white-space:nowrap}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a:hover{color:#782b90}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a .feather{margin-right:.25em;
height:1rem}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{flex-wrap:wrap;
margin-bottom:1rem}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-flex:1;
-ms-flex:1;
flex:1;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
@media (min-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-box-pack:end;
-ms-flex-pack:end;
-webkit-justify-content:flex-end;
justify-content:flex-end}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:16px;
margin-bottom:-2px}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:1rem;
margin-bottom:-1px}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a{-webkit-text-decoration:none;
text-decoration:none}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a:hover{color:#6f6970}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-label{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-left:2rem}
.docs .docs-content .docs-content-inner h1{padding-top:0;
margin-top:.6rem;
line-height:1.2}
.docs .docs-content .docs-content-inner h1::after{content:"";
width:30%;
display:block;
border:2px solid #782b90;
border-radius:2px;
margin-top:1.1rem}
.docs .docs-content .docs-content-inner .ulist>ul{padding-left:1.1rem}
.docs .docs-content .docs-content-inner h2{border-top:1px solid #dee2e6;
margin-top:5rem;
padding-top:2rem}
.docs .docs-content .docs-content-inner h3, .docs .docs-content .docs-content-inner h4{margin-top:3rem}
@media (max-width:1250px) {.docs .docs-content .docs-content-inner{max-width:calc(100% - 17.5rem)}}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner{max-width:100%}}
.docs .docs-content .admonitionblock{border-top-right-radius:.8rem;
border-bottom-right-radius:.8rem;
background-color:#f8f9fa;
padding:1rem;
margin:1.5rem 0;
border-left:9px solid transparent}
.docs .docs-content .admonitionblock.note, .docs .docs-content .admonitionblock.tip{border-color:#6cb9f0}
.docs .docs-content .admonitionblock.important, .docs .docs-content .admonitionblock.warning, .docs .docs-content .admonitionblock.caution{border-color:#f0a46c}
.docs .docs-content .admonitionblock tr{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.docs .docs-content .admonitionblock .title{font-weight:400}
.docs .docs-content .admonitionblock .title::after{content:":"}
.docs .docs-content dt{font-weight:400}
.docs .docs-content .anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.docs .docs-content .anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.docs .docs-content .anchor:hover{opacity:1}
.docs .docs-content h2:hover .anchor, .docs .docs-content h3:hover .anchor, .docs .docs-content h4:hover .anchor, .docs .docs-content h5:hover .anchor, .docs .docs-content h6:hover .anchor{opacity:1}
.docs .docs-content h1 .anchor{display:none}
.docs .docs-content h4 .anchor::after, .docs .docs-content h5 .anchor::after, .docs .docs-content h6 .anchor::after{padding-right:.6rem}</style><style id="__jsx-7824b3ad3820c879">html{line-height:1.15;
-webkit-text-size-adjust:100%}
body{margin:0}
main{display:block}
h1{font-size:2em;
margin:.67em 0}
hr{box-sizing:content-box;
height:0;
overflow:visible}
pre{font-family:monospace, monospace;
font-size:1em}
a{background-color:transparent}
abbr[title]{border-bottom:none;
text-decoration:underline;
text-decoration:underline dotted}
b, strong{font-weight:bolder}
code, kbd, samp{font-family:monospace, monospace;
font-size:1em}
small{font-size:80%}
sub, sup{font-size:75%;
line-height:0;
position:relative;
vertical-align:baseline}
sub{bottom:-0.25em}
sup{top:-0.5em}
img{border-style:none}
button, input, optgroup, select, textarea{font-family:inherit;
font-size:100%;
line-height:1.15;
margin:0}
button, input{overflow:visible}
button, select{text-transform:none}
button, [type=button], [type=reset], [type=submit]{-webkit-appearance:button}
button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner{border-style:none;
padding:0}
button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring{outline:1px dotted ButtonText}
fieldset{padding:.35em .75em .625em}
legend{box-sizing:border-box;
color:inherit;
display:table;
max-width:100%;
padding:0;
white-space:normal}
progress{vertical-align:baseline}
textarea{overflow:auto}
[type=checkbox], [type=radio]{box-sizing:border-box;
padding:0}
[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button{height:auto}
[type=search]{-webkit-appearance:textfield;
outline-offset:-2px}
[type=search]::-webkit-search-decoration{-webkit-appearance:none}
::-webkit-file-upload-button{-webkit-appearance:button;
font:inherit}
details{display:block}
summary{display:list-item}
template{display:none}
[hidden]{display:none}
.hljs, pre{display:block;
overflow-x:auto;
padding:.5em;
background:#3a2840;
color:#fff}
.hljs.language-shell :not(.bash)+.bash, .hljs.language-better-shell :not(.bash)+.bash, pre.language-shell :not(.bash)+.bash, pre.language-better-shell :not(.bash)+.bash{color:#d2a8e0}
pre{border-radius:.8rem;
padding:1rem;
font-size:.875rem;
margin:1.5rem 0}
.hljs-keyword, .hljs-selector-tag, .hljs-tag{color:#d2a8e0}
.hljs-template-tag{color:red}
.hljs-number{color:#6cb9f0}
.hljs-variable, .hljs-template-variable, .hljs-attribute, .hljs-literal{color:#c9e5f9}
.hljs-subst{color:red}
.hljs-title, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-section, .hljs-type{color:#f0a46c}
.hljs-symbol, .hljs-bullet, .hljs-link{color:#d2a8e0}
.hljs-deletion, .hljs-string, .hljs-built_in, .hljs-builtin-name{color:#6cb9f0}
.hljs-addition, .hljs-comment, .hljs-quote, .hljs-meta{color:#adb5bd}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:bold}
#nprogress{pointer-events:none}
#nprogress .bar{background:#29d;
position:fixed;
z-index:1031;
top:0;
left:0;
width:100%;
height:2px}
#nprogress .peg{display:block;
position:absolute;
right:0px;
width:100px;
height:100%;
box-shadow:0 0 10px #29d, 0 0 5px #29d;
opacity:1;
-webkit-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
-webkit-transform:rotate(3deg) translate(0px, -4px);
-moz-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
transform:rotate(3deg) translate(0px, -4px)}
#nprogress .spinner{display:block;
position:fixed;
z-index:1031;
top:15px;
right:15px}
#nprogress .spinner-icon{width:18px;
height:18px;
box-sizing:border-box;
border:solid 2px transparent;
border-top-color:#29d;
border-left-color:#29d;
border-radius:50%;
-webkit-animation:nprogress-spinner 400ms linear infinite;
-webkit-animation:nprogress-spinner 400ms linear infinite;
animation:nprogress-spinner 400ms linear infinite}
.nprogress-custom-parent{overflow:hidden;
position:relative}
.nprogress-custom-parent #nprogress .spinner, .nprogress-custom-parent #nprogress .bar{position:absolute}
@keyframes nprogress-spinner {0% {-webkit-transform:rotate(0deg)}100% {-webkit-transform:rotate(360deg)}}
@keyframes nprogress-spinner {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}
#nprogress .bar{background:#782b90}
#nprogress .peg{box-shadow:0 0 10px #782b90, 0 0 5px #782b90}
#nprogress .spinner-icon{border-top-color:#782b90;
border-left-color:#782b90}
html{box-sizing:border-box}
*, *::before, *::after{box-sizing:inherit}
:root{font-size:18px}
@media (max-width:1000px) {:root{font-size:17.1px}}
@media (max-width:768px) {:root{font-size:16.2px}}
@media (max-width:640px) {:root{font-size:15.3px}}
body, input{font-family:Roboto, sans-serif;
font-weight:300;
line-height:1.7;
color:#3c3c3b}
input{outline:none}
h1, h2, h3, h4, h5, h6{font-weight:400}
h1{font-size:2.5rem}
h2{font-size:2rem}
h3{font-size:1.75rem}
h4{font-size:1.5rem}
h5{font-size:1.25rem}
h6{font-size:1.1rem}
.container{width:100%;
padding-right:.8rem;
padding-left:.8rem;
margin-right:auto;
margin-left:auto}
@media (min-width:640px) {.container{max-width:620px}}
@media (min-width:768px) {.container{max-width:738px}}
@media (min-width:1000px) {.container{max-width:950px}}
@media (min-width:1250px) {.container{max-width:1180px}}
@media (min-width:1250px) {.container-narrow{max-width:950px}}
.img-fluid{max-width:100%}
a{-webkit-text-decoration:none;
text-decoration:none;
color:#782b90}
a:hover{text-decoration:underline;
color:#571f69}
img{vertical-align:middle}
svg{overflow:hidden;
vertical-align:middle}
code, pre{font-family:"Roboto Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
p code{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
max-width:100%;
overflow:auto}
.heading-anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.heading-anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.heading-anchor:hover{opacity:1}
h2:hover .heading-anchor, h3:hover .heading-anchor, h4:hover .heading-anchor, h5:hover .heading-anchor, h6:hover .heading-anchor{opacity:1}
h1 .heading-anchor{display:none}
h4 .heading-anchor::after, h5 .heading-anchor::after, h6 .heading-anchor::after{padding-right:.6rem}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400&display=swap">@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZKCA.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-59Y.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCkYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCAYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCgYb9lecyVC4A.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCcYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCsYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCoYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCQYb9lecyU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19-7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19a7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1967DQk6YvNkeg.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19G7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1927DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19y7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19K7DQk6YvM.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body data-build-time="2022-04-15T02:04:24.249Z" data-build-commit-id="766c4adff79746caf4f6fe1119ef754bbd583d9a" data-build-run-id="2170551511"><div id="__next" data-reactroot=""><main class="jsx-efcc50be384cabc7 page docs"><header><div class="jsx-f705e145f931f504 navbar"><div class="jsx-f705e145f931f504 navbar-content container"><div class="jsx-f705e145f931f504 navbar-logo"><a class="jsx-f705e145f931f504" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-f705e145f931f504"/></a></div><div class="jsx-f705e145f931f504 navbar-collapse-button"><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span></div><div class="jsx-f705e145f931f504 navbar-right"><div class="jsx-f705e145f931f504 navbar-menu"><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/introduction-to-vertx-and-reactive/"><li class="jsx-400ec7965926e858 dropdown-item">简介</li></a><a class="jsx-f705e145f931f504" href="/get-started/"><li class="jsx-400ec7965926e858 dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/docs/">文档</a><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/faq/"><li class="jsx-400ec7965926e858 dropdown-item">答疑</li></a><a class="jsx-f705e145f931f504" href="/channels/"><li class="jsx-400ec7965926e858 dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/advanced-vertx-guide" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">Advanced Vert.x Guide <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/blog/">博客</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/community/">社区</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/translation/">翻译团队</a></div><div class="jsx-f705e145f931f504 navbar-social"><span class="jsx-75cbc16d79a176fb "><a href="https://github.com/vert-x3/vertx-awesome" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title></title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Awesome Vert.x<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://stackoverflow.com/questions/tagged/vert.x" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title></title><path d="M15.725 0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725 0zm-3.94 3.418l-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465l-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86l-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Stack Overflow<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title></title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">YouTube<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://discord.gg/KzEMwP2" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title></title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Discord<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title></title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x User Group<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://qm.qq.com/cgi-bin/qm/qr?k=QFrKfwIVTuShDdh7puvfJWjqOx4C014c&amp;jump_from=webapi" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x中国用户组QQ群<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://qun.qq.com/qqweb/qunpro/share?_wv=3&amp;_wwv=128&amp;inviteCode=1reLvB&amp;from=246610&amp;biz=ka" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 200 200" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M13 73L16 49L52 49L58 14L82 14L77 49L135 49L141 14L166 14L160 49L195 49L192 73L157 73L148 124L184 124L181 149L144 149L137 193L90 149L61 149L55 185L31 185L36 149L0 149L6 124L100 124L120 144L131 75L72 75L64 124L40 124L48 73Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x中国用户组QQ频道<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div></div></div></div></div></header><div class="jsx-efcc50be384cabc7 page-content docs-content"><div class="jsx-efcc50be384cabc7 container"><div class="jsx-efcc50be384cabc7 docs-content-wrapper"><aside class="jsx-efcc50be384cabc7 "><div class="jsx-efcc50be384cabc7 docs-content-wrapper-sidebar"><div class="jsx-d1843944f2d67b search-panel"><div class="jsx-bf3edc7191e82cb search"><input type="text" disabled="" class="jsx-bf3edc7191e82cb autosuggest"/><input type="text" placeholder="Search..." value="" class="jsx-bf3edc7191e82cb"/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="jsx-9ece789f808ef724 search-results"></ul><div class="jsx-9ece789f808ef724 search-results-none">No results.</div></div><div class="jsx-efcc50be384cabc7 docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_vert_x_mqtt">使用 Vert.x MQTT</a></li>
<li><a href="#_vert_x_mqtt_server">Vert.x MQTT 服务端</a>
<ul class="sectlevel1">
<li><a href="#_getting_started">开始</a>
<ul class="sectlevel2">
<li><a href="#_handling_client_connectiondisconnection">处理客户端连接/断开</a></li>
<li><a href="#_handling_client_connectiondisconnection_with_ssltls_support">支持使用SSL / TLS 处理客户端连接/断开连接</a></li>
<li><a href="#_handling_client_connections_via_websocket">通过 WebSocket 处理客户端的连接</a></li>
<li><a href="#_handling_client_subscriptionunsubscription_request">处理客户端 订阅/退订 请求</a></li>
<li><a href="#_handling_client_published_message">处理客户端发布的消息</a></li>
<li><a href="#_publish_message_to_the_client">发布消息到客户端</a></li>
<li><a href="#_be_notified_by_client_keep_alive">客户端保活通知</a></li>
<li><a href="#_closing_the_server">关闭服务端</a></li>
<li><a href="#_automatic_clean_up_in_verticles">在 verticles 中自动清理</a></li>
<li><a href="#_scaling_sharing_mqtt_servers">扩展：共享 MQTT 服务器</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_vert_x_mqtt_client">Vert.x MQTT 客户端</a>
<ul class="sectlevel1">
<li><a href="#_getting_started_2">开始</a>
<ul class="sectlevel2">
<li><a href="#_connectdisconnect">连接建立/连接断开</a></li>
<li><a href="#_subscribe_to_a_topic">订阅主题消息</a></li>
<li><a href="#_publishing_message_to_a_topic">发布主题消息</a></li>
<li><a href="#_keep_connection_with_server_alive">与服务端保持连接</a></li>
<li><a href="#_be_notified_when">通知时机</a></li>
<li><a href="#_use_proxy_protocol">使用代理协议</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div></div></aside><div class="jsx-efcc50be384cabc7 docs-content-sidebar-toggle"><div style="position:relative" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="jsx-efcc50be384cabc7 docs-content-inner"><div class="jsx-efcc50be384cabc7 docs-content-metadata"><div class="jsx-efcc50be384cabc7 docs-content-metadata-left"><div class="jsx-efcc50be384cabc7 docs-content-metadata-repo"><div class="jsx-d38685edc31911e0 github-stars"><a href="https://github.com/vert-x3/vertx-mqtt" class="jsx-d38685edc31911e0"><div class="jsx-d38685edc31911e0 icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div> <!-- -->null stars</a></div></div><div class="jsx-efcc50be384cabc7"><a href="https://vertx.io/docs/apidocs" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-mqtt/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="jsx-efcc50be384cabc7 docs-content-metadata-version"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">v4.2.7<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu align-right"><a href="/docs/vertx-mqtt/java/"><li class="jsx-400ec7965926e858 dropdown-item active has-active-siblings"><span class="jsx-400ec7965926e858 dropdown-check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></span>Latest (v<!-- -->4.2.7<!-- -->)</li></a><a href="/docs/4.1.8/vertx-mqtt/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.1.8</li></a><a href="/docs/4.0.3/vertx-mqtt/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a><a href="/docs/3.9.13/vertx-mqtt/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->3.9.13</li></a></ul></div></span></div></div><div class="jsx-efcc50be384cabc7"><h1>Vert.x MQTT</h1>

<div class="sect1">
<h2 id="_using_vert_x_mqtt"><a class="anchor" href="#_using_vert_x_mqtt"></a>使用 Vert.x MQTT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>这个组件已经在 Vertx 栈中正式发布了，
现在只需要在构建描述符中添加如下内容即可使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven （在 <code>pom.xml</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-mqtt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile io.<span class="hljs-attr">vertx:</span>vertx-<span class="hljs-attr">mqtt:</span><span class="hljs-number">4.2</span><span class="hljs-number">.6</span></code></pre>
</div>
</div>
</div>
</div>
<h1 id="_vert_x_mqtt_server" class="sect0"><a class="anchor" href="#_vert_x_mqtt_server"></a>Vert.x MQTT 服务端</h1>
<div class="paragraph">
<p>这个组件提供了一个服务，它能处理远程 <a href="http://mqtt.org/">MQTT</a> 连接，通信和信息交换。
它的API提供了一系列接收客户端原生协议消息的事件，
并且提供了一些发送信息到客户端的功能。</p>
</div>
<div class="paragraph">
<p>在编写该文档时，该组件支持 MQTT 协议的 5.0 版本除 AUTH 消息外的所有消息类型（AUTH 消息还未实现）。</p>
</div>
<div class="paragraph">
<p>它不是一个功能齐全的 MQTT broker，但可以用来建立类似的东西或者进行协议转换。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">警告</div>
</td>
<td class="content">
这个模块还处于技术预览阶段,这意味着它的API在接下来的版本中可能会改变。
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>开始</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_handling_client_connectiondisconnection"><a class="anchor" href="#_handling_client_connectiondisconnection"></a>处理客户端连接/断开</h3>
<div class="paragraph">
<p>这个例子展示了如何处理一个来自远程 MQTT 客户端的请求，
首先，它会创建一个 <code><a href="../../apidocs/io/vertx/mqtt/MqttServer.html">MqttServer</a></code> 实例，
然后使用 endpointHandler 方法指定一个处理器来处理远程客户端发送的CONNECT信息，一个 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html">MqttEndpoint</a></code>
实例会作为 handler 的参数传入，它携带了所有与CONNECT消息相关联的主要信息，例如客户端标识符，
用户名/密码，"will"信息，session 清除标志，协议版本,保活超时，
和 CONNECT 消息中的消息属性 (对应于 MQTT 协议的 5.0 版本)等。
在 handler 内, <em>endpoint</em> 实例提供 accept 方法以相应的 CONNACK 消息响应远程客户端，
通过这种方式，成功建立连接。
最后，通过 <code><a href="../../apidocs/io/vertx/mqtt/MqttServer.html#listen-io.vertx.core.Handler-">listen</a></code>
方法启动一个默认的服务端（运行在 localhost 上并且默认 MQTT 端口为 1883），
这个方法同样允许指定一个 handler 来检查是否服务器是否已经正常启动。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">MqttServer</span> <span class="hljs-variable">mqttServer</span> <span class="hljs-operator">=</span> MqttServer.create(vertx);
mqttServer.endpointHandler(endpoint -&gt; {

  <span class="hljs-comment">// shows main connect info</span>
  System.out.println(<span class="hljs-string">&quot;MQTT client [&quot;</span> + endpoint.clientIdentifier() + <span class="hljs-string">&quot;] request to connect, clean session = &quot;</span> + endpoint.isCleanSession());

  <span class="hljs-keyword">if</span> (endpoint.auth() != <span class="hljs-literal">null</span>) {
    System.out.println(<span class="hljs-string">&quot;[username = &quot;</span> + endpoint.auth().getUsername() + <span class="hljs-string">&quot;, password = &quot;</span> + endpoint.auth().getPassword() + <span class="hljs-string">&quot;]&quot;</span>);
  }
  System.out.println(<span class="hljs-string">&quot;[properties = &quot;</span> + endpoint.connectProperties() + <span class="hljs-string">&quot;]&quot;</span>);
  <span class="hljs-keyword">if</span> (endpoint.will() != <span class="hljs-literal">null</span>) {
    System.out.println(<span class="hljs-string">&quot;[will topic = &quot;</span> + endpoint.will().getWillTopic() + <span class="hljs-string">&quot; msg = &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(endpoint.will().getWillMessageBytes()) +
      <span class="hljs-string">&quot; QoS = &quot;</span> + endpoint.will().getWillQos() + <span class="hljs-string">&quot; isRetain = &quot;</span> + endpoint.will().isWillRetain() + <span class="hljs-string">&quot;]&quot;</span>);
  }

  System.out.println(<span class="hljs-string">&quot;[keep alive timeout = &quot;</span> + endpoint.keepAliveTimeSeconds() + <span class="hljs-string">&quot;]&quot;</span>);

  <span class="hljs-comment">// accept connection from the remote client</span>
  endpoint.accept(<span class="hljs-literal">false</span>);

})
  .listen(ar -&gt; {

    <span class="hljs-keyword">if</span> (ar.succeeded()) {

      System.out.println(<span class="hljs-string">&quot;MQTT server is listening on port &quot;</span> + ar.result().actualPort());
    } <span class="hljs-keyword">else</span> {

      System.out.println(<span class="hljs-string">&quot;Error on starting the server&quot;</span>);
      ar.cause().printStackTrace();
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>当远程客户端发送一个 DISCONNECT 消息来主动断开与服务端的连接，
这个 <em>endpoint</em> 实例提供了一个 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#disconnectMessageHandler-io.vertx.core.Handler-">disconnectMessageHandler</a></code> 方法来指定 handler 进行处理，
该 handler 有一个类型为 <code><a href="../../apidocs/io/vertx/mqtt/messages/MqttDisconnectMessage.html">MqttDisconnectMessage</a></code> 的参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.disconnectMessageHandler(disconnectMessage -&gt; {

  System.out.println(<span class="hljs-string">&quot;Received disconnect from client, reason code = &quot;</span> + disconnectMessage.code());
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您想使用 MQTT 协议的 5.0 或更高的版本中服务端可以发送 DISCONNECT 消息并指定断开连接的原因代码和属性给客户端的特性，
可以使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#disconnect-io.vertx.mqtt.messages.codes.MqttDisconnectReasonCode-io.netty.handler.codec.mqtt.MqttProperties-">disconnect</a></code>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_client_connectiondisconnection_with_ssltls_support"><a class="anchor" href="#_handling_client_connectiondisconnection_with_ssltls_support"></a>支持使用SSL / TLS 处理客户端连接/断开连接</h3>
<div class="paragraph">
<p>服务端支持通过 SSL/TLS 方式来授权和加密客户端的连接请求，
为了做到这一点，<code><a href="../../apidocs/io/vertx/mqtt/MqttServerOptions.html">MqttServerOptions</a></code> 类提供了 <code><a href="../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setSsl-boolean-">setSsl</a></code>
方法来启用 SSL/TLS(值设为 true)，以及一些其他有用的方法来配置服务端证书和相关私钥
（作为 java 键存储引用，PEM 或 PFX 格式），在下面的例子中，
<code><a href="../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setKeyCertOptions-io.vertx.core.net.KeyCertOptions-">setKeyCertOptions</a></code>
方法可以用来配置PEM格式的证书， 这个方法需要一个
<code><a href="../../apidocs/io/vertx/core/net/KeyCertOptions.html">KeyCertOptions</a></code> 接口的实例作为参数传入。与此同时，<code><a href="../../apidocs/io/vertx/core/net/PemKeyCertOptions.html">PemKeyCertOptions</a></code>
类提供了
<code><a href="../../apidocs/io/vertx/core/net/PemKeyCertOptions.html#setCertPath-java.lang.String-">setCertPath</a></code> 和
<code><a href="../../apidocs/io/vertx/core/net/PemKeyCertOptions.html#setKeyPath-java.lang.String-">setKeyPath</a></code>
来分别设置 服务端的证书和私钥的路径。MQTT 服务端需要一个 Vert.x 实例和一个上面提到的 MQTT 配置实例作为参数来启动。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">MqttServerOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MqttServerOptions</span>()
  .setPort(<span class="hljs-number">8883</span>)
  .setKeyCertOptions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PemKeyCertOptions</span>()
    .setKeyPath(<span class="hljs-string">&quot;./src/test/resources/tls/server-key.pem&quot;</span>)
    .setCertPath(<span class="hljs-string">&quot;./src/test/resources/tls/server-cert.pem&quot;</span>))
  .setSsl(<span class="hljs-literal">true</span>);

<span class="hljs-type">MqttServer</span> <span class="hljs-variable">mqttServer</span> <span class="hljs-operator">=</span> MqttServer.create(vertx, options);
mqttServer.endpointHandler(endpoint -&gt; {

  <span class="hljs-comment">// shows main connect info</span>
  System.out.println(<span class="hljs-string">&quot;MQTT client [&quot;</span> + endpoint.clientIdentifier() + <span class="hljs-string">&quot;] request to connect, clean session = &quot;</span> + endpoint.isCleanSession());

  <span class="hljs-keyword">if</span> (endpoint.auth() != <span class="hljs-literal">null</span>) {
    System.out.println(<span class="hljs-string">&quot;[username = &quot;</span> + endpoint.auth().getUsername() + <span class="hljs-string">&quot;, password = &quot;</span> + endpoint.auth().getPassword() + <span class="hljs-string">&quot;]&quot;</span>);
  }
  <span class="hljs-keyword">if</span> (endpoint.will() != <span class="hljs-literal">null</span>) {
    System.out.println(<span class="hljs-string">&quot;[will topic = &quot;</span> + endpoint.will().getWillTopic() + <span class="hljs-string">&quot; msg = &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(endpoint.will().getWillMessageBytes()) +
      <span class="hljs-string">&quot; QoS = &quot;</span> + endpoint.will().getWillQos() + <span class="hljs-string">&quot; isRetain = &quot;</span> + endpoint.will().isWillRetain() + <span class="hljs-string">&quot;]&quot;</span>);
  }

  System.out.println(<span class="hljs-string">&quot;[keep alive timeout = &quot;</span> + endpoint.keepAliveTimeSeconds() + <span class="hljs-string">&quot;]&quot;</span>);

  <span class="hljs-comment">// accept connection from the remote client</span>
  endpoint.accept(<span class="hljs-literal">false</span>);

})
  .listen(ar -&gt; {

    <span class="hljs-keyword">if</span> (ar.succeeded()) {

      System.out.println(<span class="hljs-string">&quot;MQTT server is listening on port &quot;</span> + ar.result().actualPort());
    } <span class="hljs-keyword">else</span> {

      System.out.println(<span class="hljs-string">&quot;Error on starting the server&quot;</span>);
      ar.cause().printStackTrace();
    }
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_client_connections_via_websocket"><a class="anchor" href="#_handling_client_connections_via_websocket"></a>通过 WebSocket 处理客户端的连接</h3>
<div class="paragraph">
<p>如果您想要通过 WebSocket 来进行连接，可以通过 <code><a href="../../apidocs/io/vertx/mqtt/MqttServerOptions.html">MqttServerOptions</a></code> 将其启用，
调用 <code><a href="../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setUseWebSocket-boolean-">setUseWebSocket</a></code> 方法并设置参数为 <code>true</code> ，
它将会监听 <code>/mqtt</code> 路径上所有的 websocket 连接。</p>
</div>
<div class="paragraph">
<p>与其他连接的配置方式一样，
这种方式下 endpoint 的连接创建以及连接断开与常规的连接管理方式相同。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">DeploymentOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeploymentOptions</span>().setInstances(<span class="hljs-number">10</span>);
vertx.deployVerticle(<span class="hljs-string">&quot;com.mycompany.MyVerticle&quot;</span>, options);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_client_subscriptionunsubscription_request"><a class="anchor" href="#_handling_client_subscriptionunsubscription_request"></a>处理客户端 订阅/退订 请求</h3>
<div class="paragraph">
<p>在客户端和服务端的连接建立后，客户端可以发送 SUBSCRIBE 消息以订阅主题。
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html">MqttEndpoint</a></code> 允许使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#subscribeHandler-io.vertx.core.Handler-">subscribeHandler</a></code>
方法来指定一个 handler 处理到来的订阅请求，这个 handler 接收一个 <code><a href="../../apidocs/io/vertx/mqtt/messages/MqttSubscribeMessage.html">MqttSubscribeMessage</a></code> 类型的实例，
该实例携带了主题列表以及客户端指定的订阅配置。
订阅消息的选项包括了 QoS 等级，其他标记位和 MQTT 协议 5.0 版本新添加的标记位，
例如 <code>noLocal</code> 和 <code>retainAsPublished</code>。
最后，这个 endpoint 实例提供了 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#subscribeAcknowledge-int-java.util.List-">subscribeAcknowledge</a></code>
方法来回复一个包含原因代码 (可能是 QoS 等级或错误原因代码 - 每个主题或主题模式都有一个)
和消息属性的 SUBACK 消息给客户端。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.subscribeHandler(subscribe -&gt; {

  List&lt;MqttSubAckReasonCode&gt; reasonCodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
  <span class="hljs-keyword">for</span> (MqttTopicSubscription s: subscribe.topicSubscriptions()) {
    System.out.println(<span class="hljs-string">&quot;Subscription for &quot;</span> + s.topicName() + <span class="hljs-string">&quot; with QoS &quot;</span> + s.qualityOfService());
    reasonCodes.add(MqttSubAckReasonCode.qosGranted(s.qualityOfService()));
  }
  <span class="hljs-comment">// ack the subscriptions request</span>
  endpoint.subscribeAcknowledge(subscribe.messageId(), reasonCodes, MqttProperties.NO_PROPERTIES);

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>相应的，也可以使用 endpoint 上的 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeHandler-io.vertx.core.Handler-">unsubscribeHandler</a></code>
方法来指定一个 handler 来处理客户端的UNSUBSCRIBE消息， 这个 handler 接收一个携带退订主题列表的
<code><a href="../../apidocs/io/vertx/mqtt/messages/MqttUnsubscribeMessage.html">MqttUnsubscribeMessage</a></code> 类型实例作为参数。
最后，这个 endpoint 实例提供了 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeAcknowledge-int-">unsubscribeAcknowledge</a></code> 和
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeAcknowledge-int-java.util.List-io.netty.handler.codec.mqtt.MqttProperties-">unsubscribeAcknowledge</a></code>
方法来回复客户端相关的 UNSUBACK 消息 - 可能是简单地确认所有的取消订阅成功，或者根据每个
主题或主题模式指定原因代码和 UNSUBSCRIBE 请求中的消息属性(在 MQTT 协议的 5.0 或更高版本中支持)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.unsubscribeHandler(unsubscribe -&gt; {

  <span class="hljs-keyword">for</span> (String t: unsubscribe.topics()) {
    System.out.println(<span class="hljs-string">&quot;Unsubscription for &quot;</span> + t);
  }
  <span class="hljs-comment">// ack the subscriptions request</span>
  endpoint.unsubscribeAcknowledge(unsubscribe.messageId());
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_client_published_message"><a class="anchor" href="#_handling_client_published_message"></a>处理客户端发布的消息</h3>
<div class="paragraph">
<p>为了处理远程客户端发布的消息，<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html">MqttEndpoint</a></code> 接口提供了
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishHandler-io.vertx.core.Handler-">publishHandler</a></code> 方法来指定一个 handler,
这个handler接收一个 <code><a href="../../apidocs/io/vertx/mqtt/messages/MqttPublishMessage.html">MqttPublishMessage</a></code> 类型的实例作为参数，该实例
包含了载荷信息，QoS 等级，复制和保留标识和消息属性。</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 0 (AT_MOST_ONCE), 那么服务端没有必要回复客户端。</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 1（AT_LEAST_ONCE），endpoint 需要使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledge-int-">publishAcknowledge</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledge-int-io.vertx.mqtt.messages.codes.MqttPubAckReasonCode-io.netty.handler.codec.mqtt.MqttProperties-">publishAcknowledge</a></code> 方法回复一个 PUBACK 消息给客户端</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 2（EXACTLY_ONCE），endpoint 需要使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceived-int-">publishReceived</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceived-int-io.vertx.mqtt.messages.codes.MqttPubRecReasonCode-io.netty.handler.codec.mqtt.MqttProperties-">publishReceived</a></code> 方法回复一个PUBREC消息给客户端。 在这种情况下，
这个 endpoint 同时也要通过
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReleaseHandler-io.vertx.core.Handler-">publishReleaseHandler</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReleaseMessageHandler-io.vertx.core.Handler-">publishReleaseMessageHandler</a></code> 指定一个 handler 来处理来自客户端的PUBREL（远程客户端接收到 endpoint 发送的 PUBREC 后发送的）消息 - 取决于服务端是否需要
使用 MQTT 协议 5.0 版本扩充的内容 (原因代码和消息属性)。
为了结束 QoS 等级为2的消息的传递，endpoint 可以使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishComplete-int-">publishComplete</a></code>
或者 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishComplete-int-io.vertx.mqtt.messages.codes.MqttPubCompReasonCode-io.netty.handler.codec.mqtt.MqttProperties-">publishComplete</a></code> 方法发送一个 PUBCOMP 消息给客户端。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.publishHandler(message -&gt; {

  System.out.println(<span class="hljs-string">&quot;Just received message [&quot;</span> + message.payload().toString(Charset.defaultCharset()) + <span class="hljs-string">&quot;] with QoS [&quot;</span> + message.qosLevel() + <span class="hljs-string">&quot;]&quot;</span>);

  <span class="hljs-keyword">if</span> (message.qosLevel() == MqttQoS.AT_LEAST_ONCE) {
    endpoint.publishAcknowledge(message.messageId());
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message.qosLevel() == MqttQoS.EXACTLY_ONCE) {
    endpoint.publishReceived(message.messageId());
  }

}).publishReleaseHandler(messageId -&gt; {

  endpoint.publishComplete(messageId);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_publish_message_to_the_client"><a class="anchor" href="#_publish_message_to_the_client"></a>发布消息到客户端</h3>
<div class="paragraph">
<p>可以使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-">publish</a></code>
方法发布一个消息到远程客户端，
该方法需要补充一下参数：发布主题，消息载荷，QoS 等级，复制和保留标识。
如果您使用了 MQTT 协议的 5.0 或更高版本，并且想要指定消息属性，那么可以使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-int-io.netty.handler.codec.mqtt.MqttProperties-">publish</a></code>
方法来代替，相比之前介绍的方法，它还可以指定消息 ID 和消息属性。</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 0（AT_MOST_ONCE），endpoint 就不会收到任何客户端的响应</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 1（AT_LEAST_ONCE），endpoint 需要处理客户端的PUBACK消息，
为了收到最后的确认消息，需要使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledgeHandler-io.vertx.core.Handler-">publishAcknowledgeHandler</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledgeMessageHandler-io.vertx.core.Handler-">publishAcknowledgeMessageHandler</a></code> 指定一个handler来接收。</p>
</div>
<div class="paragraph">
<p>如果 QoS 等级是 2（EXACTLY_ONCE），endpoint 需要处理客户端的PUBREC消息，
可以通过 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceivedHandler-io.vertx.core.Handler-">publishReceivedHandler</a></code> 和
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceivedMessageHandler-io.vertx.core.Handler-">publishReceivedMessageHandler</a></code> 方法指定一个handler来实现。
在这个handler内，endpoint 可以使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishRelease-int-">publishRelease</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishRelease-int-io.vertx.mqtt.messages.codes.MqttPubRelReasonCode-io.netty.handler.codec.mqtt.MqttProperties-">publishRelease</a></code>
方法回复客户端 PUBREL 消息。最后一步是处理来自客户端的PUBCOMP消息作为已发布消息的最终确认。
这可以使用
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishCompletionHandler-io.vertx.core.Handler-">publishCompletionHandler</a></code> 或者
<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishCompletionMessageHandler-io.vertx.core.Handler-">publishCompletionMessageHandler</a></code>
方法指定一个handler来处理最终接收到的 PUBCOMP 消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.publish(<span class="hljs-string">&quot;my_topic&quot;</span>,
  Buffer.buffer(<span class="hljs-string">&quot;Hello from the Vert.x MQTT server&quot;</span>),
  MqttQoS.EXACTLY_ONCE,
  <span class="hljs-literal">false</span>,
  <span class="hljs-literal">false</span>);

<span class="hljs-comment">// specifing handlers for handling QoS 1 and 2</span>
endpoint.publishAcknowledgeHandler(messageId -&gt; {

  System.out.println(<span class="hljs-string">&quot;Received ack for message = &quot;</span> +  messageId);

}).publishReceivedHandler(messageId -&gt; {

  endpoint.publishRelease(messageId);

}).publishCompletionHandler(messageId -&gt; {

  System.out.println(<span class="hljs-string">&quot;Received ack for message = &quot;</span> +  messageId);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_be_notified_by_client_keep_alive"><a class="anchor" href="#_be_notified_by_client_keep_alive"></a>客户端保活通知</h3>
<div class="paragraph">
<p>MQTT 底层的保活机制是由服务端内部处理的。当接收到CONNECT消息，
服务端解析消息中指定的保活超时时间以便于检查客户端在这段时间内是否有发送消息，
与此同时，没收到一个 PINGREQ 消息，服务端都会回复一个相关的 PINGRESP 消息。</p>
</div>
<div class="paragraph">
<p>尽管上层应用不需要处理这些，<code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html">MqttEndpoint</a></code>
依然提供了 <code><a href="../../apidocs/io/vertx/mqtt/MqttEndpoint.html#pingHandler-io.vertx.core.Handler-">pingHandler</a></code> 方法来选定一个handler
来自客户端的 PINGREQ 消息。对于应用程序来说这只是一个通知，
客户端只会发送一个用于检测保活的没有任何意义的 ping 消息。
无论如何，PINGRESP 都会被服务端内部自动发送。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">endpoint.pingHandler(v -&gt; {

  System.out.println(<span class="hljs-string">&quot;Ping received from client&quot;</span>);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closing_the_server"><a class="anchor" href="#_closing_the_server"></a>关闭服务端</h3>
<div class="paragraph">
<p><code><a href="../../apidocs/io/vertx/mqtt/MqttServer.html">MqttServer</a></code> 提供了 <code><a href="../../apidocs/io/vertx/mqtt/MqttServer.html#close-io.vertx.core.Handler-">close</a></code>
方法来关闭服务。他会停止监听到来的连接以及关闭所有已经建立的连接，
该方法是一个异步方法，并且可以指定一个成功回调 handler，
这个 handler 会在服务端完全关闭后被调用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">mqttServer.close(v -&gt; {

  System.out.println(<span class="hljs-string">&quot;MQTT server closed&quot;</span>);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_clean_up_in_verticles"><a class="anchor" href="#_automatic_clean_up_in_verticles"></a>在 verticles 中自动清理</h3>
<div class="paragraph">
<p>如果您是在 verticles 内部创建的 MQTT 服务端，当 verticle 卸载时这些服务端会被自动关闭。</p>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_sharing_mqtt_servers"><a class="anchor" href="#_scaling_sharing_mqtt_servers"></a>扩展：共享 MQTT 服务器</h3>
<div class="paragraph">
<p>与MQTT服务器相关的 handler 总是在同一个 event loop 线程中执行。
这意味着在一个多核系统中，仅有一个实例被部署，一个核被使用。
为了使用更多的核，可以部署更多的 MQTT 服务端实例</p>
</div>
<div class="paragraph">
<p>可以通过编程方式实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {

  <span class="hljs-type">MqttServer</span> <span class="hljs-variable">mqttServer</span> <span class="hljs-operator">=</span> MqttServer.create(vertx);
  mqttServer.endpointHandler(endpoint -&gt; {
    <span class="hljs-comment">// handling endpoint</span>
  })
    .listen(ar -&gt; {

      <span class="hljs-comment">// handling start listening</span>
    });

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者使用一个 verticle 指定实例的数量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">DeploymentOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeploymentOptions</span>().setInstances(<span class="hljs-number">10</span>);
vertx.deployVerticle(<span class="hljs-string">&quot;com.mycompany.MyVerticle&quot;</span>, options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际上，尽管仅有一个MQTT服务器被部署，
但是当传入的连接到达时，会被 Vert.x 使用轮转算法分发到不同的核上运行的处理器（handlers）上。</p>
</div>
</div>
</div>
</div>
<h1 id="_vert_x_mqtt_client" class="sect0"><a class="anchor" href="#_vert_x_mqtt_client"></a>Vert.x MQTT 客户端</h1>
<div class="paragraph">
<p>这个组件提供了一个符合3.1.1版本规范的 <a href="http://mqtt.org/">MQTT</a> 客户端，它的 API 提供了一系列方法来处理连接建立/断开，发布消息（完整支持3种不同等级的 QoS）以及主题订阅</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">警告</div>
</td>
<td class="content">
这个模块还处于技术预览阶段，这意味着它的API在接下来的版本中可能会改变
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_getting_started_2"><a class="anchor" href="#_getting_started_2"></a>开始</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_connectdisconnect"><a class="anchor" href="#_connectdisconnect"></a>连接建立/连接断开</h3>
<div class="paragraph">
<p>这个客户端让您可以与服务端建立连接或者断开连接。
相应的，您可以通过构造函数的方式传入一个 <code><a href="../../apidocs/io/vertx/mqtt/MqttClientOptions.html">MqttClientOptions</a></code> 类型的实例
来指定想要建立连接的服务端的地址和端口号。</p>
</div>
<div class="paragraph">
<p>正如下面这个例子所展示的，您可以使用 Vert.x MQTT 客户端实例，分别调用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#connect-int-java.lang.String-io.vertx.core.Handler-">connect</a></code> 和 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#disconnect--">disconnect</a></code> 方法
来完成与服务端的连接建立或者断开。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">MqttClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> MqttClient.create(vertx);

client.connect(<span class="hljs-number">1883</span>, <span class="hljs-string">&quot;mqtt.eclipse.org&quot;</span>, s -&gt; {
  client.disconnect();
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
如果您在使用 SSL/TSL，服务端 <code><a href="../../apidocs/io/vertx/mqtt/MqttClientOptions.html">MqttClientOptions</a></code> 提供的默认的地址是 localhost:1883 和 localhost:8883 。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_subscribe_to_a_topic"><a class="anchor" href="#_subscribe_to_a_topic"></a>订阅主题消息</h3>
<div class="paragraph">
<p>现在，让我们再仔细看一下这个示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.publishHandler(s -&gt; {
  System.out.println(<span class="hljs-string">&quot;There are new message in topic: &quot;</span> + s.topicName());
  System.out.println(<span class="hljs-string">&quot;Content(as string) of the message: &quot;</span> + s.payload().toString());
  System.out.println(<span class="hljs-string">&quot;QoS: &quot;</span> + s.qosLevel());
})
  .subscribe(<span class="hljs-string">&quot;rpi2/temp&quot;</span>, <span class="hljs-number">2</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里我们有一个使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#subscribe-java.lang.String-int-">subscribe</a></code> 方法的例子， 为了接收到主题为 rpi2/temp 的消息，
我们调用了 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#subscribe-java.lang.String-int-">subscribe</a></code> 方法， 因此，为了能接收到的服务端的消息，您需要提供一个 handler，每当您订阅的主题有新的消息传来，这个 handler 就会被调用。
正如这个实例描述的，您需要通过 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#publishHandler-io.vertx.core.Handler-">publishHandler</a></code> 方法来指定 handler。</p>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_message_to_a_topic"><a class="anchor" href="#_publishing_message_to_a_topic"></a>发布主题消息</h3>
<div class="paragraph">
<p>如果您想要发布消息到主题上去就需要使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-">publish</a></code> 方法。
让我们来看下面这个示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.publish(<span class="hljs-string">&quot;temperature&quot;</span>,
  Buffer.buffer(<span class="hljs-string">&quot;hello&quot;</span>),
  MqttQoS.AT_LEAST_ONCE,
  <span class="hljs-literal">false</span>,
  <span class="hljs-literal">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个示例中我们发布了消息到名称为 “temperature” 的主题上去。</p>
</div>
</div>
<div class="sect2">
<h3 id="_keep_connection_with_server_alive"><a class="anchor" href="#_keep_connection_with_server_alive"></a>与服务端保持连接</h3>
<div class="paragraph">
<p>为了保持与服务端的连接，您需要时不时地发送一些数据到服务端，否则服务端可能会断开连接。
使用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#ping--">ping</a></code> 方法来保持连接是一个不错的选择。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content">
您的客户端默认情况下会自动保持与服务端的连接，这也意味着您不需要调用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#ping--">ping</a></code> 方法来保活，
因为 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html">MqttClient</a></code> 已经帮您做了这些事。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果您不想要这个特性，您需要调用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClientOptions.html#setAutoKeepAlive-boolean-">setAutoKeepAlive</a></code> 方法，设置参数为 <code>false</code> 即可。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">options.setAutoKeepAlive(<span class="hljs-literal">false</span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_be_notified_when"><a class="anchor" href="#_be_notified_when"></a>通知时机</h3>
<div class="ulist">
<ul>
<li>
<p>发布完成</p>
<div class="paragraph">
<p>您需要调用 <code><a href="../../apidocs/io/vertx/mqtt/MqttClient.html#publishCompletionHandler-io.vertx.core.Handler-">publishCompletionHandler</a></code> 来指定一个handler，这个handler每次发布完成都会被调用。
这一步是非常有用的，因为您可以看到 PUBACK 或者 PUBCOMP 数据包的 packetId。</p>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>client.publishCompletionHandler(id -&gt; {
  System.out.println("Id of just received PUBACK or PUBCOMP packet is " + id);
});
  // The line of code below will trigger publishCompletionHandler (QoS 2)
client.publish("hello", Buffer.buffer("hello"), MqttQoS.EXACTLY_ONCE, false, false);
  // The line of code below will trigger publishCompletionHandler (QoS is 1)
client.publish("hello", Buffer.buffer("hello"), MqttQoS.AT_LEAST_ONCE, false, false);
  // The line of code below does not trigger because QoS value is 0
client.publish("hello", Buffer.buffer("hello"), MqttQoS.AT_LEAST_ONCE, false, false);</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">警告</div>
</td>
<td class="content">
如果设置发布消息的 QoS=0，这个 handler 就不会被调用。
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>订阅完成</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.subscribeCompletionHandler(mqttSubAckMessage -&gt; {
  System.out.println(<span class="hljs-string">&quot;Id of just received SUBACK packet is &quot;</span> + mqttSubAckMessage.messageId());
  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> s : mqttSubAckMessage.grantedQoSLevels()) {
    <span class="hljs-keyword">if</span> (s == <span class="hljs-number">0x80</span>) {
      System.out.println(<span class="hljs-string">&quot;Failure&quot;</span>);
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">&quot;Success. Maximum QoS is &quot;</span> + s);
    }
  }
});
client.subscribe(<span class="hljs-string">&quot;temp&quot;</span>, <span class="hljs-number">1</span>);
client.subscribe(<span class="hljs-string">&quot;temp2&quot;</span>, <span class="hljs-number">2</span>);</code></pre>
</div>
</div>
</li>
<li>
<p>退订完成</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client
  .unsubscribeCompletionHandler(id -&gt; {
    System.out.println(<span class="hljs-string">&quot;Id of just received UNSUBACK packet is &quot;</span> + id);
  });
client.subscribe(<span class="hljs-string">&quot;temp&quot;</span>, <span class="hljs-number">1</span>);
client.unsubscribe(<span class="hljs-string">&quot;temp&quot;</span>);</code></pre>
</div>
</div>
</li>
<li>
<p>退订发布</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.subscribe(<span class="hljs-string">&quot;temp&quot;</span>, <span class="hljs-number">1</span>);
client.unsubscribe(<span class="hljs-string">&quot;temp&quot;</span>, id -&gt; {
    System.out.println(<span class="hljs-string">&quot;Id of just sent UNSUBSCRIBE packet is &quot;</span> + id);
  });</code></pre>
</div>
</div>
</li>
<li>
<p>接收 PINGRESP</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.pingResponseHandler(s -&gt; {
  <span class="hljs-comment">//The handler will be called time to time by default</span>
  System.out.println(<span class="hljs-string">&quot;We have just received PINGRESP packet&quot;</span>);
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_use_proxy_protocol"><a class="anchor" href="#_use_proxy_protocol"></a>使用代理协议</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">MqttServer</span> <span class="hljs-variable">mqttServer</span> <span class="hljs-operator">=</span> MqttServer
  .create(vertx, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MqttServerOptions</span>()
    <span class="hljs-comment">// 设置是否使用代理为 true</span>
    .setUseProxyProtocol(<span class="hljs-literal">true</span>));
mqttServer.endpointHandler(endpoint -&gt; {
  <span class="hljs-comment">// 此处设置的远程地址为真实的 MQTT 服务器地址，而不是代理地址</span>
  System.out.println(endpoint.remoteAddress());
  endpoint.accept(<span class="hljs-literal">false</span>);

})
  .listen(ar -&gt; {

    <span class="hljs-keyword">if</span> (ar.succeeded()) {

      System.out.println(<span class="hljs-string">&quot;MQTT server is listening on port &quot;</span> + ar.result().actualPort());
    } <span class="hljs-keyword">else</span> {

      System.out.println(<span class="hljs-string">&quot;Error on starting the server&quot;</span>);
      ar.cause().printStackTrace();
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您的服务器位于 haproxy 或 nginx 之后，并且您希望获取到 MQTT 客户端真实的 ip 和端口，那么您需要将 <code>setUseProxyProtocol</code> 选项设置为 <code>true</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content">
为了使用该特性， 您需要添加 <code>netty-codec-haproxy</code> 依赖项。 但是默认情况下该依赖不会被引入，因此您需要手动添加
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (在您的 <code>pom.xml</code> 中):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.netty<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>netty-codec-haproxy<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (在您的 <code>build.gradle</code> 文件中):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile io.<span class="hljs-attr">netty:</span>netty-codec-<span class="hljs-attr">haproxy:</span><span class="hljs-number">4.2</span><span class="hljs-number">.6</span></code></pre>
</div>
</div>
</div>
</div>
</div></div></div></div></div></div><footer class="jsx-aeedcf66895f49d7"><div class="jsx-aeedcf66895f49d7 container"><div class="jsx-aeedcf66895f49d7 footer-nav-section"><div class="jsx-aeedcf66895f49d7 footer-nav-list footer-logo"><a class="jsx-aeedcf66895f49d7" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-aeedcf66895f49d7"/></a></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse Vert.x</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7 navbar-menu-item" href="/docs/">文档</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/download/">下载</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/blog/">博客</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/community/">社区</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/translation/">翻译团队</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/eclipse-vertx/vert.x" class="jsx-aeedcf66895f49d7">GitHub</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/vertx-china/vertx-web-site" class="jsx-aeedcf66895f49d7">翻译GitHub</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">资源</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/faq/">答疑</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/channels/">联系渠道</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://how-to.vertx.io/" class="jsx-aeedcf66895f49d7">操作指南</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://start.vertx.io/" class="jsx-aeedcf66895f49d7">应用生成器</a></li><li class="jsx-aeedcf66895f49d7"><a href="/.well-known/security.txt" class="jsx-aeedcf66895f49d7">security.txt</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/" class="jsx-aeedcf66895f49d7">Eclipse 基金会</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/privacy.php" class="jsx-aeedcf66895f49d7">隐私政策</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/termsofuse.php" class="jsx-aeedcf66895f49d7">使用条款</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/copyright.php" class="jsx-aeedcf66895f49d7">版权代理</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/" class="jsx-aeedcf66895f49d7">法律资源</a></li></ul></div></div><div class="jsx-aeedcf66895f49d7 footer-copyright"><div class="jsx-aeedcf66895f49d7 footer-copyright-remarks">© <!-- -->2022<!-- --> Eclipse Vert.x™<br class="jsx-aeedcf66895f49d7"/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Apache License 2.0</a>协议下获得了双重许可。<br class="jsx-aeedcf66895f49d7 footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Michel Krämer</a> 设计。</div><div class="jsx-aeedcf66895f49d7 footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 281.3 91.1&#x27; style=&#x27;enable-background:new 0 0 281.3 91.1&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23f79422%7d.st1%7bfill:%233d3c3b%7d%3c/style%3e%3cg id=&#x27;Layer_1_1_&#x27;%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M265.7 84 257 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zm-32.4-8.3c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3 0 4.7 2.9 9.1 9.1 9.1s9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-21.2 18V73h-3.3v17.7h3.3zm-23.6 0h3.3V76h5.6v-3h-14.6v3h5.6l.1 14.7zm-18.9-6.5H163l3.3-7.6 3.3 7.6zm2.8 6.5h3.6L168.2 73h-3.6l-8 17.7h3.6l1.5-3.3h9.3l1.4 3.3zm-38-14.6h3.6c3.9 0 5.5 2.8 5.5 5.5.1 2.8-1.5 5.8-5.5 5.8h-3.6V76.1zm3.7-3.1h-6.9v17.7h6.9c6.2 0 8.9-4.5 8.9-9s-2.8-8.7-8.9-8.7zm-22.4 11L107 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zM88.2 73v10.2c0 3-1.6 4.9-4.3 4.9s-4.6-1.7-4.6-4.9V73H76v10.1c0 5.3 3.6 7.9 7.9 7.9 4.4 0 7.7-2.7 7.7-7.9V73h-3.4zm-33 2.7c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3s2.9 9.1 9.1 9.1 9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-29.7 18v-6.5h8.9v-3.1h-8.9v-4.8h9.4V73H22.2v17.6h3.3z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M269.4 54.4h-22.2v-8.9h21.4v-6.9h-21.4v-9.1h22.2v-7.2h-29.6v39.5h29.6v-7.4zm-40-25.6c-3-6.1-9.4-7.8-15.5-7.8-7.3 0-15.3 3.4-15.3 11.5 0 8.9 7.4 11 15.5 12 5.2.6 9.1 2.1 9.1 5.8 0 4.3-4.4 5.9-9.1 5.9s-9.4-1.9-11.1-6.3l-6.2 3.2c2.9 7.2 9.1 9.7 17.2 9.7 8.8 0 16.6-3.8 16.6-12.6 0-9.4-7.7-11.6-15.9-12.6-4.7-.6-8.8-1.5-8.8-5 0-2.9 2.6-5.2 8.2-5.2 4.3 0 8 2.2 9.4 4.4l5.9-3zM176 22.2c-6.2-.1-12.4 0-18.6 0v39.5h7.4V50.1H176c19.4 0 19.4-27.9 0-27.9zm-11.1 7.1H176c9.5 0 9.5 14 0 14h-11.2l.1-14zm-18 32.5V22.2h-7.4v39.5l7.4.1zm-44-39.6v39.5h27.7v-6.9h-20.3V22.2h-7.4zM90.7 51.7c-2.7 2.5-6.2 4-9.9 4-9.8 0-13.5-6.8-13.6-13.4s4.1-13.7 13.6-13.7c3.5-.1 7 1.3 9.5 3.7l5-4.8c-3.8-3.9-9.1-6-14.5-6-14.3 0-21 10.5-20.9 20.8s6.3 20.3 20.9 20.3c5.6.1 11-2 15-5.9l-5.1-5zm-39 2.7H29.5v-8.9h21.4v-6.9H29.5v-9.1h22.2v-7.2H22.2v39.5h29.6l-.1-7.4z&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M9.8 18.2C18.8 4.1 36.9-.8 52.1 6l-1-.7C35.7-4.6 15.2-.1 5.3 15.3s-5.4 35.9 10 45.8l1.1.6C3.8 50.8.8 32.3 9.8 18.2z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M272.2 26.1c0-2.5 2.1-4.6 4.6-4.6 2.5 0 4.6 2.1 4.6 4.6 0 2.5-2.1 4.6-4.6 4.6-2.6 0-4.6-2.1-4.6-4.6zm8.6 0c0-2.2-1.8-4.1-4-4.1s-4.1 1.8-4.1 4.1c0 2.2 1.7 4 3.9 4.1h.1c2.3 0 4.1-1.8 4.1-4.1zm-6-2.5h2.3c1.1 0 1.9.5 1.9 1.6 0 .7-.4 1.3-1.1 1.5l1.2 1.7h-1.4l-1-1.5h-.7v1.5h-1.1l-.1-4.8zm2.2 2.3c.5 0 .8-.3.8-.7s-.3-.7-.8-.7h-1v1.3l1 .1z&#x27;/%3e%3c/g%3e%3c/svg%3e" alt="Eclipse foundation Logo" class="jsx-aeedcf66895f49d7"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.2.6/vertx-mqtt/java","title":"Vert.x MQTT","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_using_vert_x_mqtt\"\u003e使用 Vert.x MQTT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_vert_x_mqtt_server\"\u003eVert.x MQTT 服务端\u003c/a\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_getting_started\"\u003e开始\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_handling_client_connectiondisconnection\"\u003e处理客户端连接/断开\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_client_connectiondisconnection_with_ssltls_support\"\u003e支持使用SSL / TLS 处理客户端连接/断开连接\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_client_connections_via_websocket\"\u003e通过 WebSocket 处理客户端的连接\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_client_subscriptionunsubscription_request\"\u003e处理客户端 订阅/退订 请求\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_client_published_message\"\u003e处理客户端发布的消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_publish_message_to_the_client\"\u003e发布消息到客户端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_be_notified_by_client_keep_alive\"\u003e客户端保活通知\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_closing_the_server\"\u003e关闭服务端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_automatic_clean_up_in_verticles\"\u003e在 verticles 中自动清理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_scaling_sharing_mqtt_servers\"\u003e扩展：共享 MQTT 服务器\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_vert_x_mqtt_client\"\u003eVert.x MQTT 客户端\u003c/a\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_getting_started_2\"\u003e开始\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_connectdisconnect\"\u003e连接建立/连接断开\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_subscribe_to_a_topic\"\u003e订阅主题消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_publishing_message_to_a_topic\"\u003e发布主题消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_keep_connection_with_server_alive\"\u003e与服务端保持连接\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_be_notified_when\"\u003e通知时机\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_use_proxy_protocol\"\u003e使用代理协议\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x MQTT\u003c/h1\u003e\n\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_vert_x_mqtt\"\u003e\u003ca class=\"anchor\" href=\"#_using_vert_x_mqtt\"\u003e\u003c/a\u003e使用 Vert.x MQTT\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个组件已经在 Vertx 栈中正式发布了，\n现在只需要在构建描述符中添加如下内容即可使用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven （在 \u003ccode\u003epom.xml\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-mqtt\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.2.6\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (in your \u003ccode\u003ebuild.gradle\u003c/code\u003e file):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile io.\u003cspan class=\"hljs-attr\"\u003evertx:\u003c/span\u003evertx-\u003cspan class=\"hljs-attr\"\u003emqtt:\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 id=\"_vert_x_mqtt_server\" class=\"sect0\"\u003e\u003ca class=\"anchor\" href=\"#_vert_x_mqtt_server\"\u003e\u003c/a\u003eVert.x MQTT 服务端\u003c/h1\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个组件提供了一个服务，它能处理远程 \u003ca href=\"http://mqtt.org/\"\u003eMQTT\u003c/a\u003e 连接，通信和信息交换。\n它的API提供了一系列接收客户端原生协议消息的事件，\n并且提供了一些发送信息到客户端的功能。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在编写该文档时，该组件支持 MQTT 协议的 5.0 版本除 AUTH 消息外的所有消息类型（AUTH 消息还未实现）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e它不是一个功能齐全的 MQTT broker，但可以用来建立类似的东西或者进行协议转换。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e警告\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n这个模块还处于技术预览阶段,这意味着它的API在接下来的版本中可能会改变。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_getting_started\"\u003e\u003ca class=\"anchor\" href=\"#_getting_started\"\u003e\u003c/a\u003e开始\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_client_connectiondisconnection\"\u003e\u003ca class=\"anchor\" href=\"#_handling_client_connectiondisconnection\"\u003e\u003c/a\u003e处理客户端连接/断开\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个例子展示了如何处理一个来自远程 MQTT 客户端的请求，\n首先，它会创建一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServer.html\"\u003eMqttServer\u003c/a\u003e\u003c/code\u003e 实例，\n然后使用 endpointHandler 方法指定一个处理器来处理远程客户端发送的CONNECT信息，一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html\"\u003eMqttEndpoint\u003c/a\u003e\u003c/code\u003e\n实例会作为 handler 的参数传入，它携带了所有与CONNECT消息相关联的主要信息，例如客户端标识符，\n用户名/密码，\"will\"信息，session 清除标志，协议版本,保活超时，\n和 CONNECT 消息中的消息属性 (对应于 MQTT 协议的 5.0 版本)等。\n在 handler 内, \u003cem\u003eendpoint\u003c/em\u003e 实例提供 accept 方法以相应的 CONNACK 消息响应远程客户端，\n通过这种方式，成功建立连接。\n最后，通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServer.html#listen-io.vertx.core.Handler-\"\u003elisten\u003c/a\u003e\u003c/code\u003e\n方法启动一个默认的服务端（运行在 localhost 上并且默认 MQTT 端口为 1883），\n这个方法同样允许指定一个 handler 来检查是否服务器是否已经正常启动。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eMqttServer\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003emqttServer\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e MqttServer.create(vertx);\nmqttServer.endpointHandler(endpoint -\u0026gt; {\n\n  \u003cspan class=\"hljs-comment\"\u003e// shows main connect info\u003c/span\u003e\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT client [\u0026quot;\u003c/span\u003e + endpoint.clientIdentifier() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;] request to connect, clean session = \u0026quot;\u003c/span\u003e + endpoint.isCleanSession());\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (endpoint.auth() != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[username = \u0026quot;\u003c/span\u003e + endpoint.auth().getUsername() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;, password = \u0026quot;\u003c/span\u003e + endpoint.auth().getPassword() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n  }\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[properties = \u0026quot;\u003c/span\u003e + endpoint.connectProperties() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (endpoint.will() != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[will topic = \u0026quot;\u003c/span\u003e + endpoint.will().getWillTopic() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; msg = \u0026quot;\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e(endpoint.will().getWillMessageBytes()) +\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot; QoS = \u0026quot;\u003c/span\u003e + endpoint.will().getWillQos() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; isRetain = \u0026quot;\u003c/span\u003e + endpoint.will().isWillRetain() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n  }\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[keep alive timeout = \u0026quot;\u003c/span\u003e + endpoint.keepAliveTimeSeconds() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// accept connection from the remote client\u003c/span\u003e\n  endpoint.accept(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\n})\n  .listen(ar -\u0026gt; {\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT server is listening on port \u0026quot;\u003c/span\u003e + ar.result().actualPort());\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error on starting the server\u0026quot;\u003c/span\u003e);\n      ar.cause().printStackTrace();\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当远程客户端发送一个 DISCONNECT 消息来主动断开与服务端的连接，\n这个 \u003cem\u003eendpoint\u003c/em\u003e 实例提供了一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#disconnectMessageHandler-io.vertx.core.Handler-\"\u003edisconnectMessageHandler\u003c/a\u003e\u003c/code\u003e 方法来指定 handler 进行处理，\n该 handler 有一个类型为 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/messages/MqttDisconnectMessage.html\"\u003eMqttDisconnectMessage\u003c/a\u003e\u003c/code\u003e 的参数\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.disconnectMessageHandler(disconnectMessage -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received disconnect from client, reason code = \u0026quot;\u003c/span\u003e + disconnectMessage.code());\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想使用 MQTT 协议的 5.0 或更高的版本中服务端可以发送 DISCONNECT 消息并指定断开连接的原因代码和属性给客户端的特性，\n可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#disconnect-io.vertx.mqtt.messages.codes.MqttDisconnectReasonCode-io.netty.handler.codec.mqtt.MqttProperties-\"\u003edisconnect\u003c/a\u003e\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_client_connectiondisconnection_with_ssltls_support\"\u003e\u003ca class=\"anchor\" href=\"#_handling_client_connectiondisconnection_with_ssltls_support\"\u003e\u003c/a\u003e支持使用SSL / TLS 处理客户端连接/断开连接\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务端支持通过 SSL/TLS 方式来授权和加密客户端的连接请求，\n为了做到这一点，\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServerOptions.html\"\u003eMqttServerOptions\u003c/a\u003e\u003c/code\u003e 类提供了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setSsl-boolean-\"\u003esetSsl\u003c/a\u003e\u003c/code\u003e\n方法来启用 SSL/TLS(值设为 true)，以及一些其他有用的方法来配置服务端证书和相关私钥\n（作为 java 键存储引用，PEM 或 PFX 格式），在下面的例子中，\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setKeyCertOptions-io.vertx.core.net.KeyCertOptions-\"\u003esetKeyCertOptions\u003c/a\u003e\u003c/code\u003e\n方法可以用来配置PEM格式的证书， 这个方法需要一个\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/KeyCertOptions.html\"\u003eKeyCertOptions\u003c/a\u003e\u003c/code\u003e 接口的实例作为参数传入。与此同时，\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/PemKeyCertOptions.html\"\u003ePemKeyCertOptions\u003c/a\u003e\u003c/code\u003e\n类提供了\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/PemKeyCertOptions.html#setCertPath-java.lang.String-\"\u003esetCertPath\u003c/a\u003e\u003c/code\u003e 和\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/PemKeyCertOptions.html#setKeyPath-java.lang.String-\"\u003esetKeyPath\u003c/a\u003e\u003c/code\u003e\n来分别设置 服务端的证书和私钥的路径。MQTT 服务端需要一个 Vert.x 实例和一个上面提到的 MQTT 配置实例作为参数来启动。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eMqttServerOptions\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoptions\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMqttServerOptions\u003c/span\u003e()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e8883\u003c/span\u003e)\n  .setKeyCertOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePemKeyCertOptions\u003c/span\u003e()\n    .setKeyPath(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./src/test/resources/tls/server-key.pem\u0026quot;\u003c/span\u003e)\n    .setCertPath(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./src/test/resources/tls/server-cert.pem\u0026quot;\u003c/span\u003e))\n  .setSsl(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n\n\u003cspan class=\"hljs-type\"\u003eMqttServer\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003emqttServer\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e MqttServer.create(vertx, options);\nmqttServer.endpointHandler(endpoint -\u0026gt; {\n\n  \u003cspan class=\"hljs-comment\"\u003e// shows main connect info\u003c/span\u003e\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT client [\u0026quot;\u003c/span\u003e + endpoint.clientIdentifier() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;] request to connect, clean session = \u0026quot;\u003c/span\u003e + endpoint.isCleanSession());\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (endpoint.auth() != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[username = \u0026quot;\u003c/span\u003e + endpoint.auth().getUsername() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;, password = \u0026quot;\u003c/span\u003e + endpoint.auth().getPassword() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (endpoint.will() != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[will topic = \u0026quot;\u003c/span\u003e + endpoint.will().getWillTopic() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; msg = \u0026quot;\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e(endpoint.will().getWillMessageBytes()) +\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot; QoS = \u0026quot;\u003c/span\u003e + endpoint.will().getWillQos() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; isRetain = \u0026quot;\u003c/span\u003e + endpoint.will().isWillRetain() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n  }\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;[keep alive timeout = \u0026quot;\u003c/span\u003e + endpoint.keepAliveTimeSeconds() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// accept connection from the remote client\u003c/span\u003e\n  endpoint.accept(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\n})\n  .listen(ar -\u0026gt; {\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT server is listening on port \u0026quot;\u003c/span\u003e + ar.result().actualPort());\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error on starting the server\u0026quot;\u003c/span\u003e);\n      ar.cause().printStackTrace();\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_client_connections_via_websocket\"\u003e\u003ca class=\"anchor\" href=\"#_handling_client_connections_via_websocket\"\u003e\u003c/a\u003e通过 WebSocket 处理客户端的连接\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想要通过 WebSocket 来进行连接，可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServerOptions.html\"\u003eMqttServerOptions\u003c/a\u003e\u003c/code\u003e 将其启用，\n调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServerOptions.html#setUseWebSocket-boolean-\"\u003esetUseWebSocket\u003c/a\u003e\u003c/code\u003e 方法并设置参数为 \u003ccode\u003etrue\u003c/code\u003e ，\n它将会监听 \u003ccode\u003e/mqtt\u003c/code\u003e 路径上所有的 websocket 连接。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e与其他连接的配置方式一样，\n这种方式下 endpoint 的连接创建以及连接断开与常规的连接管理方式相同。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eDeploymentOptions\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoptions\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDeploymentOptions\u003c/span\u003e().setInstances(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\nvertx.deployVerticle(\u003cspan class=\"hljs-string\"\u003e\u0026quot;com.mycompany.MyVerticle\u0026quot;\u003c/span\u003e, options);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_client_subscriptionunsubscription_request\"\u003e\u003ca class=\"anchor\" href=\"#_handling_client_subscriptionunsubscription_request\"\u003e\u003c/a\u003e处理客户端 订阅/退订 请求\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在客户端和服务端的连接建立后，客户端可以发送 SUBSCRIBE 消息以订阅主题。\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html\"\u003eMqttEndpoint\u003c/a\u003e\u003c/code\u003e 允许使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#subscribeHandler-io.vertx.core.Handler-\"\u003esubscribeHandler\u003c/a\u003e\u003c/code\u003e\n方法来指定一个 handler 处理到来的订阅请求，这个 handler 接收一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/messages/MqttSubscribeMessage.html\"\u003eMqttSubscribeMessage\u003c/a\u003e\u003c/code\u003e 类型的实例，\n该实例携带了主题列表以及客户端指定的订阅配置。\n订阅消息的选项包括了 QoS 等级，其他标记位和 MQTT 协议 5.0 版本新添加的标记位，\n例如 \u003ccode\u003enoLocal\u003c/code\u003e 和 \u003ccode\u003eretainAsPublished\u003c/code\u003e。\n最后，这个 endpoint 实例提供了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#subscribeAcknowledge-int-java.util.List-\"\u003esubscribeAcknowledge\u003c/a\u003e\u003c/code\u003e\n方法来回复一个包含原因代码 (可能是 QoS 等级或错误原因代码 - 每个主题或主题模式都有一个)\n和消息属性的 SUBACK 消息给客户端。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.subscribeHandler(subscribe -\u0026gt; {\n\n  List\u0026lt;MqttSubAckReasonCode\u0026gt; reasonCodes = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eArrayList\u003c/span\u003e\u0026lt;\u0026gt;();\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (MqttTopicSubscription s: subscribe.topicSubscriptions()) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Subscription for \u0026quot;\u003c/span\u003e + s.topicName() + \u003cspan class=\"hljs-string\"\u003e\u0026quot; with QoS \u0026quot;\u003c/span\u003e + s.qualityOfService());\n    reasonCodes.add(MqttSubAckReasonCode.qosGranted(s.qualityOfService()));\n  }\n  \u003cspan class=\"hljs-comment\"\u003e// ack the subscriptions request\u003c/span\u003e\n  endpoint.subscribeAcknowledge(subscribe.messageId(), reasonCodes, MqttProperties.NO_PROPERTIES);\n\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e相应的，也可以使用 endpoint 上的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeHandler-io.vertx.core.Handler-\"\u003eunsubscribeHandler\u003c/a\u003e\u003c/code\u003e\n方法来指定一个 handler 来处理客户端的UNSUBSCRIBE消息， 这个 handler 接收一个携带退订主题列表的\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/messages/MqttUnsubscribeMessage.html\"\u003eMqttUnsubscribeMessage\u003c/a\u003e\u003c/code\u003e 类型实例作为参数。\n最后，这个 endpoint 实例提供了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeAcknowledge-int-\"\u003eunsubscribeAcknowledge\u003c/a\u003e\u003c/code\u003e 和\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#unsubscribeAcknowledge-int-java.util.List-io.netty.handler.codec.mqtt.MqttProperties-\"\u003eunsubscribeAcknowledge\u003c/a\u003e\u003c/code\u003e\n方法来回复客户端相关的 UNSUBACK 消息 - 可能是简单地确认所有的取消订阅成功，或者根据每个\n主题或主题模式指定原因代码和 UNSUBSCRIBE 请求中的消息属性(在 MQTT 协议的 5.0 或更高版本中支持)。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.unsubscribeHandler(unsubscribe -\u0026gt; {\n\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (String t: unsubscribe.topics()) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Unsubscription for \u0026quot;\u003c/span\u003e + t);\n  }\n  \u003cspan class=\"hljs-comment\"\u003e// ack the subscriptions request\u003c/span\u003e\n  endpoint.unsubscribeAcknowledge(unsubscribe.messageId());\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_client_published_message\"\u003e\u003ca class=\"anchor\" href=\"#_handling_client_published_message\"\u003e\u003c/a\u003e处理客户端发布的消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了处理远程客户端发布的消息，\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html\"\u003eMqttEndpoint\u003c/a\u003e\u003c/code\u003e 接口提供了\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishHandler-io.vertx.core.Handler-\"\u003epublishHandler\u003c/a\u003e\u003c/code\u003e 方法来指定一个 handler,\n这个handler接收一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/messages/MqttPublishMessage.html\"\u003eMqttPublishMessage\u003c/a\u003e\u003c/code\u003e 类型的实例作为参数，该实例\n包含了载荷信息，QoS 等级，复制和保留标识和消息属性。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 0 (AT_MOST_ONCE), 那么服务端没有必要回复客户端。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 1（AT_LEAST_ONCE），endpoint 需要使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledge-int-\"\u003epublishAcknowledge\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledge-int-io.vertx.mqtt.messages.codes.MqttPubAckReasonCode-io.netty.handler.codec.mqtt.MqttProperties-\"\u003epublishAcknowledge\u003c/a\u003e\u003c/code\u003e 方法回复一个 PUBACK 消息给客户端\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 2（EXACTLY_ONCE），endpoint 需要使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceived-int-\"\u003epublishReceived\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceived-int-io.vertx.mqtt.messages.codes.MqttPubRecReasonCode-io.netty.handler.codec.mqtt.MqttProperties-\"\u003epublishReceived\u003c/a\u003e\u003c/code\u003e 方法回复一个PUBREC消息给客户端。 在这种情况下，\n这个 endpoint 同时也要通过\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReleaseHandler-io.vertx.core.Handler-\"\u003epublishReleaseHandler\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReleaseMessageHandler-io.vertx.core.Handler-\"\u003epublishReleaseMessageHandler\u003c/a\u003e\u003c/code\u003e 指定一个 handler 来处理来自客户端的PUBREL（远程客户端接收到 endpoint 发送的 PUBREC 后发送的）消息 - 取决于服务端是否需要\n使用 MQTT 协议 5.0 版本扩充的内容 (原因代码和消息属性)。\n为了结束 QoS 等级为2的消息的传递，endpoint 可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishComplete-int-\"\u003epublishComplete\u003c/a\u003e\u003c/code\u003e\n或者 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishComplete-int-io.vertx.mqtt.messages.codes.MqttPubCompReasonCode-io.netty.handler.codec.mqtt.MqttProperties-\"\u003epublishComplete\u003c/a\u003e\u003c/code\u003e 方法发送一个 PUBCOMP 消息给客户端。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.publishHandler(message -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Just received message [\u0026quot;\u003c/span\u003e + message.payload().toString(Charset.defaultCharset()) + \u003cspan class=\"hljs-string\"\u003e\u0026quot;] with QoS [\u0026quot;\u003c/span\u003e + message.qosLevel() + \u003cspan class=\"hljs-string\"\u003e\u0026quot;]\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (message.qosLevel() == MqttQoS.AT_LEAST_ONCE) {\n    endpoint.publishAcknowledge(message.messageId());\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (message.qosLevel() == MqttQoS.EXACTLY_ONCE) {\n    endpoint.publishReceived(message.messageId());\n  }\n\n}).publishReleaseHandler(messageId -\u0026gt; {\n\n  endpoint.publishComplete(messageId);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_publish_message_to_the_client\"\u003e\u003ca class=\"anchor\" href=\"#_publish_message_to_the_client\"\u003e\u003c/a\u003e发布消息到客户端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-\"\u003epublish\u003c/a\u003e\u003c/code\u003e\n方法发布一个消息到远程客户端，\n该方法需要补充一下参数：发布主题，消息载荷，QoS 等级，复制和保留标识。\n如果您使用了 MQTT 协议的 5.0 或更高版本，并且想要指定消息属性，那么可以使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-int-io.netty.handler.codec.mqtt.MqttProperties-\"\u003epublish\u003c/a\u003e\u003c/code\u003e\n方法来代替，相比之前介绍的方法，它还可以指定消息 ID 和消息属性。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 0（AT_MOST_ONCE），endpoint 就不会收到任何客户端的响应\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 1（AT_LEAST_ONCE），endpoint 需要处理客户端的PUBACK消息，\n为了收到最后的确认消息，需要使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledgeHandler-io.vertx.core.Handler-\"\u003epublishAcknowledgeHandler\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishAcknowledgeMessageHandler-io.vertx.core.Handler-\"\u003epublishAcknowledgeMessageHandler\u003c/a\u003e\u003c/code\u003e 指定一个handler来接收。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果 QoS 等级是 2（EXACTLY_ONCE），endpoint 需要处理客户端的PUBREC消息，\n可以通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceivedHandler-io.vertx.core.Handler-\"\u003epublishReceivedHandler\u003c/a\u003e\u003c/code\u003e 和\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishReceivedMessageHandler-io.vertx.core.Handler-\"\u003epublishReceivedMessageHandler\u003c/a\u003e\u003c/code\u003e 方法指定一个handler来实现。\n在这个handler内，endpoint 可以使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishRelease-int-\"\u003epublishRelease\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishRelease-int-io.vertx.mqtt.messages.codes.MqttPubRelReasonCode-io.netty.handler.codec.mqtt.MqttProperties-\"\u003epublishRelease\u003c/a\u003e\u003c/code\u003e\n方法回复客户端 PUBREL 消息。最后一步是处理来自客户端的PUBCOMP消息作为已发布消息的最终确认。\n这可以使用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishCompletionHandler-io.vertx.core.Handler-\"\u003epublishCompletionHandler\u003c/a\u003e\u003c/code\u003e 或者\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#publishCompletionMessageHandler-io.vertx.core.Handler-\"\u003epublishCompletionMessageHandler\u003c/a\u003e\u003c/code\u003e\n方法指定一个handler来处理最终接收到的 PUBCOMP 消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.publish(\u003cspan class=\"hljs-string\"\u003e\u0026quot;my_topic\u0026quot;\u003c/span\u003e,\n  Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Hello from the Vert.x MQTT server\u0026quot;\u003c/span\u003e),\n  MqttQoS.EXACTLY_ONCE,\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// specifing handlers for handling QoS 1 and 2\u003c/span\u003e\nendpoint.publishAcknowledgeHandler(messageId -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received ack for message = \u0026quot;\u003c/span\u003e +  messageId);\n\n}).publishReceivedHandler(messageId -\u0026gt; {\n\n  endpoint.publishRelease(messageId);\n\n}).publishCompletionHandler(messageId -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Received ack for message = \u0026quot;\u003c/span\u003e +  messageId);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_be_notified_by_client_keep_alive\"\u003e\u003ca class=\"anchor\" href=\"#_be_notified_by_client_keep_alive\"\u003e\u003c/a\u003e客户端保活通知\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMQTT 底层的保活机制是由服务端内部处理的。当接收到CONNECT消息，\n服务端解析消息中指定的保活超时时间以便于检查客户端在这段时间内是否有发送消息，\n与此同时，没收到一个 PINGREQ 消息，服务端都会回复一个相关的 PINGRESP 消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e尽管上层应用不需要处理这些，\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html\"\u003eMqttEndpoint\u003c/a\u003e\u003c/code\u003e\n依然提供了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttEndpoint.html#pingHandler-io.vertx.core.Handler-\"\u003epingHandler\u003c/a\u003e\u003c/code\u003e 方法来选定一个handler\n来自客户端的 PINGREQ 消息。对于应用程序来说这只是一个通知，\n客户端只会发送一个用于检测保活的没有任何意义的 ping 消息。\n无论如何，PINGRESP 都会被服务端内部自动发送。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eendpoint.pingHandler(v -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Ping received from client\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_closing_the_server\"\u003e\u003ca class=\"anchor\" href=\"#_closing_the_server\"\u003e\u003c/a\u003e关闭服务端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServer.html\"\u003eMqttServer\u003c/a\u003e\u003c/code\u003e 提供了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttServer.html#close-io.vertx.core.Handler-\"\u003eclose\u003c/a\u003e\u003c/code\u003e\n方法来关闭服务。他会停止监听到来的连接以及关闭所有已经建立的连接，\n该方法是一个异步方法，并且可以指定一个成功回调 handler，\n这个 handler 会在服务端完全关闭后被调用\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003emqttServer.close(v -\u0026gt; {\n\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT server closed\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_automatic_clean_up_in_verticles\"\u003e\u003ca class=\"anchor\" href=\"#_automatic_clean_up_in_verticles\"\u003e\u003c/a\u003e在 verticles 中自动清理\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您是在 verticles 内部创建的 MQTT 服务端，当 verticle 卸载时这些服务端会被自动关闭。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_scaling_sharing_mqtt_servers\"\u003e\u003ca class=\"anchor\" href=\"#_scaling_sharing_mqtt_servers\"\u003e\u003c/a\u003e扩展：共享 MQTT 服务器\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e与MQTT服务器相关的 handler 总是在同一个 event loop 线程中执行。\n这意味着在一个多核系统中，仅有一个实例被部署，一个核被使用。\n为了使用更多的核，可以部署更多的 MQTT 服务端实例\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e可以通过编程方式实现：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003ei\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e; i++) {\n\n  \u003cspan class=\"hljs-type\"\u003eMqttServer\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003emqttServer\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e MqttServer.create(vertx);\n  mqttServer.endpointHandler(endpoint -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// handling endpoint\u003c/span\u003e\n  })\n    .listen(ar -\u0026gt; {\n\n      \u003cspan class=\"hljs-comment\"\u003e// handling start listening\u003c/span\u003e\n    });\n\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者使用一个 verticle 指定实例的数量：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eDeploymentOptions\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoptions\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDeploymentOptions\u003c/span\u003e().setInstances(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\nvertx.deployVerticle(\u003cspan class=\"hljs-string\"\u003e\u0026quot;com.mycompany.MyVerticle\u0026quot;\u003c/span\u003e, options);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e实际上，尽管仅有一个MQTT服务器被部署，\n但是当传入的连接到达时，会被 Vert.x 使用轮转算法分发到不同的核上运行的处理器（handlers）上。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 id=\"_vert_x_mqtt_client\" class=\"sect0\"\u003e\u003ca class=\"anchor\" href=\"#_vert_x_mqtt_client\"\u003e\u003c/a\u003eVert.x MQTT 客户端\u003c/h1\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个组件提供了一个符合3.1.1版本规范的 \u003ca href=\"http://mqtt.org/\"\u003eMQTT\u003c/a\u003e 客户端，它的 API 提供了一系列方法来处理连接建立/断开，发布消息（完整支持3种不同等级的 QoS）以及主题订阅\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e警告\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n这个模块还处于技术预览阶段，这意味着它的API在接下来的版本中可能会改变\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_getting_started_2\"\u003e\u003ca class=\"anchor\" href=\"#_getting_started_2\"\u003e\u003c/a\u003e开始\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_connectdisconnect\"\u003e\u003ca class=\"anchor\" href=\"#_connectdisconnect\"\u003e\u003c/a\u003e连接建立/连接断开\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个客户端让您可以与服务端建立连接或者断开连接。\n相应的，您可以通过构造函数的方式传入一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClientOptions.html\"\u003eMqttClientOptions\u003c/a\u003e\u003c/code\u003e 类型的实例\n来指定想要建立连接的服务端的地址和端口号。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e正如下面这个例子所展示的，您可以使用 Vert.x MQTT 客户端实例，分别调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#connect-int-java.lang.String-io.vertx.core.Handler-\"\u003econnect\u003c/a\u003e\u003c/code\u003e 和 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#disconnect--\"\u003edisconnect\u003c/a\u003e\u003c/code\u003e 方法\n来完成与服务端的连接建立或者断开。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eMqttClient\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eclient\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e MqttClient.create(vertx);\n\nclient.connect(\u003cspan class=\"hljs-number\"\u003e1883\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;mqtt.eclipse.org\u0026quot;\u003c/span\u003e, s -\u0026gt; {\n  client.disconnect();\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n如果您在使用 SSL/TSL，服务端 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClientOptions.html\"\u003eMqttClientOptions\u003c/a\u003e\u003c/code\u003e 提供的默认的地址是 localhost:1883 和 localhost:8883 。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_subscribe_to_a_topic\"\u003e\u003ca class=\"anchor\" href=\"#_subscribe_to_a_topic\"\u003e\u003c/a\u003e订阅主题消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e现在，让我们再仔细看一下这个示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.publishHandler(s -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;There are new message in topic: \u0026quot;\u003c/span\u003e + s.topicName());\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Content(as string) of the message: \u0026quot;\u003c/span\u003e + s.payload().toString());\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;QoS: \u0026quot;\u003c/span\u003e + s.qosLevel());\n})\n  .subscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;rpi2/temp\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这里我们有一个使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#subscribe-java.lang.String-int-\"\u003esubscribe\u003c/a\u003e\u003c/code\u003e 方法的例子， 为了接收到主题为 rpi2/temp 的消息，\n我们调用了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#subscribe-java.lang.String-int-\"\u003esubscribe\u003c/a\u003e\u003c/code\u003e 方法， 因此，为了能接收到的服务端的消息，您需要提供一个 handler，每当您订阅的主题有新的消息传来，这个 handler 就会被调用。\n正如这个实例描述的，您需要通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#publishHandler-io.vertx.core.Handler-\"\u003epublishHandler\u003c/a\u003e\u003c/code\u003e 方法来指定 handler。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_publishing_message_to_a_topic\"\u003e\u003ca class=\"anchor\" href=\"#_publishing_message_to_a_topic\"\u003e\u003c/a\u003e发布主题消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想要发布消息到主题上去就需要使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#publish-java.lang.String-io.vertx.core.buffer.Buffer-io.netty.handler.codec.mqtt.MqttQoS-boolean-boolean-\"\u003epublish\u003c/a\u003e\u003c/code\u003e 方法。\n让我们来看下面这个示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.publish(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temperature\u0026quot;\u003c/span\u003e,\n  Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\u0026quot;hello\u0026quot;\u003c/span\u003e),\n  MqttQoS.AT_LEAST_ONCE,\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在这个示例中我们发布了消息到名称为 “temperature” 的主题上去。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_keep_connection_with_server_alive\"\u003e\u003ca class=\"anchor\" href=\"#_keep_connection_with_server_alive\"\u003e\u003c/a\u003e与服务端保持连接\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了保持与服务端的连接，您需要时不时地发送一些数据到服务端，否则服务端可能会断开连接。\n使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#ping--\"\u003eping\u003c/a\u003e\u003c/code\u003e 方法来保持连接是一个不错的选择。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock important\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e重要\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n您的客户端默认情况下会自动保持与服务端的连接，这也意味着您不需要调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#ping--\"\u003eping\u003c/a\u003e\u003c/code\u003e 方法来保活，\n因为 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html\"\u003eMqttClient\u003c/a\u003e\u003c/code\u003e 已经帮您做了这些事。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您不想要这个特性，您需要调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClientOptions.html#setAutoKeepAlive-boolean-\"\u003esetAutoKeepAlive\u003c/a\u003e\u003c/code\u003e 方法，设置参数为 \u003ccode\u003efalse\u003c/code\u003e 即可。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoptions.setAutoKeepAlive(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_be_notified_when\"\u003e\u003ca class=\"anchor\" href=\"#_be_notified_when\"\u003e\u003c/a\u003e通知时机\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e发布完成\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您需要调用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/mqtt/MqttClient.html#publishCompletionHandler-io.vertx.core.Handler-\"\u003epublishCompletionHandler\u003c/a\u003e\u003c/code\u003e 来指定一个handler，这个handler每次发布完成都会被调用。\n这一步是非常有用的，因为您可以看到 PUBACK 或者 PUBCOMP 数据包的 packetId。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre\u003eclient.publishCompletionHandler(id -\u0026gt; {\n  System.out.println(\"Id of just received PUBACK or PUBCOMP packet is \" + id);\n});\n  // The line of code below will trigger publishCompletionHandler (QoS 2)\nclient.publish(\"hello\", Buffer.buffer(\"hello\"), MqttQoS.EXACTLY_ONCE, false, false);\n  // The line of code below will trigger publishCompletionHandler (QoS is 1)\nclient.publish(\"hello\", Buffer.buffer(\"hello\"), MqttQoS.AT_LEAST_ONCE, false, false);\n  // The line of code below does not trigger because QoS value is 0\nclient.publish(\"hello\", Buffer.buffer(\"hello\"), MqttQoS.AT_LEAST_ONCE, false, false);\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e警告\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n如果设置发布消息的 QoS=0，这个 handler 就不会被调用。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e订阅完成\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.subscribeCompletionHandler(mqttSubAckMessage -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Id of just received SUBACK packet is \u0026quot;\u003c/span\u003e + mqttSubAckMessage.messageId());\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e s : mqttSubAckMessage.grantedQoSLevels()) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (s == \u003cspan class=\"hljs-number\"\u003e0x80\u003c/span\u003e) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failure\u0026quot;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Success. Maximum QoS is \u0026quot;\u003c/span\u003e + s);\n    }\n  }\n});\nclient.subscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\nclient.subscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp2\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e退订完成\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient\n  .unsubscribeCompletionHandler(id -\u0026gt; {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Id of just received UNSUBACK packet is \u0026quot;\u003c/span\u003e + id);\n  });\nclient.subscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\nclient.unsubscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp\u0026quot;\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e退订发布\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.subscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\nclient.unsubscribe(\u003cspan class=\"hljs-string\"\u003e\u0026quot;temp\u0026quot;\u003c/span\u003e, id -\u0026gt; {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Id of just sent UNSUBSCRIBE packet is \u0026quot;\u003c/span\u003e + id);\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e接收 PINGRESP\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.pingResponseHandler(s -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e//The handler will be called time to time by default\u003c/span\u003e\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;We have just received PINGRESP packet\u0026quot;\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_use_proxy_protocol\"\u003e\u003ca class=\"anchor\" href=\"#_use_proxy_protocol\"\u003e\u003c/a\u003e使用代理协议\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eMqttServer\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003emqttServer\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e MqttServer\n  .create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMqttServerOptions\u003c/span\u003e()\n    \u003cspan class=\"hljs-comment\"\u003e// 设置是否使用代理为 true\u003c/span\u003e\n    .setUseProxyProtocol(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e));\nmqttServer.endpointHandler(endpoint -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// 此处设置的远程地址为真实的 MQTT 服务器地址，而不是代理地址\u003c/span\u003e\n  System.out.println(endpoint.remoteAddress());\n  endpoint.accept(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\n})\n  .listen(ar -\u0026gt; {\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;MQTT server is listening on port \u0026quot;\u003c/span\u003e + ar.result().actualPort());\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Error on starting the server\u0026quot;\u003c/span\u003e);\n      ar.cause().printStackTrace();\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您的服务器位于 haproxy 或 nginx 之后，并且您希望获取到 MQTT 客户端真实的 ip 和端口，那么您需要将 \u003ccode\u003esetUseProxyProtocol\u003c/code\u003e 选项设置为 \u003ccode\u003etrue\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock important\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e重要\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n为了使用该特性， 您需要添加 \u003ccode\u003enetty-codec-haproxy\u003c/code\u003e 依赖项。 但是默认情况下该依赖不会被引入，因此您需要手动添加\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (在您的 \u003ccode\u003epom.xml\u003c/code\u003e 中):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.netty\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003enetty-codec-haproxy\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.2.6\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile io.\u003cspan class=\"hljs-attr\"\u003enetty:\u003c/span\u003enetty-codec-\u003cspan class=\"hljs-attr\"\u003ehaproxy:\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.2.6"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.2.6","vertx-mqtt","java"]},"buildId":"spiwwP79yF1AQ-wr254ci","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>