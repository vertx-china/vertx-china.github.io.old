<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>Oauth2 Auth | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-auth" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.f20dca63.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.f20dca63.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7cf166b02b2c6c50cd71.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" as="script"/></head><body><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">App generator <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">Channels</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">How-To’s <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x User Group" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x User Group</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_authorization_code_flow">Authorization Code Flow</a></li>
<li><a href="#_password_credentials_flow">Password Credentials Flow</a></li>
<li><a href="#_client_credentials_flow">Client Credentials Flow</a></li>
<li><a href="#_jwt_on_behalf_of_flow">JWT (on behalf of) Flow</a></li>
<li><a href="#_extensions">Extensions</a></li>
<li><a href="#_getting_started">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_authorization_code_flow_2">Authorization Code flow</a></li>
<li><a href="#_password_credentials_flow_2">Password Credentials Flow</a></li>
<li><a href="#_client_credentials_flow_2">Client Credentials Flow</a></li>
</ul>
</li>
<li><a href="#_openid_connect_discovery">OpenID Connect Discovery</a></li>
<li><a href="#_user_object">User object</a></li>
<li><a href="#_example_configuration_for_common_oauth2_providers">Example configuration for common OAuth2 providers</a>
<ul class="sectlevel2">
<li><a href="#_jboss_keycloak">JBoss Keycloak</a></li>
<li><a href="#_google_server_to_server">Google Server to Server</a></li>
</ul>
</li>
<li><a href="#_token_introspection">Token Introspection</a></li>
<li><a href="#_verifying_jwt_tokens">Verifying JWT tokens</a></li>
<li><a href="#_role_based_access_control">Role Based Access Control</a>
<ul class="sectlevel2">
<li><a href="#_keycloak_jwt">Keycloak JWT</a></li>
<li><a href="#_microprofile_jwt_1_1_spec">MicroProfile JWT 1.1 spec</a></li>
</ul>
</li>
<li><a href="#_token_management">Token Management</a>
<ul class="sectlevel2">
<li><a href="#_check_if_it_is_expired">Check if it is expired</a></li>
<li><a href="#_refresh_token">Refresh token</a></li>
<li><a href="#_revoke_token">Revoke token</a></li>
<li><a href="#_introspect">Introspect</a></li>
<li><a href="#_logging_out">Logging out</a></li>
</ul>
</li>
<li><a href="#_key_management">Key Management</a></li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/vert-x3/vertx-auth"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-auth-oauth2/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.0.3<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-auth-oauth2/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.0.3<!-- -->)</li></a><a href="/docs/3.9.6/vertx-auth-oauth2/java/"><li class="dropdown-item has-active-siblings">v<!-- -->3.9.6</li></a></ul></div></span></div></div><div><h1>OAuth2 auth provider</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This component contains an out of the box OAuth2 (and to some extent OpenID Connect) relying party implementation.
To use this project, add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-auth-oauth2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">'io.vertx:vertx-auth-oauth2:4.0.3'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>OAuth2 lets users grant the access to the desired resources to third party applications, giving them the possibility
to enable and disable those accesses whenever they want.</p>
</div>
<div class="paragraph">
<p>Vert.x OAuth2 supports the following flows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization Code Flow (for apps with servers that can store persistent information).</p>
</li>
<li>
<p>Password Credentials Flow (when previous flow can&#8217;t be used or during development).</p>
</li>
<li>
<p>Client Credentials Flow (the client can request an access token using only its client credentials)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same code will work with OpenID Connect <a href="https://openid.net/connect/" class="bare">https://openid.net/connect/</a> servers and supports the Discovery protocol
as specified in <a href="http://openid.net/specs/openid-connect-discovery-1_0.html" class="bare">http://openid.net/specs/openid-connect-discovery-1_0.html</a> .</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authorization_code_flow"><a class="anchor" href="#_authorization_code_flow"></a>Authorization Code Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The authorization code grant type is used to obtain both access tokens and refresh tokens and is optimized for
confidential clients. As a redirection-based flow, the client must be capable of interacting with the resource
owner&#8217;s user-agent (typically a web browser) and capable of receiving incoming requests (via redirection) from the
authorization server.</p>
</div>
<div class="paragraph">
<p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.1">Oauth2 specification, section 4.1</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_password_credentials_flow"><a class="anchor" href="#_password_credentials_flow"></a>Password Credentials Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The resource owner password credentials grant type is suitable in cases where the resource owner has a trust
relationship with the client, such as the device operating system or a highly privileged application. The
authorization server should take special care when enabling this grant type, and only allow it when other flows are
not viable.</p>
</div>
<div class="paragraph">
<p>The grant type is suitable for clients capable of obtaining the resource owner&#8217;s credentials (username and password,
typically using an interactive form).  It is also used to migrate existing clients using direct authentication
schemes such as HTTP Basic or Digest authentication to OAuth by converting the stored credentials to an access token.</p>
</div>
<div class="paragraph">
<p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.3">Oauth2 specification, section 4.3</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_client_credentials_flow"><a class="anchor" href="#_client_credentials_flow"></a>Client Credentials Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client can request an access token using only its client credentials (or other supported means of authentication)
when the client is requesting access to the protected resources under its control, or those of another resource owner
that have been previously arranged with the authorization server (the method of which is beyond the scope of this
specification).</p>
</div>
<div class="paragraph">
<p>The client credentials grant type MUST only be used by confidential clients.</p>
</div>
<div class="paragraph">
<p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.4">Oauth2 specification, section 4.4</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jwt_on_behalf_of_flow"><a class="anchor" href="#_jwt_on_behalf_of_flow"></a>JWT (on behalf of) Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client can request an access token using JWTs also known as "on-behalf-of".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extensions"><a class="anchor" href="#_extensions"></a>Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The provider supports RFC7523 an extension to allow server to server authorization based on JWT.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An example on how to use this provider and authenticate with GitHub can be implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OAuth2Auth oauth2 = OAuth2Auth.create(vertx, <span class="hljs-keyword">new</span> OAuth2Options()
  .setFlow(OAuth2FlowType.AUTH_CODE)
  .setClientID(<span class="hljs-string">"YOUR_CLIENT_ID"</span>)
  .setClientSecret(<span class="hljs-string">"YOUR_CLIENT_SECRET"</span>)
  .setSite(<span class="hljs-string">"https://github.com/login"</span>)
  .setTokenPath(<span class="hljs-string">"/oauth/access_token"</span>)
  .setAuthorizationPath(<span class="hljs-string">"/oauth/authorize"</span>)
);

<span class="hljs-comment">// when there is a need to access a protected resource</span>
<span class="hljs-comment">// or call a protected method, call the authZ url for</span>
<span class="hljs-comment">// a challenge</span>

String authorization_uri = oauth2.authorizeURL(<span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"redirect_uri"</span>, <span class="hljs-string">"http://localhost:8080/callback"</span>)
  .put(<span class="hljs-string">"scope"</span>, <span class="hljs-string">"notifications"</span>)
  .put(<span class="hljs-string">"state"</span>, <span class="hljs-string">"3(#0/!~"</span>));

<span class="hljs-comment">// when working with web application use the above string as a redirect url</span>

<span class="hljs-comment">// in this case GitHub will call you back in the callback uri one</span>
<span class="hljs-comment">// should now complete the handshake as:</span>

<span class="hljs-comment">// the code is provided as a url parameter by github callback call</span>
String code = <span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxx"</span>;

oauth2.authenticate(
  <span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">"code"</span>, code)
    .put(<span class="hljs-string">"redirect_uri"</span>, <span class="hljs-string">"http://localhost:8080/callback"</span>))
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// save the token and continue...</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// error, the code provided is not valid</span>
  });</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_authorization_code_flow_2"><a class="anchor" href="#_authorization_code_flow_2"></a>Authorization Code flow</h3>
<div class="paragraph">
<p>The Authorization Code flow is made up from two parts. At first your application asks to the user the permission to
access their data. If the user approves the OAuth2 server sends to the client an authorization code. In the second
part, the client POST the authorization code along with its client secret to the authority server in order to get the
access token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OAuth2Options credentials = <span class="hljs-keyword">new</span> OAuth2Options()
  .setFlow(OAuth2FlowType.AUTH_CODE)
  .setClientID(<span class="hljs-string">"&lt;client-id&gt;"</span>)
  .setClientSecret(<span class="hljs-string">"&lt;client-secret&gt;"</span>)
  .setSite(<span class="hljs-string">"https://api.oauth.com"</span>);


<span class="hljs-comment">// Initialize the OAuth2 Library</span>
OAuth2Auth oauth2 = OAuth2Auth.create(vertx, credentials);

<span class="hljs-comment">// Authorization oauth2 URI</span>
String authorization_uri = oauth2.authorizeURL(<span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"redirect_uri"</span>, <span class="hljs-string">"http://localhost:8080/callback"</span>)
  .put(<span class="hljs-string">"scope"</span>, <span class="hljs-string">"&lt;scope&gt;"</span>)
  .put(<span class="hljs-string">"state"</span>, <span class="hljs-string">"&lt;state&gt;"</span>));

<span class="hljs-comment">// Redirect example using Vert.x</span>
response.putHeader(<span class="hljs-string">"Location"</span>, authorization_uri)
  .setStatusCode(<span class="hljs-number">302</span>)
  .end();

JsonObject tokenConfig = <span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"code"</span>, <span class="hljs-string">"&lt;code&gt;"</span>)
  .put(<span class="hljs-string">"redirect_uri"</span>, <span class="hljs-string">"http://localhost:3000/callback"</span>);

<span class="hljs-comment">// Callbacks</span>
<span class="hljs-comment">// Save the access token</span>
oauth2.authenticate(tokenConfig)
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// Get the access token object</span>
    <span class="hljs-comment">// (the authorization code is given from the previous step).</span>
  })
  .onFailure(err -&gt; {
    System.err.println(<span class="hljs-string">"Access Token Error: "</span> + err.getMessage());
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_password_credentials_flow_2"><a class="anchor" href="#_password_credentials_flow_2"></a>Password Credentials Flow</h3>
<div class="paragraph">
<p>This flow is suitable when the resource owner has a trust relationship with the client, such as its computer
operating system or a highly privileged application. Use this flow only when other flows are not viable or when you
need a fast way to test your application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OAuth2Auth oauth2 = OAuth2Auth.create(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setFlow(OAuth2FlowType.PASSWORD));

JsonObject tokenConfig = <span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"username"</span>, <span class="hljs-string">"username"</span>)
  .put(<span class="hljs-string">"password"</span>, <span class="hljs-string">"password"</span>);

oauth2.authenticate(tokenConfig)
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// Get the access token object</span>
    <span class="hljs-comment">// (the authorization code is given from the previous step).</span>

    <span class="hljs-comment">// you can now make requests using the</span>
    <span class="hljs-comment">// `Authorization` header and the value:</span>
    String httpAuthorizationHeader = user.principal()
      .getString(<span class="hljs-string">"access_token"</span>);

  })
  .onFailure(err -&gt; {
    System.err.println(<span class="hljs-string">"Access Token Error: "</span> + err.getMessage());
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_client_credentials_flow_2"><a class="anchor" href="#_client_credentials_flow_2"></a>Client Credentials Flow</h3>
<div class="paragraph">
<p>This flow is suitable when client is requesting access to the protected resources under its control.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OAuth2Options credentials = <span class="hljs-keyword">new</span> OAuth2Options()
  .setFlow(OAuth2FlowType.CLIENT)
  .setClientID(<span class="hljs-string">"&lt;client-id&gt;"</span>)
  .setClientSecret(<span class="hljs-string">"&lt;client-secret&gt;"</span>)
  .setSite(<span class="hljs-string">"https://api.oauth.com"</span>);


<span class="hljs-comment">// Initialize the OAuth2 Library</span>
OAuth2Auth oauth2 = OAuth2Auth.create(vertx, credentials);

JsonObject tokenConfig = <span class="hljs-keyword">new</span> JsonObject();

oauth2.authenticate(tokenConfig)
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// Success</span>
  })
  .onFailure(err -&gt; {
    System.err.println(<span class="hljs-string">"Access Token Error: "</span> + err.getMessage());
  });</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_openid_connect_discovery"><a class="anchor" href="#_openid_connect_discovery"></a>OpenID Connect Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is limited support for OpenID Discovery servers. Using OIDC Discovery will simplify the configuration of your
auth module into a single line of code, for example, consider setting up your auth using Google:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OpenIDConnectAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>)
    .setSite(<span class="hljs-string">"https://accounts.google.com"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// the setup call succeeded.</span>
    <span class="hljs-comment">// at this moment your auth is ready to use and</span>
    <span class="hljs-comment">// google signature keys are loaded so tokens can be decoded and verified.</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// the setup failed.</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Behind the scenes a couple of actions are performed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTTP get request to the <code>.well-known/openid-configuration</code> resource</p>
</li>
<li>
<p>Validation of the response <code>issuer</code> field as mandated by the spec (the issuer value must match the request one)</p>
</li>
<li>
<p>If the JWK uri is present, keys are loaded from the server and added to the auth keychain</p>
</li>
<li>
<p>the auth module is configure and returned to the user.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A couple of well known OpenID Connect Discovery providers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keycloak: <code><a href="http://keycloakhost:keycloakport/auth/realms/{realm}" class="bare">http://keycloakhost:keycloakport/auth/realms/{realm}</a></code></p>
</li>
<li>
<p>Google: <code><a href="https://accounts.google.com" class="bare">https://accounts.google.com</a></code></p>
</li>
<li>
<p>SalesForce: <code><a href="https://login.salesforce.com" class="bare">https://login.salesforce.com</a></code></p>
</li>
<li>
<p>Microsoft: <code><a href="https://login.windows.net/common" class="bare">https://login.windows.net/common</a></code></p>
</li>
<li>
<p>IBM Cloud: <code><a href="https://&lt;region-id&gt;.appid.cloud.ibm.com/oauth/v4/&lt;tenant-id&gt" class="bare">https://&lt;region-id&gt;.appid.cloud.ibm.com/oauth/v4/&lt;tenant-id&gt</a>;</code></p>
</li>
<li>
<p>Amazon Cognito: <code>"https://cognito-idp.&lt;region&gt;.amazonaws.com/&lt;user-pool-id&gt;"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This and the given <code>client id/client secret</code> is enough to configure your auth provider object.</p>
</div>
<div class="paragraph">
<p>For these well known providers a shortcut is provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">KeycloakAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>)
    .setSite(<span class="hljs-string">"http://keycloakhost:keycloakport/auth/realms/{realm}"</span>)
    .setTenant(<span class="hljs-string">"your-realm"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// ...</span>
  });

<span class="hljs-comment">// Google example</span>
GoogleAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// ...</span>
  });

<span class="hljs-comment">// Salesforce example</span>
SalesforceAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// ...</span>
  });

<span class="hljs-comment">// Azure AD example</span>
AzureADAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>)
    .setTenant(<span class="hljs-string">"your-app-guid"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// ...</span>
  });

<span class="hljs-comment">// IBM Cloud example</span>
IBMCloudAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setClientSecret(<span class="hljs-string">"clientSecret"</span>)
    .setSite(<span class="hljs-string">"https://&lt;region-id&gt;.appid.cloud.ibm.com/oauth/v4/{tenant}"</span>)
    .setTenant(<span class="hljs-string">"your-tenant-id"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// ...</span>
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_object"><a class="anchor" href="#_user_object"></a>User object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a token expires we need to refresh it. OAuth2 offers the AccessToken class that add a couple of useful methods
to refresh the access token when it is expired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">if</span> (user.expired()) {
  <span class="hljs-comment">// Callbacks</span>
  oauth2.refresh(user)
    .onSuccess(refreshedUser -&gt; {
      <span class="hljs-comment">// the refreshed user is now available</span>
    })
    .onFailure(err -&gt; {
      <span class="hljs-comment">// error handling...</span>
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you&#8217;ve done with the token or you want to log out, you can revoke the access token and refresh token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.revoke(user, <span class="hljs-string">"access_token"</span>)
  .onSuccess(v -&gt; {
    <span class="hljs-comment">// Session ended. But the refresh_token is still valid.</span>

    <span class="hljs-comment">// Revoke the refresh_token</span>
    oauth2.revoke(user, <span class="hljs-string">"refresh_token"</span>)
      .onSuccess(v2 -&gt; {
        System.out.println(<span class="hljs-string">"token revoked."</span>);
      });
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_configuration_for_common_oauth2_providers"><a class="anchor" href="#_example_configuration_for_common_oauth2_providers"></a>Example configuration for common OAuth2 providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For convenience there are several helpers to assist your with your configuration. Currently we provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon Cognito <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/AmazonCognitoAuth.html">AmazonCognitoAuth</a></code></p>
</li>
<li>
<p>Azure Active Directory <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/AzureADAuth.html">AzureADAuth</a></code></p>
</li>
<li>
<p>Box.com <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/BoxAuth.html">BoxAuth</a></code></p>
</li>
<li>
<p>CloudFoundry <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/CloudFoundryAuth.html">CloudFoundryAuth</a></code></p>
</li>
<li>
<p>Dropbox <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/DropboxAuth.html">DropboxAuth</a></code></p>
</li>
<li>
<p>Facebook <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/FacebookAuth.html">FacebookAuth</a></code></p>
</li>
<li>
<p>Foursquare <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/FoursquareAuth.html">FoursquareAuth</a></code></p>
</li>
<li>
<p>Github <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/GithubAuth.html">GithubAuth</a></code></p>
</li>
<li>
<p>GitLab <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/GitLabAuth.html">GitLabAuth</a></code></p>
</li>
<li>
<p>Google <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/GoogleAuth.html">GoogleAuth</a></code></p>
</li>
<li>
<p>Heroku <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/HerokuAuth.html">HerokuAuth</a></code></p>
</li>
<li>
<p>IBM Cloud <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/IBMCloudAuth.html">IBMCloudAuth</a></code></p>
</li>
<li>
<p>Instagram <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/InstagramAuth.html">InstagramAuth</a></code></p>
</li>
<li>
<p>Keycloak <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/KeycloakAuth.html">KeycloakAuth</a></code></p>
</li>
<li>
<p>LinkedIn <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/LinkedInAuth.html">LinkedInAuth</a></code></p>
</li>
<li>
<p>Live.com <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/LiveAuth.html">LiveAuth</a></code></p>
</li>
<li>
<p>Mailchimp <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/MailchimpAuth.html">MailchimpAuth</a></code></p>
</li>
<li>
<p>OpenIDConnect <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/OpenIDConnectAuth.html">OpenIDConnectAuth</a></code></p>
</li>
<li>
<p>Salesforce <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/SalesforceAuth.html">SalesforceAuth</a></code></p>
</li>
<li>
<p>Shopify <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/ShopifyAuth.html">ShopifyAuth</a></code></p>
</li>
<li>
<p>Soundcloud <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/SoundcloudAuth.html">SoundcloudAuth</a></code></p>
</li>
<li>
<p>Stripe <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/StripeAuth.html">StripeAuth</a></code></p>
</li>
<li>
<p>Twitter <code><a href="../../apidocs/io/vertx/ext/auth/oauth2/providers/TwitterAuth.html">TwitterAuth</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_jboss_keycloak"><a class="anchor" href="#_jboss_keycloak"></a>JBoss Keycloak</h3>
<div class="paragraph">
<p>When using this Keycloak the provider has knowledge on how to parse access tokens and extract grants from inside.
This information is quite valuable since it allows to do authorization at the API level, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">JsonObject keycloakJson = <span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"realm"</span>, <span class="hljs-string">"master"</span>)
  .put(<span class="hljs-string">"realm-public-key"</span>, <span class="hljs-string">"MIIBIjANBgkqhk...wIDAQAB"</span>)
  .put(<span class="hljs-string">"auth-server-url"</span>, <span class="hljs-string">"http://localhost:9000/auth"</span>)
  .put(<span class="hljs-string">"ssl-required"</span>, <span class="hljs-string">"external"</span>)
  .put(<span class="hljs-string">"resource"</span>, <span class="hljs-string">"frontend"</span>)
  .put(<span class="hljs-string">"credentials"</span>, <span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">"secret"</span>, <span class="hljs-string">"2fbf5e18-b923-4a83-9657-b4ebd5317f60"</span>));

<span class="hljs-comment">// Initialize the OAuth2 Library</span>
OAuth2Auth oauth2 = KeycloakAuth
  .create(vertx, OAuth2FlowType.PASSWORD, keycloakJson);

<span class="hljs-comment">// first get a token (authenticate)</span>
oauth2.authenticate(
  <span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">"username"</span>, <span class="hljs-string">"user"</span>)
    .put(<span class="hljs-string">"password"</span>, <span class="hljs-string">"secret"</span>))
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// now check for permissions</span>
    AuthorizationProvider authz = KeycloakAuthorization.create();

    authz.getAuthorizations(user)
      .onSuccess(v -&gt; {
        <span class="hljs-keyword">if</span> (
          RoleBasedAuthorization.create(<span class="hljs-string">"manage-account"</span>)
            .setResource(<span class="hljs-string">"account"</span>)
            .match(user)) {
          <span class="hljs-comment">// this user is authorized to manage its account</span>
        }
      });
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also provide a helper class for Keycloak so that we can we can easily retrieve decoded token and some necessary
data (e.g. <code>preferred_username</code>) from the Keycloak principal. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">JsonObject idToken = user.attributes().getJsonObject(<span class="hljs-string">"idToken"</span>);

<span class="hljs-comment">// you can also retrieve some properties directly from the Keycloak principal</span>
<span class="hljs-comment">// e.g. `preferred_username`</span>
String username = user.principal().getString(<span class="hljs-string">"preferred_username"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please remember that Keycloak <strong>does</strong> implement OpenID Connect, so you can configure it just by using it&#8217;s discovery url:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">OpenIDConnectAuth.discover(
  vertx,
  <span class="hljs-keyword">new</span> OAuth2Options()
    .setClientID(<span class="hljs-string">"clientId"</span>)
    .setTenant(<span class="hljs-string">"your_realm"</span>)
    .setSite(<span class="hljs-string">"http://server:port/auth/realms/{tenant}"</span>))
  .onSuccess(oauth2 -&gt; {
    <span class="hljs-comment">// the setup call succeeded.</span>
    <span class="hljs-comment">// at this moment your auth is ready to use</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since you can deploy your Keycloak server anywhere, just replace <code>server:port</code> with the correct value and the <code>your_realm</code>
value with your application realm.</p>
</div>
</div>
<div class="sect2">
<h3 id="_google_server_to_server"><a class="anchor" href="#_google_server_to_server"></a>Google Server to Server</h3>
<div class="paragraph">
<p>The provider also supports Server to Server or the RFC7523 extension. This is a feature present on Google with their
service account.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_token_introspection"><a class="anchor" href="#_token_introspection"></a>Token Introspection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tokens can be introspected in order to assert that they are still valid. Although there is RFC7662 for this purpose
not many providers implement it. Instead there are variations also known as <code>TokenInfo</code> end points. The OAuth2
provider will accept both end points as a configuration. Currently we are known to work with <code>Google</code> and <code>Keycloak</code>.</p>
</div>
<div class="paragraph">
<p>Token introspection assumes that tokens are opaque, so they need to be validated on the provider server. Every time a
token is validated it requires a round trip to the provider. Introspection can be performed at the OAuth2 level or at
the User level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.authenticate(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"access_token"</span>, <span class="hljs-string">"opaque string"</span>))
  .onSuccess(theUser -&gt; {
    <span class="hljs-comment">// token is valid!</span>
  });

<span class="hljs-comment">// User level</span>
oauth2.authenticate(user.principal())
  .onSuccess(authenticatedUser -&gt; {
    <span class="hljs-comment">// Token is valid!</span>
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_jwt_tokens"><a class="anchor" href="#_verifying_jwt_tokens"></a>Verifying JWT tokens</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve just covered how to introspect a token however when dealing with JWT tokens one can reduce the amount of trips
to the provider server thus enhancing your overall response times. In this case tokens will be verified using the
JWT protocol at your application side only. Verifying JWT tokens is cheaper and offers better performance, however
due to the stateless nature of JWTs it is not possible to know if a user is logged out and a token is invalid. For
this specific case one needs to use the token introspection if the provider supports it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.authenticate(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"access_token"</span>, <span class="hljs-string">"jwt-token"</span>))
  .onSuccess(theUser -&gt; {
    <span class="hljs-comment">// token is valid!</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Until now we covered mostly authentication, although the implementation is relying party (that means that the real
authentication happens somewhere else), there is more you can do with the handler. For example you can also do
authorization if the provider is known to support JSON web tokens. This is a common feature if your provider is a
OpenId Connect provider or if the provider does support `access_token`s as JWTs.</p>
</div>
<div class="paragraph">
<p>Such provider is Keycloak that is a OpenId Connect implementation. In that case you will be able to perform
authorization in a very easy way.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_based_access_control"><a class="anchor" href="#_role_based_access_control"></a>Role Based Access Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OAuth2 is an AuthN protocol, however OpenId Connect adds JWTs to the token format which means that AuthZ can be encoded
at the token level. Currently there are 2 known JWT AuthZ known formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keycloak</p>
</li>
<li>
<p>MicroProfile JWT 1.1 spec (from the auth-jwt module)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_keycloak_jwt"><a class="anchor" href="#_keycloak_jwt"></a>Keycloak JWT</h3>
<div class="paragraph">
<p>Given that Keycloak does provide <code>JWT</code> access_tokens one can authorize at two distinct levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>role</p>
</li>
<li>
<p>authority</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To distinct the two, the auth provider follows the same recommendations from the base user class, i.e.: use the`:` as
a separator for the two. It should be noted that both role and authorities do not need to be together, in the most
simple case an authority is enough.</p>
</div>
<div class="paragraph">
<p>In order to map to keycloak&#8217;s token format the following checks are performed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If no role is provided, it is assumed to the the provider realm name</p>
</li>
<li>
<p>If the role is <code>realm</code> then the lookup happens in <code>realm_access</code> list</p>
</li>
<li>
<p>If a role is provided then the lookup happends in the <code>resource_access</code> list under the role name</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_check_for_a_specific_authorities"><a class="anchor" href="#_check_for_a_specific_authorities"></a>Check for a specific authorities</h4>
<div class="paragraph">
<p>Here is one example how you can perform authorization after the user has been loaded from the oauth2 handshake, for
example you want to see if the user can <code>print</code> in the current application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">if</span> (PermissionBasedAuthorization.create(<span class="hljs-string">"print"</span>).match(user)) {
  <span class="hljs-comment">// Yes the user can print</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However this is quite specific, you might want to verify if the user can <code>add-user</code> to the whole system (the realm):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">if</span> (
  PermissionBasedAuthorization.create(<span class="hljs-string">"add-user"</span>)
    .setResource(<span class="hljs-string">"realm"</span>)
    .match(user)) {
  <span class="hljs-comment">// Yes the user can add users to the application</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if the user can access the <code>year-report</code> in the <code>finance</code> department:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">if</span> (
  PermissionBasedAuthorization.create(<span class="hljs-string">"year-report"</span>)
    .setResource(<span class="hljs-string">"finance"</span>)
    .match(user)) {
  <span class="hljs-comment">// Yes the user can access the year report from the finance department</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_microprofile_jwt_1_1_spec"><a class="anchor" href="#_microprofile_jwt_1_1_spec"></a>MicroProfile JWT 1.1 spec</h3>
<div class="paragraph">
<p>Another format in the form of a spec is the MP-JWT 1.1. This spec defines a JSON array of strings under the property
name <code>groups</code> that define the "groups" the token has an authority over.</p>
</div>
<div class="paragraph">
<p>In order to use this spec to assert AuthZ use the <code><a href="../../apidocs/io/vertx/ext/auth/authorization/AuthorizationProvider.html">AuthorizationProvider</a></code> factory
provided on the <code>auth-jwt</code> module.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_token_management"><a class="anchor" href="#_token_management"></a>Token Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_check_if_it_is_expired"><a class="anchor" href="#_check_if_it_is_expired"></a>Check if it is expired</h3>
<div class="paragraph">
<p>Tokens are usually fetched from the server and cached, in this case when used later they might have already expired
and be invalid, you can verify if the token is still valid like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">boolean</span> isExpired = user.expired();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This call is totally offline, it could still happen that the Oauth2 server invalidated your token but you get a non
expired token result. The reason behind this is that the expiration is checked against the token expiration dates,
not before date and such values.</p>
</div>
</div>
<div class="sect2">
<h3 id="_refresh_token"><a class="anchor" href="#_refresh_token"></a>Refresh token</h3>
<div class="paragraph">
<p>There are times you know the token is about to expire and would like to avoid to redirect the user again to the login
screen. In this case you can refresh the token. To refresh a token you need to have already a user and call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.refresh(user)
  .onSuccess(refreshedUser -&gt; {
    <span class="hljs-comment">// the refresh call succeeded</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// the token was not refreshed, a best practise would be</span>
    <span class="hljs-comment">// to forcefully logout the user since this could be a</span>
    <span class="hljs-comment">// symptom that you're logged out by the server and this</span>
    <span class="hljs-comment">// token is not valid anymore.</span>
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_revoke_token"><a class="anchor" href="#_revoke_token"></a>Revoke token</h3>
<div class="paragraph">
<p>Since tokens can be shared across various applications you might want to disallow the usage of the current token by
any application. In order to do this one needs to revoke the token against the Oauth2 server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.revoke(user, <span class="hljs-string">"access_token"</span>)
  .onSuccess(v -&gt; {
    <span class="hljs-comment">// the revoke call succeeded</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// the token was not revoked.</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that this call requires a token type. The reason is because some providers will return more
than one token e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>id_token</p>
</li>
<li>
<p>refresh_token</p>
</li>
<li>
<p>access_token</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So one needs to know what token to invalidate. It should be obvious that if you invalidate the <code>refresh_token</code> you&#8217;re
still logged in but you won&#8217;t be able to refresh anymore, which means that once the token expires you need to redirect
the user again to the login page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_introspect"><a class="anchor" href="#_introspect"></a>Introspect</h3>
<div class="paragraph">
<p>Introspect a token is similar to a expiration check, however one needs to note that this check is fully online. This
means that the check happens on the OAuth2 server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.authenticate(user.principal())
  .onSuccess(validUser -&gt; {
    <span class="hljs-comment">// the introspection call succeeded</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// the token failed the introspection. You should proceed</span>
    <span class="hljs-comment">// to logout the user since this means that this token is</span>
    <span class="hljs-comment">// not valid anymore.</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Important note is that even if the <code>expired()</code> call is <code>true</code> the return from the <code>introspect</code> call can still be an
error. This is because the OAuth2 might have received a request to invalidate the token or a loggout in between.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging_out"><a class="anchor" href="#_logging_out"></a>Logging out</h3>
<div class="paragraph">
<p>Logging out is not a <code>Oauth2</code> feature but it is present on <code>OpenID Connect</code> and most providers do support some sort
of logging out. This provider also covers this area if the configuration is enough to let it make the call. For the
user this is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">user.logout(res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {
    <span class="hljs-comment">// the logout call succeeded</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// the user might not have been logged out</span>
    <span class="hljs-comment">// to know why:</span>
    System.err.println(res.cause());
  }
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_management"><a class="anchor" href="#_key_management"></a>Key Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the provider is configured with a <code>jwks</code> path. Either manually or using the discovery mechanism, there are events
when keys must be rotated. For this reason this provider implements the 2 recommended ways by the openid connect core
spec.</p>
</div>
<div class="paragraph">
<p>When calling the refresh method, if the server returns the recommended cache header as described on
<a href="https://openid.net/specs/openid-connect-core-1_0.html#RotateEncKeys" class="bare">https://openid.net/specs/openid-connect-core-1_0.html#RotateEncKeys</a> then a periodic task will run at the recommeneded
time by the server to reload the keys.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">boolean</span> isExpired = user.expired();</code></pre>
</div>
</div>
<div class="paragraph">
<p>However there are times when servers change keys and this provider isn&#8217;t aware. For example, to mitigate a leak or an
expired certificate. In such event the server will start emitting tokens with a different kid than the ones on the store
as described: <a href="https://openid.net/specs/openid-connect-core-1_0.html#RotateSigKeys" class="bare">https://openid.net/specs/openid-connect-core-1_0.html#RotateSigKeys</a> For this situation and to avoid DDoS
attacks the provider will notify you that a unknown key is missing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">oauth2.refresh(user)
  .onSuccess(refreshedUser -&gt; {
    <span class="hljs-comment">// the refresh call succeeded</span>
  })
  .onFailure(err -&gt; {
    <span class="hljs-comment">// the token was not refreshed, a best practise would be</span>
    <span class="hljs-comment">// to forcefully logout the user since this could be a</span>
    <span class="hljs-comment">// symptom that you're logged out by the server and this</span>
    <span class="hljs-comment">// token is not valid anymore.</span>
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>A special note on this is that if a user will send many requests with a missing key, your handler should throttle the
calls to refresh the new key set, or you might end up DDoS your IdP server.</p>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">Channels</a></li><li><a href="https://how-to.vertx.io/">How-To’s</a></li><li><a href="https://start.vertx.io/">App Generator</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse Foundation</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li><li><a href="https://www.eclipse.org/legal/">Legal Resources</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x<br/>Eclipse Vert.x is open source and dual-licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a> and the <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>. <br class="footer-copyright-break"/>Website design by <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a>.</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"vertx-auth-oauth2/java","title":"OAuth2 auth provider","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_authorization_code_flow\"\u003eAuthorization Code Flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_password_credentials_flow\"\u003ePassword Credentials Flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_client_credentials_flow\"\u003eClient Credentials Flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_jwt_on_behalf_of_flow\"\u003eJWT (on behalf of) Flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_extensions\"\u003eExtensions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_getting_started\"\u003eGetting Started\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_authorization_code_flow_2\"\u003eAuthorization Code flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_password_credentials_flow_2\"\u003ePassword Credentials Flow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_client_credentials_flow_2\"\u003eClient Credentials Flow\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_openid_connect_discovery\"\u003eOpenID Connect Discovery\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_user_object\"\u003eUser object\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_example_configuration_for_common_oauth2_providers\"\u003eExample configuration for common OAuth2 providers\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_jboss_keycloak\"\u003eJBoss Keycloak\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_google_server_to_server\"\u003eGoogle Server to Server\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_token_introspection\"\u003eToken Introspection\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_verifying_jwt_tokens\"\u003eVerifying JWT tokens\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_role_based_access_control\"\u003eRole Based Access Control\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_keycloak_jwt\"\u003eKeycloak JWT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_microprofile_jwt_1_1_spec\"\u003eMicroProfile JWT 1.1 spec\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_token_management\"\u003eToken Management\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_check_if_it_is_expired\"\u003eCheck if it is expired\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_refresh_token\"\u003eRefresh token\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_revoke_token\"\u003eRevoke token\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_introspect\"\u003eIntrospect\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_logging_out\"\u003eLogging out\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_key_management\"\u003eKey Management\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eOAuth2 auth provider\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis component contains an out of the box OAuth2 (and to some extent OpenID Connect) relying party implementation.\nTo use this project, add the following dependency to the \u003cem\u003edependencies\u003c/em\u003e section of your build descriptor:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (in your \u003ccode\u003epom.xml\u003c/code\u003e):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-auth-oauth2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.3\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (in your \u003ccode\u003ebuild.gradle\u003c/code\u003e file):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-auth-oauth2:4.0.3'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOAuth2 lets users grant the access to the desired resources to third party applications, giving them the possibility\nto enable and disable those accesses whenever they want.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x OAuth2 supports the following flows.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAuthorization Code Flow (for apps with servers that can store persistent information).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePassword Credentials Flow (when previous flow can\u0026#8217;t be used or during development).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClient Credentials Flow (the client can request an access token using only its client credentials)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe same code will work with OpenID Connect \u003ca href=\"https://openid.net/connect/\" class=\"bare\"\u003ehttps://openid.net/connect/\u003c/a\u003e servers and supports the Discovery protocol\nas specified in \u003ca href=\"http://openid.net/specs/openid-connect-discovery-1_0.html\" class=\"bare\"\u003ehttp://openid.net/specs/openid-connect-discovery-1_0.html\u003c/a\u003e .\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authorization_code_flow\"\u003e\u003ca class=\"anchor\" href=\"#_authorization_code_flow\"\u003e\u003c/a\u003eAuthorization Code Flow\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe authorization code grant type is used to obtain both access tokens and refresh tokens and is optimized for\nconfidential clients. As a redirection-based flow, the client must be capable of interacting with the resource\nowner\u0026#8217;s user-agent (typically a web browser) and capable of receiving incoming requests (via redirection) from the\nauthorization server.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor more details see \u003ca href=\"http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.1\"\u003eOauth2 specification, section 4.1\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_password_credentials_flow\"\u003e\u003ca class=\"anchor\" href=\"#_password_credentials_flow\"\u003e\u003c/a\u003ePassword Credentials Flow\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe resource owner password credentials grant type is suitable in cases where the resource owner has a trust\nrelationship with the client, such as the device operating system or a highly privileged application. The\nauthorization server should take special care when enabling this grant type, and only allow it when other flows are\nnot viable.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe grant type is suitable for clients capable of obtaining the resource owner\u0026#8217;s credentials (username and password,\ntypically using an interactive form).  It is also used to migrate existing clients using direct authentication\nschemes such as HTTP Basic or Digest authentication to OAuth by converting the stored credentials to an access token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor more details see \u003ca href=\"http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.3\"\u003eOauth2 specification, section 4.3\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_client_credentials_flow\"\u003e\u003ca class=\"anchor\" href=\"#_client_credentials_flow\"\u003e\u003c/a\u003eClient Credentials Flow\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client can request an access token using only its client credentials (or other supported means of authentication)\nwhen the client is requesting access to the protected resources under its control, or those of another resource owner\nthat have been previously arranged with the authorization server (the method of which is beyond the scope of this\nspecification).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client credentials grant type MUST only be used by confidential clients.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor more details see \u003ca href=\"http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.4\"\u003eOauth2 specification, section 4.4\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_jwt_on_behalf_of_flow\"\u003e\u003ca class=\"anchor\" href=\"#_jwt_on_behalf_of_flow\"\u003e\u003c/a\u003eJWT (on behalf of) Flow\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client can request an access token using JWTs also known as \"on-behalf-of\".\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_extensions\"\u003e\u003ca class=\"anchor\" href=\"#_extensions\"\u003e\u003c/a\u003eExtensions\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe provider supports RFC7523 an extension to allow server to server authorization based on JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_getting_started\"\u003e\u003ca class=\"anchor\" href=\"#_getting_started\"\u003e\u003c/a\u003eGetting Started\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAn example on how to use this provider and authenticate with GitHub can be implemented as:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOAuth2Auth oauth2 = OAuth2Auth.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n  .setFlow(OAuth2FlowType.AUTH_CODE)\n  .setClientID(\u003cspan class=\"hljs-string\"\u003e\"YOUR_CLIENT_ID\"\u003c/span\u003e)\n  .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"YOUR_CLIENT_SECRET\"\u003c/span\u003e)\n  .setSite(\u003cspan class=\"hljs-string\"\u003e\"https://github.com/login\"\u003c/span\u003e)\n  .setTokenPath(\u003cspan class=\"hljs-string\"\u003e\"/oauth/access_token\"\u003c/span\u003e)\n  .setAuthorizationPath(\u003cspan class=\"hljs-string\"\u003e\"/oauth/authorize\"\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// when there is a need to access a protected resource\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// or call a protected method, call the authZ url for\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// a challenge\u003c/span\u003e\n\nString authorization_uri = oauth2.authorizeURL(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"redirect_uri\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"http://localhost:8080/callback\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"scope\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"notifications\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"state\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"3(#0/!~\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// when working with web application use the above string as a redirect url\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// in this case GitHub will call you back in the callback uri one\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// should now complete the handshake as:\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// the code is provided as a url parameter by github callback call\u003c/span\u003e\nString code = \u003cspan class=\"hljs-string\"\u003e\"xxxxxxxxxxxxxxxxxxxxxxxx\"\u003c/span\u003e;\n\noauth2.authenticate(\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e, code)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"redirect_uri\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"http://localhost:8080/callback\"\u003c/span\u003e))\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// save the token and continue...\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// error, the code provided is not valid\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_authorization_code_flow_2\"\u003e\u003ca class=\"anchor\" href=\"#_authorization_code_flow_2\"\u003e\u003c/a\u003eAuthorization Code flow\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Authorization Code flow is made up from two parts. At first your application asks to the user the permission to\naccess their data. If the user approves the OAuth2 server sends to the client an authorization code. In the second\npart, the client POST the authorization code along with its client secret to the authority server in order to get the\naccess token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOAuth2Options credentials = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n  .setFlow(OAuth2FlowType.AUTH_CODE)\n  .setClientID(\u003cspan class=\"hljs-string\"\u003e\"\u0026lt;client-id\u0026gt;\"\u003c/span\u003e)\n  .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"\u0026lt;client-secret\u0026gt;\"\u003c/span\u003e)\n  .setSite(\u003cspan class=\"hljs-string\"\u003e\"https://api.oauth.com\"\u003c/span\u003e);\n\n\n\u003cspan class=\"hljs-comment\"\u003e// Initialize the OAuth2 Library\u003c/span\u003e\nOAuth2Auth oauth2 = OAuth2Auth.create(vertx, credentials);\n\n\u003cspan class=\"hljs-comment\"\u003e// Authorization oauth2 URI\u003c/span\u003e\nString authorization_uri = oauth2.authorizeURL(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"redirect_uri\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"http://localhost:8080/callback\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"scope\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\u0026lt;scope\u0026gt;\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"state\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\u0026lt;state\u0026gt;\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Redirect example using Vert.x\u003c/span\u003e\nresponse.putHeader(\u003cspan class=\"hljs-string\"\u003e\"Location\"\u003c/span\u003e, authorization_uri)\n  .setStatusCode(\u003cspan class=\"hljs-number\"\u003e302\u003c/span\u003e)\n  .end();\n\nJsonObject tokenConfig = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\u0026lt;code\u0026gt;\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"redirect_uri\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"http://localhost:3000/callback\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Callbacks\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Save the access token\u003c/span\u003e\noauth2.authenticate(tokenConfig)\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// Get the access token object\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// (the authorization code is given from the previous step).\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    System.err.println(\u003cspan class=\"hljs-string\"\u003e\"Access Token Error: \"\u003c/span\u003e + err.getMessage());\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_password_credentials_flow_2\"\u003e\u003ca class=\"anchor\" href=\"#_password_credentials_flow_2\"\u003e\u003c/a\u003ePassword Credentials Flow\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis flow is suitable when the resource owner has a trust relationship with the client, such as its computer\noperating system or a highly privileged application. Use this flow only when other flows are not viable or when you\nneed a fast way to test your application.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOAuth2Auth oauth2 = OAuth2Auth.create(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setFlow(OAuth2FlowType.PASSWORD));\n\nJsonObject tokenConfig = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e);\n\noauth2.authenticate(tokenConfig)\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// Get the access token object\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// (the authorization code is given from the previous step).\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// you can now make requests using the\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// `Authorization` header and the value:\u003c/span\u003e\n    String httpAuthorizationHeader = user.principal()\n      .getString(\u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e);\n\n  })\n  .onFailure(err -\u0026gt; {\n    System.err.println(\u003cspan class=\"hljs-string\"\u003e\"Access Token Error: \"\u003c/span\u003e + err.getMessage());\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_client_credentials_flow_2\"\u003e\u003ca class=\"anchor\" href=\"#_client_credentials_flow_2\"\u003e\u003c/a\u003eClient Credentials Flow\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis flow is suitable when client is requesting access to the protected resources under its control.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOAuth2Options credentials = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n  .setFlow(OAuth2FlowType.CLIENT)\n  .setClientID(\u003cspan class=\"hljs-string\"\u003e\"\u0026lt;client-id\u0026gt;\"\u003c/span\u003e)\n  .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"\u0026lt;client-secret\u0026gt;\"\u003c/span\u003e)\n  .setSite(\u003cspan class=\"hljs-string\"\u003e\"https://api.oauth.com\"\u003c/span\u003e);\n\n\n\u003cspan class=\"hljs-comment\"\u003e// Initialize the OAuth2 Library\u003c/span\u003e\nOAuth2Auth oauth2 = OAuth2Auth.create(vertx, credentials);\n\nJsonObject tokenConfig = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject();\n\noauth2.authenticate(tokenConfig)\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// Success\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    System.err.println(\u003cspan class=\"hljs-string\"\u003e\"Access Token Error: \"\u003c/span\u003e + err.getMessage());\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_openid_connect_discovery\"\u003e\u003ca class=\"anchor\" href=\"#_openid_connect_discovery\"\u003e\u003c/a\u003eOpenID Connect Discovery\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere is limited support for OpenID Discovery servers. Using OIDC Discovery will simplify the configuration of your\nauth module into a single line of code, for example, consider setting up your auth using Google:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOpenIDConnectAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e)\n    .setSite(\u003cspan class=\"hljs-string\"\u003e\"https://accounts.google.com\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the setup call succeeded.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// at this moment your auth is ready to use and\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// google signature keys are loaded so tokens can be decoded and verified.\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the setup failed.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBehind the scenes a couple of actions are performed:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eHTTP get request to the \u003ccode\u003e.well-known/openid-configuration\u003c/code\u003e resource\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eValidation of the response \u003ccode\u003eissuer\u003c/code\u003e field as mandated by the spec (the issuer value must match the request one)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf the JWK uri is present, keys are loaded from the server and added to the auth keychain\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe auth module is configure and returned to the user.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA couple of well known OpenID Connect Discovery providers are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eKeycloak: \u003ccode\u003e\u003ca href=\"http://keycloakhost:keycloakport/auth/realms/{realm}\" class=\"bare\"\u003ehttp://keycloakhost:keycloakport/auth/realms/{realm}\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGoogle: \u003ccode\u003e\u003ca href=\"https://accounts.google.com\" class=\"bare\"\u003ehttps://accounts.google.com\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSalesForce: \u003ccode\u003e\u003ca href=\"https://login.salesforce.com\" class=\"bare\"\u003ehttps://login.salesforce.com\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMicrosoft: \u003ccode\u003e\u003ca href=\"https://login.windows.net/common\" class=\"bare\"\u003ehttps://login.windows.net/common\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIBM Cloud: \u003ccode\u003e\u003ca href=\"https://\u0026lt;region-id\u0026gt;.appid.cloud.ibm.com/oauth/v4/\u0026lt;tenant-id\u0026gt\" class=\"bare\"\u003ehttps://\u0026lt;region-id\u0026gt;.appid.cloud.ibm.com/oauth/v4/\u0026lt;tenant-id\u0026gt\u003c/a\u003e;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAmazon Cognito: \u003ccode\u003e\"https://cognito-idp.\u0026lt;region\u0026gt;.amazonaws.com/\u0026lt;user-pool-id\u0026gt;\"\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis and the given \u003ccode\u003eclient id/client secret\u003c/code\u003e is enough to configure your auth provider object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor these well known providers a shortcut is provided:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eKeycloakAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e)\n    .setSite(\u003cspan class=\"hljs-string\"\u003e\"http://keycloakhost:keycloakport/auth/realms/{realm}\"\u003c/span\u003e)\n    .setTenant(\u003cspan class=\"hljs-string\"\u003e\"your-realm\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// Google example\u003c/span\u003e\nGoogleAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// Salesforce example\u003c/span\u003e\nSalesforceAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// Azure AD example\u003c/span\u003e\nAzureADAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e)\n    .setTenant(\u003cspan class=\"hljs-string\"\u003e\"your-app-guid\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// IBM Cloud example\u003c/span\u003e\nIBMCloudAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setClientSecret(\u003cspan class=\"hljs-string\"\u003e\"clientSecret\"\u003c/span\u003e)\n    .setSite(\u003cspan class=\"hljs-string\"\u003e\"https://\u0026lt;region-id\u0026gt;.appid.cloud.ibm.com/oauth/v4/{tenant}\"\u003c/span\u003e)\n    .setTenant(\u003cspan class=\"hljs-string\"\u003e\"your-tenant-id\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_user_object\"\u003e\u003ca class=\"anchor\" href=\"#_user_object\"\u003e\u003c/a\u003eUser object\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen a token expires we need to refresh it. OAuth2 offers the AccessToken class that add a couple of useful methods\nto refresh the access token when it is expired.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (user.expired()) {\n  \u003cspan class=\"hljs-comment\"\u003e// Callbacks\u003c/span\u003e\n  oauth2.refresh(user)\n    .onSuccess(refreshedUser -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// the refreshed user is now available\u003c/span\u003e\n    })\n    .onFailure(err -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// error handling...\u003c/span\u003e\n    });\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen you\u0026#8217;ve done with the token or you want to log out, you can revoke the access token and refresh token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.revoke(user, \u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e)\n  .onSuccess(v -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// Session ended. But the refresh_token is still valid.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// Revoke the refresh_token\u003c/span\u003e\n    oauth2.revoke(user, \u003cspan class=\"hljs-string\"\u003e\"refresh_token\"\u003c/span\u003e)\n      .onSuccess(v2 -\u0026gt; {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"token revoked.\"\u003c/span\u003e);\n      });\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_example_configuration_for_common_oauth2_providers\"\u003e\u003ca class=\"anchor\" href=\"#_example_configuration_for_common_oauth2_providers\"\u003e\u003c/a\u003eExample configuration for common OAuth2 providers\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor convenience there are several helpers to assist your with your configuration. Currently we provide:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAmazon Cognito \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/AmazonCognitoAuth.html\"\u003eAmazonCognitoAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAzure Active Directory \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/AzureADAuth.html\"\u003eAzureADAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBox.com \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/BoxAuth.html\"\u003eBoxAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCloudFoundry \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/CloudFoundryAuth.html\"\u003eCloudFoundryAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDropbox \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/DropboxAuth.html\"\u003eDropboxAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFacebook \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/FacebookAuth.html\"\u003eFacebookAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFoursquare \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/FoursquareAuth.html\"\u003eFoursquareAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGithub \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/GithubAuth.html\"\u003eGithubAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGitLab \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/GitLabAuth.html\"\u003eGitLabAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGoogle \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/GoogleAuth.html\"\u003eGoogleAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHeroku \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/HerokuAuth.html\"\u003eHerokuAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIBM Cloud \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/IBMCloudAuth.html\"\u003eIBMCloudAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInstagram \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/InstagramAuth.html\"\u003eInstagramAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eKeycloak \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/KeycloakAuth.html\"\u003eKeycloakAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLinkedIn \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/LinkedInAuth.html\"\u003eLinkedInAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLive.com \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/LiveAuth.html\"\u003eLiveAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMailchimp \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/MailchimpAuth.html\"\u003eMailchimpAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOpenIDConnect \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/OpenIDConnectAuth.html\"\u003eOpenIDConnectAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSalesforce \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/SalesforceAuth.html\"\u003eSalesforceAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eShopify \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/ShopifyAuth.html\"\u003eShopifyAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSoundcloud \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/SoundcloudAuth.html\"\u003eSoundcloudAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eStripe \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/StripeAuth.html\"\u003eStripeAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTwitter \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/oauth2/providers/TwitterAuth.html\"\u003eTwitterAuth\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_jboss_keycloak\"\u003e\u003ca class=\"anchor\" href=\"#_jboss_keycloak\"\u003e\u003c/a\u003eJBoss Keycloak\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen using this Keycloak the provider has knowledge on how to parse access tokens and extract grants from inside.\nThis information is quite valuable since it allows to do authorization at the API level, for example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eJsonObject keycloakJson = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"realm\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"master\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"realm-public-key\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"MIIBIjANBgkqhk...wIDAQAB\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"auth-server-url\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"http://localhost:9000/auth\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"ssl-required\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"external\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"resource\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"frontend\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"credentials\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"2fbf5e18-b923-4a83-9657-b4ebd5317f60\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Initialize the OAuth2 Library\u003c/span\u003e\nOAuth2Auth oauth2 = KeycloakAuth\n  .create(vertx, OAuth2FlowType.PASSWORD, keycloakJson);\n\n\u003cspan class=\"hljs-comment\"\u003e// first get a token (authenticate)\u003c/span\u003e\noauth2.authenticate(\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e))\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// now check for permissions\u003c/span\u003e\n    AuthorizationProvider authz = KeycloakAuthorization.create();\n\n    authz.getAuthorizations(user)\n      .onSuccess(v -\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\n          RoleBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"manage-account\"\u003c/span\u003e)\n            .setResource(\u003cspan class=\"hljs-string\"\u003e\"account\"\u003c/span\u003e)\n            .match(user)) {\n          \u003cspan class=\"hljs-comment\"\u003e// this user is authorized to manage its account\u003c/span\u003e\n        }\n      });\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWe also provide a helper class for Keycloak so that we can we can easily retrieve decoded token and some necessary\ndata (e.g. \u003ccode\u003epreferred_username\u003c/code\u003e) from the Keycloak principal. For example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eJsonObject idToken = user.attributes().getJsonObject(\u003cspan class=\"hljs-string\"\u003e\"idToken\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// you can also retrieve some properties directly from the Keycloak principal\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// e.g. `preferred_username`\u003c/span\u003e\nString username = user.principal().getString(\u003cspan class=\"hljs-string\"\u003e\"preferred_username\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePlease remember that Keycloak \u003cstrong\u003edoes\u003c/strong\u003e implement OpenID Connect, so you can configure it just by using it\u0026#8217;s discovery url:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eOpenIDConnectAuth.discover(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e OAuth2Options()\n    .setClientID(\u003cspan class=\"hljs-string\"\u003e\"clientId\"\u003c/span\u003e)\n    .setTenant(\u003cspan class=\"hljs-string\"\u003e\"your_realm\"\u003c/span\u003e)\n    .setSite(\u003cspan class=\"hljs-string\"\u003e\"http://server:port/auth/realms/{tenant}\"\u003c/span\u003e))\n  .onSuccess(oauth2 -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the setup call succeeded.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// at this moment your auth is ready to use\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince you can deploy your Keycloak server anywhere, just replace \u003ccode\u003eserver:port\u003c/code\u003e with the correct value and the \u003ccode\u003eyour_realm\u003c/code\u003e\nvalue with your application realm.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_google_server_to_server\"\u003e\u003ca class=\"anchor\" href=\"#_google_server_to_server\"\u003e\u003c/a\u003eGoogle Server to Server\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe provider also supports Server to Server or the RFC7523 extension. This is a feature present on Google with their\nservice account.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_token_introspection\"\u003e\u003ca class=\"anchor\" href=\"#_token_introspection\"\u003e\u003c/a\u003eToken Introspection\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTokens can be introspected in order to assert that they are still valid. Although there is RFC7662 for this purpose\nnot many providers implement it. Instead there are variations also known as \u003ccode\u003eTokenInfo\u003c/code\u003e end points. The OAuth2\nprovider will accept both end points as a configuration. Currently we are known to work with \u003ccode\u003eGoogle\u003c/code\u003e and \u003ccode\u003eKeycloak\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eToken introspection assumes that tokens are opaque, so they need to be validated on the provider server. Every time a\ntoken is validated it requires a round trip to the provider. Introspection can be performed at the OAuth2 level or at\nthe User level:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.authenticate(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"opaque string\"\u003c/span\u003e))\n  .onSuccess(theUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// token is valid!\u003c/span\u003e\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// User level\u003c/span\u003e\noauth2.authenticate(user.principal())\n  .onSuccess(authenticatedUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// Token is valid!\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_verifying_jwt_tokens\"\u003e\u003ca class=\"anchor\" href=\"#_verifying_jwt_tokens\"\u003e\u003c/a\u003eVerifying JWT tokens\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWe\u0026#8217;ve just covered how to introspect a token however when dealing with JWT tokens one can reduce the amount of trips\nto the provider server thus enhancing your overall response times. In this case tokens will be verified using the\nJWT protocol at your application side only. Verifying JWT tokens is cheaper and offers better performance, however\ndue to the stateless nature of JWTs it is not possible to know if a user is logged out and a token is invalid. For\nthis specific case one needs to use the token introspection if the provider supports it.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.authenticate(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"jwt-token\"\u003c/span\u003e))\n  .onSuccess(theUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// token is valid!\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUntil now we covered mostly authentication, although the implementation is relying party (that means that the real\nauthentication happens somewhere else), there is more you can do with the handler. For example you can also do\nauthorization if the provider is known to support JSON web tokens. This is a common feature if your provider is a\nOpenId Connect provider or if the provider does support `access_token`s as JWTs.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSuch provider is Keycloak that is a OpenId Connect implementation. In that case you will be able to perform\nauthorization in a very easy way.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_role_based_access_control\"\u003e\u003ca class=\"anchor\" href=\"#_role_based_access_control\"\u003e\u003c/a\u003eRole Based Access Control\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOAuth2 is an AuthN protocol, however OpenId Connect adds JWTs to the token format which means that AuthZ can be encoded\nat the token level. Currently there are 2 known JWT AuthZ known formats:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eKeycloak\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMicroProfile JWT 1.1 spec (from the auth-jwt module)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_keycloak_jwt\"\u003e\u003ca class=\"anchor\" href=\"#_keycloak_jwt\"\u003e\u003c/a\u003eKeycloak JWT\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eGiven that Keycloak does provide \u003ccode\u003eJWT\u003c/code\u003e access_tokens one can authorize at two distinct levels:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003erole\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eauthority\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo distinct the two, the auth provider follows the same recommendations from the base user class, i.e.: use the`:` as\na separator for the two. It should be noted that both role and authorities do not need to be together, in the most\nsimple case an authority is enough.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn order to map to keycloak\u0026#8217;s token format the following checks are performed:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eIf no role is provided, it is assumed to the the provider realm name\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf the role is \u003ccode\u003erealm\u003c/code\u003e then the lookup happens in \u003ccode\u003erealm_access\u003c/code\u003e list\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf a role is provided then the lookup happends in the \u003ccode\u003eresource_access\u003c/code\u003e list under the role name\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_check_for_a_specific_authorities\"\u003e\u003ca class=\"anchor\" href=\"#_check_for_a_specific_authorities\"\u003e\u003c/a\u003eCheck for a specific authorities\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is one example how you can perform authorization after the user has been loaded from the oauth2 handshake, for\nexample you want to see if the user can \u003ccode\u003eprint\u003c/code\u003e in the current application:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (PermissionBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"print\"\u003c/span\u003e).match(user)) {\n  \u003cspan class=\"hljs-comment\"\u003e// Yes the user can print\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHowever this is quite specific, you might want to verify if the user can \u003ccode\u003eadd-user\u003c/code\u003e to the whole system (the realm):\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\n  PermissionBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"add-user\"\u003c/span\u003e)\n    .setResource(\u003cspan class=\"hljs-string\"\u003e\"realm\"\u003c/span\u003e)\n    .match(user)) {\n  \u003cspan class=\"hljs-comment\"\u003e// Yes the user can add users to the application\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOr if the user can access the \u003ccode\u003eyear-report\u003c/code\u003e in the \u003ccode\u003efinance\u003c/code\u003e department:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\n  PermissionBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"year-report\"\u003c/span\u003e)\n    .setResource(\u003cspan class=\"hljs-string\"\u003e\"finance\"\u003c/span\u003e)\n    .match(user)) {\n  \u003cspan class=\"hljs-comment\"\u003e// Yes the user can access the year report from the finance department\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_microprofile_jwt_1_1_spec\"\u003e\u003ca class=\"anchor\" href=\"#_microprofile_jwt_1_1_spec\"\u003e\u003c/a\u003eMicroProfile JWT 1.1 spec\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnother format in the form of a spec is the MP-JWT 1.1. This spec defines a JSON array of strings under the property\nname \u003ccode\u003egroups\u003c/code\u003e that define the \"groups\" the token has an authority over.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn order to use this spec to assert AuthZ use the \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/authorization/AuthorizationProvider.html\"\u003eAuthorizationProvider\u003c/a\u003e\u003c/code\u003e factory\nprovided on the \u003ccode\u003eauth-jwt\u003c/code\u003e module.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_token_management\"\u003e\u003ca class=\"anchor\" href=\"#_token_management\"\u003e\u003c/a\u003eToken Management\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_check_if_it_is_expired\"\u003e\u003ca class=\"anchor\" href=\"#_check_if_it_is_expired\"\u003e\u003c/a\u003eCheck if it is expired\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTokens are usually fetched from the server and cached, in this case when used later they might have already expired\nand be invalid, you can verify if the token is still valid like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eboolean\u003c/span\u003e isExpired = user.expired();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis call is totally offline, it could still happen that the Oauth2 server invalidated your token but you get a non\nexpired token result. The reason behind this is that the expiration is checked against the token expiration dates,\nnot before date and such values.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_refresh_token\"\u003e\u003ca class=\"anchor\" href=\"#_refresh_token\"\u003e\u003c/a\u003eRefresh token\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere are times you know the token is about to expire and would like to avoid to redirect the user again to the login\nscreen. In this case you can refresh the token. To refresh a token you need to have already a user and call:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.refresh(user)\n  .onSuccess(refreshedUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the refresh call succeeded\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the token was not refreshed, a best practise would be\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// to forcefully logout the user since this could be a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// symptom that you're logged out by the server and this\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// token is not valid anymore.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_revoke_token\"\u003e\u003ca class=\"anchor\" href=\"#_revoke_token\"\u003e\u003c/a\u003eRevoke token\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince tokens can be shared across various applications you might want to disallow the usage of the current token by\nany application. In order to do this one needs to revoke the token against the Oauth2 server:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.revoke(user, \u003cspan class=\"hljs-string\"\u003e\"access_token\"\u003c/span\u003e)\n  .onSuccess(v -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the revoke call succeeded\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the token was not revoked.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIt is important to note that this call requires a token type. The reason is because some providers will return more\nthan one token e.g.:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eid_token\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003erefresh_token\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eaccess_token\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSo one needs to know what token to invalidate. It should be obvious that if you invalidate the \u003ccode\u003erefresh_token\u003c/code\u003e you\u0026#8217;re\nstill logged in but you won\u0026#8217;t be able to refresh anymore, which means that once the token expires you need to redirect\nthe user again to the login page.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_introspect\"\u003e\u003ca class=\"anchor\" href=\"#_introspect\"\u003e\u003c/a\u003eIntrospect\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIntrospect a token is similar to a expiration check, however one needs to note that this check is fully online. This\nmeans that the check happens on the OAuth2 server.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.authenticate(user.principal())\n  .onSuccess(validUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the introspection call succeeded\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the token failed the introspection. You should proceed\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// to logout the user since this means that this token is\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// not valid anymore.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImportant note is that even if the \u003ccode\u003eexpired()\u003c/code\u003e call is \u003ccode\u003etrue\u003c/code\u003e the return from the \u003ccode\u003eintrospect\u003c/code\u003e call can still be an\nerror. This is because the OAuth2 might have received a request to invalidate the token or a loggout in between.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_logging_out\"\u003e\u003ca class=\"anchor\" href=\"#_logging_out\"\u003e\u003c/a\u003eLogging out\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eLogging out is not a \u003ccode\u003eOauth2\u003c/code\u003e feature but it is present on \u003ccode\u003eOpenID Connect\u003c/code\u003e and most providers do support some sort\nof logging out. This provider also covers this area if the configuration is enough to let it make the call. For the\nuser this is as simple as:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003euser.logout(res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// the logout call succeeded\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// the user might not have been logged out\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// to know why:\u003c/span\u003e\n    System.err.println(res.cause());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_key_management\"\u003e\u003ca class=\"anchor\" href=\"#_key_management\"\u003e\u003c/a\u003eKey Management\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen the provider is configured with a \u003ccode\u003ejwks\u003c/code\u003e path. Either manually or using the discovery mechanism, there are events\nwhen keys must be rotated. For this reason this provider implements the 2 recommended ways by the openid connect core\nspec.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen calling the refresh method, if the server returns the recommended cache header as described on\n\u003ca href=\"https://openid.net/specs/openid-connect-core-1_0.html#RotateEncKeys\" class=\"bare\"\u003ehttps://openid.net/specs/openid-connect-core-1_0.html#RotateEncKeys\u003c/a\u003e then a periodic task will run at the recommeneded\ntime by the server to reload the keys.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eboolean\u003c/span\u003e isExpired = user.expired();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHowever there are times when servers change keys and this provider isn\u0026#8217;t aware. For example, to mitigate a leak or an\nexpired certificate. In such event the server will start emitting tokens with a different kid than the ones on the store\nas described: \u003ca href=\"https://openid.net/specs/openid-connect-core-1_0.html#RotateSigKeys\" class=\"bare\"\u003ehttps://openid.net/specs/openid-connect-core-1_0.html#RotateSigKeys\u003c/a\u003e For this situation and to avoid DDoS\nattacks the provider will notify you that a unknown key is missing:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eoauth2.refresh(user)\n  .onSuccess(refreshedUser -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the refresh call succeeded\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// the token was not refreshed, a best practise would be\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// to forcefully logout the user since this could be a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// symptom that you're logged out by the server and this\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// token is not valid anymore.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA special note on this is that if a user will send many requests with a missing key, your handler should throttle the\ncalls to refresh the new key set, or you might end up DDoS your IdP server.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["vertx-auth-oauth2","java"]},"buildId":"SNoKZlKGt8D8t6Tc6_UYD","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7cf166b02b2c6c50cd71.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" async=""></script><script src="/_next/static/SNoKZlKGt8D8t6Tc6_UYD/_buildManifest.js" async=""></script><script src="/_next/static/SNoKZlKGt8D8t6Tc6_UYD/_ssgManifest.js" async=""></script></body></html>