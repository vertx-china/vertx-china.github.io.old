<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>STOMP | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-stomp" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.f20dca63.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.f20dca63.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.f7eb36393fca57ab228a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" as="script"/></head><body><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">App generator <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">Channels</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">How-To’s <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x User Group" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x User Group</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_vertx_stomp">使用 vertx-stomp</a></li>
<li><a href="#_stomp_server">STOMP 服务器</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_stomp_server">创建 STOMP 服务器</a></li>
<li><a href="#_closing_a_stomp_server">关闭 STOMP 服务器</a></li>
<li><a href="#_configuration">配置服务端</a></li>
<li><a href="#_subscriptions">订阅</a></li>
<li><a href="#_type_of_destinations">消息目的地点类型</a></li>
<li><a href="#_providing_your_own_type_of_destination">提供您自定义的目的地类型</a></li>
<li><a href="#_acknowledgment">确认消息</a></li>
<li><a href="#_customizing_the_stomp_server">自定义 STOMP 服务器配置</a></li>
</ul>
</li>
<li><a href="#_stomp_client">STOMP 客户端</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_stomp_client">创建 STOMP 客户端</a></li>
<li><a href="#_closing_a_stomp_client">关闭 STOMP 客户端</a></li>
<li><a href="#_handling_errors">错误处理</a></li>
<li><a href="#_configuration_2">配置客户端</a></li>
<li><a href="#_subscribing_to_destinations">订阅</a></li>
<li><a href="#_sending_messages">发送消息</a></li>
<li><a href="#_acknowledgements">确认消息</a></li>
<li><a href="#_transactions">事务</a></li>
<li><a href="#_receipt">确认消息</a></li>
</ul>
</li>
<li><a href="#_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus">使用 STOMP 服务器桥接 Vert.x 事件总线</a></li>
<li><a href="#_using_the_stomp_server_with_web_sockets">使用基于 websocket 的 STOMP 服务器</a></li>
<li><a href="#_registering_received_and_writing_frame_handlers">注册接收消息处理器和写入消息处理器</a></li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/vert-x3/vertx-stomp"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-stomp/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.0.3<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-stomp/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.0.3<!-- -->)</li></a><a href="/docs/3.9.6/vertx-stomp/java/"><li class="dropdown-item has-active-siblings">v<!-- -->3.9.6</li></a></ul></div></span></div></div><div><h1>Vert.x-Stomp</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>STOMP 即简单(流)文本定向消息。 STOMP
提供了一种可交互的消息管线，因此 STOMP 客户端可以与任意的 STOMP 消息中介（broker） 通信，并
基于各种不同的语言，平台与消息中介实现信息的交互和操作。 参阅 <a href="https://stomp.github.io/index.html" class="bare">https://stomp.github.io/index.html</a> 了解更多关于 STOMP 的信息。</p>
</div>
<div class="paragraph">
<p>Vertx-Stomp 提供了 STOMP 客户端和服务端的实现。 您可以使用其他客户端连接 Vert.x 的 STOMP 服务端，也可以
使用 Vert.x 的 STOMP 客户端连接其他服务端实现。 Vert.x 提供的服务端和客户端都支持 STOMP 的 1.0，1.1 和 1.2
版本  (参见 <a href="https://stomp.github.io/stomp-specification-1.2.html)。" class="bare">https://stomp.github.io/stomp-specification-1.2.html)。</a> 该 STOMP 服务端也可以用于跟
Vert.x 的事件总线桥接, 或者直接与 websocket 客户端建立连接 (使用 StompJS)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_vertx_stomp"><a class="anchor" href="#_using_vertx_stomp"></a>使用 vertx-stomp</h2>
<div class="sectionbody">
<div class="paragraph">
<p>为了使用 Vert.x Stomp 服务端和客户端, 需要将以下依赖项添加到您的项目构建描述文件
的 <em>依赖配置</em> 中:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (在您的 <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-stomp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (在您的 <code>build.gradle</code> 文件中):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">'io.vertx:vertx-stomp:4.0.3'</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stomp_server"><a class="anchor" href="#_stomp_server"></a>STOMP 服务器</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_creating_a_stomp_server"><a class="anchor" href="#_creating_a_stomp_server"></a>创建 STOMP 服务器</h3>
<div class="paragraph">
<p>以下是使用默认配置去创建 STOMP 服务器的最简单的方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会创建一个符合 STOMP 标准的服务器， 它会监听 <code>localhost:61613</code> 地址</p>
</div>
<div class="paragraph">
<p>您可以使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServer.html#listen-int-java.lang.String-">listen</a></code> 方法
去配置服务器监听的主机地址和端口:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx))
    .listen(<span class="hljs-number">1234</span>, <span class="hljs-string">"0.0.0.0"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您设置端口号为 <code>-1</code> , TCP 服务器将无法启动。 如果您使用到了 websocket 桥接
这会很有用。 使用以下方式设置回调处理器，以便在服务器就绪时被调用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompServer server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx))
    .listen(ar -&gt; {
      <span class="hljs-keyword">if</span> (ar.failed()) {
        System.out.println(<span class="hljs-string">"Failing to start the STOMP server : "</span> + ar.cause().getMessage());
      } <span class="hljs-keyword">else</span> {
        System.out.println(<span class="hljs-string">"Ready to receive STOMP frames"</span>);
      }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>该回调处理器接收一个类型是 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServer.html">StompServer</a></code> 的引用参数</p>
</div>
<div class="paragraph">
<p>您也可以使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServerOptions.html">StompServerOptions</a></code> 配置服务器监听的主机地址和端口:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx, <span class="hljs-keyword">new</span> StompServerOptions().setPort(<span class="hljs-number">1234</span>).setHost(<span class="hljs-string">"0.0.0.0"</span>))
    .handler(StompServerHandler.create(vertx))
    .listen();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closing_a_stomp_server"><a class="anchor" href="#_closing_a_stomp_server"></a>关闭 STOMP 服务器</h3>
<div class="paragraph">
<p>使用如下方式关闭 STOMP 服务器:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">server.close(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    System.out.println(<span class="hljs-string">"The STOMP server has been closed"</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"The STOMP server failed to close : "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>配置服务端</h3>
<div class="paragraph">
<p>使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServerOptions.html">StompServerOptions</a></code> 配置 STOMP 服务器的多项参数</p>
</div>
<div class="paragraph">
<p>首先，STOMP 服务器是基于
<code><a href="../../apidocs/io/vertx/core/net/NetServer.html">NetServer</a></code> 的， 因此您可以在  <code><a href="../../apidocs/io/vertx/ext/stomp/StompServerOptions.html">StompServerOptions</a></code> 中配置
底层使用的 <code><a href="../../apidocs/io/vertx/core/net/NetServer.html">NetServer</a></code>。或者您也可以将
您想要使用的 <code><a href="../../apidocs/io/vertx/core/net/NetServer.html">NetServer</a></code> 实例作为参数传入:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx, netServer)
    .handler(StompServerHandler.create(vertx))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>该配置类 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServerOptions.html">StompServerOptions</a></code> 可以让您设置以下选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>STOMP 服务器默认监听的主机地址和端口 - 默认为 <code>0.0.0.0:61613</code>.</p>
</li>
<li>
<p>STOMP 服务器是否使用安全验证 - 默认为 <code>false</code></p>
</li>
<li>
<p>STOMP 协议消息体的最大尺寸限制 - 默认为 10 Mb</p>
</li>
<li>
<p>STOMP 协议消息体的最大首部限制 - 默认为 1000</p>
</li>
<li>
<p>STOMP 协议消息体中首部行长度的最大限制 - 默认为 10240</p>
</li>
<li>
<p>STOMP 协议的心跳时间 - 默认为 <code>1000, 1000</code></p>
</li>
<li>
<p>支持的 STOMP 协议版本 (默认为 1.0, 1.1 和 1.2)</p>
</li>
<li>
<p>STOMP 协议中事务所支持的最大消息数量 (默认为 1000)</p>
</li>
<li>
<p>分块传输的最大尺寸 - 默认为 1000 (参见`<a href="../../apidocs/io/vertx/ext/stomp/StompServerOptions.html#setTransactionChunkSize-int-">setTransactionChunkSize</a>`)</p>
</li>
<li>
<p>一个客户端可以使用的最大订阅数量 - 默认为 1000</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如下所示，使用 JsonObject 配置 STOMP 协议的心跳时间：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx, <span class="hljs-keyword">new</span> StompServerOptions().setHeartbeat(
    <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"x"</span>, <span class="hljs-number">1000</span>).put(<span class="hljs-string">"y"</span>, <span class="hljs-number">1000</span>)))
    .handler(StompServerHandler.create(vertx))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用安全认证功能，需要提供 <code><a href="../../apidocs/io/vertx/ext/auth/authentication/AuthenticationProvider.html">AuthenticationProvider</a></code> 以处理
认证请求：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx, <span class="hljs-keyword">new</span> StompServerOptions().setSecured(<span class="hljs-keyword">true</span>))
    .handler(StompServerHandler.create(vertx).authProvider(provider))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>更多关于 <code><a href="../../apidocs/io/vertx/ext/auth/authentication/AuthenticationProvider.html">AuthenticationProvider</a></code> 的信息请参考
<a href="http://vertx.io/docs/#authentication_and_authorisation">此文档</a>.</p>
</div>
<div class="paragraph">
<p>如果一个消息体的大小超过了限制, 那么它会被拒绝接收，并且客户端会收到一个 <code>ERROR</code> 消息。 按照协议
要求，在发送这种错误消息后，客户端的连接需要立即关闭。 如果发送的消息不符合其他
要求的限制，客户端也需要立即关闭。</p>
</div>
</div>
<div class="sect2">
<h3 id="_subscriptions"><a class="anchor" href="#_subscriptions"></a>订阅</h3>
<div class="paragraph">
<p>默认的 STOMP 服务器将订阅的目的地点作为普通的字符串处理。 因此它不会对其进行解析
和分级。 默认的 STOMP 服务器使用 <em>topic</em> 模式处理订阅 (因此消息会被分发给所有
对应的订阅客户端)</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_of_destinations"><a class="anchor" href="#_type_of_destinations"></a>消息目的地点类型</h3>
<div class="paragraph">
<p>默认情况下， STOMP 服务器将消息发送的 <em>目的地点</em> 作为 topic 处理。 因此消息会被发送给所有的订阅者。 您可以
配置 STOMP 服务器将消息发送的目的地作为 queue 处理, 或两种模式都支持：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
        .destinationFactory((v, name) -&gt; {
          <span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">"/queue"</span>)) {
            <span class="hljs-keyword">return</span> Destination.queue(vertx, name);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> Destination.topic(vertx, name);
          }
        }))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在以上代码中， 所有以 <code>/queue</code> 开头的目的地点均被作为 queue 处理，而其他的目的地点被当作 topic 类型。 目的地点是在 STOMP 服务器
第一次接收到对应的订阅消息时被创建的</p>
</div>
<div class="paragraph">
<p>STOMP 服务器通过返回 <code>null</code> 以拒绝目的地点的创建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
        .destinationFactory((v, name) -&gt; {
          <span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">"/forbidden"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">"/queue"</span>)) {
            <span class="hljs-keyword">return</span> Destination.queue(vertx, name);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> Destination.topic(vertx, name);
          }
        }))
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下， 订阅客户端会收到一个 <code>ERROR</code> 消息</p>
</div>
<div class="paragraph">
<p>queue 类型的目的地点使用轮询调度策略向订阅者分发消息</p>
</div>
</div>
<div class="sect2">
<h3 id="_providing_your_own_type_of_destination"><a class="anchor" href="#_providing_your_own_type_of_destination"></a>提供您自定义的目的地类型</h3>
<div class="paragraph">
<p>Vert.x 提供的 STOMP 有意没有实现任何高级特性。 如果您需要更高级的消息分发策略，
可以提供自定义的 <code><a href="../../apidocs/io/vertx/ext/stomp/DestinationFactory.html">DestinationFactory</a></code> 实现
以返回您自定义的 <code><a href="../../apidocs/io/vertx/ext/stomp/Destination.html">Destination</a></code> 实例。</p>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgment"><a class="anchor" href="#_acknowledgment"></a>确认消息</h3>
<div class="paragraph">
<p>默认情况下， STOMP 服务器如果没有收到一个消息的确认消息不会做任何处理。 您可以通过提供您自定义的
 <code><a href="../../apidocs/io/vertx/ext/stomp/Destination.html">Destination</a></code> 以实现对确认消息的处理</p>
</div>
<div class="paragraph">
<p>自定义的目的地点类型应该实现</p>
</div>
<div class="paragraph">
<p><code><a href="../../apidocs/io/vertx/ext/stomp/StompServerHandler.html#onAck-io.vertx.ext.stomp.StompServerConnection-io.vertx.ext.stomp.Frame-java.util.List-">onAck</a></code>
和
<code><a href="../../apidocs/io/vertx/ext/stomp/StompServerHandler.html#onNack-io.vertx.ext.stomp.StompServerConnection-io.vertx.ext.stomp.Frame-java.util.List-">onNack</a></code>
方法以供 <code><a href="../../apidocs/io/vertx/ext/stomp/StompServerHandler.html">StompServerHandler</a></code> 实现特定行为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
        .onAckHandler(acknowledgement -&gt; {
          <span class="hljs-comment">// Action to execute when the frames (one in `client-individual` mode, several</span>
          <span class="hljs-comment">// in `client` mode are acknowledged.</span>
        })
        .onNackHandler(acknowledgement -&gt; {
          <span class="hljs-comment">// Action to execute when the frames (1 in `client-individual` mode, several in</span>
          <span class="hljs-comment">// `client` mode are not acknowledged.</span>
        }))
    .listen();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_the_stomp_server"><a class="anchor" href="#_customizing_the_stomp_server"></a>自定义 STOMP 服务器配置</h3>
<div class="paragraph">
<p>除了上文所述的回调, 您还可以配置 STOMP 服务器的几乎所有配置, 例如收到
指定消息类型的响应动作, 发送给客户端的 <code>ping</code> 消息 (为了实现
心跳)。以下是示例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
            .closeHandler(connection -&gt; {
              <span class="hljs-comment">// 客户端关闭的回调</span>
            })
            .beginHandler(frame -&gt; {
              <span class="hljs-comment">// 开始传输事务的回调</span>
            })
            .commitHandler(frame -&gt; {
                  <span class="hljs-comment">// 传输事务完成的回调</span>
                }
            )
        <span class="hljs-comment">//...</span>
    ).listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，改变默认的实现可能会导致对 STOMP 标准的破坏。 所以请参考
默认的实现。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stomp_client"><a class="anchor" href="#_stomp_client"></a>STOMP 客户端</h2>
<div class="sectionbody">
<div class="paragraph">
<p>STOMP 客户端可以连接到 STOMP 服务器并且接受和发送数据。</p>
</div>
<div class="sect2">
<h3 id="_creating_a_stomp_client"><a class="anchor" href="#_creating_a_stomp_client"></a>创建 STOMP 客户端</h3>
<div class="paragraph">
<p>通过以下方式使用默认配置创建 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClient.html">StompClient</a></code> 实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>以上的代码片段创建了一个客户端连接到 "0.0.0.0:61613"。 一旦连接成功, 您就可以获得一个
<code><a href="../../apidocs/io/vertx/ext/stomp/StompClientConnection.html">StompClientConnection</a></code> 实例用于和服务端交互。 您可以
通过以下方式配置客户端的连接地址和端口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect(<span class="hljs-number">61613</span>, <span class="hljs-string">"0.0.0.0"</span>)
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了捕获因为安全认证原因导致的异常， 或其他因为交互时
产生的异常而返回的错误信息, 您可以提供一个 <em>异常处理器</em> 给 Stomp 客户端。 所有
被该 STOMP 客户端创建的连接都会默认继承该异常处理器 (但他们也可以各自单独设置异常处理器)：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .errorFrameHandler(frame -&gt; {
    <span class="hljs-comment">// 接受错误消息</span>
  })
  .connect(<span class="hljs-number">61613</span>, <span class="hljs-string">"0.0.0.0"</span>)
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClientOptions.html">StompClientOptions</a></code> 来配置 STOMP 客户端的连接地址和端口:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient
  .create(vertx, <span class="hljs-keyword">new</span> StompClientOptions().setHost(<span class="hljs-string">"localhost"</span>).setPort(<span class="hljs-number">1234</span>))
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closing_a_stomp_client"><a class="anchor" href="#_closing_a_stomp_client"></a>关闭 STOMP 客户端</h3>
<div class="paragraph">
<p>您可以关闭 STOMP 客户端:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient client = StompClient
  .create(vertx, <span class="hljs-keyword">new</span> StompClientOptions().setHost(<span class="hljs-string">"localhost"</span>).setPort(<span class="hljs-number">1234</span>));

client
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));

client.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>然而, 使用以上方式关闭客户端不会告知 STOMP 服务器断开连接。 为了显式的断开连接， 您应当
使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClientConnection.html#disconnect--">disconnect</a></code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient
  .create(vertx, <span class="hljs-keyword">new</span> StompClientOptions().setHost(<span class="hljs-string">"localhost"</span>).setPort(<span class="hljs-number">1234</span>))
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
    connection.disconnect();
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您使用了心跳并且 STOMP 客户端在配置的心跳时间内没有检测到服务端的活动， 连接
会自动关闭</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_errors"><a class="anchor" href="#_handling_errors"></a>错误处理</h3>
<div class="paragraph">
<p>对于 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClientConnection.html">StompClientConnection</a></code> 的实例, 您可以注册一个错误处理器用于接收
服务端发送的 <code>ERROR</code> 消息。 注意服务端会在发送该错误消息后关闭连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient
  .create(vertx, <span class="hljs-keyword">new</span> StompClientOptions().setHost(<span class="hljs-string">"localhost"</span>).setPort(<span class="hljs-number">1234</span>))
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
    connection
      .errorHandler(frame -&gt;
        System.out.println(<span class="hljs-string">"ERROR frame received : "</span> + frame));
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果客户端发现当前的连接被丢弃时会收到通知。 STOMP 客户端通过心跳机制
监视连接是否失效。 当 STOMP 服务器在心跳时间窗口内没有发送心跳, 那么连接会被
关闭并且 <code>connectionDroppedHandler</code> 会被调用 (如果设置了的话)。 为了设置 <code>connectionDroppedHandler</code>, 您需要调用
<code><a href="../../apidocs/io/vertx/ext/stomp/StompClientConnection.html#connectionDroppedHandler-io.vertx.core.Handler-">connectionDroppedHandler</a></code> 方法。该处理器可以起到
让该 STOMP 客户端实例重新连接服务器的作用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {

    connection.connectionDroppedHandler(con -&gt; {
      <span class="hljs-comment">// 该连接已被丢失</span>
      <span class="hljs-comment">// 您需要重新建立连接或切换使用另一个连接</span>
    });

    connection.send(<span class="hljs-string">"/queue"</span>, Buffer.buffer(<span class="hljs-string">"Hello"</span>))
      .onSuccess(frame -&gt; System.out.println(<span class="hljs-string">"Message processed by the server"</span>)
      );
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>配置客户端</h3>
<div class="paragraph">
<p>您可以通过在创建 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClient.html">StompClient</a></code> 时传入
<code><a href="../../apidocs/io/vertx/ext/stomp/StompClientOptions.html">StompClientOptions</a></code> 以自定义多项配置。 由于
STOMP 客户端底层依赖了 <code><a href="../../apidocs/io/vertx/core/net/NetClient.html">NetClient</a></code>， 因此您可以在 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClientOptions.html">StompClientOptions</a></code> 中配置
底层的 Net Client。 或者您也可以在 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClient.html#connect-io.vertx.core.net.NetClient-io.vertx.core.Handler-">connect</a></code> 方法中
传入一个
您想使用的 <code><a href="../../apidocs/io/vertx/core/net/NetClient.html">NetClient</a></code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect(netClient)
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
    connection
      .errorHandler(frame -&gt;
        System.out.println(<span class="hljs-string">"ERROR frame received : "</span> + frame));
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code><a href="../../apidocs/io/vertx/ext/stomp/StompClientOptions.html">StompClientOptions</a></code> 可以配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>连接 STOMP 服务器的地址和端口</p>
</li>
<li>
<p>连接 STOMP 服务器的登录和密码</p>
</li>
<li>
<p>如果没有显式设置 <code>content-length</code> 首部，是否自动添加 (默认开启)</p>
</li>
<li>
<p>是否用 <code>STOMP</code> 指令来替换 <code>CONNECT</code> 指令 (默认关闭)</p>
</li>
<li>
<p>在 <code>CONNECT</code> 消息中 <code>host</code> 首部是否被忽略  (默认关闭)</p>
</li>
<li>
<p>心跳时间配置 (默认为 1000, 1000)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_subscribing_to_destinations"><a class="anchor" href="#_subscribing_to_destinations"></a>订阅</h3>
<div class="paragraph">
<p>为了订阅消息的目的地点，使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
    connection.subscribe(<span class="hljs-string">"/queue"</span>, frame -&gt;
      System.out.println(<span class="hljs-string">"Just received a frame from /queue : "</span> + frame));
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了取消订阅，使用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    <span class="hljs-comment">// 使用连接</span>
    connection.subscribe(<span class="hljs-string">"/queue"</span>, frame -&gt;
      System.out.println(<span class="hljs-string">"Just received a frame from /queue : "</span> + frame));

    <span class="hljs-comment">// ....</span>

    connection.unsubscribe(<span class="hljs-string">"/queue"</span>);
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_messages"><a class="anchor" href="#_sending_messages"></a>发送消息</h3>
<div class="paragraph">
<p>为了发送消息，使用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    Map&lt;String, String&gt; headers = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    headers.put(<span class="hljs-string">"header1"</span>, <span class="hljs-string">"value1"</span>);
    connection.send(<span class="hljs-string">"/queue"</span>, headers, Buffer.buffer(<span class="hljs-string">"Hello"</span>));
    <span class="hljs-comment">//没有首部:</span>
    connection.send(<span class="hljs-string">"/queue"</span>, Buffer.buffer(<span class="hljs-string">"World"</span>));
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 Java 和 Groovy 语言中， 您可以使用 <code><a href="../../apidocs/io/vertx/ext/stomp/utils/Headers.html">Headers</a></code> 类用于简化首部的创建</p>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>确认消息</h3>
<div class="paragraph">
<p>STOMP 客户端可以发送 <code>ACK</code> 和 <code>NACK</code> 消息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    connection.subscribe(<span class="hljs-string">"/queue"</span>, frame -&gt; {
      connection.ack(frame.getAck());
      <span class="hljs-comment">// 或者</span>
      connection.nack(frame.getAck());
    });
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transactions"><a class="anchor" href="#_transactions"></a>事务</h3>
<div class="paragraph">
<p>STOMP 客户端也可以创建事务。 <code>ACK</code>, <code>NACK</code> 和 <code>SEND</code> 消息只有在事务被提交时才会
发送。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    Map&lt;String, String&gt; headers = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    headers.put(<span class="hljs-string">"transaction"</span>, <span class="hljs-string">"my-transaction"</span>);
    connection.beginTX(<span class="hljs-string">"my-transaction"</span>);
    connection.send(<span class="hljs-string">"/queue"</span>, headers, Buffer.buffer(<span class="hljs-string">"Hello"</span>));
    connection.send(<span class="hljs-string">"/queue"</span>, headers, Buffer.buffer(<span class="hljs-string">"World"</span>));
    connection.send(<span class="hljs-string">"/queue"</span>, headers, Buffer.buffer(<span class="hljs-string">"!!!"</span>));
    connection.commit(<span class="hljs-string">"my-transaction"</span>);
    <span class="hljs-comment">// 或者</span>
    connection.abort(<span class="hljs-string">"my-transaction"</span>);
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_receipt"><a class="anchor" href="#_receipt"></a>确认消息</h3>
<div class="paragraph">
<p>每次发送指令可以设置一个 <em>确认</em> 处理器, 该处理器会在服务端确认处理完消息后被调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompClient.create(vertx)
  .connect()
  .onSuccess(connection -&gt; {
    connection
      .send(<span class="hljs-string">"/queue"</span>, Buffer.buffer(<span class="hljs-string">"Hello"</span>))
      .onSuccess(frame -&gt;
        System.out.println(<span class="hljs-string">"Message processed by the server"</span>));
  })
  .onFailure(err -&gt;
    System.out.println(
      <span class="hljs-string">"Failed to connect to the STOMP server: "</span> + err.toString()));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus"><a class="anchor" href="#_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus"></a>使用 STOMP 服务器桥接 Vert.x 事件总线</h2>
<div class="sectionbody">
<div class="paragraph">
<p>STOMP 服务器可以桥接 Vert.x 的事件总线。 这种桥接是双向的，这意味着 STOMP 消息
可以被转换为事件总线中的消息，并且事件总线中的消息可以被转化为 STOMP 消息。</p>
</div>
<div class="paragraph">
<p>为了使用桥接， 您需要配置入站和出站地址。 入站地址是指需要转入事件总线的
 STOMP 消息的目的地点。 这些 STOMP 消息的目的地点会被作为事件总线的地址。 出站地址
是指需要被转化为 STOMP 消息的事件总线地址。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
        .bridge(<span class="hljs-keyword">new</span> BridgeOptions()
            .addInboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toBus"</span>))
            .addOutboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toStomp"</span>))
        )
    )
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下， 桥接使用 发布/订阅 模式发送消息 (topic 模式)。 您也可以配置它使用点对点模式去发送
消息， 这样就只会有一个 STOMP 客户端或事件总线的消费者被调用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
            .bridge(<span class="hljs-keyword">new</span> BridgeOptions()
                    .addInboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toBus"</span>))
                    .addOutboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toStomp"</span>))
                    .setPointToPoint(<span class="hljs-keyword">true</span>)
            )
    )
    .listen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>出入站的许可字符串可以作为一个 "正则字符串" 或者一个 <em>匹配项</em>。 <em>匹配项</em> 是指
消息体需要满足的特定结构。 以下代码展示了消息体必须拥有字段 "foo" ，并且其
值为 "bar"。 结构匹配当前只支持 Json 数据类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx)
        .bridge(<span class="hljs-keyword">new</span> BridgeOptions()
            .addInboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toBus"</span>)
                .setMatch(<span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>)))
            .addOutboundPermitted(<span class="hljs-keyword">new</span> PermittedOptions().setAddress(<span class="hljs-string">"/toStomp"</span>))
            .setPointToPoint(<span class="hljs-keyword">true</span>)
        )
    )
    .listen();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_stomp_server_with_web_sockets"><a class="anchor" href="#_using_the_stomp_server_with_web_sockets"></a>使用基于 websocket 的 STOMP 服务器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果您想使用一个 Javascript 客户端 (在 node.js 或浏览器中) 直接连接 STOMP 服务器, 您可以使用
websocket。 STOMP 协议目前完成了适配，可以基于 websocket 工作，参见
<a href="http://jmesnil.net/stomp-websocket/doc/">StompJS</a> 。 使用 JavaScript 客户端直接连接到 STOMP 服务器并且
使用 websocket 协议发送消息。 这样也可以使用 websocket 接收 STOMP 消息。</p>
</div>
<div class="paragraph">
<p>为了配置服务器使用 StompJS, 您需要：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用 websocket 桥接并且配置 websocket 需要监听的路径 (默认为 <code>/stomp</code>).</p>
</li>
<li>
<p>在您的应用中引入 <a href="http://jmesnil.net/stomp-websocket/doc/#download">StompJS</a> (您的应用可以是
HTML 页面上的脚本, 或者一个 node 模块 (<a href="https://www.npmjs.com/package/stompjs" class="bare">https://www.npmjs.com/package/stompjs</a>).</p>
</li>
<li>
<p>连接到服务器</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>为了完成第一步， 您首先需要创建一个 HTTP 服务器, 并且将
<code><a href="../../apidocs/io/vertx/ext/stomp/StompServer.html#webSocketHandler--">webSocketHandler</a></code> 的结果传递给
<code><a href="../../apidocs/io/vertx/core/http/HttpServer.html#webSocketHandler-io.vertx.core.Handler-">webSocketHandler</a></code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StompServer server = StompServer.create(vertx, <span class="hljs-keyword">new</span> StompServerOptions()
    .setPort(-<span class="hljs-number">1</span>) <span class="hljs-comment">// 禁用 tcp 端口，这一项是可选的</span>
    .setWebsocketBridge(<span class="hljs-keyword">true</span>) <span class="hljs-comment">// 开启 websocket 支持</span>
    .setWebsocketPath(<span class="hljs-string">"/stomp"</span>)) <span class="hljs-comment">// 配置 websocket 路径，默认是 /stomp</span>
    .handler(StompServerHandler.create(vertx));

Future&lt;HttpServer&gt; http = vertx.createHttpServer(
    <span class="hljs-keyword">new</span> HttpServerOptions().setWebSocketSubProtocols(Arrays.asList(<span class="hljs-string">"v10.stomp"</span>, <span class="hljs-string">"v11.stomp"</span>))
)
    .webSocketHandler(server.webSocketHandler())
    .listen(<span class="hljs-number">8080</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>不要忘了声明要支持的子协议， 否则连接会被拒绝。</p>
</div>
<div class="paragraph">
<p>以下示例代码来自  <a href="http://jmesnil.net/stomp-websocket/doc/">the StompJS documentation</a> ，展示了如何连接
到服务器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="hljs-keyword">var</span> url = <span class="hljs-string">"ws://localhost:8080/stomp"</span>;
<span class="hljs-keyword">var</span> client = Stomp.client(url);
<span class="hljs-keyword">var</span> callback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">frame</span>) </span>{
  <span class="hljs-built_in">console</span>.log(frame);
};

client.connect({}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> subscription = client.subscribe(<span class="hljs-string">"foo"</span>, callback);
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_received_and_writing_frame_handlers"><a class="anchor" href="#_registering_received_and_writing_frame_handlers"></a>注册接收消息处理器和写入消息处理器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>STOMP 客户端， 客户端连接和服务端都支持注册一个接收
<code><a href="../../apidocs/io/vertx/ext/stomp/Frame.html">Frame</a></code> 的处理器，该处理器会在每次接收到消息时被调用。 您可以通过
它去打印数据包的日志或实现其他自定义的行为。 该处理器也会在接收 <code>PING</code>
消息, 和其他 <em>非法 / 未知</em> 类型消息时被调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx).receivedFrameHandler(sf -&gt; {
      System.out.println(sf.frame());
    }))
    .listen();

StompClient client = StompClient.create(vertx).receivedFrameHandler(frame -&gt; System.out.println(frame));</code></pre>
</div>
</div>
<div class="paragraph">
<p>该处理器是在消息体被处理前调用的，因此可以使用它来 <em>修改</em> 消息体内容</p>
</div>
<div class="paragraph">
<p>使用了不合法的指令的消息会被当做 <code>UNKNOWN</code> 指令类型来处理。 原本的指令值会被写入
首部，其字段为 <code><a href="../../apidocs/io/vertx/ext/stomp/Frame.html#STOMP_FRAME_COMMAND">Frame.STOMP_FRAME_COMMAND</a></code></p>
</div>
<div class="paragraph">
<p>您也可以设置一个处理器，该处理器会在数据包被发送前调用 (写入到网络前):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;StompServer&gt; server = StompServer.create(vertx)
    .handler(StompServerHandler.create(vertx))
    .writingFrameHandler(sf -&gt; {
      System.out.println(sf.frame());
    })
    .listen();

StompClient client = StompClient.create(vertx).writingFrameHandler(frame -&gt; {
  System.out.println(frame);
});</code></pre>
</div>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">Channels</a></li><li><a href="https://how-to.vertx.io/">How-To’s</a></li><li><a href="https://start.vertx.io/">App Generator</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse Foundation</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li><li><a href="https://www.eclipse.org/legal/">Legal Resources</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x<br/>Eclipse Vert.x is open source and dual-licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a> and the <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>. <br class="footer-copyright-break"/>Website design by <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a>.</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"vertx-stomp/java","title":"Vert.x-Stomp","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_using_vertx_stomp\"\u003e使用 vertx-stomp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_stomp_server\"\u003eSTOMP 服务器\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_creating_a_stomp_server\"\u003e创建 STOMP 服务器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_closing_a_stomp_server\"\u003e关闭 STOMP 服务器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_configuration\"\u003e配置服务端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_subscriptions\"\u003e订阅\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_type_of_destinations\"\u003e消息目的地点类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_providing_your_own_type_of_destination\"\u003e提供您自定义的目的地类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_acknowledgment\"\u003e确认消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_customizing_the_stomp_server\"\u003e自定义 STOMP 服务器配置\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_stomp_client\"\u003eSTOMP 客户端\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_creating_a_stomp_client\"\u003e创建 STOMP 客户端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_closing_a_stomp_client\"\u003e关闭 STOMP 客户端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_errors\"\u003e错误处理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_configuration_2\"\u003e配置客户端\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_subscribing_to_destinations\"\u003e订阅\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_sending_messages\"\u003e发送消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_acknowledgements\"\u003e确认消息\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_transactions\"\u003e事务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_receipt\"\u003e确认消息\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus\"\u003e使用 STOMP 服务器桥接 Vert.x 事件总线\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_the_stomp_server_with_web_sockets\"\u003e使用基于 websocket 的 STOMP 服务器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_registering_received_and_writing_frame_handlers\"\u003e注册接收消息处理器和写入消息处理器\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x-Stomp\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 即简单(流)文本定向消息。 STOMP\n提供了一种可交互的消息管线，因此 STOMP 客户端可以与任意的 STOMP 消息中介（broker） 通信，并\n基于各种不同的语言，平台与消息中介实现信息的交互和操作。 参阅 \u003ca href=\"https://stomp.github.io/index.html\" class=\"bare\"\u003ehttps://stomp.github.io/index.html\u003c/a\u003e 了解更多关于 STOMP 的信息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVertx-Stomp 提供了 STOMP 客户端和服务端的实现。 您可以使用其他客户端连接 Vert.x 的 STOMP 服务端，也可以\n使用 Vert.x 的 STOMP 客户端连接其他服务端实现。 Vert.x 提供的服务端和客户端都支持 STOMP 的 1.0，1.1 和 1.2\n版本  (参见 \u003ca href=\"https://stomp.github.io/stomp-specification-1.2.html)。\" class=\"bare\"\u003ehttps://stomp.github.io/stomp-specification-1.2.html)。\u003c/a\u003e 该 STOMP 服务端也可以用于跟\nVert.x 的事件总线桥接, 或者直接与 websocket 客户端建立连接 (使用 StompJS)\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_vertx_stomp\"\u003e\u003ca class=\"anchor\" href=\"#_using_vertx_stomp\"\u003e\u003c/a\u003e使用 vertx-stomp\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了使用 Vert.x Stomp 服务端和客户端, 需要将以下依赖项添加到您的项目构建描述文件\n的 \u003cem\u003e依赖配置\u003c/em\u003e 中:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (在您的 \u003ccode\u003epom.xml\u003c/code\u003e):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-stomp\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.0.3\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-stomp:4.0.3'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_stomp_server\"\u003e\u003ca class=\"anchor\" href=\"#_stomp_server\"\u003e\u003c/a\u003eSTOMP 服务器\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_creating_a_stomp_server\"\u003e\u003ca class=\"anchor\" href=\"#_creating_a_stomp_server\"\u003e\u003c/a\u003e创建 STOMP 服务器\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e以下是使用默认配置去创建 STOMP 服务器的最简单的方法:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这会创建一个符合 STOMP 标准的服务器， 它会监听 \u003ccode\u003elocalhost:61613\u003c/code\u003e 地址\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServer.html#listen-int-java.lang.String-\"\u003elisten\u003c/a\u003e\u003c/code\u003e 方法\n去配置服务器监听的主机地址和端口:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx))\n    .listen(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您设置端口号为 \u003ccode\u003e-1\u003c/code\u003e , TCP 服务器将无法启动。 如果您使用到了 websocket 桥接\n这会很有用。 使用以下方式设置回调处理器，以便在服务器就绪时被调用:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompServer server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx))\n    .listen(ar -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.failed()) {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failing to start the STOMP server : \"\u003c/span\u003e + ar.cause().getMessage());\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Ready to receive STOMP frames\"\u003c/span\u003e);\n      }\n    });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e该回调处理器接收一个类型是 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServer.html\"\u003eStompServer\u003c/a\u003e\u003c/code\u003e 的引用参数\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerOptions.html\"\u003eStompServerOptions\u003c/a\u003e\u003c/code\u003e 配置服务器监听的主机地址和端口:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompServerOptions().setPort(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e).setHost(\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e))\n    .handler(StompServerHandler.create(vertx))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_closing_a_stomp_server\"\u003e\u003ca class=\"anchor\" href=\"#_closing_a_stomp_server\"\u003e\u003c/a\u003e关闭 STOMP 服务器\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用如下方式关闭 STOMP 服务器:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eserver.close(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"The STOMP server has been closed\"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"The STOMP server failed to close : \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_configuration\"\u003e\u003c/a\u003e配置服务端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerOptions.html\"\u003eStompServerOptions\u003c/a\u003e\u003c/code\u003e 配置 STOMP 服务器的多项参数\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e首先，STOMP 服务器是基于\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/NetServer.html\"\u003eNetServer\u003c/a\u003e\u003c/code\u003e 的， 因此您可以在  \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerOptions.html\"\u003eStompServerOptions\u003c/a\u003e\u003c/code\u003e 中配置\n底层使用的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/NetServer.html\"\u003eNetServer\u003c/a\u003e\u003c/code\u003e。或者您也可以将\n您想要使用的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/NetServer.html\"\u003eNetServer\u003c/a\u003e\u003c/code\u003e 实例作为参数传入:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx, netServer)\n    .handler(StompServerHandler.create(vertx))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e该配置类 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerOptions.html\"\u003eStompServerOptions\u003c/a\u003e\u003c/code\u003e 可以让您设置以下选项：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 服务器默认监听的主机地址和端口 - 默认为 \u003ccode\u003e0.0.0.0:61613\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 服务器是否使用安全验证 - 默认为 \u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 协议消息体的最大尺寸限制 - 默认为 10 Mb\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 协议消息体的最大首部限制 - 默认为 1000\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 协议消息体中首部行长度的最大限制 - 默认为 10240\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 协议的心跳时间 - 默认为 \u003ccode\u003e1000, 1000\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e支持的 STOMP 协议版本 (默认为 1.0, 1.1 和 1.2)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSTOMP 协议中事务所支持的最大消息数量 (默认为 1000)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e分块传输的最大尺寸 - 默认为 1000 (参见`\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerOptions.html#setTransactionChunkSize-int-\"\u003esetTransactionChunkSize\u003c/a\u003e`)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e一个客户端可以使用的最大订阅数量 - 默认为 1000\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如下所示，使用 JsonObject 配置 STOMP 协议的心跳时间：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompServerOptions().setHeartbeat(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"x\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e).put(\u003cspan class=\"hljs-string\"\u003e\"y\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)))\n    .handler(StompServerHandler.create(vertx))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要使用安全认证功能，需要提供 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/authentication/AuthenticationProvider.html\"\u003eAuthenticationProvider\u003c/a\u003e\u003c/code\u003e 以处理\n认证请求：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompServerOptions().setSecured(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e))\n    .handler(StompServerHandler.create(vertx).authProvider(provider))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多关于 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/authentication/AuthenticationProvider.html\"\u003eAuthenticationProvider\u003c/a\u003e\u003c/code\u003e 的信息请参考\n\u003ca href=\"http://vertx.io/docs/#authentication_and_authorisation\"\u003e此文档\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果一个消息体的大小超过了限制, 那么它会被拒绝接收，并且客户端会收到一个 \u003ccode\u003eERROR\u003c/code\u003e 消息。 按照协议\n要求，在发送这种错误消息后，客户端的连接需要立即关闭。 如果发送的消息不符合其他\n要求的限制，客户端也需要立即关闭。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_subscriptions\"\u003e\u003ca class=\"anchor\" href=\"#_subscriptions\"\u003e\u003c/a\u003e订阅\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认的 STOMP 服务器将订阅的目的地点作为普通的字符串处理。 因此它不会对其进行解析\n和分级。 默认的 STOMP 服务器使用 \u003cem\u003etopic\u003c/em\u003e 模式处理订阅 (因此消息会被分发给所有\n对应的订阅客户端)\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_type_of_destinations\"\u003e\u003ca class=\"anchor\" href=\"#_type_of_destinations\"\u003e\u003c/a\u003e消息目的地点类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认情况下， STOMP 服务器将消息发送的 \u003cem\u003e目的地点\u003c/em\u003e 作为 topic 处理。 因此消息会被发送给所有的订阅者。 您可以\n配置 STOMP 服务器将消息发送的目的地作为 queue 处理, 或两种模式都支持：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n        .destinationFactory((v, name) -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (name.startsWith(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e)) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Destination.queue(vertx, name);\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Destination.topic(vertx, name);\n          }\n        }))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在以上代码中， 所有以 \u003ccode\u003e/queue\u003c/code\u003e 开头的目的地点均被作为 queue 处理，而其他的目的地点被当作 topic 类型。 目的地点是在 STOMP 服务器\n第一次接收到对应的订阅消息时被创建的\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 服务器通过返回 \u003ccode\u003enull\u003c/code\u003e 以拒绝目的地点的创建：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n        .destinationFactory((v, name) -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (name.startsWith(\u003cspan class=\"hljs-string\"\u003e\"/forbidden\"\u003c/span\u003e)) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enull\u003c/span\u003e;\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (name.startsWith(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e)) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Destination.queue(vertx, name);\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Destination.topic(vertx, name);\n          }\n        }))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在这种情况下， 订阅客户端会收到一个 \u003ccode\u003eERROR\u003c/code\u003e 消息\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003equeue 类型的目的地点使用轮询调度策略向订阅者分发消息\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_providing_your_own_type_of_destination\"\u003e\u003ca class=\"anchor\" href=\"#_providing_your_own_type_of_destination\"\u003e\u003c/a\u003e提供您自定义的目的地类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x 提供的 STOMP 有意没有实现任何高级特性。 如果您需要更高级的消息分发策略，\n可以提供自定义的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/DestinationFactory.html\"\u003eDestinationFactory\u003c/a\u003e\u003c/code\u003e 实现\n以返回您自定义的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/Destination.html\"\u003eDestination\u003c/a\u003e\u003c/code\u003e 实例。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_acknowledgment\"\u003e\u003ca class=\"anchor\" href=\"#_acknowledgment\"\u003e\u003c/a\u003e确认消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认情况下， STOMP 服务器如果没有收到一个消息的确认消息不会做任何处理。 您可以通过提供您自定义的\n \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/Destination.html\"\u003eDestination\u003c/a\u003e\u003c/code\u003e 以实现对确认消息的处理\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e自定义的目的地点类型应该实现\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerHandler.html#onAck-io.vertx.ext.stomp.StompServerConnection-io.vertx.ext.stomp.Frame-java.util.List-\"\u003eonAck\u003c/a\u003e\u003c/code\u003e\n和\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerHandler.html#onNack-io.vertx.ext.stomp.StompServerConnection-io.vertx.ext.stomp.Frame-java.util.List-\"\u003eonNack\u003c/a\u003e\u003c/code\u003e\n方法以供 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServerHandler.html\"\u003eStompServerHandler\u003c/a\u003e\u003c/code\u003e 实现特定行为：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n        .onAckHandler(acknowledgement -\u0026gt; {\n          \u003cspan class=\"hljs-comment\"\u003e// Action to execute when the frames (one in `client-individual` mode, several\u003c/span\u003e\n          \u003cspan class=\"hljs-comment\"\u003e// in `client` mode are acknowledged.\u003c/span\u003e\n        })\n        .onNackHandler(acknowledgement -\u0026gt; {\n          \u003cspan class=\"hljs-comment\"\u003e// Action to execute when the frames (1 in `client-individual` mode, several in\u003c/span\u003e\n          \u003cspan class=\"hljs-comment\"\u003e// `client` mode are not acknowledged.\u003c/span\u003e\n        }))\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_customizing_the_stomp_server\"\u003e\u003ca class=\"anchor\" href=\"#_customizing_the_stomp_server\"\u003e\u003c/a\u003e自定义 STOMP 服务器配置\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e除了上文所述的回调, 您还可以配置 STOMP 服务器的几乎所有配置, 例如收到\n指定消息类型的响应动作, 发送给客户端的 \u003ccode\u003eping\u003c/code\u003e 消息 (为了实现\n心跳)。以下是示例\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n            .closeHandler(connection -\u0026gt; {\n              \u003cspan class=\"hljs-comment\"\u003e// 客户端关闭的回调\u003c/span\u003e\n            })\n            .beginHandler(frame -\u0026gt; {\n              \u003cspan class=\"hljs-comment\"\u003e// 开始传输事务的回调\u003c/span\u003e\n            })\n            .commitHandler(frame -\u0026gt; {\n                  \u003cspan class=\"hljs-comment\"\u003e// 传输事务完成的回调\u003c/span\u003e\n                }\n            )\n        \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n    ).listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意，改变默认的实现可能会导致对 STOMP 标准的破坏。 所以请参考\n默认的实现。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_stomp_client\"\u003e\u003ca class=\"anchor\" href=\"#_stomp_client\"\u003e\u003c/a\u003eSTOMP 客户端\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 客户端可以连接到 STOMP 服务器并且接受和发送数据。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_creating_a_stomp_client\"\u003e\u003ca class=\"anchor\" href=\"#_creating_a_stomp_client\"\u003e\u003c/a\u003e创建 STOMP 客户端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e通过以下方式使用默认配置创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClient.html\"\u003eStompClient\u003c/a\u003e\u003c/code\u003e 实例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e以上的代码片段创建了一个客户端连接到 \"0.0.0.0:61613\"。 一旦连接成功, 您就可以获得一个\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientConnection.html\"\u003eStompClientConnection\u003c/a\u003e\u003c/code\u003e 实例用于和服务端交互。 您可以\n通过以下方式配置客户端的连接地址和端口：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect(\u003cspan class=\"hljs-number\"\u003e61613\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e)\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了捕获因为安全认证原因导致的异常， 或其他因为交互时\n产生的异常而返回的错误信息, 您可以提供一个 \u003cem\u003e异常处理器\u003c/em\u003e 给 Stomp 客户端。 所有\n被该 STOMP 客户端创建的连接都会默认继承该异常处理器 (但他们也可以各自单独设置异常处理器)：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .errorFrameHandler(frame -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 接受错误消息\u003c/span\u003e\n  })\n  .connect(\u003cspan class=\"hljs-number\"\u003e61613\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e)\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientOptions.html\"\u003eStompClientOptions\u003c/a\u003e\u003c/code\u003e 来配置 STOMP 客户端的连接地址和端口:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient\n  .create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompClientOptions().setHost(\u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e).setPort(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e))\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_closing_a_stomp_client\"\u003e\u003ca class=\"anchor\" href=\"#_closing_a_stomp_client\"\u003e\u003c/a\u003e关闭 STOMP 客户端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以关闭 STOMP 客户端:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient client = StompClient\n  .create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompClientOptions().setHost(\u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e).setPort(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e));\n\nclient\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\n\nclient.close();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e然而, 使用以上方式关闭客户端不会告知 STOMP 服务器断开连接。 为了显式的断开连接， 您应当\n使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientConnection.html#disconnect--\"\u003edisconnect\u003c/a\u003e\u003c/code\u003e 方法:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient\n  .create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompClientOptions().setHost(\u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e).setPort(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e))\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n    connection.disconnect();\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您使用了心跳并且 STOMP 客户端在配置的心跳时间内没有检测到服务端的活动， 连接\n会自动关闭\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_errors\"\u003e\u003ca class=\"anchor\" href=\"#_handling_errors\"\u003e\u003c/a\u003e错误处理\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e对于 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientConnection.html\"\u003eStompClientConnection\u003c/a\u003e\u003c/code\u003e 的实例, 您可以注册一个错误处理器用于接收\n服务端发送的 \u003ccode\u003eERROR\u003c/code\u003e 消息。 注意服务端会在发送该错误消息后关闭连接：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient\n  .create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompClientOptions().setHost(\u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e).setPort(\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e))\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n    connection\n      .errorHandler(frame -\u0026gt;\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"ERROR frame received : \"\u003c/span\u003e + frame));\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果客户端发现当前的连接被丢弃时会收到通知。 STOMP 客户端通过心跳机制\n监视连接是否失效。 当 STOMP 服务器在心跳时间窗口内没有发送心跳, 那么连接会被\n关闭并且 \u003ccode\u003econnectionDroppedHandler\u003c/code\u003e 会被调用 (如果设置了的话)。 为了设置 \u003ccode\u003econnectionDroppedHandler\u003c/code\u003e, 您需要调用\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientConnection.html#connectionDroppedHandler-io.vertx.core.Handler-\"\u003econnectionDroppedHandler\u003c/a\u003e\u003c/code\u003e 方法。该处理器可以起到\n让该 STOMP 客户端实例重新连接服务器的作用。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n\n    connection.connectionDroppedHandler(con -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// 该连接已被丢失\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 您需要重新建立连接或切换使用另一个连接\u003c/span\u003e\n    });\n\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"Hello\"\u003c/span\u003e))\n      .onSuccess(frame -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Message processed by the server\"\u003c/span\u003e)\n      );\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_2\"\u003e\u003ca class=\"anchor\" href=\"#_configuration_2\"\u003e\u003c/a\u003e配置客户端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以通过在创建 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClient.html\"\u003eStompClient\u003c/a\u003e\u003c/code\u003e 时传入\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientOptions.html\"\u003eStompClientOptions\u003c/a\u003e\u003c/code\u003e 以自定义多项配置。 由于\nSTOMP 客户端底层依赖了 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/NetClient.html\"\u003eNetClient\u003c/a\u003e\u003c/code\u003e， 因此您可以在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientOptions.html\"\u003eStompClientOptions\u003c/a\u003e\u003c/code\u003e 中配置\n底层的 Net Client。 或者您也可以在 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClient.html#connect-io.vertx.core.net.NetClient-io.vertx.core.Handler-\"\u003econnect\u003c/a\u003e\u003c/code\u003e 方法中\n传入一个\n您想使用的 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/net/NetClient.html\"\u003eNetClient\u003c/a\u003e\u003c/code\u003e：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect(netClient)\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n    connection\n      .errorHandler(frame -\u0026gt;\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"ERROR frame received : \"\u003c/span\u003e + frame));\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompClientOptions.html\"\u003eStompClientOptions\u003c/a\u003e\u003c/code\u003e 可以配置：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e连接 STOMP 服务器的地址和端口\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e连接 STOMP 服务器的登录和密码\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如果没有显式设置 \u003ccode\u003econtent-length\u003c/code\u003e 首部，是否自动添加 (默认开启)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e是否用 \u003ccode\u003eSTOMP\u003c/code\u003e 指令来替换 \u003ccode\u003eCONNECT\u003c/code\u003e 指令 (默认关闭)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在 \u003ccode\u003eCONNECT\u003c/code\u003e 消息中 \u003ccode\u003ehost\u003c/code\u003e 首部是否被忽略  (默认关闭)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e心跳时间配置 (默认为 1000, 1000)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_subscribing_to_destinations\"\u003e\u003ca class=\"anchor\" href=\"#_subscribing_to_destinations\"\u003e\u003c/a\u003e订阅\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了订阅消息的目的地点，使用\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n    connection.subscribe(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, frame -\u0026gt;\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Just received a frame from /queue : \"\u003c/span\u003e + frame));\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了取消订阅，使用:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 使用连接\u003c/span\u003e\n    connection.subscribe(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, frame -\u0026gt;\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Just received a frame from /queue : \"\u003c/span\u003e + frame));\n\n    \u003cspan class=\"hljs-comment\"\u003e// ....\u003c/span\u003e\n\n    connection.unsubscribe(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e);\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_sending_messages\"\u003e\u003ca class=\"anchor\" href=\"#_sending_messages\"\u003e\u003c/a\u003e发送消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了发送消息，使用:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    Map\u0026lt;String, String\u0026gt; headers = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HashMap\u0026lt;\u0026gt;();\n    headers.put(\u003cspan class=\"hljs-string\"\u003e\"header1\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"value1\"\u003c/span\u003e);\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, headers, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"Hello\"\u003c/span\u003e));\n    \u003cspan class=\"hljs-comment\"\u003e//没有首部:\u003c/span\u003e\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"World\"\u003c/span\u003e));\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在 Java 和 Groovy 语言中， 您可以使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/utils/Headers.html\"\u003eHeaders\u003c/a\u003e\u003c/code\u003e 类用于简化首部的创建\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_acknowledgements\"\u003e\u003ca class=\"anchor\" href=\"#_acknowledgements\"\u003e\u003c/a\u003e确认消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 客户端可以发送 \u003ccode\u003eACK\u003c/code\u003e 和 \u003ccode\u003eNACK\u003c/code\u003e 消息：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    connection.subscribe(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, frame -\u0026gt; {\n      connection.ack(frame.getAck());\n      \u003cspan class=\"hljs-comment\"\u003e// 或者\u003c/span\u003e\n      connection.nack(frame.getAck());\n    });\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_transactions\"\u003e\u003ca class=\"anchor\" href=\"#_transactions\"\u003e\u003c/a\u003e事务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 客户端也可以创建事务。 \u003ccode\u003eACK\u003c/code\u003e, \u003ccode\u003eNACK\u003c/code\u003e 和 \u003ccode\u003eSEND\u003c/code\u003e 消息只有在事务被提交时才会\n发送。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    Map\u0026lt;String, String\u0026gt; headers = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HashMap\u0026lt;\u0026gt;();\n    headers.put(\u003cspan class=\"hljs-string\"\u003e\"transaction\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"my-transaction\"\u003c/span\u003e);\n    connection.beginTX(\u003cspan class=\"hljs-string\"\u003e\"my-transaction\"\u003c/span\u003e);\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, headers, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"Hello\"\u003c/span\u003e));\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, headers, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"World\"\u003c/span\u003e));\n    connection.send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, headers, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"!!!\"\u003c/span\u003e));\n    connection.commit(\u003cspan class=\"hljs-string\"\u003e\"my-transaction\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// 或者\u003c/span\u003e\n    connection.abort(\u003cspan class=\"hljs-string\"\u003e\"my-transaction\"\u003c/span\u003e);\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_receipt\"\u003e\u003ca class=\"anchor\" href=\"#_receipt\"\u003e\u003c/a\u003e确认消息\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e每次发送指令可以设置一个 \u003cem\u003e确认\u003c/em\u003e 处理器, 该处理器会在服务端确认处理完消息后被调用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompClient.create(vertx)\n  .connect()\n  .onSuccess(connection -\u0026gt; {\n    connection\n      .send(\u003cspan class=\"hljs-string\"\u003e\"/queue\"\u003c/span\u003e, Buffer.buffer(\u003cspan class=\"hljs-string\"\u003e\"Hello\"\u003c/span\u003e))\n      .onSuccess(frame -\u0026gt;\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Message processed by the server\"\u003c/span\u003e));\n  })\n  .onFailure(err -\u0026gt;\n    System.out.println(\n      \u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the STOMP server: \"\u003c/span\u003e + err.toString()));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_stomp_server_as_a_bridge_to_the_vert_x_event_bus\"\u003e\u003c/a\u003e使用 STOMP 服务器桥接 Vert.x 事件总线\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 服务器可以桥接 Vert.x 的事件总线。 这种桥接是双向的，这意味着 STOMP 消息\n可以被转换为事件总线中的消息，并且事件总线中的消息可以被转化为 STOMP 消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了使用桥接， 您需要配置入站和出站地址。 入站地址是指需要转入事件总线的\n STOMP 消息的目的地点。 这些 STOMP 消息的目的地点会被作为事件总线的地址。 出站地址\n是指需要被转化为 STOMP 消息的事件总线地址。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n        .bridge(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e BridgeOptions()\n            .addInboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toBus\"\u003c/span\u003e))\n            .addOutboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toStomp\"\u003c/span\u003e))\n        )\n    )\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e默认情况下， 桥接使用 发布/订阅 模式发送消息 (topic 模式)。 您也可以配置它使用点对点模式去发送\n消息， 这样就只会有一个 STOMP 客户端或事件总线的消费者被调用:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n            .bridge(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e BridgeOptions()\n                    .addInboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toBus\"\u003c/span\u003e))\n                    .addOutboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toStomp\"\u003c/span\u003e))\n                    .setPointToPoint(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n            )\n    )\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e出入站的许可字符串可以作为一个 \"正则字符串\" 或者一个 \u003cem\u003e匹配项\u003c/em\u003e。 \u003cem\u003e匹配项\u003c/em\u003e 是指\n消息体需要满足的特定结构。 以下代码展示了消息体必须拥有字段 \"foo\" ，并且其\n值为 \"bar\"。 结构匹配当前只支持 Json 数据类型。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx)\n        .bridge(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e BridgeOptions()\n            .addInboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toBus\"\u003c/span\u003e)\n                .setMatch(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"foo\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"bar\"\u003c/span\u003e)))\n            .addOutboundPermitted(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PermittedOptions().setAddress(\u003cspan class=\"hljs-string\"\u003e\"/toStomp\"\u003c/span\u003e))\n            .setPointToPoint(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n        )\n    )\n    .listen();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_the_stomp_server_with_web_sockets\"\u003e\u003ca class=\"anchor\" href=\"#_using_the_stomp_server_with_web_sockets\"\u003e\u003c/a\u003e使用基于 websocket 的 STOMP 服务器\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想使用一个 Javascript 客户端 (在 node.js 或浏览器中) 直接连接 STOMP 服务器, 您可以使用\nwebsocket。 STOMP 协议目前完成了适配，可以基于 websocket 工作，参见\n\u003ca href=\"http://jmesnil.net/stomp-websocket/doc/\"\u003eStompJS\u003c/a\u003e 。 使用 JavaScript 客户端直接连接到 STOMP 服务器并且\n使用 websocket 协议发送消息。 这样也可以使用 websocket 接收 STOMP 消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了配置服务器使用 StompJS, 您需要：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e使用 websocket 桥接并且配置 websocket 需要监听的路径 (默认为 \u003ccode\u003e/stomp\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在您的应用中引入 \u003ca href=\"http://jmesnil.net/stomp-websocket/doc/#download\"\u003eStompJS\u003c/a\u003e (您的应用可以是\nHTML 页面上的脚本, 或者一个 node 模块 (\u003ca href=\"https://www.npmjs.com/package/stompjs\" class=\"bare\"\u003ehttps://www.npmjs.com/package/stompjs\u003c/a\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e连接到服务器\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了完成第一步， 您首先需要创建一个 HTTP 服务器, 并且将\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/StompServer.html#webSocketHandler--\"\u003ewebSocketHandler\u003c/a\u003e\u003c/code\u003e 的结果传递给\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/http/HttpServer.html#webSocketHandler-io.vertx.core.Handler-\"\u003ewebSocketHandler\u003c/a\u003e\u003c/code\u003e 方法:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eStompServer server = StompServer.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StompServerOptions()\n    .setPort(-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 禁用 tcp 端口，这一项是可选的\u003c/span\u003e\n    .setWebsocketBridge(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 开启 websocket 支持\u003c/span\u003e\n    .setWebsocketPath(\u003cspan class=\"hljs-string\"\u003e\"/stomp\"\u003c/span\u003e)) \u003cspan class=\"hljs-comment\"\u003e// 配置 websocket 路径，默认是 /stomp\u003c/span\u003e\n    .handler(StompServerHandler.create(vertx));\n\nFuture\u0026lt;HttpServer\u0026gt; http = vertx.createHttpServer(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HttpServerOptions().setWebSocketSubProtocols(Arrays.asList(\u003cspan class=\"hljs-string\"\u003e\"v10.stomp\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"v11.stomp\"\u003c/span\u003e))\n)\n    .webSocketHandler(server.webSocketHandler())\n    .listen(\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e不要忘了声明要支持的子协议， 否则连接会被拒绝。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e以下示例代码来自  \u003ca href=\"http://jmesnil.net/stomp-websocket/doc/\"\u003ethe StompJS documentation\u003c/a\u003e ，展示了如何连接\n到服务器：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e url = \u003cspan class=\"hljs-string\"\u003e\"ws://localhost:8080/stomp\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e client = Stomp.client(url);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e callback = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eframe\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(frame);\n};\n\nclient.connect({}, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e subscription = client.subscribe(\u003cspan class=\"hljs-string\"\u003e\"foo\"\u003c/span\u003e, callback);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_registering_received_and_writing_frame_handlers\"\u003e\u003ca class=\"anchor\" href=\"#_registering_received_and_writing_frame_handlers\"\u003e\u003c/a\u003e注册接收消息处理器和写入消息处理器\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSTOMP 客户端， 客户端连接和服务端都支持注册一个接收\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/Frame.html\"\u003eFrame\u003c/a\u003e\u003c/code\u003e 的处理器，该处理器会在每次接收到消息时被调用。 您可以通过\n它去打印数据包的日志或实现其他自定义的行为。 该处理器也会在接收 \u003ccode\u003ePING\u003c/code\u003e\n消息, 和其他 \u003cem\u003e非法 / 未知\u003c/em\u003e 类型消息时被调用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx).receivedFrameHandler(sf -\u0026gt; {\n      System.out.println(sf.frame());\n    }))\n    .listen();\n\nStompClient client = StompClient.create(vertx).receivedFrameHandler(frame -\u0026gt; System.out.println(frame));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e该处理器是在消息体被处理前调用的，因此可以使用它来 \u003cem\u003e修改\u003c/em\u003e 消息体内容\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用了不合法的指令的消息会被当做 \u003ccode\u003eUNKNOWN\u003c/code\u003e 指令类型来处理。 原本的指令值会被写入\n首部，其字段为 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/stomp/Frame.html#STOMP_FRAME_COMMAND\"\u003eFrame.STOMP_FRAME_COMMAND\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以设置一个处理器，该处理器会在数据包被发送前调用 (写入到网络前):\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFuture\u0026lt;StompServer\u0026gt; server = StompServer.create(vertx)\n    .handler(StompServerHandler.create(vertx))\n    .writingFrameHandler(sf -\u0026gt; {\n      System.out.println(sf.frame());\n    })\n    .listen();\n\nStompClient client = StompClient.create(vertx).writingFrameHandler(frame -\u0026gt; {\n  System.out.println(frame);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["vertx-stomp","java"]},"buildId":"dDVH8nD8CIlrAYVmKegA1","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.f7eb36393fca57ab228a.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" async=""></script><script src="/_next/static/dDVH8nD8CIlrAYVmKegA1/_buildManifest.js" async=""></script><script src="/_next/static/dDVH8nD8CIlrAYVmKegA1/_ssgManifest.js" async=""></script></body></html>