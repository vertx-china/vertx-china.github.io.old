<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>服务代理 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-service-proxy" as="fetch" crossorigin="anonymous" class="jsx-d38685edc31911e0"/><meta name="next-head-count" content="14"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-6853d859ade043b9.js" defer=""></script><script src="/_next/static/chunks/framework-01395af778c6fb71.js" defer=""></script><script src="/_next/static/chunks/main-2ea7ab41ab691905.js" defer=""></script><script src="/_next/static/chunks/pages/_app-155bbedc7d6c4b74.js" defer=""></script><script src="/_next/static/chunks/778-5eaf13e353ab0b06.js" defer=""></script><script src="/_next/static/chunks/619-34d9218a66d5b123.js" defer=""></script><script src="/_next/static/chunks/629-5a87bb724d19315e.js" defer=""></script><script src="/_next/static/chunks/923-e93d8f14ebe18c9e.js" defer=""></script><script src="/_next/static/chunks/434-be9324d6e5b718aa.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-b6a025bc5d4ae207.js" defer=""></script><script src="/_next/static/DxYj1qG9XZR4Q5BZwOJ88/_buildManifest.js" defer=""></script><script src="/_next/static/DxYj1qG9XZR4Q5BZwOJ88/_ssgManifest.js" defer=""></script><script src="/_next/static/DxYj1qG9XZR4Q5BZwOJ88/_middlewareManifest.js" defer=""></script><style id="__jsx-400ec7965926e858">.dropdown-item.jsx-400ec7965926e858{white-space:nowrap;
line-height:2;
width:100%;
padding:0 1.5rem;
cursor:pointer}
.dropdown-item.jsx-400ec7965926e858:hover{background-color:#e9ecef}
.dropdown-item.active.jsx-400ec7965926e858{font-weight:400;
padding-left:.75rem}
.dropdown-item.has-active-siblings.jsx-400ec7965926e858:not(.active){padding-left:calc(0.75rem + 16px + 0.5em)}
.dropdown-item.jsx-400ec7965926e858 .dropdown-check-icon.jsx-400ec7965926e858{width:16px;
margin-right:.5em;
margin-top:1px}</style><style id="__jsx-6650573c8f14945d">.dropdown.jsx-6650573c8f14945d{position:relative;
display:inline-block}
.dropdown.jsx-6650573c8f14945d .dropdown-title.jsx-6650573c8f14945d{margin-right:0;
cursor:pointer;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d{position:absolute;
background-color:#f8f9fa;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
border-radius:.8rem;
list-style-type:none;
padding:.6666666667rem 0;
margin:.25rem 0 0 0;
z-index:100;
display:none;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a{color:#4d4d4d;
-webkit-text-decoration:none;
text-decoration:none;
font-weight:300}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.align-right.jsx-6650573c8f14945d{right:0}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.visible.jsx-6650573c8f14945d{display:block}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a.jsx-6650573c8f14945d:hover{color:inherit}
.dropdown.jsx-6650573c8f14945d svg{margin-bottom:2px}</style><style id="__jsx-75cbc16d79a176fb">.tooltip.jsx-75cbc16d79a176fb{font-size:.75rem;
color:#4d4d4d;
background-color:#f8f9fa;
border-radius:.4rem;
padding:0 .4rem;
box-shadow:0 0 5px rgba(0, 0, 0, .3);
display:none;
white-space:nowrap;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.tooltip.visible.jsx-75cbc16d79a176fb{display:block}
.tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb, .tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb::before{position:absolute;
width:8px;
height:8px;
z-index:-1}
.tooltip.jsx-75cbc16d79a176fb .tooltip-arrow.jsx-75cbc16d79a176fb::before{content:"";
-webkit-transform:rotate(45deg);
-moz-transform:rotate(45deg);
-ms-transform:rotate(45deg);
transform:rotate(45deg);
background:#f8f9fa;
box-shadow:-2px -2px 2px rgba(0, 0, 0, .1)}
.tooltip[data-popper-placement^=top].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{bottom:-4px}
.tooltip[data-popper-placement^=top].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(225deg);
-moz-transform:rotate(225deg);
-ms-transform:rotate(225deg);
transform:rotate(225deg)}
.tooltip[data-popper-placement^=bottom].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{top:-4px}
.tooltip[data-popper-placement^=left].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{right:-4px}
.tooltip[data-popper-placement^=left].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(135deg);
-moz-transform:rotate(135deg);
-ms-transform:rotate(135deg);
transform:rotate(135deg)}
.tooltip[data-popper-placement^=right].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb{left:-4px}
.tooltip[data-popper-placement^=right].jsx-75cbc16d79a176fb>.tooltip-arrow.jsx-75cbc16d79a176fb::before{-webkit-transform:rotate(315deg);
-moz-transform:rotate(315deg);
-ms-transform:rotate(315deg);
transform:rotate(315deg)}</style><style id="__jsx-f705e145f931f504">.navbar{position:absolute;
top:2.75rem;
width:100%}
.navbar a{color:#3c3c3b}
.navbar a.navbar-menu-item, .navbar .dropdown-title{text-transform:uppercase}
.navbar a.navbar-menu-item:hover, .navbar .dropdown-title:hover{-webkit-text-decoration:none;
text-decoration:none;
color:#898987;
-webkit-transition:color .15s ease-in-out;
transition:color .15s ease-in-out}
.navbar .navbar-content{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
position:relative}
.navbar .navbar-content .navbar-logo{-webkit-flex:1;
-ms-flex:1;
flex:1}
.navbar .navbar-content .navbar-logo img{width:8.3rem}
.navbar .navbar-content .navbar-collapse-button{display:none;
cursor:pointer}
@media (max-width:1000px) {.navbar .navbar-content .navbar-collapse-button{display:inline-block}}
.navbar .navbar-content .navbar-collapse-button span{display:block;
width:33px;
height:4px;
margin-bottom:5px;
position:relative;
background:#3c3c3b;
border-radius:3px;
z-index:1;
transform-origin:4px 0;
-webkit-transition:-webkit-transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease;
transition:transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease}
.navbar .navbar-content .navbar-collapse-button span:first-child{transform-origin:0% 0%}
.navbar .navbar-content .navbar-collapse-button span:nth-last-child(2){transform-origin:0% 100%}
.navbar .navbar-content .navbar-right{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline;
margin-bottom:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-right{max-height:0;
-webkit-transition:max-height 200ms ease-in-out;
transition:max-height 200ms ease-in-out;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:absolute;
top:2.75rem;
left:.8rem;
right:.8rem;
background-color:#f8f9fa;
overflow-x:auto;
overflow-y:hidden}}
.navbar .navbar-content .navbar-menu .navbar-menu-item{font-weight:400;
margin-right:2.5rem}
.navbar .navbar-content .navbar-menu .navbar-menu-item.with-drop-down{margin-right:1.8rem}
@media (max-width:1250px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{margin-right:1.5rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{display:block;
margin-bottom:1rem;
font-size:1.2rem}}
.navbar .navbar-content .navbar-menu .navbar-menu-item .external-link-icon{margin-left:.25em}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
padding:1rem}}
.navbar .navbar-content .navbar-social{margin-left:1.6rem;
font-size:.875rem}
.navbar .navbar-content .navbar-social svg{height:16px;
margin-bottom:2px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social svg{height:1rem}}
@media (max-width:1250px) {.navbar .navbar-content .navbar-social{margin-left:1rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social{margin-left:auto;
padding:0 1rem 1rem 0;
font-size:1rem}}
@media (max-width:768px) {.navbar{top:1rem}}
.page .navbar{top:0;
padding-top:1.5rem;
padding-bottom:1rem;
position:fixed;
background-color:#fff;
z-index:2}</style><style id="__jsx-bf3edc7191e82cb">.search{position:relative}
.search input{color:#adb5bd;
border:1px solid #dee2e6;
border-radius:.4rem;
font-size:.875rem;
padding:.25rem 1.8rem .35rem 1.8rem;
width:100%;
-webkit-transition:color .15s ease-in-out, border-color .15s ease-in-out;
transition:color .15s ease-in-out, border-color .15s ease-in-out;
background-color:transparent}
.search input:focus{border-color:#adb5bd;
color:#3c3c3b}
.search .autosuggest{position:absolute;
top:0;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none;
z-index:-100;
opacity:.5}
.search .search-icon, .search .search-icon-delete{position:absolute;
top:.55rem;
height:1rem;
stroke:#adb5bd;
-webkit-transition:stroke .15s ease-in-out;
transition:stroke .15s ease-in-out}
.search .search-icon{left:.4rem}
.search input:focus+.search-icon{stroke:#6f6970}
.search .search-icon-delete{stroke:#6f6970;
right:.4rem;
height:.75rem;
top:.7rem;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out;
cursor:text}
.search.has-content .search-icon-delete{opacity:1;
cursor:pointer}</style><style id="__jsx-9ece789f808ef724">.search-results, .search-results-none{font-size:.875rem;
overflow:auto;
list-style-type:none;
padding-left:0;
display:none}
.search-results.visible, .search-results-none.visible{display:block}
.search-results{list-style-type:none;
padding:0;
margin-bottom:0}
.search-results li{display:block;
padding:.5rem;
margin-bottom:1rem;
border-radius:.4rem;
border:1px solid transparent;
cursor:pointer;
max-width:17rem;
overflow-x:hidden}
.search-results li.active{background-color:#f8f9fa;
border:1px solid #e9ecef}
.search-results li h5{margin:0 0 .5rem 0;
font-size:1em}
.search-results li .search-results-highlight{background-color:#ff0}
.search-results-none{padding:1rem .5rem;
text-align:center;
width:100%}</style><style id="__jsx-d1843944f2d67b">.search-panel{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:relative}</style><style id="__jsx-d38685edc31911e0">.github-stars.jsx-d38685edc31911e0{display:inline-block}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0{margin-right:.25em}
.github-stars.jsx-d38685edc31911e0 .icon.jsx-d38685edc31911e0 svg{height:1rem}</style><style id="__jsx-aeedcf66895f49d7">footer{font-size:.875rem;
padding-top:3rem;
padding-bottom:4rem;
background-color:#f8f9fa;
border-top:1px solid #dee2e6;
margin-top:1rem;
color:#6f6970}
footer h5{font-size:1rem;
margin-top:0;
margin-bottom:1rem;
color:#3c3c3b;
text-transform:uppercase}
footer ul{padding:0;
list-style:none;
line-height:2}
footer a{color:#6f6970}
footer .footer-logo img, footer .footer-copyright-eclipse-logo img{-webkit-filter:grayscale(100);
filter:grayscale(100);
opacity:.5;
-webkit-transition:all .15s ease-in-out;
transition:all .15s ease-in-out}
footer .footer-logo img:hover, footer .footer-copyright-eclipse-logo img:hover{-webkit-filter:grayscale(0);
filter:grayscale(0);
opacity:1}
footer .footer-nav-section{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
margin-bottom:6rem}
footer .footer-nav-section .footer-logo{margin-top:.4rem}
footer .footer-nav-section .footer-logo img{width:8.3rem}
footer .footer-nav-section .footer-nav-list{width:20%}
footer .footer-copyright{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
footer .footer-copyright a{white-space:nowrap}
footer .footer-copyright .footer-copyright-eclipse-logo{width:17%;
margin-bottom:.5rem}
@media (max-width:1250px) {footer .footer-copyright .footer-copyright-break{display:none}
footer .footer-copyright .footer-copyright-eclipse-logo{width:30%}}
@media (max-width:1000px) {footer .footer-nav-section .footer-nav-list{width:25%}
footer .footer-copyright .footer-copyright-break{display:inline-block}
footer .footer-copyright .footer-copyright-eclipse-logo{width:40%}}
@media (max-width:768px) {footer .footer-nav-section{max-width:100%;
margin-left:auto;
margin-right:auto}}
@media (max-width:640px) {footer .footer-nav-section{max-width:80%;
margin-bottom:3rem;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
footer .footer-nav-section h5{cursor:pointer}
footer .footer-nav-section h5::after{display:inline-block;
content:"";
border-top:.4em solid;
border-right:.4em solid transparent;
border-bottom:0;
border-left:.4em solid transparent;
position:absolute;
top:.75rem;
right:0}
footer .footer-nav-section .footer-nav-list{width:100%;
position:relative}
footer .footer-nav-section .footer-nav-list ul{overflow-y:hidden;
max-height:0;
-webkit-transition:all 200ms ease-in-out;
transition:all 200ms ease-in-out}
footer .footer-nav-section .footer-nav-list ul.visible{margin-bottom:2rem}
footer .footer-nav-section .footer-logo{margin:0 auto 3rem auto;
width:auto}
footer .footer-copyright{max-width:80%;
text-align:center;
margin-left:auto;
margin-right:auto;
-webkit-flex-direction:column-reverse;
-ms-flex-direction:column-reverse;
flex-direction:column-reverse}
footer .footer-copyright .footer-copyright-eclipse-logo{width:7.6rem;
margin-bottom:1rem}}</style><style id="__jsx-efcc50be384cabc7">.page-content{margin-top:6em;
margin-bottom:8rem}
.docs .docs-content .docs-content-wrapper{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between}
.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 17rem;
-ms-flex:0 0 17rem;
flex:0 0 17rem}
.docs .docs-content .docs-content-wrapper aside .docs-content-wrapper-sidebar{position:-webkit-sticky;
position:sticky;
top:7em}
.docs .docs-content .docs-content-wrapper aside .search-panel{margin-top:1rem;
width:100%}
.docs .docs-content .docs-content-wrapper aside .search-panel .search-results{max-height:calc(100vh - 10rem - 1px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc{margin-top:1rem;
overflow-y:auto;
max-height:calc(100vh - 10rem - 3px)}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc #toctitle{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul{margin-top:0;
padding-left:0;
list-style-type:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul.sectlevel2{display:none}
.docs .docs-content .docs-content-wrapper aside .docs-content-toc ul li{padding:.3333333333rem 0}
.docs .docs-content .docs-content-wrapper aside.docs-has-search-results .docs-content-toc{display:none}
@media (max-width:1250px) {.docs .docs-content .docs-content-wrapper aside{-webkit-flex:0 0 15rem;
-ms-flex:0 0 15rem;
flex:0 0 15rem}}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper aside{z-index:1;
position:fixed;
top:0;
right:0;
width:25rem;
height:100vh;
max-width:100%;
padding-top:6rem;
padding-left:2rem;
padding-right:2rem;
background-color:#fff;
border-left:1px solid #dee2e6;
-webkit-transform:translateX(100%);
-moz-transform:translateX(100%);
-ms-transform:translateX(100%);
transform:translateX(100%);
-webkit-transition:-webkit-transform 200ms ease-in-out;
transition:transform 200ms ease-in-out;
will-change:transform}
.docs .docs-content .docs-content-wrapper aside.collapse{-webkit-transform:translateX(0%);
-moz-transform:translateX(0%);
-ms-transform:translateX(0%);
transform:translateX(0%)}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper aside{min-width:100%;
border-left:none}}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{z-index:1000;
cursor:pointer;
display:none;
position:fixed;
-webkit-justify-content:center;
justify-content:center;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
right:2rem;
bottom:2rem;
color:#fff;
background-color:#4d4d4d;
padding:.5rem;
border-radius:.8rem;
-webkit-transition:background-color .15s ease-in-out;
transition:background-color .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-list, .docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{display:block}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle .feather-x{position:absolute;
left:0;
top:0;
opacity:0;
-webkit-transition:opacity .15s ease-in-out;
transition:opacity .15s ease-in-out}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle:hover{background-color:#3c3c3b}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-list{opacity:0}
.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle.collapse .feather-x{opacity:1}
@media (max-width:1000px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}}
@media (max-width:640px) {.docs .docs-content .docs-content-wrapper .docs-content-sidebar-toggle{right:1rem;
bottom:1rem}}
.docs .docs-content .docs-content-inner{max-width:calc(100% - 19.5rem);
overflow:hidden}
.docs .docs-content .docs-content-inner .docs-content-metadata{margin-top:1.2rem;
margin-bottom:1.2rem;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
flex-wrap:wrap;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-repo{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-flex:1;
-ms-flex:1;
flex:1}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*{margin-right:2rem}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left>*:last-child{margin-right:0}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
color:#6f6970;
white-space:nowrap}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a:hover{color:#782b90}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left a .feather{margin-right:.25em;
height:1rem}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-left{flex-wrap:wrap;
margin-bottom:1rem}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-flex:1;
-ms-flex:1;
flex:1;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex}
@media (min-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version{-webkit-box-pack:end;
-ms-flex-pack:end;
-webkit-justify-content:flex-end;
justify-content:flex-end}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:16px;
margin-bottom:-2px}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version svg{height:1rem;
margin-bottom:-1px}}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a{-webkit-text-decoration:none;
text-decoration:none}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-version .dropdown-menu a:hover{color:#6f6970}
.docs .docs-content .docs-content-inner .docs-content-metadata .docs-content-metadata-label{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-left:2rem}
.docs .docs-content .docs-content-inner h1{padding-top:0;
margin-top:.6rem;
line-height:1.2}
.docs .docs-content .docs-content-inner h1::after{content:"";
width:30%;
display:block;
border:2px solid #782b90;
border-radius:2px;
margin-top:1.1rem}
.docs .docs-content .docs-content-inner .ulist>ul{padding-left:1.1rem}
.docs .docs-content .docs-content-inner h2{border-top:1px solid #dee2e6;
margin-top:5rem;
padding-top:2rem}
.docs .docs-content .docs-content-inner h3, .docs .docs-content .docs-content-inner h4{margin-top:3rem}
@media (max-width:1250px) {.docs .docs-content .docs-content-inner{max-width:calc(100% - 17.5rem)}}
@media (max-width:1000px) {.docs .docs-content .docs-content-inner{max-width:100%}}
.docs .docs-content .admonitionblock{border-top-right-radius:.8rem;
border-bottom-right-radius:.8rem;
background-color:#f8f9fa;
padding:1rem;
margin:1.5rem 0;
border-left:9px solid transparent}
.docs .docs-content .admonitionblock.note, .docs .docs-content .admonitionblock.tip{border-color:#6cb9f0}
.docs .docs-content .admonitionblock.important, .docs .docs-content .admonitionblock.warning, .docs .docs-content .admonitionblock.caution{border-color:#f0a46c}
.docs .docs-content .admonitionblock tr{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.docs .docs-content .admonitionblock .title{font-weight:400}
.docs .docs-content .admonitionblock .title::after{content:":"}
.docs .docs-content dt{font-weight:400}
.docs .docs-content .anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.docs .docs-content .anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.docs .docs-content .anchor:hover{opacity:1}
.docs .docs-content h2:hover .anchor, .docs .docs-content h3:hover .anchor, .docs .docs-content h4:hover .anchor, .docs .docs-content h5:hover .anchor, .docs .docs-content h6:hover .anchor{opacity:1}
.docs .docs-content h1 .anchor{display:none}
.docs .docs-content h4 .anchor::after, .docs .docs-content h5 .anchor::after, .docs .docs-content h6 .anchor::after{padding-right:.6rem}</style><style id="__jsx-7824b3ad3820c879">html{line-height:1.15;
-webkit-text-size-adjust:100%}
body{margin:0}
main{display:block}
h1{font-size:2em;
margin:.67em 0}
hr{box-sizing:content-box;
height:0;
overflow:visible}
pre{font-family:monospace, monospace;
font-size:1em}
a{background-color:transparent}
abbr[title]{border-bottom:none;
text-decoration:underline;
text-decoration:underline dotted}
b, strong{font-weight:bolder}
code, kbd, samp{font-family:monospace, monospace;
font-size:1em}
small{font-size:80%}
sub, sup{font-size:75%;
line-height:0;
position:relative;
vertical-align:baseline}
sub{bottom:-0.25em}
sup{top:-0.5em}
img{border-style:none}
button, input, optgroup, select, textarea{font-family:inherit;
font-size:100%;
line-height:1.15;
margin:0}
button, input{overflow:visible}
button, select{text-transform:none}
button, [type=button], [type=reset], [type=submit]{-webkit-appearance:button}
button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner{border-style:none;
padding:0}
button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring{outline:1px dotted ButtonText}
fieldset{padding:.35em .75em .625em}
legend{box-sizing:border-box;
color:inherit;
display:table;
max-width:100%;
padding:0;
white-space:normal}
progress{vertical-align:baseline}
textarea{overflow:auto}
[type=checkbox], [type=radio]{box-sizing:border-box;
padding:0}
[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button{height:auto}
[type=search]{-webkit-appearance:textfield;
outline-offset:-2px}
[type=search]::-webkit-search-decoration{-webkit-appearance:none}
::-webkit-file-upload-button{-webkit-appearance:button;
font:inherit}
details{display:block}
summary{display:list-item}
template{display:none}
[hidden]{display:none}
.hljs, pre{display:block;
overflow-x:auto;
padding:.5em;
background:#3a2840;
color:#fff}
.hljs.language-shell :not(.bash)+.bash, .hljs.language-better-shell :not(.bash)+.bash, pre.language-shell :not(.bash)+.bash, pre.language-better-shell :not(.bash)+.bash{color:#d2a8e0}
pre{border-radius:.8rem;
padding:1rem;
font-size:.875rem;
margin:1.5rem 0}
.hljs-keyword, .hljs-selector-tag, .hljs-tag{color:#d2a8e0}
.hljs-template-tag{color:red}
.hljs-number{color:#6cb9f0}
.hljs-variable, .hljs-template-variable, .hljs-attribute, .hljs-literal{color:#c9e5f9}
.hljs-subst{color:red}
.hljs-title, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-section, .hljs-type{color:#f0a46c}
.hljs-symbol, .hljs-bullet, .hljs-link{color:#d2a8e0}
.hljs-deletion, .hljs-string, .hljs-built_in, .hljs-builtin-name{color:#6cb9f0}
.hljs-addition, .hljs-comment, .hljs-quote, .hljs-meta{color:#adb5bd}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:bold}
#nprogress{pointer-events:none}
#nprogress .bar{background:#29d;
position:fixed;
z-index:1031;
top:0;
left:0;
width:100%;
height:2px}
#nprogress .peg{display:block;
position:absolute;
right:0px;
width:100px;
height:100%;
box-shadow:0 0 10px #29d, 0 0 5px #29d;
opacity:1;
-webkit-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
-webkit-transform:rotate(3deg) translate(0px, -4px);
-moz-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
transform:rotate(3deg) translate(0px, -4px)}
#nprogress .spinner{display:block;
position:fixed;
z-index:1031;
top:15px;
right:15px}
#nprogress .spinner-icon{width:18px;
height:18px;
box-sizing:border-box;
border:solid 2px transparent;
border-top-color:#29d;
border-left-color:#29d;
border-radius:50%;
-webkit-animation:nprogress-spinner 400ms linear infinite;
-webkit-animation:nprogress-spinner 400ms linear infinite;
animation:nprogress-spinner 400ms linear infinite}
.nprogress-custom-parent{overflow:hidden;
position:relative}
.nprogress-custom-parent #nprogress .spinner, .nprogress-custom-parent #nprogress .bar{position:absolute}
@keyframes nprogress-spinner {0% {-webkit-transform:rotate(0deg)}100% {-webkit-transform:rotate(360deg)}}
@keyframes nprogress-spinner {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}
#nprogress .bar{background:#782b90}
#nprogress .peg{box-shadow:0 0 10px #782b90, 0 0 5px #782b90}
#nprogress .spinner-icon{border-top-color:#782b90;
border-left-color:#782b90}
html{box-sizing:border-box}
*, *::before, *::after{box-sizing:inherit}
:root{font-size:18px}
@media (max-width:1000px) {:root{font-size:17.1px}}
@media (max-width:768px) {:root{font-size:16.2px}}
@media (max-width:640px) {:root{font-size:15.3px}}
body, input{font-family:Roboto, sans-serif;
font-weight:300;
line-height:1.7;
color:#3c3c3b}
input{outline:none}
h1, h2, h3, h4, h5, h6{font-weight:400}
h1{font-size:2.5rem}
h2{font-size:2rem}
h3{font-size:1.75rem}
h4{font-size:1.5rem}
h5{font-size:1.25rem}
h6{font-size:1.1rem}
.container{width:100%;
padding-right:.8rem;
padding-left:.8rem;
margin-right:auto;
margin-left:auto}
@media (min-width:640px) {.container{max-width:620px}}
@media (min-width:768px) {.container{max-width:738px}}
@media (min-width:1000px) {.container{max-width:950px}}
@media (min-width:1250px) {.container{max-width:1180px}}
@media (min-width:1250px) {.container-narrow{max-width:950px}}
.img-fluid{max-width:100%}
a{-webkit-text-decoration:none;
text-decoration:none;
color:#782b90}
a:hover{text-decoration:underline;
color:#571f69}
img{vertical-align:middle}
svg{overflow:hidden;
vertical-align:middle}
code, pre{font-family:"Roboto Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
p code{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
max-width:100%;
overflow:auto}
.heading-anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.heading-anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.heading-anchor:hover{opacity:1}
h2:hover .heading-anchor, h3:hover .heading-anchor, h4:hover .heading-anchor, h5:hover .heading-anchor, h6:hover .heading-anchor{opacity:1}
h1 .heading-anchor{display:none}
h4 .heading-anchor::after, h5 .heading-anchor::after, h6 .heading-anchor::after{padding-right:.6rem}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400&display=swap">@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZKCA.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-59Y.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCkYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCAYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCgYb9lecyVC4A.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCcYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCsYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCoYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCQYb9lecyU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-19-7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-19a7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-1967DQk6YvNkeg.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-19G7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-1927DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-19y7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v25/ieVl2ZhZI2eCN5jzbjEETS9weq8-19K7DQk6YvM.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v21/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body data-build-time="2022-05-05T22:55:21.503Z" data-build-commit-id="74c7933730aaf9b2d601c96696b7cbaa4beb5d95" data-build-run-id="2278663533"><div id="__next" data-reactroot=""><main class="jsx-efcc50be384cabc7 page docs"><header><div class="jsx-f705e145f931f504 navbar"><div class="jsx-f705e145f931f504 navbar-content container"><div class="jsx-f705e145f931f504 navbar-logo"><a class="jsx-f705e145f931f504" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-f705e145f931f504"/></a></div><div class="jsx-f705e145f931f504 navbar-collapse-button"><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span></div><div class="jsx-f705e145f931f504 navbar-right"><div class="jsx-f705e145f931f504 navbar-menu"><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/introduction-to-vertx-and-reactive/"><li class="jsx-400ec7965926e858 dropdown-item">简介</li></a><a class="jsx-f705e145f931f504" href="/get-started/"><li class="jsx-400ec7965926e858 dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/docs/">文档</a><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/faq/"><li class="jsx-400ec7965926e858 dropdown-item">答疑</li></a><a class="jsx-f705e145f931f504" href="/channels/"><li class="jsx-400ec7965926e858 dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/advanced-vertx-guide" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">Advanced Vert.x Guide <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/blog/">博客</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/community/">社区</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/translation/">翻译团队</a></div><div class="jsx-f705e145f931f504 navbar-social"><span class="jsx-75cbc16d79a176fb "><a href="https://github.com/vert-x3/vertx-awesome" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title></title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Awesome Vert.x<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://stackoverflow.com/questions/tagged/vert.x" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title></title><path d="M15.725 0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725 0zm-3.94 3.418l-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465l-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86l-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Stack Overflow<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title></title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">YouTube<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://discord.gg/KzEMwP2" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title></title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Discord<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title></title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x User Group<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://qm.qq.com/cgi-bin/qm/qr?k=I4Z94iAgTJXB6FyR_U5scsJHtkjb1pif&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title></title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x中国用户组QQ群<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div><span class="jsx-75cbc16d79a176fb "><a href="https://qun.qq.com/qqweb/qunpro/share?_wv=3&amp;_wwv=128&amp;inviteCode=1reLvB&amp;from=246610&amp;biz=ka" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 200 200" aria-label=""><path d="M13 73L16 49L52 49L58 14L82 14L77 49L135 49L141 14L166 14L160 49L195 49L192 73L157 73L148 124L184 124L181 149L144 149L137 193L90 149L61 149L55 185L31 185L36 149L0 149L6 124L100 124L120 144L131 75L72 75L64 124L40 124L48 73Z"></path></svg></a></span><div class="jsx-75cbc16d79a176fb tooltip">Vert.x中国用户组QQ频道<div data-popper-arrow="true" class="jsx-75cbc16d79a176fb tooltip-arrow"></div></div></div></div></div></div></header><div class="jsx-efcc50be384cabc7 page-content docs-content"><div class="jsx-efcc50be384cabc7 container"><div class="jsx-efcc50be384cabc7 docs-content-wrapper"><aside class="jsx-efcc50be384cabc7 "><div class="jsx-efcc50be384cabc7 docs-content-wrapper-sidebar"><div class="jsx-d1843944f2d67b search-panel"><div class="jsx-bf3edc7191e82cb search"><input type="text" disabled="" class="jsx-bf3edc7191e82cb autosuggest"/><input type="text" placeholder="Search..." value="" class="jsx-bf3edc7191e82cb"/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="jsx-9ece789f808ef724 search-results"></ul><div class="jsx-9ece789f808ef724 search-results-none">No results.</div></div><div class="jsx-efcc50be384cabc7 docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_vert_x_service_proxies">使用Vert.x服务代理</a></li>
<li><a href="#_introduction_to_service_proxies">服务代理简介</a></li>
<li><a href="#_async_interface">异步接口</a></li>
<li><a href="#_async_interface_with_callbacks">带回调的异步接口</a></li>
<li><a href="#_security">安全</a></li>
<li><a href="#_code_generation">代码生成</a></li>
<li><a href="#_exposing_your_service">公开服务</a></li>
<li><a href="#_proxy_creation">代理创建</a></li>
<li><a href="#_error_handling">错误处理</a></li>
<li><a href="#_restrictions_for_service_interface">接口类型限制</a>
<ul class="sectlevel2">
<li><a href="#_data_types">数据类型</a></li>
<li><a href="#_overloaded_methods">重载方法</a></li>
</ul>
</li>
<li><a href="#_convention_for_invoking_services_over_the_event_bus_without_proxies">通过事件总线调用服务的规则 (不使用服务代理)</a></li>
</ul>
</div></div></div></aside><div class="jsx-efcc50be384cabc7 docs-content-sidebar-toggle"><div style="position:relative" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="jsx-efcc50be384cabc7 docs-content-inner"><div class="jsx-efcc50be384cabc7 docs-content-metadata"><div class="jsx-efcc50be384cabc7 docs-content-metadata-left"><div class="jsx-efcc50be384cabc7 docs-content-metadata-repo"><div class="jsx-d38685edc31911e0 github-stars"><a href="https://github.com/vert-x3/vertx-service-proxy" class="jsx-d38685edc31911e0"><div class="jsx-d38685edc31911e0 icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div> <!-- -->null stars</a></div></div><div class="jsx-efcc50be384cabc7"><a href="https://vertx.io/docs/apidocs" class="jsx-efcc50be384cabc7"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-examples"><a href="https://github.com/vert-x3/vertx-examples/tree/4.x/service-proxy-examples"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Examples</a></div><div class="jsx-efcc50be384cabc7 docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-service-proxy/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="jsx-efcc50be384cabc7 docs-content-metadata-version"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">v4.2.7<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu align-right"><a href="/docs/vertx-service-proxy/java/"><li class="jsx-400ec7965926e858 dropdown-item active has-active-siblings"><span class="jsx-400ec7965926e858 dropdown-check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></span>Latest (v<!-- -->4.2.7<!-- -->)</li></a><a href="/docs/4.1.8/vertx-service-proxy/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.1.8</li></a><a href="/docs/4.0.3/vertx-service-proxy/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a><a href="/docs/3.9.13/vertx-service-proxy/java/"><li class="jsx-400ec7965926e858 dropdown-item has-active-siblings">v<!-- -->3.9.13</li></a></ul></div></span></div></div><div class="jsx-efcc50be384cabc7"><h1>Vert.x 服务代理</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>当您编写 Vert.x 程序的时候，您也许想将某处独立服务功能提供给其他程序使用。
此时便使用服务代理。它可以让您在事件总线上发布您的 <em>服务</em> ，
任何 Vert.x 程序只要知道其 <em>地址</em>
即可使用该服务。</p>
</div>
<div class="paragraph">
<p>一个 <em>服务</em> 通过 Java 接口描述并遵循 <em>异步</em> 模式。
从本质上说，消息通过事件总线发送调用服务并获取响应。
但为了方便使用，它会生成一个 <em>代理</em> ，您可直接使用该代理（用代理提供的服务接口 API）。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_vert_x_service_proxies"><a class="anchor" href="#_using_vert_x_service_proxies"></a>使用Vert.x服务代理</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>使用</strong> Vert.x Service Proxies 之前，
您必须在您得项目当中添加 <em>依赖</em> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-proxy<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle（在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">&#x27;io.vertx:vertx-service-proxy:4.1.7&#x27;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为了 <strong>实现</strong> 服务代理, 您还需要添加：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-codegen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle &lt; 5 （在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compileOnly <span class="hljs-string">&#x27;io.vertx:vertx-codegen:4.1.7&#x27;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle &gt;= 5（在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">annotationProcessor <span class="hljs-string">&#x27;io.vertx:vertx-codegen:4.1.7:processor&#x27;</span>
annotationProcessor <span class="hljs-string">&#x27;io.vertx:vertx-service-proxy:4.1.7&#x27;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：因为服务代理类是由代码自动生成的，因此每当您修改了 <em>服务接口</em> 您必须重新编译源码，
以重新生成代理类。</p>
</div>
<div class="paragraph">
<p>如果您要生成不同语言的代理类，您需要添加相应的依赖。例如，
生成 Groovy 语言的代理接口需要添加 <code>vertx-lang-groovy</code> 依赖</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_service_proxies"><a class="anchor" href="#_introduction_to_service_proxies"></a>服务代理简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p>让我看看服务代理它怎么用。
如果您在事件总线上公开 <em>数据库服务</em> 您可以执行下面的操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">JsonObject</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObject</span>();

message
  .put(<span class="hljs-string">&quot;collection&quot;</span>, <span class="hljs-string">&quot;mycollection&quot;</span>)
  .put(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObject</span>().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;tim&quot;</span>));

<span class="hljs-type">DeliveryOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeliveryOptions</span>().addHeader(<span class="hljs-string">&quot;action&quot;</span>, <span class="hljs-string">&quot;save&quot;</span>);

vertx.eventBus()
  .request(<span class="hljs-string">&quot;database-service-address&quot;</span>, message, options)
  .onSuccess(msg -&gt; {
    <span class="hljs-comment">// 完成</span>
  }).onFailure(err -&gt; {
  <span class="hljs-comment">// 失败</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>当创建服务的时候，会有一定数量的样本代码在事件总线接收信息，
路由会找到合适的方法并在总线上返回结果</p>
</div>
<div class="paragraph">
<p>使用 Vert.x 服务代理时, 您可以使用代码生成避免编写重复的代码，从而集中精力编写服务</p>
</div>
<div class="paragraph">
<p>在您编写的Java接口上面打上 <code>@ProxyGen</code> 注解, 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SomeDatabaseService</span> {

 <span class="hljs-comment">// 几个工厂方法用于创建实例和代理</span>
 <span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title function_">create</span><span class="hljs-params">(Vertx vertx)</span> {
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span>(vertx);
 }

 <span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Vertx vertx,
   String address)</span> {
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceVertxEBProxy</span>(vertx, address);
 }

<span class="hljs-comment">// 此处是实际的服务操作……</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(String collection, JsonObject document,
  Handler&lt;AsyncResult&lt;Void&gt;&gt; resultHandler)</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还需要编写 <code>package-info.java</code> 文件，位置处于接口定义包中。
这个包还需要 <code>@ModuleGen</code> 注解，
以便 Vert.x 代码生成器生成事件总线代理代码。</p>
</div>
<div class="listingblock">
<div class="title">package-info.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@io</span>.vertx.codegen.annotations.ModuleGen(groupPackage = <span class="hljs-string">&quot;io.vertx.example&quot;</span>, name = <span class="hljs-string">&quot;services&quot;</span>, useFutures = <span class="hljs-literal">true</span>)
<span class="hljs-keyword">package</span> io.vertx.example;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了这个接口，Vert.x 会生成所有需要的用于在事件总线上访问您服务的模板代码，
同时也会生成对应的 <strong>调用端代理类（client side proxy）</strong> ，
这样您的服务调用端就可以使用一个相当符合习惯的 API（译者注：即相同的服务接口）进行服务调用，而不是去手动地向事件总线发送消息。
不管您的服务实际依赖于哪个事件总线上（可能是在不同的机器上），调用端代理类都能正常工作。</p>
</div>
<div class="paragraph">
<p>也就是说，您可以通过以下方式进行服务调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> SomeDatabaseService
  .createProxy(vertx, <span class="hljs-string">&quot;database-service-address&quot;</span>);

<span class="hljs-comment">// 保存数据到数据库，这里使用了代理</span>
service.save(
  <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObject</span>().put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;tim&quot;</span>),
  res2 -&gt; {
    <span class="hljs-keyword">if</span> (res2.succeeded()) {
      <span class="hljs-comment">// 调用完毕</span>
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以将多语言 API 生成功能（@VertxGen 注解）与 @ProxyGen 注解相结合，
用于生成其它 Vert.x 支持的 JVM 语言对应的服务代理 —— 这意味着您可以只用 Java 编写您的服务一次，
就可以在其他语言中以一种习惯的 API 风格进行服务调用，而完全不必管服务是在本地还是在哪个事件总线上。
想要利用多语言代码生成功能，不要忘记添加对应支持语言的依赖。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span> <span class="hljs-comment">// 生成服务代理</span>
<span class="hljs-meta">@VertxGen</span> <span class="hljs-comment">// 生成客户端</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SomeDatabaseService</span> {
 <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_async_interface"><a class="anchor" href="#_async_interface"></a>异步接口</h2>
<div class="sectionbody">
<div class="paragraph">
<p>想要正确地生成服务代理类，<em>服务接口</em> 的设计必须遵循一些规则。 首先是需要遵循异步模式。
如果需要返回结果，对应的方法需要包含一个 <code>Future&lt;ResultType&gt;</code> 类型的返回值。
其中 <code>ResultType</code> 可以是另一种代理类型（所以一个代理类可以作为另一个代理类的工厂）。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SomeDatabaseService</span> {

<span class="hljs-comment">// 一些用于创建服务实例和服务代理实例的工厂方法</span>

<span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title function_">create</span><span class="hljs-params">(Vertx vertx)</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span>(vertx);
}

<span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Vertx vertx, String address)</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceVertxEBProxy</span>(vertx, address);
}

<span class="hljs-comment">// 异步方法，仅通知调用是否完成，不返回结果</span>
Future&lt;Void&gt; <span class="hljs-title function_">save</span><span class="hljs-params">(String collection, JsonObject document)</span>;

<span class="hljs-comment">// 异步方法，包含JsonObject类型的返回结果</span>
Future&lt;JsonObject&gt; <span class="hljs-title function_">findOne</span><span class="hljs-params">(String collection, JsonObject query)</span>;

<span class="hljs-comment">// 创建连接</span>
Future&lt;MyDatabaseConnection&gt; <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String shoeSize)</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以及：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-meta">@VertxGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyDatabaseConnection</span> {

<span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(JsonObject someData)</span>;

Future&lt;Void&gt; <span class="hljs-title function_">commit</span><span class="hljs-params">()</span>;

<span class="hljs-meta">@ProxyClose</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过声明一个特殊方法，并给其加上 <code>@ProxyClose</code> 注解来注销代理。
当此方法被调用时，代理实例被清除。</p>
</div>
<div class="paragraph">
<p>更多 <code>服务接口</code> 的限制会在下面详解。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_async_interface_with_callbacks"><a class="anchor" href="#_async_interface_with_callbacks"></a>带回调的异步接口</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 Vert.x 4.1 之前，服务异步接口由回调定义。</p>
</div>
<div class="paragraph">
<p>您仍然可以使用回调创建服务异步接口，使用以下模块声明：</p>
</div>
<div class="listingblock">
<div class="title">package-info.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@io</span>.vertx.codegen.annotations.ModuleGen(groupPackage = <span class="hljs-string">&quot;io.vertx.example&quot;</span>, name = <span class="hljs-string">&quot;services&quot;</span>, useFutures = <span class="hljs-literal">false</span>)
<span class="hljs-keyword">package</span> io.vertx.example;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
为向后兼容，<code>useFutures</code> 的默认值为 <code>false</code>，因此您也可以省略该声明
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>带有回调的服务异步接口如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SomeDatabaseService</span> {

 <span class="hljs-comment">// 一个通知完成而没有结果的方法（void）</span>
 <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(String collection, JsonObject document,
  Handler&lt;AsyncResult&lt;Void&gt;&gt; result)</span>;

 <span class="hljs-comment">// 一个提供了结果的方法（一个 json 对象）</span>
 <span class="hljs-keyword">void</span> <span class="hljs-title function_">findOne</span><span class="hljs-params">(String collection, JsonObject query,
  Handler&lt;AsyncResult&lt;JsonObject&gt;&gt; result)</span>;

 <span class="hljs-comment">// 创建连接</span>
 <span class="hljs-keyword">void</span> <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String shoeSize,
  Handler&lt;AsyncResult&lt;MyDatabaseConnection&gt;&gt; resultHandler)</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回类型必须是以下之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code></p>
</li>
<li>
<p><code>@Fluent</code> 并返回对该服务的引用（<code>this</code>）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Fluent</span>
SomeDatabaseService <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是因为方法不允许阻塞，如果该服务是远程调用（remote）（译者注：远程意思是服务代理通过事件总线调用其他verticle中的服务），
那么无法在不阻塞的前提下立即返回结果。（译者注：因为远程调用需要消耗一定时间）</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security"><a class="anchor" href="#_security"></a>安全</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务代理可以使用简单的拦截器保障基本安全。
提供一个身份验证器，可以选择添加 <code>Authorization</code> 在这种情况下，<code>AuthorizationProvider</code> 是必须提提供的。
注意，身份认证的令牌从 <code>auth-token</code> 信息头获取。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span>();
<span class="hljs-comment">// 注册处理器</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceBinder</span>(vertx)
  .setAddress(<span class="hljs-string">&quot;database-service-address&quot;</span>)
  <span class="hljs-comment">// 保护传输中的信息</span>
  .addInterceptor(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceAuthInterceptor</span>()
      <span class="hljs-comment">// 使用JWT认证进行校验令牌</span>
      .setAuthenticationProvider(JWTAuth.create(vertx, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JWTAuthOptions</span>()))
      <span class="hljs-comment">// 我们可以选择部分权限进行保护：</span>

      <span class="hljs-comment">// 比如admin组</span>
      .addAuthorization(RoleBasedAuthorization.create(<span class="hljs-string">&quot;admin&quot;</span>))
      <span class="hljs-comment">// 比如打印权限</span>
      .addAuthorization(PermissionBasedAuthorization.create(<span class="hljs-string">&quot;print&quot;</span>))

      <span class="hljs-comment">// 或者从令牌种加载权限</span>
      <span class="hljs-comment">// 如果有需要您也可以从数据库或文件加载中权限</span>
      .setAuthorizationProvider(
        JWTAuthorization.create(<span class="hljs-string">&quot;permissions&quot;</span>)))

  .register(SomeDatabaseService.class, service);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_generation"><a class="anchor" href="#_code_generation"></a>代码生成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>被 @ProxyGen 注解的服务接口会触发生成对应的服务辅助类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>服务代理类（service proxy）：一个编译时产生的代理类，用 <code>EventBus</code> 通过消息与服务交互。</p>
</li>
<li>
<p>服务处理器类（service handler）： 一个编译时产生的 <code>EventBus</code> 处理器类，用于响应由服务代理发送的事件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>产生的服务代理和处理器的命名是在类名的后面加相关的字段，例如，如果一个服务接口名为 <code>MyService</code>，
则对应的处理器类命名为 <code>MyServiceProxyHandler</code>，对应的服务代理类命名为 MyServiceVertxEBProxy。</p>
</div>
<div class="paragraph">
<p>此外 Vert.x Core 提供了一个生成器用于数据转化器，以简化服务代理中数据对象的使用。
数据转化器要求数据对象提供一个以 <code>JsonObject</code>
为基础的构造器和 <code>toJson()</code> 方法</p>
</div>
<div class="paragraph">
<p><em>codegen</em> 注释处理器在编译时生成这些类
它是Java编译器的功能 所以无需 <em>额外步骤</em>, 只需正确配置您的构建参数即可：</p>
</div>
<div class="paragraph">
<p>只需要在构建配置中加上 <code>io.vertx:vertx-codegen:processor</code> 和 <code>io.vertx:vertx-service-proxy</code>
依赖。</p>
</div>
<div class="paragraph">
<p>这是一个针对 Maven 的配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-codegen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>processor<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-proxy<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此功能也可以在 Gradle 中使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>compile "io.vertx:vertx-codegen:4.1.7:processor"
compile "io.vertx:vertx-service-proxy:4.1.7"</code></pre>
</div>
</div>
<div class="paragraph">
<p>IDE 通常为注释处理器提供支持。</p>
</div>
<div class="paragraph">
<p>代码生成 <code>处理器</code> 分类器会把服务代理注释处理器的配置自动添加到 jar 包目录下的
<code>META-INF/services</code> 当中。</p>
</div>
<div class="paragraph">
<p>如果您想和其与常规 jar一起使用，但是需要显式声明注释处理器,
例如在 Maven 中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessors</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessor</span>&gt;</span>io.vertx.codegen.CodeGenProcessor<span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessor</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessors</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposing_your_service"><a class="anchor" href="#_exposing_your_service"></a>公开服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当您写好服务接口以后，执行构建操作以生成代码。
然后您需要将您的服务 <code>注册</code> 到事件总线上：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span>();
<span class="hljs-comment">// 注册处理器</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceBinder</span>(vertx)
  .setAddress(<span class="hljs-string">&quot;database-service-address&quot;</span>)
  .register(SomeDatabaseService.class, service);</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个过程既可以在 Verticle 中完成，也可以在您的代码的任何其它位置完成。</p>
</div>
<div class="paragraph">
<p>一旦注册了，这个服务就可用了。如果您的应用运行在集群上，
则集群中节点都可访问。</p>
</div>
<div class="paragraph">
<p>如果想注销这个服务, 使用 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceBinder.html#unregister-io.vertx.core.eventbus.MessageConsumer-">unregister</a></code>
方法注销：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">ServiceBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceBinder</span>(vertx);

<span class="hljs-comment">// 创建服务实现实例</span>
<span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span>();
<span class="hljs-comment">// 注册处理器</span>
MessageConsumer&lt;JsonObject&gt; consumer = binder
  .setAddress(<span class="hljs-string">&quot;database-service-address&quot;</span>)
  .register(SomeDatabaseService.class, service);

<span class="hljs-comment">// ....</span>

<span class="hljs-comment">// 销毁服务。</span>
binder.unregister(consumer);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proxy_creation"><a class="anchor" href="#_proxy_creation"></a>代理创建</h2>
<div class="sectionbody">
<div class="paragraph">
<p>现在服务已经公开, 现在可以消费使用它。 为此，您必须创建一个代理。
创建代理使用 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceProxyBuilder.html">ServiceProxyBuilder</a></code> 类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-type">ServiceProxyBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceProxyBuilder</span>(vertx)
  .setAddress(<span class="hljs-string">&quot;database-service-address&quot;</span>);

<span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> builder.build(SomeDatabaseService.class);
<span class="hljs-comment">// 设置其他属性：</span>
<span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service2</span> <span class="hljs-operator">=</span> builder.setOptions(options)
  .build(SomeDatabaseService.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>第二种构造通过 <code><a href="../../apidocs/io/vertx/core/eventbus/DeliveryOptions.html">DeliveryOptions</a></code> 构造实例，
您可以在其中配置属性（例如：超时）</p>
</div>
<div class="paragraph">
<p>或者,您也可以使用代理类。
这个代理名称为 <em>服务接口</em> 类目后追加 <code>VertxEBProxy</code>。
例如, 如果您的 <em>服务接口</em> 名为 <code>SomeDatabaseService</code>，那么代理类名为 <code>SomeDatabaseServiceVertxEBProxy</code>。</p>
</div>
<div class="paragraph">
<p>一般来说, <em>服务接口</em> 包含 <code>createProxy</code> 静态方法用于创建代理。 但这不是必须的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SomeDatabaseService</span> {

<span class="hljs-comment">// 静态方法创建代理。</span>
<span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Vertx vertx, String address)</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeDatabaseServiceVertxEBProxy</span>(vertx, address);
}

<span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling"><a class="anchor" href="#_error_handling"></a>错误处理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务方法可能会通过向方法的处理器（Handler）传递一个失败状态的 Future （包含一个 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceException.html">ServiceException</a></code> 实例。
一个 <code>ServiceException</code> 包含 <code>int</code> 类型的错误码、消息,以及一个可选的
 <code>JsonObject</code> 对象用于传递额外信息。为了方便，
<code><a href="../../apidocs/io/vertx/serviceproxy/ServiceException.html#fail-int-java.lang.String-">ServiceException.fail</a></code> 工厂方法来创建一个已经是失败状态并且包装着
<code>ServiceException</code> 实例的失败 <code>Future</code> 。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SomeDatabaseService</span> {

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">final</span> <span class="hljs-variable">BAD_SHOE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">final</span> <span class="hljs-variable">CONNECTION_FAILED</span> <span class="hljs-operator">=</span> <span class="hljs-number">43</span>;

 <span class="hljs-comment">// 创建连接</span>
 <span class="hljs-keyword">public</span> Future&lt;MyDatabaseConnection&gt; <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String shoeSize)</span> {
   <span class="hljs-keyword">if</span> (!shoeSize.equals(<span class="hljs-string">&quot;9&quot;</span>)) {
     <span class="hljs-keyword">return</span> Future.failedFuture(ServiceException.fail(BAD_SHOE_SIZE, <span class="hljs-string">&quot;The shoe size must be 9!&quot;</span>,
       <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObject</span>().put(<span class="hljs-string">&quot;shoeSize&quot;</span>, shoeSize)));
    } <span class="hljs-keyword">else</span> {
       <span class="hljs-keyword">return</span> doDbConnection().recover(err -&gt; Future.failedFuture(ServiceException.fail(CONNECTION_FAILED, result.cause().getMessage())));
    }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>服务调用端（客户端）可以检查它接收到的失败状态的 <code>Future</code> 包含的 <code>Throwable</code> 对象是否为 <code>ServiceException</code> 实例。
如果是的话，继续检查内部的特定的错误状态码。
调用端可以通过这些信息来将业务逻辑错误与系统错误（如服务没有被注册到事件总线上）区分开，
以便确定到底发生了哪一种业务逻辑错误。下面是一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> Future&lt;JsonObject&gt; <span class="hljs-title function_">foo</span><span class="hljs-params">(String shoeSize)</span> {
 <span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
 server.createConnection(<span class="hljs-string">&quot;8&quot;</span>)
   .compose(connection -&gt; {
     <span class="hljs-comment">// 正常调用。</span>
     <span class="hljs-keyword">return</span> doSuccessStuff(connection);
   })
   .recover(err -&gt; {
     <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> ServiceException) {
       <span class="hljs-type">ServiceException</span> <span class="hljs-variable">exc</span> <span class="hljs-operator">=</span> (ServiceException) err;
       <span class="hljs-keyword">if</span> (exc.failureCode() == SomeDatabaseServiceImpl.BAD_SHOE_SIZE) {
         <span class="hljs-keyword">return</span> Future.failedFuture(
           <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidInputError</span>(<span class="hljs-string">&quot;You provided a bad shoe size: &quot;</span> +
             exc.getDebugInfo().getString(<span class="hljs-string">&quot;shoeSize&quot;</span>)));
       } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exc.failureCode() == SomeDatabaseServiceImpl.CONNECTION) {
         <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionError</span>(<span class="hljs-string">&quot;Failed to connect to the DB&quot;</span>));
       }
     } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// 必须是一个系统错误，如：服务代理没有对应的已注册的服务</span>
       <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemError</span>(<span class="hljs-string">&quot;An unexpected error occurred: + &quot;</span> result.cause().getMessage()));
     }
   });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要的话, 服务实现的时候也可以返回 <code>ServiceException</code> 子类,
只要向事件总线注册了对应的默认 <code>MessageCodec</code> 就可以了。 例如, 比如给定下面的 <code>ServiceException</code> 子类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoeSizeException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceException</span> {
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">final</span> <span class="hljs-variable">BAD_SHOE_SIZE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String shoeSize;

 <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShoeSizeException</span><span class="hljs-params">(String shoeSize)</span> {
   <span class="hljs-built_in">super</span>(BAD_SHOE_SIZE_ERROR, <span class="hljs-string">&quot;In invalid shoe size was received: &quot;</span> + shoeSize);
   <span class="hljs-built_in">this</span>.shoeSize = shoeSize;
 }

 <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getShoeSize</span><span class="hljs-params">()</span> {
   <span class="hljs-keyword">return</span> extra;
 }

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Future&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(<span class="hljs-type">int</span> failureCode, String message, String shoeSize)</span> {
   <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServiceException</span>(failureCode, message, shoeSize));
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>只要向事件总线注册了对应的 <code>MessageCodec</code> ，
服务就可以直接向调用者返回自定义的异常类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeDatabaseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SomeDatabaseService</span> {
 <span class="hljs-keyword">public</span> <span class="hljs-title function_">SomeDataBaseServiceImpl</span><span class="hljs-params">(Vertx vertx)</span> {
   <span class="hljs-comment">// 注册服务，如果你是用事件总线使用本地模式，这就是全部</span>
   <span class="hljs-comment">// 因为代理端和服务端共享一个vert.x实例</span>
 <span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
   vertx.eventBus().registerDefaultCodec(ShoeSizeException.class,
     <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoeSizeExceptionMessageCodec</span>());
 }

 <span class="hljs-comment">// 创建连接</span>
 Future&lt;MyDatabaseConnection&gt; <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String shoeSize)</span> {
   <span class="hljs-keyword">if</span> (!shoeSize.equals(<span class="hljs-string">&quot;9&quot;</span>)) {
     <span class="hljs-keyword">return</span> ShoeSizeException.fail(shoeSize);
   } <span class="hljs-keyword">else</span> {
     <span class="hljs-comment">// 此处创建连接</span>
     <span class="hljs-keyword">return</span> Future.succeededFuture(myDbConnection);
   }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后调用端可以检查自定义的异常类型了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> Future&lt;JsonObject&gt; <span class="hljs-title function_">foo</span><span class="hljs-params">(String shoeSize)</span> {
 <span class="hljs-comment">// 如果运行在集群模式当中，代码在不同的节点运行，</span>
 <span class="hljs-comment">// ShoeSizeExceptionMessageCodec 必须注册到</span>
 <span class="hljs-comment">// 该节点的Vertx当中</span>
 <span class="hljs-type">SomeDatabaseService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
 service.createConnection(<span class="hljs-string">&quot;8&quot;</span>)
   .compose(connection -&gt; {
     <span class="hljs-comment">// 成功调用。</span>
     <span class="hljs-keyword">return</span> doSuccessStuff(connection);
   })
   .recover(err -&gt; {
     <span class="hljs-keyword">if</span> (result.cause() <span class="hljs-keyword">instanceof</span> ShoeSizeException) {
       <span class="hljs-type">ShoeSizeException</span> <span class="hljs-variable">exc</span> <span class="hljs-operator">=</span> (ShoeSizeException) result.cause();
       <span class="hljs-keyword">return</span> Future.failedFuture(
         <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidInputError</span>(<span class="hljs-string">&quot;You provided a bad shoe size: &quot;</span> + exc.getShoeSize()));
     } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// 必须是个系统错误 (例如：没有为服务代理进行注册)</span>
       <span class="hljs-keyword">return</span> Future.failedFuture(
         <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemError</span>(<span class="hljs-string">&quot;An unexpected error occurred: + &quot;</span> result.cause().getMessage())
       );
     }
   });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意在 <code>Vertx</code> 集群模式下，您需要向集群中每个节点的事件总线注册对应的自定义异常类型
的 <code>MessageCodec</code> 实例</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restrictions_for_service_interface"><a class="anchor" href="#_restrictions_for_service_interface"></a>接口类型限制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在服务中参数和返回值在类型上有一定的限制,因此可以方便在事件总线中进行转化。
他们是：</p>
</div>
<div class="sect2">
<h3 id="_data_types"><a class="anchor" href="#_data_types"></a>数据类型</h3>
<div class="paragraph">
<p><code>JSON</code> 表示 <code>JsonObject 或 JsonArray</code>
<code>PRIMITIVE</code> 表示任何原始类型或被自动拆装箱的原始类型</p>
</div>
<div class="paragraph">
<p>参数可以是以下任意一种：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JSON</code></p>
</li>
<li>
<p><code>PRIMITIVE</code></p>
</li>
<li>
<p><code>List&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>List&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Set&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>Set&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Map&lt;String, JSON&gt;</code></p>
</li>
<li>
<p><code>Map&lt;String, PRIMITIVE&gt;</code></p>
</li>
<li>
<p>任何 <em>枚举</em> 类型</p>
</li>
<li>
<p>任何被打上 <code>@DataObject</code> 注解的实体类</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>异步结果可建模为</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Future&lt;R&gt;</code></p>
</li>
<li>
<p>用于回调样式的 <code>Handler&lt;AsyncResult&lt;R&gt;&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>R</code> 的类型可以是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JSON</code></p>
</li>
<li>
<p><code>PRIMITIVE</code></p>
</li>
<li>
<p><code>List&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>List&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Set&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>Set&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p>任何 <em>枚举</em> 类型</p>
</li>
<li>
<p>任何打上 <code>@DataObject</code> 注解的类（需符合上文的代码篇章要求）</p>
</li>
<li>
<p>另一个代理类</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overloaded_methods"><a class="anchor" href="#_overloaded_methods"></a>重载方法</h3>
<div class="paragraph">
<p>服务接口不支持任何的重载(即方法名称相同，但参数列表不同)服务方法。。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_convention_for_invoking_services_over_the_event_bus_without_proxies"><a class="anchor" href="#_convention_for_invoking_services_over_the_event_bus_without_proxies"></a>通过事件总线调用服务的规则 (不使用服务代理)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务代理假定事件总线中的消息遵循一定的格式，因此能被用于服务的调用</p>
</div>
<div class="paragraph">
<p>当然，如果不愿意的话，您也可以 <strong>不用</strong> 服务代理类来访问远程服务。
被广泛接受的与服务交互的方式就是直接在事件总线发送消息。</p>
</div>
<div class="paragraph">
<p>为了使服务访问的方式一致，
所有的服务都必须遵循以下的消息格式。</p>
</div>
<div class="paragraph">
<p>格式非常简单：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>需要有一个名为 <code>action</code> 的 消息头(header)，作为要执行操作的名称。</p>
</li>
<li>
<p>消息体（message body）应该是一个 <code>JsonObject</code> 对象，里面需要包含操作需要的所有参数。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>举个例子，假如我们要去执行一个名为 <code>save</code> 的操作，此操作接受一个字符串类型的 collection 和 JsonObject 类型 document：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Headers:
   "action": "save"
Body:
   {
       "collection", "mycollection",
       "document", {
           "name": "tim"
       }
   }</pre>
</div>
</div>
<div class="paragraph">
<p>无论有没有用到服务代理来创建服务，都应该用上面这种方式编写服务，
因为这样允许服务交互时保持一致性。</p>
</div>
<div class="paragraph">
<p>在上面的例子中，"action" 对应的值应该与服务接口的某个方法名称相对应，
而消息体中每个 <code>[key, value]</code> 都要与服务方法中的某个 <code>[arg_name, arg_value]</code> 相对应</p>
</div>
<div class="paragraph">
<p>对于返回值，服务需使用 <code>message.reply(&#8230;&#8203;)</code> 方法去向调用端发送回一个返回值 - 这个值可以是事件总线支持的任何类型。
如果需要表示调用失败，可以调用 <code>message.fail(&#8230;&#8203;)</code> 方法。</p>
</div>
<div class="paragraph">
<p>如果您使用 Vert.x 服务代理组件的话，生成的代码会自动帮您处理这些问题。</p>
</div>
</div>
</div></div></div></div></div></div><footer class="jsx-aeedcf66895f49d7"><div class="jsx-aeedcf66895f49d7 container"><div class="jsx-aeedcf66895f49d7 footer-nav-section"><div class="jsx-aeedcf66895f49d7 footer-nav-list footer-logo"><a class="jsx-aeedcf66895f49d7" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-aeedcf66895f49d7"/></a></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse Vert.x</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7 navbar-menu-item" href="/docs/">文档</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/download/">下载</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/blog/">博客</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/community/">社区</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/translation/">翻译团队</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/eclipse-vertx/vert.x" class="jsx-aeedcf66895f49d7">GitHub</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/vertx-china/vertx-web-site" class="jsx-aeedcf66895f49d7">翻译GitHub</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">资源</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/faq/">答疑</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/channels/">联系渠道</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://how-to.vertx.io/" class="jsx-aeedcf66895f49d7">操作指南</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://start.vertx.io/" class="jsx-aeedcf66895f49d7">应用生成器</a></li><li class="jsx-aeedcf66895f49d7"><a href="/.well-known/security.txt" class="jsx-aeedcf66895f49d7">security.txt</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/" class="jsx-aeedcf66895f49d7">Eclipse 基金会</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/privacy.php" class="jsx-aeedcf66895f49d7">隐私政策</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/termsofuse.php" class="jsx-aeedcf66895f49d7">使用条款</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/copyright.php" class="jsx-aeedcf66895f49d7">版权代理</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/" class="jsx-aeedcf66895f49d7">法律资源</a></li></ul></div></div><div class="jsx-aeedcf66895f49d7 footer-copyright"><div class="jsx-aeedcf66895f49d7 footer-copyright-remarks">© <!-- -->2022<!-- --> Eclipse Vert.x™<br class="jsx-aeedcf66895f49d7"/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Apache License 2.0</a>协议下获得了双重许可。<br class="jsx-aeedcf66895f49d7 footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Michel Krämer</a> 设计。</div><div class="jsx-aeedcf66895f49d7 footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 281.3 91.1&#x27; style=&#x27;enable-background:new 0 0 281.3 91.1&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23f79422%7d.st1%7bfill:%233d3c3b%7d%3c/style%3e%3cg id=&#x27;Layer_1_1_&#x27;%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M265.7 84 257 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zm-32.4-8.3c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3 0 4.7 2.9 9.1 9.1 9.1s9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-21.2 18V73h-3.3v17.7h3.3zm-23.6 0h3.3V76h5.6v-3h-14.6v3h5.6l.1 14.7zm-18.9-6.5H163l3.3-7.6 3.3 7.6zm2.8 6.5h3.6L168.2 73h-3.6l-8 17.7h3.6l1.5-3.3h9.3l1.4 3.3zm-38-14.6h3.6c3.9 0 5.5 2.8 5.5 5.5.1 2.8-1.5 5.8-5.5 5.8h-3.6V76.1zm3.7-3.1h-6.9v17.7h6.9c6.2 0 8.9-4.5 8.9-9s-2.8-8.7-8.9-8.7zm-22.4 11L107 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zM88.2 73v10.2c0 3-1.6 4.9-4.3 4.9s-4.6-1.7-4.6-4.9V73H76v10.1c0 5.3 3.6 7.9 7.9 7.9 4.4 0 7.7-2.7 7.7-7.9V73h-3.4zm-33 2.7c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3s2.9 9.1 9.1 9.1 9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-29.7 18v-6.5h8.9v-3.1h-8.9v-4.8h9.4V73H22.2v17.6h3.3z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M269.4 54.4h-22.2v-8.9h21.4v-6.9h-21.4v-9.1h22.2v-7.2h-29.6v39.5h29.6v-7.4zm-40-25.6c-3-6.1-9.4-7.8-15.5-7.8-7.3 0-15.3 3.4-15.3 11.5 0 8.9 7.4 11 15.5 12 5.2.6 9.1 2.1 9.1 5.8 0 4.3-4.4 5.9-9.1 5.9s-9.4-1.9-11.1-6.3l-6.2 3.2c2.9 7.2 9.1 9.7 17.2 9.7 8.8 0 16.6-3.8 16.6-12.6 0-9.4-7.7-11.6-15.9-12.6-4.7-.6-8.8-1.5-8.8-5 0-2.9 2.6-5.2 8.2-5.2 4.3 0 8 2.2 9.4 4.4l5.9-3zM176 22.2c-6.2-.1-12.4 0-18.6 0v39.5h7.4V50.1H176c19.4 0 19.4-27.9 0-27.9zm-11.1 7.1H176c9.5 0 9.5 14 0 14h-11.2l.1-14zm-18 32.5V22.2h-7.4v39.5l7.4.1zm-44-39.6v39.5h27.7v-6.9h-20.3V22.2h-7.4zM90.7 51.7c-2.7 2.5-6.2 4-9.9 4-9.8 0-13.5-6.8-13.6-13.4s4.1-13.7 13.6-13.7c3.5-.1 7 1.3 9.5 3.7l5-4.8c-3.8-3.9-9.1-6-14.5-6-14.3 0-21 10.5-20.9 20.8s6.3 20.3 20.9 20.3c5.6.1 11-2 15-5.9l-5.1-5zm-39 2.7H29.5v-8.9h21.4v-6.9H29.5v-9.1h22.2v-7.2H22.2v39.5h29.6l-.1-7.4z&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M9.8 18.2C18.8 4.1 36.9-.8 52.1 6l-1-.7C35.7-4.6 15.2-.1 5.3 15.3s-5.4 35.9 10 45.8l1.1.6C3.8 50.8.8 32.3 9.8 18.2z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M272.2 26.1c0-2.5 2.1-4.6 4.6-4.6 2.5 0 4.6 2.1 4.6 4.6 0 2.5-2.1 4.6-4.6 4.6-2.6 0-4.6-2.1-4.6-4.6zm8.6 0c0-2.2-1.8-4.1-4-4.1s-4.1 1.8-4.1 4.1c0 2.2 1.7 4 3.9 4.1h.1c2.3 0 4.1-1.8 4.1-4.1zm-6-2.5h2.3c1.1 0 1.9.5 1.9 1.6 0 .7-.4 1.3-1.1 1.5l1.2 1.7h-1.4l-1-1.5h-.7v1.5h-1.1l-.1-4.8zm2.2 2.3c.5 0 .8-.3.8-.7s-.3-.7-.8-.7h-1v1.3l1 .1z&#x27;/%3e%3c/g%3e%3c/svg%3e" alt="Eclipse foundation Logo" class="jsx-aeedcf66895f49d7"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.1.7/vertx-service-proxy/java","title":"Vert.x 服务代理","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_using_vert_x_service_proxies\"\u003e使用Vert.x服务代理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_introduction_to_service_proxies\"\u003e服务代理简介\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_async_interface\"\u003e异步接口\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_async_interface_with_callbacks\"\u003e带回调的异步接口\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_security\"\u003e安全\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_code_generation\"\u003e代码生成\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_exposing_your_service\"\u003e公开服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_proxy_creation\"\u003e代理创建\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_error_handling\"\u003e错误处理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_restrictions_for_service_interface\"\u003e接口类型限制\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_data_types\"\u003e数据类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_overloaded_methods\"\u003e重载方法\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e通过事件总线调用服务的规则 (不使用服务代理)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x 服务代理\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您编写 Vert.x 程序的时候，您也许想将某处独立服务功能提供给其他程序使用。\n此时便使用服务代理。它可以让您在事件总线上发布您的 \u003cem\u003e服务\u003c/em\u003e ，\n任何 Vert.x 程序只要知道其 \u003cem\u003e地址\u003c/em\u003e\n即可使用该服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个 \u003cem\u003e服务\u003c/em\u003e 通过 Java 接口描述并遵循 \u003cem\u003e异步\u003c/em\u003e 模式。\n从本质上说，消息通过事件总线发送调用服务并获取响应。\n但为了方便使用，它会生成一个 \u003cem\u003e代理\u003c/em\u003e ，您可直接使用该代理（用代理提供的服务接口 API）。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_vert_x_service_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_using_vert_x_service_proxies\"\u003e\u003c/a\u003e使用Vert.x服务代理\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003cstrong\u003e使用\u003c/strong\u003e Vert.x Service Proxies 之前，\n您必须在您得项目当中添加 \u003cem\u003e依赖\u003c/em\u003e ：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-proxy\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.7\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-proxy:4.1.7\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了 \u003cstrong\u003e实现\u003c/strong\u003e 服务代理, 您还需要添加：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-codegen\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.7\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle \u0026lt; 5 （在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompileOnly \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-codegen:4.1.7\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle \u0026gt;= 5（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003eannotationProcessor \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-codegen:4.1.7:processor\u0026#x27;\u003c/span\u003e\nannotationProcessor \u003cspan class=\"hljs-string\"\u003e\u0026#x27;io.vertx:vertx-service-proxy:4.1.7\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：因为服务代理类是由代码自动生成的，因此每当您修改了 \u003cem\u003e服务接口\u003c/em\u003e 您必须重新编译源码，\n以重新生成代理类。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您要生成不同语言的代理类，您需要添加相应的依赖。例如，\n生成 Groovy 语言的代理接口需要添加 \u003ccode\u003evertx-lang-groovy\u003c/code\u003e 依赖\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_introduction_to_service_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_introduction_to_service_proxies\"\u003e\u003c/a\u003e服务代理简介\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e让我看看服务代理它怎么用。\n如果您在事件总线上公开 \u003cem\u003e数据库服务\u003c/em\u003e 您可以执行下面的操作\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eJsonObject\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003emessage\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJsonObject\u003c/span\u003e();\n\nmessage\n  .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;collection\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;mycollection\u0026quot;\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJsonObject\u003c/span\u003e().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;tim\u0026quot;\u003c/span\u003e));\n\n\u003cspan class=\"hljs-type\"\u003eDeliveryOptions\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoptions\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDeliveryOptions\u003c/span\u003e().addHeader(\u003cspan class=\"hljs-string\"\u003e\u0026quot;action\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;save\u0026quot;\u003c/span\u003e);\n\nvertx.eventBus()\n  .request(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e, message, options)\n  .onSuccess(msg -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 完成\u003c/span\u003e\n  }).onFailure(err -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// 失败\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当创建服务的时候，会有一定数量的样本代码在事件总线接收信息，\n路由会找到合适的方法并在总线上返回结果\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用 Vert.x 服务代理时, 您可以使用代码生成避免编写重复的代码，从而集中精力编写服务\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在您编写的Java接口上面打上 \u003ccode\u003e@ProxyGen\u003c/code\u003e 注解, 例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n\n \u003cspan class=\"hljs-comment\"\u003e// 几个工厂方法用于创建实例和代理\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e(vertx);\n }\n\n \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx,\n   String address)\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceVertxEBProxy\u003c/span\u003e(vertx, address);\n }\n\n\u003cspan class=\"hljs-comment\"\u003e// 此处是实际的服务操作……\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document,\n  Handler\u0026lt;AsyncResult\u0026lt;Void\u0026gt;\u0026gt; resultHandler)\u003c/span\u003e;\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您还需要编写 \u003ccode\u003epackage-info.java\u003c/code\u003e 文件，位置处于接口定义包中。\n这个包还需要 \u003ccode\u003e@ModuleGen\u003c/code\u003e 注解，\n以便 Vert.x 代码生成器生成事件总线代理代码。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"title\"\u003epackage-info.java\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@io\u003c/span\u003e.vertx.codegen.annotations.ModuleGen(groupPackage = \u003cspan class=\"hljs-string\"\u003e\u0026quot;io.vertx.example\u0026quot;\u003c/span\u003e, name = \u003cspan class=\"hljs-string\"\u003e\u0026quot;services\u0026quot;\u003c/span\u003e, useFutures = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e io.vertx.example;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e有了这个接口，Vert.x 会生成所有需要的用于在事件总线上访问您服务的模板代码，\n同时也会生成对应的 \u003cstrong\u003e调用端代理类（client side proxy）\u003c/strong\u003e ，\n这样您的服务调用端就可以使用一个相当符合习惯的 API（译者注：即相同的服务接口）进行服务调用，而不是去手动地向事件总线发送消息。\n不管您的服务实际依赖于哪个事件总线上（可能是在不同的机器上），调用端代理类都能正常工作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e也就是说，您可以通过以下方式进行服务调用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e SomeDatabaseService\n  .createProxy(vertx, \u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// 保存数据到数据库，这里使用了代理\u003c/span\u003e\nservice.save(\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;mycollection\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJsonObject\u003c/span\u003e().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;tim\u0026quot;\u003c/span\u003e),\n  res2 -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res2.succeeded()) {\n      \u003cspan class=\"hljs-comment\"\u003e// 调用完毕\u003c/span\u003e\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以将多语言 API 生成功能（@VertxGen 注解）与 @ProxyGen 注解相结合，\n用于生成其它 Vert.x 支持的 JVM 语言对应的服务代理 —— 这意味着您可以只用 Java 编写您的服务一次，\n就可以在其他语言中以一种习惯的 API 风格进行服务调用，而完全不必管服务是在本地还是在哪个事件总线上。\n想要利用多语言代码生成功能，不要忘记添加对应支持语言的依赖。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 生成服务代理\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@VertxGen\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 生成客户端\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_async_interface\"\u003e\u003ca class=\"anchor\" href=\"#_async_interface\"\u003e\u003c/a\u003e异步接口\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e想要正确地生成服务代理类，\u003cem\u003e服务接口\u003c/em\u003e 的设计必须遵循一些规则。 首先是需要遵循异步模式。\n如果需要返回结果，对应的方法需要包含一个 \u003ccode\u003eFuture\u0026lt;ResultType\u0026gt;\u003c/code\u003e 类型的返回值。\n其中 \u003ccode\u003eResultType\u003c/code\u003e 可以是另一种代理类型（所以一个代理类可以作为另一个代理类的工厂）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n\n\u003cspan class=\"hljs-comment\"\u003e// 一些用于创建服务实例和服务代理实例的工厂方法\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e(vertx);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx, String address)\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceVertxEBProxy\u003c/span\u003e(vertx, address);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 异步方法，仅通知调用是否完成，不返回结果\u003c/span\u003e\nFuture\u0026lt;Void\u0026gt; \u003cspan class=\"hljs-title function_\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document)\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 异步方法，包含JsonObject类型的返回结果\u003c/span\u003e\nFuture\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject query)\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\nFuture\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title function_\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e;\n\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e以及：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@VertxGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyDatabaseConnection\u003c/span\u003e {\n\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einsert\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(JsonObject someData)\u003c/span\u003e;\n\nFuture\u0026lt;Void\u0026gt; \u003cspan class=\"hljs-title function_\"\u003ecommit\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ProxyClose\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eclose\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e;\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以通过声明一个特殊方法，并给其加上 \u003ccode\u003e@ProxyClose\u003c/code\u003e 注解来注销代理。\n当此方法被调用时，代理实例被清除。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多 \u003ccode\u003e服务接口\u003c/code\u003e 的限制会在下面详解。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_async_interface_with_callbacks\"\u003e\u003ca class=\"anchor\" href=\"#_async_interface_with_callbacks\"\u003e\u003c/a\u003e带回调的异步接口\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在 Vert.x 4.1 之前，服务异步接口由回调定义。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您仍然可以使用回调创建服务异步接口，使用以下模块声明：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"title\"\u003epackage-info.java\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@io\u003c/span\u003e.vertx.codegen.annotations.ModuleGen(groupPackage = \u003cspan class=\"hljs-string\"\u003e\u0026quot;io.vertx.example\u0026quot;\u003c/span\u003e, name = \u003cspan class=\"hljs-string\"\u003e\u0026quot;services\u0026quot;\u003c/span\u003e, useFutures = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e io.vertx.example;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n为向后兼容，\u003ccode\u003euseFutures\u003c/code\u003e 的默认值为 \u003ccode\u003efalse\u003c/code\u003e，因此您也可以省略该声明\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e带有回调的服务异步接口如下所示：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n\n \u003cspan class=\"hljs-comment\"\u003e// 一个通知完成而没有结果的方法（void）\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document,\n  Handler\u0026lt;AsyncResult\u0026lt;Void\u0026gt;\u0026gt; result)\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 一个提供了结果的方法（一个 json 对象）\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject query,\n  Handler\u0026lt;AsyncResult\u0026lt;JsonObject\u0026gt;\u0026gt; result)\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize,\n  Handler\u0026lt;AsyncResult\u0026lt;MyDatabaseConnection\u0026gt;\u0026gt; resultHandler)\u003c/span\u003e;\n\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e返回类型必须是以下之一：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003evoid\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e@Fluent\u003c/code\u003e 并返回对该服务的引用（\u003ccode\u003ethis\u003c/code\u003e）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Fluent\u003c/span\u003e\nSomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003edoSomething\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这是因为方法不允许阻塞，如果该服务是远程调用（remote）（译者注：远程意思是服务代理通过事件总线调用其他verticle中的服务），\n那么无法在不阻塞的前提下立即返回结果。（译者注：因为远程调用需要消耗一定时间）\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_security\"\u003e\u003ca class=\"anchor\" href=\"#_security\"\u003e\u003c/a\u003e安全\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务代理可以使用简单的拦截器保障基本安全。\n提供一个身份验证器，可以选择添加 \u003ccode\u003eAuthorization\u003c/code\u003e 在这种情况下，\u003ccode\u003eAuthorizationProvider\u003c/code\u003e 是必须提提供的。\n注意，身份认证的令牌从 \u003ccode\u003eauth-token\u003c/code\u003e 信息头获取。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceBinder\u003c/span\u003e(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// 保护传输中的信息\u003c/span\u003e\n  .addInterceptor(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceAuthInterceptor\u003c/span\u003e()\n      \u003cspan class=\"hljs-comment\"\u003e// 使用JWT认证进行校验令牌\u003c/span\u003e\n      .setAuthenticationProvider(JWTAuth.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJWTAuthOptions\u003c/span\u003e()))\n      \u003cspan class=\"hljs-comment\"\u003e// 我们可以选择部分权限进行保护：\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 比如admin组\u003c/span\u003e\n      .addAuthorization(RoleBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\u0026quot;admin\u0026quot;\u003c/span\u003e))\n      \u003cspan class=\"hljs-comment\"\u003e// 比如打印权限\u003c/span\u003e\n      .addAuthorization(PermissionBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\u0026quot;print\u0026quot;\u003c/span\u003e))\n\n      \u003cspan class=\"hljs-comment\"\u003e// 或者从令牌种加载权限\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 如果有需要您也可以从数据库或文件加载中权限\u003c/span\u003e\n      .setAuthorizationProvider(\n        JWTAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\u0026quot;permissions\u0026quot;\u003c/span\u003e)))\n\n  .register(SomeDatabaseService.class, service);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_code_generation\"\u003e\u003ca class=\"anchor\" href=\"#_code_generation\"\u003e\u003c/a\u003e代码生成\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e被 @ProxyGen 注解的服务接口会触发生成对应的服务辅助类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e服务代理类（service proxy）：一个编译时产生的代理类，用 \u003ccode\u003eEventBus\u003c/code\u003e 通过消息与服务交互。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务处理器类（service handler）： 一个编译时产生的 \u003ccode\u003eEventBus\u003c/code\u003e 处理器类，用于响应由服务代理发送的事件。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e产生的服务代理和处理器的命名是在类名的后面加相关的字段，例如，如果一个服务接口名为 \u003ccode\u003eMyService\u003c/code\u003e，\n则对应的处理器类命名为 \u003ccode\u003eMyServiceProxyHandler\u003c/code\u003e，对应的服务代理类命名为 MyServiceVertxEBProxy。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e此外 Vert.x Core 提供了一个生成器用于数据转化器，以简化服务代理中数据对象的使用。\n数据转化器要求数据对象提供一个以 \u003ccode\u003eJsonObject\u003c/code\u003e\n为基础的构造器和 \u003ccode\u003etoJson()\u003c/code\u003e 方法\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003cem\u003ecodegen\u003c/em\u003e 注释处理器在编译时生成这些类\n它是Java编译器的功能 所以无需 \u003cem\u003e额外步骤\u003c/em\u003e, 只需正确配置您的构建参数即可：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e只需要在构建配置中加上 \u003ccode\u003eio.vertx:vertx-codegen:processor\u003c/code\u003e 和 \u003ccode\u003eio.vertx:vertx-service-proxy\u003c/code\u003e\n依赖。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这是一个针对 Maven 的配置示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-codegen\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.7\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003eprocessor\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-proxy\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.7\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e此功能也可以在 Gradle 中使用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode\u003ecompile \"io.vertx:vertx-codegen:4.1.7:processor\"\ncompile \"io.vertx:vertx-service-proxy:4.1.7\"\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIDE 通常为注释处理器提供支持。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e代码生成 \u003ccode\u003e处理器\u003c/code\u003e 分类器会把服务代理注释处理器的配置自动添加到 jar 包目录下的\n\u003ccode\u003eMETA-INF/services\u003c/code\u003e 当中。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想和其与常规 jar一起使用，但是需要显式声明注释处理器,\n例如在 Maven 中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003emaven-compiler-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eannotationProcessors\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eannotationProcessor\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx.codegen.CodeGenProcessor\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eannotationProcessor\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eannotationProcessors\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_exposing_your_service\"\u003e\u003ca class=\"anchor\" href=\"#_exposing_your_service\"\u003e\u003c/a\u003e公开服务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您写好服务接口以后，执行构建操作以生成代码。\n然后您需要将您的服务 \u003ccode\u003e注册\u003c/code\u003e 到事件总线上：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceBinder\u003c/span\u003e(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e)\n  .register(SomeDatabaseService.class, service);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个过程既可以在 Verticle 中完成，也可以在您的代码的任何其它位置完成。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦注册了，这个服务就可用了。如果您的应用运行在集群上，\n则集群中节点都可访问。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果想注销这个服务, 使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceBinder.html#unregister-io.vertx.core.eventbus.MessageConsumer-\"\u003eunregister\u003c/a\u003e\u003c/code\u003e\n方法注销：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eServiceBinder\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003ebinder\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceBinder\u003c/span\u003e(vertx);\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建服务实现实例\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\nMessageConsumer\u0026lt;JsonObject\u0026gt; consumer = binder\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e)\n  .register(SomeDatabaseService.class, service);\n\n\u003cspan class=\"hljs-comment\"\u003e// ....\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 销毁服务。\u003c/span\u003e\nbinder.unregister(consumer);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_proxy_creation\"\u003e\u003ca class=\"anchor\" href=\"#_proxy_creation\"\u003e\u003c/a\u003e代理创建\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e现在服务已经公开, 现在可以消费使用它。 为此，您必须创建一个代理。\n创建代理使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceProxyBuilder.html\"\u003eServiceProxyBuilder\u003c/a\u003e\u003c/code\u003e 类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-type\"\u003eServiceProxyBuilder\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003ebuilder\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceProxyBuilder\u003c/span\u003e(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database-service-address\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e builder.build(SomeDatabaseService.class);\n\u003cspan class=\"hljs-comment\"\u003e// 设置其他属性：\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice2\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e builder.setOptions(options)\n  .build(SomeDatabaseService.class);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e第二种构造通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/eventbus/DeliveryOptions.html\"\u003eDeliveryOptions\u003c/a\u003e\u003c/code\u003e 构造实例，\n您可以在其中配置属性（例如：超时）\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者,您也可以使用代理类。\n这个代理名称为 \u003cem\u003e服务接口\u003c/em\u003e 类目后追加 \u003ccode\u003eVertxEBProxy\u003c/code\u003e。\n例如, 如果您的 \u003cem\u003e服务接口\u003c/em\u003e 名为 \u003ccode\u003eSomeDatabaseService\u003c/code\u003e，那么代理类名为 \u003ccode\u003eSomeDatabaseServiceVertxEBProxy\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一般来说, \u003cem\u003e服务接口\u003c/em\u003e 包含 \u003ccode\u003ecreateProxy\u003c/code\u003e 静态方法用于创建代理。 但这不是必须的：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n\n\u003cspan class=\"hljs-comment\"\u003e// 静态方法创建代理。\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title function_\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx, String address)\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceVertxEBProxy\u003c/span\u003e(vertx, address);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_error_handling\"\u003e\u003ca class=\"anchor\" href=\"#_error_handling\"\u003e\u003c/a\u003e错误处理\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务方法可能会通过向方法的处理器（Handler）传递一个失败状态的 Future （包含一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceException.html\"\u003eServiceException\u003c/a\u003e\u003c/code\u003e 实例。\n一个 \u003ccode\u003eServiceException\u003c/code\u003e 包含 \u003ccode\u003eint\u003c/code\u003e 类型的错误码、消息,以及一个可选的\n \u003ccode\u003eJsonObject\u003c/code\u003e 对象用于传递额外信息。为了方便，\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceException.html#fail-int-java.lang.String-\"\u003eServiceException.fail\u003c/a\u003e\u003c/code\u003e 工厂方法来创建一个已经是失败状态并且包装着\n\u003ccode\u003eServiceException\u003c/code\u003e 实例的失败 \u003ccode\u003eFuture\u003c/code\u003e 。例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003efinal\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eBAD_SHOE_SIZE\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e;\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003efinal\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eCONNECTION_FAILED\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e43\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title function_\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!shoeSize.equals(\u003cspan class=\"hljs-string\"\u003e\u0026quot;9\u0026quot;\u003c/span\u003e)) {\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(ServiceException.fail(BAD_SHOE_SIZE, \u003cspan class=\"hljs-string\"\u003e\u0026quot;The shoe size must be 9!\u0026quot;\u003c/span\u003e,\n       \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJsonObject\u003c/span\u003e().put(\u003cspan class=\"hljs-string\"\u003e\u0026quot;shoeSize\u0026quot;\u003c/span\u003e, shoeSize)));\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doDbConnection().recover(err -\u0026gt; Future.failedFuture(ServiceException.fail(CONNECTION_FAILED, result.cause().getMessage())));\n    }\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务调用端（客户端）可以检查它接收到的失败状态的 \u003ccode\u003eFuture\u003c/code\u003e 包含的 \u003ccode\u003eThrowable\u003c/code\u003e 对象是否为 \u003ccode\u003eServiceException\u003c/code\u003e 实例。\n如果是的话，继续检查内部的特定的错误状态码。\n调用端可以通过这些信息来将业务逻辑错误与系统错误（如服务没有被注册到事件总线上）区分开，\n以便确定到底发生了哪一种业务逻辑错误。下面是一个例子：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title function_\"\u003efoo\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e {\n \u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n server.createConnection(\u003cspan class=\"hljs-string\"\u003e\u0026quot;8\u0026quot;\u003c/span\u003e)\n   .compose(connection -\u0026gt; {\n     \u003cspan class=\"hljs-comment\"\u003e// 正常调用。\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doSuccessStuff(connection);\n   })\n   .recover(err -\u0026gt; {\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e ServiceException) {\n       \u003cspan class=\"hljs-type\"\u003eServiceException\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eexc\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e (ServiceException) err;\n       \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exc.failureCode() == SomeDatabaseServiceImpl.BAD_SHOE_SIZE) {\n         \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n           \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eInvalidInputError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;You provided a bad shoe size: \u0026quot;\u003c/span\u003e +\n             exc.getDebugInfo().getString(\u003cspan class=\"hljs-string\"\u003e\u0026quot;shoeSize\u0026quot;\u003c/span\u003e)));\n       } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exc.failureCode() == SomeDatabaseServiceImpl.CONNECTION) {\n         \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eConnectionError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Failed to connect to the DB\u0026quot;\u003c/span\u003e));\n       }\n     } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-comment\"\u003e// 必须是一个系统错误，如：服务代理没有对应的已注册的服务\u003c/span\u003e\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSystemError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;An unexpected error occurred: + \u0026quot;\u003c/span\u003e result.cause().getMessage()));\n     }\n   });\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果需要的话, 服务实现的时候也可以返回 \u003ccode\u003eServiceException\u003c/code\u003e 子类,\n只要向事件总线注册了对应的默认 \u003ccode\u003eMessageCodec\u003c/code\u003e 就可以了。 例如, 比如给定下面的 \u003ccode\u003eServiceException\u003c/code\u003e 子类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eShoeSizeException\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServiceException\u003c/span\u003e {\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003efinal\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eBAD_SHOE_SIZE_ERROR\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e;\n\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e String shoeSize;\n\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eShoeSizeException\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e {\n   \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(BAD_SHOE_SIZE_ERROR, \u003cspan class=\"hljs-string\"\u003e\u0026quot;In invalid shoe size was received: \u0026quot;\u003c/span\u003e + shoeSize);\n   \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.shoeSize = shoeSize;\n }\n\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e String \u003cspan class=\"hljs-title function_\"\u003egetShoeSize\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e extra;\n }\n\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u0026lt;T\u0026gt; Future\u0026lt;T\u0026gt; \u003cspan class=\"hljs-title function_\"\u003efail\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e failureCode, String message, String shoeSize)\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyServiceException\u003c/span\u003e(failureCode, message, shoeSize));\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e只要向事件总线注册了对应的 \u003ccode\u003eMessageCodec\u003c/code\u003e ，\n服务就可以直接向调用者返回自定义的异常类型：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSomeDatabaseService\u003c/span\u003e {\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eSomeDataBaseServiceImpl\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e {\n   \u003cspan class=\"hljs-comment\"\u003e// 注册服务，如果你是用事件总线使用本地模式，这就是全部\u003c/span\u003e\n   \u003cspan class=\"hljs-comment\"\u003e// 因为代理端和服务端共享一个vert.x实例\u003c/span\u003e\n \u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n   vertx.eventBus().registerDefaultCodec(ShoeSizeException.class,\n     \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eShoeSizeExceptionMessageCodec\u003c/span\u003e());\n }\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n Future\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title function_\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!shoeSize.equals(\u003cspan class=\"hljs-string\"\u003e\u0026quot;9\u0026quot;\u003c/span\u003e)) {\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ShoeSizeException.fail(shoeSize);\n   } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n     \u003cspan class=\"hljs-comment\"\u003e// 此处创建连接\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(myDbConnection);\n   }\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e最后调用端可以检查自定义的异常类型了：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title function_\"\u003efoo\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e {\n \u003cspan class=\"hljs-comment\"\u003e// 如果运行在集群模式当中，代码在不同的节点运行，\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e// ShoeSizeExceptionMessageCodec 必须注册到\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e// 该节点的Vertx当中\u003c/span\u003e\n \u003cspan class=\"hljs-type\"\u003eSomeDatabaseService\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eservice\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n service.createConnection(\u003cspan class=\"hljs-string\"\u003e\u0026quot;8\u0026quot;\u003c/span\u003e)\n   .compose(connection -\u0026gt; {\n     \u003cspan class=\"hljs-comment\"\u003e// 成功调用。\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doSuccessStuff(connection);\n   })\n   .recover(err -\u0026gt; {\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.cause() \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e ShoeSizeException) {\n       \u003cspan class=\"hljs-type\"\u003eShoeSizeException\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eexc\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e (ShoeSizeException) result.cause();\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n         \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eInvalidInputError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;You provided a bad shoe size: \u0026quot;\u003c/span\u003e + exc.getShoeSize()));\n     } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-comment\"\u003e// 必须是个系统错误 (例如：没有为服务代理进行注册)\u003c/span\u003e\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n         \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSystemError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;An unexpected error occurred: + \u0026quot;\u003c/span\u003e result.cause().getMessage())\n       );\n     }\n   });\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意在 \u003ccode\u003eVertx\u003c/code\u003e 集群模式下，您需要向集群中每个节点的事件总线注册对应的自定义异常类型\n的 \u003ccode\u003eMessageCodec\u003c/code\u003e 实例\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_restrictions_for_service_interface\"\u003e\u003ca class=\"anchor\" href=\"#_restrictions_for_service_interface\"\u003e\u003c/a\u003e接口类型限制\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在服务中参数和返回值在类型上有一定的限制,因此可以方便在事件总线中进行转化。\n他们是：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_data_types\"\u003e\u003ca class=\"anchor\" href=\"#_data_types\"\u003e\u003c/a\u003e数据类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e 表示 \u003ccode\u003eJsonObject 或 JsonArray\u003c/code\u003e\n\u003ccode\u003ePRIMITIVE\u003c/code\u003e 表示任何原始类型或被自动拆装箱的原始类型\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e参数可以是以下任意一种：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePRIMITIVE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eMap\u0026lt;String, JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eMap\u0026lt;String, PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何 \u003cem\u003e枚举\u003c/em\u003e 类型\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何被打上 \u003ccode\u003e@DataObject\u003c/code\u003e 注解的实体类\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e异步结果可建模为\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eFuture\u0026lt;R\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e用于回调样式的 \u003ccode\u003eHandler\u0026lt;AsyncResult\u0026lt;R\u0026gt;\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003eR\u003c/code\u003e 的类型可以是：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePRIMITIVE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何 \u003cem\u003e枚举\u003c/em\u003e 类型\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何打上 \u003ccode\u003e@DataObject\u003c/code\u003e 注解的类（需符合上文的代码篇章要求）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e另一个代理类\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_overloaded_methods\"\u003e\u003ca class=\"anchor\" href=\"#_overloaded_methods\"\u003e\u003c/a\u003e重载方法\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务接口不支持任何的重载(即方法名称相同，但参数列表不同)服务方法。。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e\u003c/a\u003e通过事件总线调用服务的规则 (不使用服务代理)\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务代理假定事件总线中的消息遵循一定的格式，因此能被用于服务的调用\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当然，如果不愿意的话，您也可以 \u003cstrong\u003e不用\u003c/strong\u003e 服务代理类来访问远程服务。\n被广泛接受的与服务交互的方式就是直接在事件总线发送消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了使服务访问的方式一致，\n所有的服务都必须遵循以下的消息格式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e格式非常简单：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e需要有一个名为 \u003ccode\u003eaction\u003c/code\u003e 的 消息头(header)，作为要执行操作的名称。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e消息体（message body）应该是一个 \u003ccode\u003eJsonObject\u003c/code\u003e 对象，里面需要包含操作需要的所有参数。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e举个例子，假如我们要去执行一个名为 \u003ccode\u003esave\u003c/code\u003e 的操作，此操作接受一个字符串类型的 collection 和 JsonObject 类型 document：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre\u003eHeaders:\n   \"action\": \"save\"\nBody:\n   {\n       \"collection\", \"mycollection\",\n       \"document\", {\n           \"name\": \"tim\"\n       }\n   }\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e无论有没有用到服务代理来创建服务，都应该用上面这种方式编写服务，\n因为这样允许服务交互时保持一致性。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在上面的例子中，\"action\" 对应的值应该与服务接口的某个方法名称相对应，\n而消息体中每个 \u003ccode\u003e[key, value]\u003c/code\u003e 都要与服务方法中的某个 \u003ccode\u003e[arg_name, arg_value]\u003c/code\u003e 相对应\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e对于返回值，服务需使用 \u003ccode\u003emessage.reply(\u0026#8230;\u0026#8203;)\u003c/code\u003e 方法去向调用端发送回一个返回值 - 这个值可以是事件总线支持的任何类型。\n如果需要表示调用失败，可以调用 \u003ccode\u003emessage.fail(\u0026#8230;\u0026#8203;)\u003c/code\u003e 方法。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您使用 Vert.x 服务代理组件的话，生成的代码会自动帮您处理这些问题。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.1.7"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.1.7","vertx-service-proxy","java"]},"buildId":"DxYj1qG9XZR4Q5BZwOJ88","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>