<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>服务代理 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-service-proxy" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.bee17d6f.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.bee17d6f.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7689a0583e30048c05ff.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-3a425d1828d3af7aa498.js" as="script"/></head><body data-build-time="2021-06-05T02:38:04.831Z" data-build-commit-id="8eced7ccd5d5d18e251eed1984699c51cc7b52fb" data-build-run-id="908234911"><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_vert_x_service_proxies">使用Vert.x服务代理</a></li>
<li><a href="#_introduction_to_service_proxies">服务代理简介</a></li>
<li><a href="#_async_interface">异步接口</a></li>
<li><a href="#_async_interface_with_callbacks">带回调的异步接口</a></li>
<li><a href="#_security">安全</a></li>
<li><a href="#_code_generation">代码生成</a></li>
<li><a href="#_exposing_your_service">公开服务</a></li>
<li><a href="#_proxy_creation">代理创建</a></li>
<li><a href="#_error_handling">错误处理</a></li>
<li><a href="#_restrictions_for_service_interface">接口类型限制</a>
<ul class="sectlevel2">
<li><a href="#_data_types">数据类型</a></li>
<li><a href="#_overloaded_methods">重载方法</a></li>
</ul>
</li>
<li><a href="#_convention_for_invoking_services_over_the_event_bus_without_proxies">通过事件总线调用服务的规则 (不使用服务代理)</a></li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/vert-x3/vertx-service-proxy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-examples"><a href="https://github.com/vert-x3/vertx-examples/tree/4.x/service-proxy-examples"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Examples</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-service-proxy/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.1.0<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-service-proxy/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.1.0<!-- -->)</li></a><a href="/docs/4.0.3/vertx-service-proxy/java/"><li class="dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a><a href="/docs/3.9.7/vertx-service-proxy/java/"><li class="dropdown-item has-active-siblings">v<!-- -->3.9.7</li></a></ul></div></span></div></div><div><h1>Vert.x 服务代理</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>当您编写 Vert.x 程序的时候，您也许想将某处独立服务功能提供给其他程序使用。
此时便使用服务代理。它可以让您在事件总线上发布您的 <em>服务</em> ，
任何 Vert.x 程序只要知道其 <em>地址</em>
即可使用该服务。</p>
</div>
<div class="paragraph">
<p>一个 <em>服务</em> 通过 Java 接口描述并遵循 <em>异步</em> 模式。
从本质上说，消息通过事件总线发送调用服务并获取响应。
但为了方便使用，它会生成一个 <em>代理</em> ，您可直接使用该代理（用代理提供的服务接口 API）。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_vert_x_service_proxies"><a class="anchor" href="#_using_vert_x_service_proxies"></a>使用Vert.x服务代理</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>使用</strong> Vert.x Service Proxies 之前，
您必须在您得项目当中添加 <em>依赖</em> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-proxy<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle（在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">'io.vertx:vertx-service-proxy:4.1.0'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为了 <strong>实现</strong> 服务代理, 您还需要添加：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven（在您的 <code>pom.xml</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-codegen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle &lt; 5 （在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compileOnly <span class="hljs-string">'io.vertx:vertx-codegen:4.1.0'</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle &gt;= 5（在您的 <code>build.gradle</code> 文件中）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">annotationProcessor <span class="hljs-string">'io.vertx:vertx-codegen:4.1.0:processor'</span>
annotationProcessor <span class="hljs-string">'io.vertx:vertx-service-proxy:4.1.0'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：因为服务代理类是由代码自动生成的，因此每当您修改了 <em>服务接口</em> 您必须重新编译源码，
以重新生成代理类。</p>
</div>
<div class="paragraph">
<p>如果您要生成不同语言的代理类，您需要添加相应的依赖。例如，
生成 Groovy 语言的代理接口需要添加 <code>vertx-lang-groovy</code> 依赖</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_service_proxies"><a class="anchor" href="#_introduction_to_service_proxies"></a>服务代理简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p>让我看看服务代理它怎么用。
如果您在事件总线上公开 <em>数据库服务</em> 您可以执行下面的操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">JsonObject message = <span class="hljs-keyword">new</span> JsonObject();

message
  .put(<span class="hljs-string">"collection"</span>, <span class="hljs-string">"mycollection"</span>)
  .put(<span class="hljs-string">"document"</span>, <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"tim"</span>));

DeliveryOptions options = <span class="hljs-keyword">new</span> DeliveryOptions().addHeader(<span class="hljs-string">"action"</span>, <span class="hljs-string">"save"</span>);

vertx.eventBus()
  .request(<span class="hljs-string">"database-service-address"</span>, message, options)
  .onSuccess(msg -&gt; {
    <span class="hljs-comment">// 完成</span>
  }).onFailure(err -&gt; {
  <span class="hljs-comment">// 失败</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>当创建服务的时候，会有一定数量的样本代码在事件总线接收信息，
路由会找到合适的方法并在总线上返回结果</p>
</div>
<div class="paragraph">
<p>使用 Vert.x 服务代理时, 您可以使用代码生成避免编写重复的代码，从而集中精力编写服务</p>
</div>
<div class="paragraph">
<p>在您编写的Java接口上面打上 <code>@ProxyGen</code> 注解, 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SomeDatabaseService</span> </span>{

 <span class="hljs-comment">// 几个工厂方法用于创建实例和代理</span>
 <span class="hljs-function"><span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title">create</span><span class="hljs-params">(Vertx vertx)</span> </span>{
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SomeDatabaseServiceImpl(vertx);
 }

 <span class="hljs-function"><span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title">createProxy</span><span class="hljs-params">(Vertx vertx,
   String address)</span> </span>{
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SomeDatabaseServiceVertxEBProxy(vertx, address);
 }

<span class="hljs-comment">// 此处是实际的服务操作……</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String collection, JsonObject document,
  Handler&lt;AsyncResult&lt;Void&gt;&gt; resultHandler)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还需要编写 <code>package-info.java</code> 文件，位置处于接口定义包中。
这个包还需要 <code>@ModuleGen</code> 注解，
以便 Vert.x 代码生成器生成事件总线代理代码。</p>
</div>
<div class="listingblock">
<div class="title">package-info.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@io</span>.vertx.codegen.annotations.ModuleGen(groupPackage = <span class="hljs-string">"io.vertx.example"</span>, name = <span class="hljs-string">"services"</span>, useFutures = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">package</span> io.vertx.example;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了这个接口，Vert.x 会生成所有需要的用于在事件总线上访问您服务的模板代码，
同时也会生成对应的 <strong>调用端代理类（client side proxy）</strong> ，
这样您的服务调用端就可以使用一个相当符合习惯的 API（译者注：即相同的服务接口）进行服务调用，而不是去手动地向事件总线发送消息。
不管您的服务实际依赖于哪个事件总线上（可能是在不同的机器上），调用端代理类都能正常工作。</p>
</div>
<div class="paragraph">
<p>也就是说，您可以通过以下方式进行服务调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SomeDatabaseService service = SomeDatabaseService
  .createProxy(vertx, <span class="hljs-string">"database-service-address"</span>);

<span class="hljs-comment">// 保存数据到数据库，这里使用了代理</span>
service.save(
  <span class="hljs-string">"mycollection"</span>,
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"tim"</span>),
  res2 -&gt; {
    <span class="hljs-keyword">if</span> (res2.succeeded()) {
      <span class="hljs-comment">// 调用完毕</span>
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以将多语言 API 生成功能（@VertxGen 注解）与 @ProxyGen 注解相结合，
用于生成其它 Vert.x 支持的 JVM 语言对应的服务代理 —— 这意味着您可以只用 Java 编写您的服务一次，
就可以在其他语言中以一种习惯的 API 风格进行服务调用，而完全不必管服务是在本地还是在哪个事件总线上。
想要利用多语言代码生成功能，不要忘记添加对应支持语言的依赖。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span> <span class="hljs-comment">// 生成服务代理</span>
<span class="hljs-meta">@VertxGen</span> <span class="hljs-comment">// 生成客户端</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SomeDatabaseService</span> </span>{
 <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_async_interface"><a class="anchor" href="#_async_interface"></a>异步接口</h2>
<div class="sectionbody">
<div class="paragraph">
<p>想要正确地生成服务代理类，<em>服务接口</em> 的设计必须遵循一些规则。 首先是需要遵循异步模式。
如果需要返回结果，对应的方法需要包含一个 <code>Future&lt;ResultType&gt;</code> 类型的返回值。
其中 <code>ResultType</code> 可以是另一种代理类型（所以一个代理类可以作为另一个代理类的工厂）。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SomeDatabaseService</span> </span>{

<span class="hljs-comment">// 一些用于创建服务实例和服务代理实例的工厂方法</span>

<span class="hljs-function"><span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title">create</span><span class="hljs-params">(Vertx vertx)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SomeDatabaseServiceImpl(vertx);
}

<span class="hljs-function"><span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title">createProxy</span><span class="hljs-params">(Vertx vertx, String address)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SomeDatabaseServiceVertxEBProxy(vertx, address);
}

<span class="hljs-comment">// 异步方法，仅通知调用是否完成，不返回结果</span>
<span class="hljs-function">Future&lt;Void&gt; <span class="hljs-title">save</span><span class="hljs-params">(String collection, JsonObject document)</span></span>;

<span class="hljs-comment">// 异步方法，包含JsonObject类型的返回结果</span>
<span class="hljs-function">Future&lt;JsonObject&gt; <span class="hljs-title">findOne</span><span class="hljs-params">(String collection, JsonObject query)</span></span>;

<span class="hljs-comment">// 创建连接</span>
<span class="hljs-function">Future&lt;MyDatabaseConnection&gt; <span class="hljs-title">createConnection</span><span class="hljs-params">(String shoeSize)</span></span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以及：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-meta">@VertxGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyDatabaseConnection</span> </span>{

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(JsonObject someData)</span></span>;

<span class="hljs-function">Future&lt;Void&gt; <span class="hljs-title">commit</span><span class="hljs-params">()</span></span>;

<span class="hljs-meta">@ProxyClose</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过声明一个特殊方法，并给其加上 <code>@ProxyClose</code> 注解来注销代理。
当此方法被调用时，代理实例被清除。</p>
</div>
<div class="paragraph">
<p>更多 <code>服务接口</code> 的限制会在下面详解。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_async_interface_with_callbacks"><a class="anchor" href="#_async_interface_with_callbacks"></a>带回调的异步接口</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 Vert.x 4.1 之前，服务异步接口由回调定义。</p>
</div>
<div class="paragraph">
<p>您仍然可以使用回调创建服务异步接口，使用以下模块声明：</p>
</div>
<div class="listingblock">
<div class="title">package-info.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@io</span>.vertx.codegen.annotations.ModuleGen(groupPackage = <span class="hljs-string">"io.vertx.example"</span>, name = <span class="hljs-string">"services"</span>, useFutures = <span class="hljs-keyword">false</span>)
<span class="hljs-keyword">package</span> io.vertx.example;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
为向后兼容，<code>useFutures</code> 的默认值为 <code>false</code>，因此您也可以省略该声明
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>带有回调的服务异步接口如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SomeDatabaseService</span> </span>{

 <span class="hljs-comment">// 一个通知完成而没有结果的方法（void）</span>
 <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String collection, JsonObject document,
  Handler&lt;AsyncResult&lt;Void&gt;&gt; result)</span></span>;

 <span class="hljs-comment">// 一个提供了结果的方法（一个 json 对象）</span>
 <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">findOne</span><span class="hljs-params">(String collection, JsonObject query,
  Handler&lt;AsyncResult&lt;JsonObject&gt;&gt; result)</span></span>;

 <span class="hljs-comment">// 创建连接</span>
 <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createConnection</span><span class="hljs-params">(String shoeSize,
  Handler&lt;AsyncResult&lt;MyDatabaseConnection&gt;&gt; resultHandler)</span></span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>返回类型必须是以下之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code></p>
</li>
<li>
<p><code>@Fluent</code> 并返回对该服务的引用（<code>this</code>）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Fluent</span>
<span class="hljs-function">SomeDatabaseService <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是因为方法不允许阻塞，如果该服务是远程调用（remote）（译者注：远程意思是服务代理通过事件总线调用其他verticle中的服务），
那么无法在不阻塞的前提下立即返回结果。（译者注：因为远程调用需要消耗一定时间）</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security"><a class="anchor" href="#_security"></a>安全</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务代理可以使用简单的拦截器保障基本安全。
提供一个身份验证器，可以选择添加 <code>Authorization</code> 在这种情况下，<code>AuthorizationProvider</code> 是必须提提供的。
注意，身份认证的令牌从 <code>auth-token</code> 信息头获取。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SomeDatabaseService service = <span class="hljs-keyword">new</span> SomeDatabaseServiceImpl();
<span class="hljs-comment">// 注册处理器</span>
<span class="hljs-keyword">new</span> ServiceBinder(vertx)
  .setAddress(<span class="hljs-string">"database-service-address"</span>)
  <span class="hljs-comment">// 保护传输中的信息</span>
  .addInterceptor(
    <span class="hljs-keyword">new</span> ServiceAuthInterceptor()
      <span class="hljs-comment">// 使用JWT认证进行校验令牌</span>
      .setAuthenticationProvider(JWTAuth.create(vertx, <span class="hljs-keyword">new</span> JWTAuthOptions()))
      <span class="hljs-comment">// 我们可以选择部分权限进行保护：</span>

      <span class="hljs-comment">// 比如admin组</span>
      .addAuthorization(RoleBasedAuthorization.create(<span class="hljs-string">"admin"</span>))
      <span class="hljs-comment">// 比如打印权限</span>
      .addAuthorization(PermissionBasedAuthorization.create(<span class="hljs-string">"print"</span>))

      <span class="hljs-comment">// 或者从令牌种加载权限</span>
      <span class="hljs-comment">// 如果有需要您也可以从数据库或文件加载中权限</span>
      .setAuthorizationProvider(
        JWTAuthorization.create(<span class="hljs-string">"permissions"</span>)))

  .register(SomeDatabaseService<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">service</span>)</span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_generation"><a class="anchor" href="#_code_generation"></a>代码生成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>被 @ProxyGen 注解的服务接口会触发生成对应的服务辅助类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>服务代理类（service proxy）：一个编译时产生的代理类，用 <code>EventBus</code> 通过消息与服务交互。</p>
</li>
<li>
<p>服务处理器类（service handler）： 一个编译时产生的 <code>EventBus</code> 处理器类，用于响应由服务代理发送的事件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>产生的服务代理和处理器的命名是在类名的后面加相关的字段，例如，如果一个服务接口名为 <code>MyService</code>，
则对应的处理器类命名为 <code>MyServiceProxyHandler</code>，对应的服务代理类命名为 MyServiceVertxEBProxy。</p>
</div>
<div class="paragraph">
<p>此外 Vert.x Core 提供了一个生成器用于数据转化器，以简化服务代理中数据对象的使用。
数据转化器要求数据对象提供一个以 <code>JsonObject</code>
为基础的构造器和 <code>toJson()</code> 方法</p>
</div>
<div class="paragraph">
<p><em>codegen</em> 注释处理器在编译时生成这些类
它是Java编译器的功能 所以无需 <em>额外步骤</em>, 只需正确配置您的构建参数即可：</p>
</div>
<div class="paragraph">
<p>只需要在构建配置中加上 <code>io.vertx:vertx-codegen:processor</code> 和 <code>io.vertx:vertx-service-proxy</code>
依赖。</p>
</div>
<div class="paragraph">
<p>这是一个针对 Maven 的配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-codegen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>processor<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-service-proxy<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此功能也可以在 Gradle 中使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>compile "io.vertx:vertx-codegen:4.1.0:processor"
compile "io.vertx:vertx-service-proxy:4.1.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>IDE 通常为注释处理器提供支持。</p>
</div>
<div class="paragraph">
<p>代码生成 <code>处理器</code> 分类器会把服务代理注释处理器的配置自动添加到 jar 包目录下的
<code>META-INF/services</code> 当中。</p>
</div>
<div class="paragraph">
<p>如果您想和其与常规 jar一起使用，但是需要显式声明注释处理器,
例如在 Maven 中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessors</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessor</span>&gt;</span>io.vertx.codegen.CodeGenProcessor<span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessor</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessors</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposing_your_service"><a class="anchor" href="#_exposing_your_service"></a>公开服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当您写好服务接口以后，执行构建操作以生成代码。
然后您需要将您的服务 <code>注册</code> 到事件总线上：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SomeDatabaseService service = <span class="hljs-keyword">new</span> SomeDatabaseServiceImpl();
<span class="hljs-comment">// 注册处理器</span>
<span class="hljs-keyword">new</span> ServiceBinder(vertx)
  .setAddress(<span class="hljs-string">"database-service-address"</span>)
  .register(SomeDatabaseService<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">service</span>)</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个过程既可以在 Verticle 中完成，也可以在您的代码的任何其它位置完成。</p>
</div>
<div class="paragraph">
<p>一旦注册了，这个服务就可用了。如果您的应用运行在集群上，
则集群中节点都可访问。</p>
</div>
<div class="paragraph">
<p>如果想注销这个服务, 使用 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceBinder.html#unregister-io.vertx.core.eventbus.MessageConsumer-">unregister</a></code>
方法注销：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceBinder binder = <span class="hljs-keyword">new</span> ServiceBinder(vertx);

<span class="hljs-comment">// 创建服务实现实例</span>
SomeDatabaseService service = <span class="hljs-keyword">new</span> SomeDatabaseServiceImpl();
<span class="hljs-comment">// 注册处理器</span>
MessageConsumer&lt;JsonObject&gt; consumer = binder
  .setAddress(<span class="hljs-string">"database-service-address"</span>)
  .register(SomeDatabaseService<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">service</span>)</span>;

<span class="hljs-comment">// ....</span>

<span class="hljs-comment">// 销毁服务。</span>
binder.unregister(consumer);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proxy_creation"><a class="anchor" href="#_proxy_creation"></a>代理创建</h2>
<div class="sectionbody">
<div class="paragraph">
<p>现在服务已经公开, 现在可以消费使用它。 为此，您必须创建一个代理。
创建代理使用 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceProxyBuilder.html">ServiceProxyBuilder</a></code> 类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServiceProxyBuilder builder = <span class="hljs-keyword">new</span> ServiceProxyBuilder(vertx)
  .setAddress(<span class="hljs-string">"database-service-address"</span>);

SomeDatabaseService service = builder.build(SomeDatabaseService<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
<span class="hljs-comment">// 设置其他属性：</span>
SomeDatabaseService service2 = builder.setOptions(options)
  .build(SomeDatabaseService<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>第二种构造通过 <code><a href="../../apidocs/io/vertx/core/eventbus/DeliveryOptions.html">DeliveryOptions</a></code> 构造实例，
您可以在其中配置属性（例如：超时）</p>
</div>
<div class="paragraph">
<p>或者,您也可以使用代理类。
这个代理名称为 <em>服务接口</em> 类目后追加 <code>VertxEBProxy</code>。
例如, 如果您的 <em>服务接口</em> 名为 <code>SomeDatabaseService</code>，那么代理类名为 <code>SomeDatabaseServiceVertxEBProxy</code>。</p>
</div>
<div class="paragraph">
<p>一般来说, <em>服务接口</em> 包含 <code>createProxy</code> 静态方法用于创建代理。 但这不是必须的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@ProxyGen</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SomeDatabaseService</span> </span>{

<span class="hljs-comment">// 静态方法创建代理。</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> SomeDatabaseService <span class="hljs-title">createProxy</span><span class="hljs-params">(Vertx vertx, String address)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SomeDatabaseServiceVertxEBProxy(vertx, address);
}

<span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling"><a class="anchor" href="#_error_handling"></a>错误处理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务方法可能会通过向方法的处理器（Handler）传递一个失败状态的 Future （包含一个 <code><a href="../../apidocs/io/vertx/serviceproxy/ServiceException.html">ServiceException</a></code> 实例。
一个 <code>ServiceException</code> 包含 <code>int</code> 类型的错误码、消息,以及一个可选的
 <code>JsonObject</code> 对象用于传递额外信息。为了方便，
<code><a href="../../apidocs/io/vertx/serviceproxy/ServiceException.html#fail-int-java.lang.String-">ServiceException.fail</a></code> 工厂方法来创建一个已经是失败状态并且包装着
<code>ServiceException</code> 实例的失败 <code>Future</code> 。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeDatabaseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SomeDatabaseService</span> </span>{

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> BAD_SHOE_SIZE = <span class="hljs-number">42</span>;
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> CONNECTION_FAILED = <span class="hljs-number">43</span>;

 <span class="hljs-comment">// 创建连接</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;MyDatabaseConnection&gt; <span class="hljs-title">createConnection</span><span class="hljs-params">(String shoeSize)</span> </span>{
   <span class="hljs-keyword">if</span> (!shoeSize.equals(<span class="hljs-string">"9"</span>)) {
     <span class="hljs-keyword">return</span> Future.failedFuture(ServiceException.fail(BAD_SHOE_SIZE, <span class="hljs-string">"The shoe size must be 9!"</span>,
       <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"shoeSize"</span>, shoeSize)));
    } <span class="hljs-keyword">else</span> {
       <span class="hljs-keyword">return</span> doDbConnection().recover(err -&gt; Future.failedFuture(ServiceException.fail(CONNECTION_FAILED, result.cause().getMessage())));
    }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>服务调用端（客户端）可以检查它接收到的失败状态的 <code>Future</code> 包含的 <code>Throwable</code> 对象是否为 <code>ServiceException</code> 实例。
如果是的话，继续检查内部的特定的错误状态码。
调用端可以通过这些信息来将业务逻辑错误与系统错误（如服务没有被注册到事件总线上）区分开，
以便确定到底发生了哪一种业务逻辑错误。下面是一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;JsonObject&gt; <span class="hljs-title">foo</span><span class="hljs-params">(String shoeSize)</span> </span>{
 SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
 server.createConnection(<span class="hljs-string">"8"</span>)
   .compose(connection -&gt; {
     <span class="hljs-comment">// 正常调用。</span>
     <span class="hljs-keyword">return</span> doSuccessStuff(connection);
   })
   .recover(err -&gt; {
     <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> ServiceException) {
       ServiceException exc = (ServiceException) err;
       <span class="hljs-keyword">if</span> (exc.failureCode() == SomeDatabaseServiceImpl.BAD_SHOE_SIZE) {
         <span class="hljs-keyword">return</span> Future.failedFuture(
           <span class="hljs-keyword">new</span> InvalidInputError(<span class="hljs-string">"You provided a bad shoe size: "</span> +
             exc.getDebugInfo().getString(<span class="hljs-string">"shoeSize"</span>)));
       } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exc.failureCode() == SomeDatabaseServiceImpl.CONNECTION) {
         <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> ConnectionError(<span class="hljs-string">"Failed to connect to the DB"</span>));
       }
     } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// 必须是一个系统错误，如：服务代理没有对应的已注册的服务</span>
       <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> SystemError(<span class="hljs-string">"An unexpected error occurred: + "</span> result.cause().getMessage()));
     }
   });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要的话, 服务实现的时候也可以返回 <code>ServiceException</code> 子类,
只要向事件总线注册了对应的默认 <code>MessageCodec</code> 就可以了。 例如, 比如给定下面的 <code>ServiceException</code> 子类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShoeSizeException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceException</span> </span>{
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> BAD_SHOE_SIZE_ERROR = <span class="hljs-number">42</span>;

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String shoeSize;

 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ShoeSizeException</span><span class="hljs-params">(String shoeSize)</span> </span>{
   <span class="hljs-keyword">super</span>(BAD_SHOE_SIZE_ERROR, <span class="hljs-string">"In invalid shoe size was received: "</span> + shoeSize);
   <span class="hljs-keyword">this</span>.shoeSize = shoeSize;
 }

 <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getShoeSize</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-keyword">return</span> extra;
 }

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">fail</span><span class="hljs-params">(<span class="hljs-keyword">int</span> failureCode, String message, String shoeSize)</span> </span>{
   <span class="hljs-keyword">return</span> Future.failedFuture(<span class="hljs-keyword">new</span> MyServiceException(failureCode, message, shoeSize));
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>只要向事件总线注册了对应的 <code>MessageCodec</code> ，
服务就可以直接向调用者返回自定义的异常类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeDatabaseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SomeDatabaseService</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SomeDataBaseServiceImpl</span><span class="hljs-params">(Vertx vertx)</span> </span>{
   <span class="hljs-comment">// 注册服务，如果你是用事件总线使用本地模式，这就是全部</span>
   <span class="hljs-comment">// 因为代理端和服务端共享一个vert.x实例</span>
 SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
   vertx.eventBus().registerDefaultCodec(ShoeSizeException<span class="hljs-class">.<span class="hljs-keyword">class</span>,
     <span class="hljs-title">new</span> <span class="hljs-title">ShoeSizeExceptionMessageCodec</span>())</span>;
 }

 <span class="hljs-comment">// 创建连接</span>
 <span class="hljs-function">Future&lt;MyDatabaseConnection&gt; <span class="hljs-title">createConnection</span><span class="hljs-params">(String shoeSize)</span> </span>{
   <span class="hljs-keyword">if</span> (!shoeSize.equals(<span class="hljs-string">"9"</span>)) {
     <span class="hljs-keyword">return</span> ShoeSizeException.fail(shoeSize);
   } <span class="hljs-keyword">else</span> {
     <span class="hljs-comment">// 此处创建连接</span>
     <span class="hljs-keyword">return</span> Future.succeededFuture(myDbConnection);
   }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后调用端可以检查自定义的异常类型了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;JsonObject&gt; <span class="hljs-title">foo</span><span class="hljs-params">(String shoeSize)</span> </span>{
 <span class="hljs-comment">// 如果运行在集群模式当中，代码在不同的节点运行，</span>
 <span class="hljs-comment">// ShoeSizeExceptionMessageCodec 必须注册到</span>
 <span class="hljs-comment">// 该节点的Vertx当中</span>
 SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);
 service.createConnection(<span class="hljs-string">"8"</span>)
   .compose(connection -&gt; {
     <span class="hljs-comment">// 成功调用。</span>
     <span class="hljs-keyword">return</span> doSuccessStuff(connection);
   })
   .recover(err -&gt; {
     <span class="hljs-keyword">if</span> (result.cause() <span class="hljs-keyword">instanceof</span> ShoeSizeException) {
       ShoeSizeException exc = (ShoeSizeException) result.cause();
       <span class="hljs-keyword">return</span> Future.failedFuture(
         <span class="hljs-keyword">new</span> InvalidInputError(<span class="hljs-string">"You provided a bad shoe size: "</span> + exc.getShoeSize()));
     } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// 必须是个系统错误 (例如：没有为服务代理进行注册)</span>
       <span class="hljs-keyword">return</span> Future.failedFuture(
         <span class="hljs-keyword">new</span> SystemError(<span class="hljs-string">"An unexpected error occurred: + "</span> result.cause().getMessage())
       );
     }
   });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意在 <code>Vertx</code> 集群模式下，您需要向集群中每个节点的事件总线注册对应的自定义异常类型
的 <code>MessageCodec</code> 实例</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restrictions_for_service_interface"><a class="anchor" href="#_restrictions_for_service_interface"></a>接口类型限制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在服务中参数和返回值在类型上有一定的限制,因此可以方便在事件总线中进行转化。
他们是：</p>
</div>
<div class="sect2">
<h3 id="_data_types"><a class="anchor" href="#_data_types"></a>数据类型</h3>
<div class="paragraph">
<p><code>JSON</code> 表示 <code>JsonObject 或 JsonArray</code>
<code>PRIMITIVE</code> 表示任何原始类型或被自动拆装箱的原始类型</p>
</div>
<div class="paragraph">
<p>参数可以是以下任意一种：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JSON</code></p>
</li>
<li>
<p><code>PRIMITIVE</code></p>
</li>
<li>
<p><code>List&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>List&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Set&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>Set&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Map&lt;String, JSON&gt;</code></p>
</li>
<li>
<p><code>Map&lt;String, PRIMITIVE&gt;</code></p>
</li>
<li>
<p>任何 <em>枚举</em> 类型</p>
</li>
<li>
<p>任何被打上 <code>@DataObject</code> 注解的实体类</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>异步结果可建模为</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Future&lt;R&gt;</code></p>
</li>
<li>
<p>用于回调样式的 <code>Handler&lt;AsyncResult&lt;R&gt;&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>R</code> 的类型可以是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JSON</code></p>
</li>
<li>
<p><code>PRIMITIVE</code></p>
</li>
<li>
<p><code>List&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>List&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p><code>Set&lt;JSON&gt;</code></p>
</li>
<li>
<p><code>Set&lt;PRIMITIVE&gt;</code></p>
</li>
<li>
<p>任何 <em>枚举</em> 类型</p>
</li>
<li>
<p>任何打上 <code>@DataObject</code> 注解的类（需符合上文的代码篇章要求）</p>
</li>
<li>
<p>另一个代理类</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overloaded_methods"><a class="anchor" href="#_overloaded_methods"></a>重载方法</h3>
<div class="paragraph">
<p>服务接口不支持任何的重载(即方法名称相同，但参数列表不同)服务方法。。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_convention_for_invoking_services_over_the_event_bus_without_proxies"><a class="anchor" href="#_convention_for_invoking_services_over_the_event_bus_without_proxies"></a>通过事件总线调用服务的规则 (不使用服务代理)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>服务代理假定事件总线中的消息遵循一定的格式，因此能被用于服务的调用</p>
</div>
<div class="paragraph">
<p>当然，如果不愿意的话，您也可以 <strong>不用</strong> 服务代理类来访问远程服务。
被广泛接受的与服务交互的方式就是直接在事件总线发送消息。</p>
</div>
<div class="paragraph">
<p>为了使服务访问的方式一致，
所有的服务都必须遵循以下的消息格式。</p>
</div>
<div class="paragraph">
<p>格式非常简单：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>需要有一个名为 <code>action</code> 的 消息头(header)，作为要执行操作的名称。</p>
</li>
<li>
<p>消息体（message body）应该是一个 <code>JsonObject</code> 对象，里面需要包含操作需要的所有参数。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>举个例子，假如我们要去执行一个名为 <code>save</code> 的操作，此操作接受一个字符串类型的 collection 和 JsonObject 类型 document：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Headers:
   "action": "save"
Body:
   {
       "collection", "mycollection",
       "document", {
           "name": "tim"
       }
   }</pre>
</div>
</div>
<div class="paragraph">
<p>无论有没有用到服务代理来创建服务，都应该用上面这种方式编写服务，
因为这样允许服务交互时保持一致性。</p>
</div>
<div class="paragraph">
<p>在上面的例子中，"action" 对应的值应该与服务接口的某个方法名称相对应，
而消息体中每个 <code>[key, value]</code> 都要与服务方法中的某个 <code>[arg_name, arg_value]</code> 相对应</p>
</div>
<div class="paragraph">
<p>对于返回值，服务需使用 <code>message.reply(&#8230;&#8203;)</code> 方法去向调用端发送回一个返回值 - 这个值可以是事件总线支持的任何类型。
如果需要表示调用失败，可以调用 <code>message.fail(&#8230;&#8203;)</code> 方法。</p>
</div>
<div class="paragraph">
<p>如果您使用 Vert.x 服务代理组件的话，生成的代码会自动帮您处理这些问题。</p>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">联系渠道</a></li><li><a href="https://how-to.vertx.io/">操作指南</a></li><li><a href="https://start.vertx.io/">应用生成器</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse 基金会</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">隐私政策</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">使用条款</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">版权代理</a></li><li><a href="https://www.eclipse.org/legal/">法律资源</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x™<br/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>协议下获得了双重许可。<br class="footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a> 设计。</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"vertx-service-proxy/java","title":"Vert.x 服务代理","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_using_vert_x_service_proxies\"\u003e使用Vert.x服务代理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_introduction_to_service_proxies\"\u003e服务代理简介\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_async_interface\"\u003e异步接口\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_async_interface_with_callbacks\"\u003e带回调的异步接口\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_security\"\u003e安全\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_code_generation\"\u003e代码生成\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_exposing_your_service\"\u003e公开服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_proxy_creation\"\u003e代理创建\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_error_handling\"\u003e错误处理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_restrictions_for_service_interface\"\u003e接口类型限制\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_data_types\"\u003e数据类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_overloaded_methods\"\u003e重载方法\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e通过事件总线调用服务的规则 (不使用服务代理)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x 服务代理\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您编写 Vert.x 程序的时候，您也许想将某处独立服务功能提供给其他程序使用。\n此时便使用服务代理。它可以让您在事件总线上发布您的 \u003cem\u003e服务\u003c/em\u003e ，\n任何 Vert.x 程序只要知道其 \u003cem\u003e地址\u003c/em\u003e\n即可使用该服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个 \u003cem\u003e服务\u003c/em\u003e 通过 Java 接口描述并遵循 \u003cem\u003e异步\u003c/em\u003e 模式。\n从本质上说，消息通过事件总线发送调用服务并获取响应。\n但为了方便使用，它会生成一个 \u003cem\u003e代理\u003c/em\u003e ，您可直接使用该代理（用代理提供的服务接口 API）。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_vert_x_service_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_using_vert_x_service_proxies\"\u003e\u003c/a\u003e使用Vert.x服务代理\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003cstrong\u003e使用\u003c/strong\u003e Vert.x Service Proxies 之前，\n您必须在您得项目当中添加 \u003cem\u003e依赖\u003c/em\u003e ：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-proxy\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-service-proxy:4.1.0'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了 \u003cstrong\u003e实现\u003c/strong\u003e 服务代理, 您还需要添加：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven（在您的 \u003ccode\u003epom.xml\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-codegen\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle \u0026lt; 5 （在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompileOnly \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-codegen:4.1.0'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle \u0026gt;= 5（在您的 \u003ccode\u003ebuild.gradle\u003c/code\u003e 文件中）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003eannotationProcessor \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-codegen:4.1.0:processor'\u003c/span\u003e\nannotationProcessor \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-service-proxy:4.1.0'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意：因为服务代理类是由代码自动生成的，因此每当您修改了 \u003cem\u003e服务接口\u003c/em\u003e 您必须重新编译源码，\n以重新生成代理类。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您要生成不同语言的代理类，您需要添加相应的依赖。例如，\n生成 Groovy 语言的代理接口需要添加 \u003ccode\u003evertx-lang-groovy\u003c/code\u003e 依赖\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_introduction_to_service_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_introduction_to_service_proxies\"\u003e\u003c/a\u003e服务代理简介\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e让我看看服务代理它怎么用。\n如果您在事件总线上公开 \u003cem\u003e数据库服务\u003c/em\u003e 您可以执行下面的操作\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eJsonObject message = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject();\n\nmessage\n  .put(\u003cspan class=\"hljs-string\"\u003e\"collection\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"mycollection\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"document\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"tim\"\u003c/span\u003e));\n\nDeliveryOptions options = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e DeliveryOptions().addHeader(\u003cspan class=\"hljs-string\"\u003e\"action\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"save\"\u003c/span\u003e);\n\nvertx.eventBus()\n  .request(\u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e, message, options)\n  .onSuccess(msg -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 完成\u003c/span\u003e\n  }).onFailure(err -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// 失败\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当创建服务的时候，会有一定数量的样本代码在事件总线接收信息，\n路由会找到合适的方法并在总线上返回结果\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e使用 Vert.x 服务代理时, 您可以使用代码生成避免编写重复的代码，从而集中精力编写服务\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在您编写的Java接口上面打上 \u003ccode\u003e@ProxyGen\u003c/code\u003e 注解, 例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n\n \u003cspan class=\"hljs-comment\"\u003e// 几个工厂方法用于创建实例和代理\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title\"\u003ecreate\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceImpl(vertx);\n }\n\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx,\n   String address)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceVertxEBProxy(vertx, address);\n }\n\n\u003cspan class=\"hljs-comment\"\u003e// 此处是实际的服务操作……\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document,\n  Handler\u0026lt;AsyncResult\u0026lt;Void\u0026gt;\u0026gt; resultHandler)\u003c/span\u003e\u003c/span\u003e;\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您还需要编写 \u003ccode\u003epackage-info.java\u003c/code\u003e 文件，位置处于接口定义包中。\n这个包还需要 \u003ccode\u003e@ModuleGen\u003c/code\u003e 注解，\n以便 Vert.x 代码生成器生成事件总线代理代码。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"title\"\u003epackage-info.java\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@io\u003c/span\u003e.vertx.codegen.annotations.ModuleGen(groupPackage = \u003cspan class=\"hljs-string\"\u003e\"io.vertx.example\"\u003c/span\u003e, name = \u003cspan class=\"hljs-string\"\u003e\"services\"\u003c/span\u003e, useFutures = \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e io.vertx.example;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e有了这个接口，Vert.x 会生成所有需要的用于在事件总线上访问您服务的模板代码，\n同时也会生成对应的 \u003cstrong\u003e调用端代理类（client side proxy）\u003c/strong\u003e ，\n这样您的服务调用端就可以使用一个相当符合习惯的 API（译者注：即相同的服务接口）进行服务调用，而不是去手动地向事件总线发送消息。\n不管您的服务实际依赖于哪个事件总线上（可能是在不同的机器上），调用端代理类都能正常工作。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e也就是说，您可以通过以下方式进行服务调用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSomeDatabaseService service = SomeDatabaseService\n  .createProxy(vertx, \u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// 保存数据到数据库，这里使用了代理\u003c/span\u003e\nservice.save(\n  \u003cspan class=\"hljs-string\"\u003e\"mycollection\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"tim\"\u003c/span\u003e),\n  res2 -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res2.succeeded()) {\n      \u003cspan class=\"hljs-comment\"\u003e// 调用完毕\u003c/span\u003e\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您也可以将多语言 API 生成功能（@VertxGen 注解）与 @ProxyGen 注解相结合，\n用于生成其它 Vert.x 支持的 JVM 语言对应的服务代理 —— 这意味着您可以只用 Java 编写您的服务一次，\n就可以在其他语言中以一种习惯的 API 风格进行服务调用，而完全不必管服务是在本地还是在哪个事件总线上。\n想要利用多语言代码生成功能，不要忘记添加对应支持语言的依赖。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 生成服务代理\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@VertxGen\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 生成客户端\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_async_interface\"\u003e\u003ca class=\"anchor\" href=\"#_async_interface\"\u003e\u003c/a\u003e异步接口\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e想要正确地生成服务代理类，\u003cem\u003e服务接口\u003c/em\u003e 的设计必须遵循一些规则。 首先是需要遵循异步模式。\n如果需要返回结果，对应的方法需要包含一个 \u003ccode\u003eFuture\u0026lt;ResultType\u0026gt;\u003c/code\u003e 类型的返回值。\n其中 \u003ccode\u003eResultType\u003c/code\u003e 可以是另一种代理类型（所以一个代理类可以作为另一个代理类的工厂）。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n\n\u003cspan class=\"hljs-comment\"\u003e// 一些用于创建服务实例和服务代理实例的工厂方法\u003c/span\u003e\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title\"\u003ecreate\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceImpl(vertx);\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx, String address)\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceVertxEBProxy(vertx, address);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 异步方法，仅通知调用是否完成，不返回结果\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;Void\u0026gt; \u003cspan class=\"hljs-title\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document)\u003c/span\u003e\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 异步方法，包含JsonObject类型的返回结果\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title\"\u003efindOne\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject query)\u003c/span\u003e\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e\u003c/span\u003e;\n\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e以及：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@VertxGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eMyDatabaseConnection\u003c/span\u003e \u003c/span\u003e{\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einsert\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(JsonObject someData)\u003c/span\u003e\u003c/span\u003e;\n\n\u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;Void\u0026gt; \u003cspan class=\"hljs-title\"\u003ecommit\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ProxyClose\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eclose\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e;\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以通过声明一个特殊方法，并给其加上 \u003ccode\u003e@ProxyClose\u003c/code\u003e 注解来注销代理。\n当此方法被调用时，代理实例被清除。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多 \u003ccode\u003e服务接口\u003c/code\u003e 的限制会在下面详解。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_async_interface_with_callbacks\"\u003e\u003ca class=\"anchor\" href=\"#_async_interface_with_callbacks\"\u003e\u003c/a\u003e带回调的异步接口\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在 Vert.x 4.1 之前，服务异步接口由回调定义。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您仍然可以使用回调创建服务异步接口，使用以下模块声明：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"title\"\u003epackage-info.java\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@io\u003c/span\u003e.vertx.codegen.annotations.ModuleGen(groupPackage = \u003cspan class=\"hljs-string\"\u003e\"io.vertx.example\"\u003c/span\u003e, name = \u003cspan class=\"hljs-string\"\u003e\"services\"\u003c/span\u003e, useFutures = \u003cspan class=\"hljs-keyword\"\u003efalse\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e io.vertx.example;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n为向后兼容，\u003ccode\u003euseFutures\u003c/code\u003e 的默认值为 \u003ccode\u003efalse\u003c/code\u003e，因此您也可以省略该声明\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e带有回调的服务异步接口如下所示：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n\n \u003cspan class=\"hljs-comment\"\u003e// 一个通知完成而没有结果的方法（void）\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esave\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject document,\n  Handler\u0026lt;AsyncResult\u0026lt;Void\u0026gt;\u0026gt; result)\u003c/span\u003e\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 一个提供了结果的方法（一个 json 对象）\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efindOne\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String collection, JsonObject query,\n  Handler\u0026lt;AsyncResult\u0026lt;JsonObject\u0026gt;\u0026gt; result)\u003c/span\u003e\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize,\n  Handler\u0026lt;AsyncResult\u0026lt;MyDatabaseConnection\u0026gt;\u0026gt; resultHandler)\u003c/span\u003e\u003c/span\u003e;\n\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e返回类型必须是以下之一：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003evoid\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e@Fluent\u003c/code\u003e 并返回对该服务的引用（\u003ccode\u003ethis\u003c/code\u003e）：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Fluent\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003eSomeDatabaseService \u003cspan class=\"hljs-title\"\u003edoSomething\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这是因为方法不允许阻塞，如果该服务是远程调用（remote）（译者注：远程意思是服务代理通过事件总线调用其他verticle中的服务），\n那么无法在不阻塞的前提下立即返回结果。（译者注：因为远程调用需要消耗一定时间）\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_security\"\u003e\u003ca class=\"anchor\" href=\"#_security\"\u003e\u003c/a\u003e安全\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务代理可以使用简单的拦截器保障基本安全。\n提供一个身份验证器，可以选择添加 \u003ccode\u003eAuthorization\u003c/code\u003e 在这种情况下，\u003ccode\u003eAuthorizationProvider\u003c/code\u003e 是必须提提供的。\n注意，身份认证的令牌从 \u003ccode\u003eauth-token\u003c/code\u003e 信息头获取。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSomeDatabaseService service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceImpl();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceBinder(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// 保护传输中的信息\u003c/span\u003e\n  .addInterceptor(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceAuthInterceptor()\n      \u003cspan class=\"hljs-comment\"\u003e// 使用JWT认证进行校验令牌\u003c/span\u003e\n      .setAuthenticationProvider(JWTAuth.create(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JWTAuthOptions()))\n      \u003cspan class=\"hljs-comment\"\u003e// 我们可以选择部分权限进行保护：\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// 比如admin组\u003c/span\u003e\n      .addAuthorization(RoleBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"admin\"\u003c/span\u003e))\n      \u003cspan class=\"hljs-comment\"\u003e// 比如打印权限\u003c/span\u003e\n      .addAuthorization(PermissionBasedAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"print\"\u003c/span\u003e))\n\n      \u003cspan class=\"hljs-comment\"\u003e// 或者从令牌种加载权限\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 如果有需要您也可以从数据库或文件加载中权限\u003c/span\u003e\n      .setAuthorizationProvider(\n        JWTAuthorization.create(\u003cspan class=\"hljs-string\"\u003e\"permissions\"\u003c/span\u003e)))\n\n  .register(SomeDatabaseService\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, \u003cspan class=\"hljs-title\"\u003eservice\u003c/span\u003e)\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_code_generation\"\u003e\u003ca class=\"anchor\" href=\"#_code_generation\"\u003e\u003c/a\u003e代码生成\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e被 @ProxyGen 注解的服务接口会触发生成对应的服务辅助类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e服务代理类（service proxy）：一个编译时产生的代理类，用 \u003ccode\u003eEventBus\u003c/code\u003e 通过消息与服务交互。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务处理器类（service handler）： 一个编译时产生的 \u003ccode\u003eEventBus\u003c/code\u003e 处理器类，用于响应由服务代理发送的事件。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e产生的服务代理和处理器的命名是在类名的后面加相关的字段，例如，如果一个服务接口名为 \u003ccode\u003eMyService\u003c/code\u003e，\n则对应的处理器类命名为 \u003ccode\u003eMyServiceProxyHandler\u003c/code\u003e，对应的服务代理类命名为 MyServiceVertxEBProxy。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e此外 Vert.x Core 提供了一个生成器用于数据转化器，以简化服务代理中数据对象的使用。\n数据转化器要求数据对象提供一个以 \u003ccode\u003eJsonObject\u003c/code\u003e\n为基础的构造器和 \u003ccode\u003etoJson()\u003c/code\u003e 方法\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003cem\u003ecodegen\u003c/em\u003e 注释处理器在编译时生成这些类\n它是Java编译器的功能 所以无需 \u003cem\u003e额外步骤\u003c/em\u003e, 只需正确配置您的构建参数即可：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e只需要在构建配置中加上 \u003ccode\u003eio.vertx:vertx-codegen:processor\u003c/code\u003e 和 \u003ccode\u003eio.vertx:vertx-service-proxy\u003c/code\u003e\n依赖。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这是一个针对 Maven 的配置示例：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-codegen\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003eprocessor\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-service-proxy\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e此功能也可以在 Gradle 中使用：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode\u003ecompile \"io.vertx:vertx-codegen:4.1.0:processor\"\ncompile \"io.vertx:vertx-service-proxy:4.1.0\"\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIDE 通常为注释处理器提供支持。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e代码生成 \u003ccode\u003e处理器\u003c/code\u003e 分类器会把服务代理注释处理器的配置自动添加到 jar 包目录下的\n\u003ccode\u003eMETA-INF/services\u003c/code\u003e 当中。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您想和其与常规 jar一起使用，但是需要显式声明注释处理器,\n例如在 Maven 中：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003emaven-compiler-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eannotationProcessors\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eannotationProcessor\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx.codegen.CodeGenProcessor\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eannotationProcessor\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eannotationProcessors\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_exposing_your_service\"\u003e\u003ca class=\"anchor\" href=\"#_exposing_your_service\"\u003e\u003c/a\u003e公开服务\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当您写好服务接口以后，执行构建操作以生成代码。\n然后您需要将您的服务 \u003ccode\u003e注册\u003c/code\u003e 到事件总线上：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSomeDatabaseService service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceImpl();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceBinder(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e)\n  .register(SomeDatabaseService\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, \u003cspan class=\"hljs-title\"\u003eservice\u003c/span\u003e)\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个过程既可以在 Verticle 中完成，也可以在您的代码的任何其它位置完成。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦注册了，这个服务就可用了。如果您的应用运行在集群上，\n则集群中节点都可访问。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果想注销这个服务, 使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceBinder.html#unregister-io.vertx.core.eventbus.MessageConsumer-\"\u003eunregister\u003c/a\u003e\u003c/code\u003e\n方法注销：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceBinder binder = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceBinder(vertx);\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建服务实现实例\u003c/span\u003e\nSomeDatabaseService service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceImpl();\n\u003cspan class=\"hljs-comment\"\u003e// 注册处理器\u003c/span\u003e\nMessageConsumer\u0026lt;JsonObject\u0026gt; consumer = binder\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e)\n  .register(SomeDatabaseService\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, \u003cspan class=\"hljs-title\"\u003eservice\u003c/span\u003e)\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// ....\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 销毁服务。\u003c/span\u003e\nbinder.unregister(consumer);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_proxy_creation\"\u003e\u003ca class=\"anchor\" href=\"#_proxy_creation\"\u003e\u003c/a\u003e代理创建\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e现在服务已经公开, 现在可以消费使用它。 为此，您必须创建一个代理。\n创建代理使用 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceProxyBuilder.html\"\u003eServiceProxyBuilder\u003c/a\u003e\u003c/code\u003e 类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServiceProxyBuilder builder = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ServiceProxyBuilder(vertx)\n  .setAddress(\u003cspan class=\"hljs-string\"\u003e\"database-service-address\"\u003c/span\u003e);\n\nSomeDatabaseService service = builder.build(SomeDatabaseService\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e)\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// 设置其他属性：\u003c/span\u003e\nSomeDatabaseService service2 = builder.setOptions(options)\n  .build(SomeDatabaseService\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e)\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e第二种构造通过 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/core/eventbus/DeliveryOptions.html\"\u003eDeliveryOptions\u003c/a\u003e\u003c/code\u003e 构造实例，\n您可以在其中配置属性（例如：超时）\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e或者,您也可以使用代理类。\n这个代理名称为 \u003cem\u003e服务接口\u003c/em\u003e 类目后追加 \u003ccode\u003eVertxEBProxy\u003c/code\u003e。\n例如, 如果您的 \u003cem\u003e服务接口\u003c/em\u003e 名为 \u003ccode\u003eSomeDatabaseService\u003c/code\u003e，那么代理类名为 \u003ccode\u003eSomeDatabaseServiceVertxEBProxy\u003c/code\u003e。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一般来说, \u003cem\u003e服务接口\u003c/em\u003e 包含 \u003ccode\u003ecreateProxy\u003c/code\u003e 静态方法用于创建代理。 但这不是必须的：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@ProxyGen\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n\n\u003cspan class=\"hljs-comment\"\u003e// 静态方法创建代理。\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e SomeDatabaseService \u003cspan class=\"hljs-title\"\u003ecreateProxy\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx, String address)\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SomeDatabaseServiceVertxEBProxy(vertx, address);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_error_handling\"\u003e\u003ca class=\"anchor\" href=\"#_error_handling\"\u003e\u003c/a\u003e错误处理\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务方法可能会通过向方法的处理器（Handler）传递一个失败状态的 Future （包含一个 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceException.html\"\u003eServiceException\u003c/a\u003e\u003c/code\u003e 实例。\n一个 \u003ccode\u003eServiceException\u003c/code\u003e 包含 \u003ccode\u003eint\u003c/code\u003e 类型的错误码、消息,以及一个可选的\n \u003ccode\u003eJsonObject\u003c/code\u003e 对象用于传递额外信息。为了方便，\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/serviceproxy/ServiceException.html#fail-int-java.lang.String-\"\u003eServiceException.fail\u003c/a\u003e\u003c/code\u003e 工厂方法来创建一个已经是失败状态并且包装着\n\u003ccode\u003eServiceException\u003c/code\u003e 实例的失败 \u003ccode\u003eFuture\u003c/code\u003e 。例如：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e BAD_SHOE_SIZE = \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e;\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e CONNECTION_FAILED = \u003cspan class=\"hljs-number\"\u003e43\u003c/span\u003e;\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!shoeSize.equals(\u003cspan class=\"hljs-string\"\u003e\"9\"\u003c/span\u003e)) {\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(ServiceException.fail(BAD_SHOE_SIZE, \u003cspan class=\"hljs-string\"\u003e\"The shoe size must be 9!\"\u003c/span\u003e,\n       \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"shoeSize\"\u003c/span\u003e, shoeSize)));\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doDbConnection().recover(err -\u0026gt; Future.failedFuture(ServiceException.fail(CONNECTION_FAILED, result.cause().getMessage())));\n    }\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务调用端（客户端）可以检查它接收到的失败状态的 \u003ccode\u003eFuture\u003c/code\u003e 包含的 \u003ccode\u003eThrowable\u003c/code\u003e 对象是否为 \u003ccode\u003eServiceException\u003c/code\u003e 实例。\n如果是的话，继续检查内部的特定的错误状态码。\n调用端可以通过这些信息来将业务逻辑错误与系统错误（如服务没有被注册到事件总线上）区分开，\n以便确定到底发生了哪一种业务逻辑错误。下面是一个例子：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n server.createConnection(\u003cspan class=\"hljs-string\"\u003e\"8\"\u003c/span\u003e)\n   .compose(connection -\u0026gt; {\n     \u003cspan class=\"hljs-comment\"\u003e// 正常调用。\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doSuccessStuff(connection);\n   })\n   .recover(err -\u0026gt; {\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e ServiceException) {\n       ServiceException exc = (ServiceException) err;\n       \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exc.failureCode() == SomeDatabaseServiceImpl.BAD_SHOE_SIZE) {\n         \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n           \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e InvalidInputError(\u003cspan class=\"hljs-string\"\u003e\"You provided a bad shoe size: \"\u003c/span\u003e +\n             exc.getDebugInfo().getString(\u003cspan class=\"hljs-string\"\u003e\"shoeSize\"\u003c/span\u003e)));\n       } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exc.failureCode() == SomeDatabaseServiceImpl.CONNECTION) {\n         \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ConnectionError(\u003cspan class=\"hljs-string\"\u003e\"Failed to connect to the DB\"\u003c/span\u003e));\n       }\n     } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-comment\"\u003e// 必须是一个系统错误，如：服务代理没有对应的已注册的服务\u003c/span\u003e\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SystemError(\u003cspan class=\"hljs-string\"\u003e\"An unexpected error occurred: + \"\u003c/span\u003e result.cause().getMessage()));\n     }\n   });\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果需要的话, 服务实现的时候也可以返回 \u003ccode\u003eServiceException\u003c/code\u003e 子类,\n只要向事件总线注册了对应的默认 \u003ccode\u003eMessageCodec\u003c/code\u003e 就可以了。 例如, 比如给定下面的 \u003ccode\u003eServiceException\u003c/code\u003e 子类：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eShoeSizeException\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eServiceException\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e BAD_SHOE_SIZE_ERROR = \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e;\n\n \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e String shoeSize;\n\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eShoeSizeException\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(BAD_SHOE_SIZE_ERROR, \u003cspan class=\"hljs-string\"\u003e\"In invalid shoe size was received: \"\u003c/span\u003e + shoeSize);\n   \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.shoeSize = shoeSize;\n }\n\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e String \u003cspan class=\"hljs-title\"\u003egetShoeSize\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e extra;\n }\n\n \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u0026lt;T\u0026gt; \u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;T\u0026gt; \u003cspan class=\"hljs-title\"\u003efail\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e failureCode, String message, String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e MyServiceException(failureCode, message, shoeSize));\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e只要向事件总线注册了对应的 \u003ccode\u003eMessageCodec\u003c/code\u003e ，\n服务就可以直接向调用者返回自定义的异常类型：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseServiceImpl\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDatabaseService\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eSomeDataBaseServiceImpl\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Vertx vertx)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-comment\"\u003e// 注册服务，如果你是用事件总线使用本地模式，这就是全部\u003c/span\u003e\n   \u003cspan class=\"hljs-comment\"\u003e// 因为代理端和服务端共享一个vert.x实例\u003c/span\u003e\n SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n   vertx.eventBus().registerDefaultCodec(ShoeSizeException\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e,\n     \u003cspan class=\"hljs-title\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eShoeSizeExceptionMessageCodec\u003c/span\u003e())\u003c/span\u003e;\n }\n\n \u003cspan class=\"hljs-comment\"\u003e// 创建连接\u003c/span\u003e\n \u003cspan class=\"hljs-function\"\u003eFuture\u0026lt;MyDatabaseConnection\u0026gt; \u003cspan class=\"hljs-title\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n   \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!shoeSize.equals(\u003cspan class=\"hljs-string\"\u003e\"9\"\u003c/span\u003e)) {\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ShoeSizeException.fail(shoeSize);\n   } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n     \u003cspan class=\"hljs-comment\"\u003e// 此处创建连接\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(myDbConnection);\n   }\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e最后调用端可以检查自定义的异常类型了：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;JsonObject\u0026gt; \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String shoeSize)\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-comment\"\u003e// 如果运行在集群模式当中，代码在不同的节点运行，\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e// ShoeSizeExceptionMessageCodec 必须注册到\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e// 该节点的Vertx当中\u003c/span\u003e\n SomeDatabaseService service = SomeDatabaseService.createProxy(vertx, SERVICE_ADDRESS);\n service.createConnection(\u003cspan class=\"hljs-string\"\u003e\"8\"\u003c/span\u003e)\n   .compose(connection -\u0026gt; {\n     \u003cspan class=\"hljs-comment\"\u003e// 成功调用。\u003c/span\u003e\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e doSuccessStuff(connection);\n   })\n   .recover(err -\u0026gt; {\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.cause() \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e ShoeSizeException) {\n       ShoeSizeException exc = (ShoeSizeException) result.cause();\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n         \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e InvalidInputError(\u003cspan class=\"hljs-string\"\u003e\"You provided a bad shoe size: \"\u003c/span\u003e + exc.getShoeSize()));\n     } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n       \u003cspan class=\"hljs-comment\"\u003e// 必须是个系统错误 (例如：没有为服务代理进行注册)\u003c/span\u003e\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.failedFuture(\n         \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SystemError(\u003cspan class=\"hljs-string\"\u003e\"An unexpected error occurred: + \"\u003c/span\u003e result.cause().getMessage())\n       );\n     }\n   });\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e注意在 \u003ccode\u003eVertx\u003c/code\u003e 集群模式下，您需要向集群中每个节点的事件总线注册对应的自定义异常类型\n的 \u003ccode\u003eMessageCodec\u003c/code\u003e 实例\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_restrictions_for_service_interface\"\u003e\u003ca class=\"anchor\" href=\"#_restrictions_for_service_interface\"\u003e\u003c/a\u003e接口类型限制\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在服务中参数和返回值在类型上有一定的限制,因此可以方便在事件总线中进行转化。\n他们是：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_data_types\"\u003e\u003ca class=\"anchor\" href=\"#_data_types\"\u003e\u003c/a\u003e数据类型\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e 表示 \u003ccode\u003eJsonObject 或 JsonArray\u003c/code\u003e\n\u003ccode\u003ePRIMITIVE\u003c/code\u003e 表示任何原始类型或被自动拆装箱的原始类型\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e参数可以是以下任意一种：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePRIMITIVE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eMap\u0026lt;String, JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eMap\u0026lt;String, PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何 \u003cem\u003e枚举\u003c/em\u003e 类型\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何被打上 \u003ccode\u003e@DataObject\u003c/code\u003e 注解的实体类\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e异步结果可建模为\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eFuture\u0026lt;R\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e用于回调样式的 \u003ccode\u003eHandler\u0026lt;AsyncResult\u0026lt;R\u0026gt;\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003eR\u003c/code\u003e 的类型可以是：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eJSON\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePRIMITIVE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eList\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;JSON\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eSet\u0026lt;PRIMITIVE\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何 \u003cem\u003e枚举\u003c/em\u003e 类型\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任何打上 \u003ccode\u003e@DataObject\u003c/code\u003e 注解的类（需符合上文的代码篇章要求）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e另一个代理类\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_overloaded_methods\"\u003e\u003ca class=\"anchor\" href=\"#_overloaded_methods\"\u003e\u003c/a\u003e重载方法\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务接口不支持任何的重载(即方法名称相同，但参数列表不同)服务方法。。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e\u003ca class=\"anchor\" href=\"#_convention_for_invoking_services_over_the_event_bus_without_proxies\"\u003e\u003c/a\u003e通过事件总线调用服务的规则 (不使用服务代理)\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e服务代理假定事件总线中的消息遵循一定的格式，因此能被用于服务的调用\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e当然，如果不愿意的话，您也可以 \u003cstrong\u003e不用\u003c/strong\u003e 服务代理类来访问远程服务。\n被广泛接受的与服务交互的方式就是直接在事件总线发送消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了使服务访问的方式一致，\n所有的服务都必须遵循以下的消息格式。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e格式非常简单：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e需要有一个名为 \u003ccode\u003eaction\u003c/code\u003e 的 消息头(header)，作为要执行操作的名称。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e消息体（message body）应该是一个 \u003ccode\u003eJsonObject\u003c/code\u003e 对象，里面需要包含操作需要的所有参数。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e举个例子，假如我们要去执行一个名为 \u003ccode\u003esave\u003c/code\u003e 的操作，此操作接受一个字符串类型的 collection 和 JsonObject 类型 document：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre\u003eHeaders:\n   \"action\": \"save\"\nBody:\n   {\n       \"collection\", \"mycollection\",\n       \"document\", {\n           \"name\": \"tim\"\n       }\n   }\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e无论有没有用到服务代理来创建服务，都应该用上面这种方式编写服务，\n因为这样允许服务交互时保持一致性。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在上面的例子中，\"action\" 对应的值应该与服务接口的某个方法名称相对应，\n而消息体中每个 \u003ccode\u003e[key, value]\u003c/code\u003e 都要与服务方法中的某个 \u003ccode\u003e[arg_name, arg_value]\u003c/code\u003e 相对应\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e对于返回值，服务需使用 \u003ccode\u003emessage.reply(\u0026#8230;\u0026#8203;)\u003c/code\u003e 方法去向调用端发送回一个返回值 - 这个值可以是事件总线支持的任何类型。\n如果需要表示调用失败，可以调用 \u003ccode\u003emessage.fail(\u0026#8230;\u0026#8203;)\u003c/code\u003e 方法。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您使用 Vert.x 服务代理组件的话，生成的代码会自动帮您处理这些问题。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["vertx-service-proxy","java"]},"buildId":"4tgS-biC6RDn0AIqdVpla","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7689a0583e30048c05ff.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-3a425d1828d3af7aa498.js" async=""></script><script src="/_next/static/4tgS-biC6RDn0AIqdVpla/_buildManifest.js" async=""></script><script src="/_next/static/4tgS-biC6RDn0AIqdVpla/_ssgManifest.js" async=""></script></body></html>