<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>gRPC | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-grpc" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.f20dca63.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.f20dca63.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.dd672925a2e24782fa8b.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.9018d0edef70f2f225a9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-a029dc5d19ec928c6924.js" as="script"/></head><body><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_grpc_types">gRPC类型</a></li>
<li><a href="#_a_simple_hello_world">一个简单的 Hello World</a>
<ul class="sectlevel2">
<li><a href="#_compile_the_rpc_definition">编译RPC的定义</a></li>
<li><a href="#_grpc_server">gRPC 服务</a></li>
<li><a href="#_grpc_client">gRPC 客户端</a></li>
</ul>
</li>
<li><a href="#_advanced_configuration">高级配置</a></li>
<li><a href="#_native_transports">本地传输</a></li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/vert-x3/vertx-grpc"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-examples"><a href="https://github.com/vert-x3/vertx-examples/tree/4.x/grpc-examples"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Examples</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-grpc/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.0.3<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-grpc/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.0.3<!-- -->)</li></a><a href="/docs/3.9.6/vertx-grpc/java/"><li class="dropdown-item has-active-siblings">v<!-- -->3.9.6</li></a></ul></div></span></div></div><div><h1>Vert.x gRPC</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>可以在维基百科看到对gRPC全面的介绍</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gRPC是一个由谷歌开发的开源远程方法调用（RPC）系统。
它用HTTP/2作为传输协议，以协议Buffer作为接口描述语言，
它提供一些特性，例如认证、双向streaming和flow的控制，
阻塞或非阻塞绑定，和撤销、超时操作。
它为很多语言生成跨平台客户端和服务端。</pre>
</div>
</div>
<div class="paragraph">
<p>Vert.x gRPC是一个将谷歌风格gRPC编程风格对应到Vert.x风格的模块。作为这个模块的用户，
您会更加习惯于用Vert.x Streams和Futures的编码风格从而体验到
gRPC的好处。</p>
</div>
<div class="paragraph">
<p>更多关于gRPC的信息请查看官方文档 <a href="http://www.grpc.io/" class="bare">http://www.grpc.io/</a> 。</p>
</div>
<div class="paragraph">
<p>Vert.x gRPC 额外支持：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用Verticle横向扩展gRPC服务</p>
</li>
<li>
<p>非阻塞的本地传输</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grpc_types"><a class="anchor" href="#_grpc_types"></a>gRPC类型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>用gRPC，您将受益于HTTP/2协议，这意味着您会获得异步流的支持，
同时您的远程方法调用会有如下特性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>客户端发出stream请求，服务端响应单个对象</p>
</li>
<li>
<p>客户端发出stream请求，服务端响应stream</p>
</li>
<li>
<p>客户端发送单个对象请求，服务端响应单个对象</p>
</li>
<li>
<p>客户端发送单个对象请求，服务端响应stream</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>尽管对于非专业认识来讲，这也许看起来和其他基于HTTP协议实现的RPC没有区别，但您需要注意一点，
那就是在HTTP/2协议下，在响应到达之前您的请求不必完成。这意味着
您的通信通道是全双工的。全双工允可以减小响应延迟并且增强应用的响应能力。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_simple_hello_world"><a class="anchor" href="#_a_simple_hello_world"></a>一个简单的 Hello World</h2>
<div class="sectionbody">
<div class="paragraph">
<p>为了开始您的第一个Hello World示例，您需要定义协议。gRPC要求
用 <code>protobuffer</code> 格式来定义协议。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-proto" data-lang="proto">syntax = "proto3";

option java_multiple_files = true;
option java_package = "examples";
option java_outer_classname = "HelloWorldProto";
package helloworld;

// 服务定义。
service Greeter {
 // 发送请求
 rpc SayHello (HelloRequest) returns (HelloReply) {}
}

// 包含用户名字的请求消息
message HelloRequest {
 string name = 1;
}

// 包含请求信息的响应消息
message HelloReply {
 string message = 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个非常普通的示例，用来展示单次请求单次响应。</p>
</div>
<div class="sect2">
<h3 id="_compile_the_rpc_definition"><a class="anchor" href="#_compile_the_rpc_definition"></a>编译RPC的定义</h3>
<div class="paragraph">
<p>要用前述的定义，那么我们需要将其编译。</p>
</div>
<div class="paragraph">
<p>如果您 <a href="https://github.com/google/protobuf/tree/master/java#installation---without-maven">喜欢</a> ，您可以用 <code>protoc</code> 编译器来编译原始文件，您也可以添加如下依赖：</p>
</div>
<div class="paragraph">
<p>如果您用Apache Maven，您需要添加如下插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>protobuf-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.6.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:3.2.0:exe:${os.detected.classifier}<span class="hljs-tag">&lt;/<span class="hljs-name">protocArtifact</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">pluginId</span>&gt;</span>grpc-java<span class="hljs-tag">&lt;/<span class="hljs-name">pluginId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">pluginArtifact</span>&gt;</span>io.grpc:protoc-gen-grpc-java:${vertx.grpc.version}:exe:${os.detected.classifier}<span class="hljs-tag">&lt;/<span class="hljs-name">pluginArtifact</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">protocPlugins</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">protocPlugin</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${stack.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>io.vertx.grpc.protoc.plugin.VertxGrpcGenerator<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">protocPlugin</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">protocPlugins</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.basedir}/src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">clearOutputDirectory</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">clearOutputDirectory</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>compile-custom<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>test-compile<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>test-compile<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>test-compile-custom<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>${os.detected.classifier}</code> 属性在构建时用来区分操作系统，在苹果系统（OSX）中，
需要替换为 <em>osx-x86_64</em> ，其他同理。要使用它，您需要在 <code>pom.xml</code> 文件中添加 <a href="https://github.com/trustin/os-maven-plugin">os-maven-plugin</a>
插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
 ...
 <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">extension</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>kr.motd.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>os-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">extension</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>
 ...
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个插件会编译 <code>src/main/proto</code> 目录下的原始文件，并且使其对您的项目可用。</p>
</div>
<div class="paragraph">
<p>如果您正在用Gradle，那么您需要加入如下依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">...
apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'com.google.protobuf'</span>
...
buildscript {
 ...
 dependencies {
   <span class="hljs-comment">// ASSUMES GRADLE 2.12 OR HIGHER. Use plugin version 0.7.5 with earlier gradle versions</span>
   classpath <span class="hljs-string">'com.google.protobuf:protobuf-gradle-plugin:0.8.0'</span>
 }
}
...
protobuf {
 protoc {
   artifact = <span class="hljs-string">'com.google.protobuf:protoc:3.2.0'</span>
 }
 plugins {
   grpc {
     artifact = <span class="hljs-string">"io.grpc:protoc-gen-grpc-java:1.25.0"</span>
   }
   vertx {
     artifact = <span class="hljs-string">"io.vertx:vertx-grpc-protoc-plugin:${vertx.grpc.version}"</span>
   }
 }
 generateProtoTasks {
   all()*.plugins {
     grpc
     vertx
   }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个插件会编译 <code>build/generated/source/proto/main</code> 目录下的原始文件，然后使其对项目可用。</p>
</div>
</div>
<div class="sect2">
<h3 id="_grpc_server"><a class="anchor" href="#_grpc_server"></a>gRPC 服务</h3>
<div class="paragraph">
<p>您已经拥有您的RPC基础代码，现在该实现您自己的服务器了。由前述可知，
我们的服务需要实现 <code>sayHello</code> 方法，该方法接收 <code>HelloRequest</code> 对象，然后返回
一个 <code>HelloReply</code> 对象，所以 您可以像如下实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GreeterGrpc.GreeterImplBase service = <span class="hljs-keyword">new</span> GreeterGrpc.GreeterImplBase() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(
    HelloRequest request,
    StreamObserver&lt;HelloReply&gt; responseObserver)</span> </span>{

    responseObserver.onNext(
      HelloReply.newBuilder()
        .setMessage(request.getName())
        .build());
    responseObserver.onCompleted();
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您愿意，您可以让它在服务上可用。Vert.x使服务的创建变得很简单，
您只需要添加如下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">VertxServer rpcServer = VertxServerBuilder
  .forAddress(vertx, <span class="hljs-string">"my.host"</span>, <span class="hljs-number">8080</span>)
  .addService(service)
  .build();

<span class="hljs-comment">// 异步启动</span>
rpcServer.start();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_using_vert_x_future_and_streams"><a class="anchor" href="#_using_vert_x_future_and_streams"></a>使用Vert.x future和streams</h4>
<div class="paragraph">
<p>前述示例通过gRPC异步架构（ 例如 <code>io.grpc.stub.StreamObserver</code> ）进行异步处理的方式来使用gRPC服务。
这些代码由 protoc 编译器生成。</p>
</div>
<div class="paragraph">
<p>上述插件的配置作用于以下插件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">protocPlugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${stack.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>io.vertx.grpc.protoc.plugin.VertxGrpcGenerator<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">protocPlugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>它用Vert.x的异步架构（ 例如 <code>Future</code> 或 <code>ReadStream</code> 或 <code>WriteStream</code> ）生成服务版本，这样在Vert.x生态中更加方便。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">VertxGreeterGrpc.GreeterVertxImplBase service =
  <span class="hljs-keyword">new</span> VertxGreeterGrpc.GreeterVertxImplBase() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;HelloReply&gt; <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request)</span> </span>{
      <span class="hljs-keyword">return</span> Future.succeededFuture(
        HelloReply.newBuilder()
          .setMessage(request.getName())
          .build());
    }
  };</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_gzip_compression"><a class="anchor" href="#_server_gzip_compression"></a>服务 gzip 压缩</h4>
<div class="paragraph">
<p>您可以启用gzip压缩来告诉服务端来返回压缩的响应
（服务器会自动处理压缩过的请求）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">VertxGreeterGrpc.GreeterVertxImplBase service =
  <span class="hljs-keyword">new</span> VertxGreeterGrpc.GreeterVertxImplBase() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;HelloReply&gt; <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request)</span> </span>{
      <span class="hljs-keyword">return</span> Future.succeededFuture(
        HelloReply.newBuilder()
          .setMessage(request.getName())
          .build());
    }
  }
    .withCompression(<span class="hljs-string">"gzip"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>withCompression</code> 配置是由Vert.x gRPC protoc 插件生成。
您也可以在默认服务上启用压缩功能
（将 <code>ResponseObserver</code> 转换成 <code>ServerCallStreamObserver</code> 并在响应之前调用 <code>setCompression</code> ）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GreeterGrpc.GreeterImplBase service = <span class="hljs-keyword">new</span> GreeterGrpc.GreeterImplBase() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(
    HelloRequest request,
    StreamObserver&lt;HelloReply&gt; responseObserver)</span> </span>{

    ((ServerCallStreamObserver) responseObserver)
      .setCompression(<span class="hljs-string">"gzip"</span>);

    responseObserver.onNext(
      HelloReply.newBuilder()
        .setMessage(request.getName())
        .build());

    responseObserver.onCompleted();
  }
};</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
只要服务端支持，您可以使用任何其他的压缩器，在构建 <code>ManagedChannel</code> 时注册它们。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_configuration"><a class="anchor" href="#_ssl_configuration"></a>SSL 配置</h4>
<div class="paragraph">
<p>前一个例子很简单，但您的RPC并不安全。为了让RPC更安全，我们应该启用SSL/TLS：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">VertxServerBuilder builder = VertxServerBuilder.forPort(vertx, <span class="hljs-number">8080</span>)
  .useSsl(options -&gt; options
    .setSsl(<span class="hljs-keyword">true</span>)
    .setUseAlpn(<span class="hljs-keyword">true</span>)
    .setKeyStoreOptions(<span class="hljs-keyword">new</span> JksOptions()
      .setPath(<span class="hljs-string">"server-keystore.jks"</span>)
      .setPassword(<span class="hljs-string">"secret"</span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>恭喜您拥有了第一个gRPC服务。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content">
因为gRPC用HTTP/2作为传输协议，SSL/TLS服务的启用必须拥有 <a href="https://wikipedia.org/wiki/Application-Layer_Protocol_Negotiation">Application-Layer Protocol Negotiation</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_server_scaling"><a class="anchor" href="#_server_scaling"></a>服务横向扩展</h4>
<div class="paragraph">
<p>如果你将一个Verticle部署了多个实例，gRPC服务将
在verticle event-loops上横向扩展。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">vertx.deployVerticle(

  <span class="hljs-comment">// Verticle supplier - 被调用了4次</span>
  () -&gt; <span class="hljs-keyword">new</span> AbstractVerticle() {

    BindableService service = <span class="hljs-keyword">new</span> GreeterGrpc.GreeterImplBase() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(
        HelloRequest request,
        StreamObserver&lt;HelloReply&gt; responseObserver)</span> </span>{

        responseObserver.onNext(
          HelloReply.newBuilder()
            .setMessage(request.getName())
            .build());

        responseObserver.onCompleted();
      }
    };

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
      VertxServerBuilder
        .forAddress(vertx, <span class="hljs-string">"my.host"</span>, <span class="hljs-number">8080</span>)
        .addService(service)
        .build()
        .start();
    }
  },

  <span class="hljs-comment">// 部署4个实例，即服务以4个eventloop的形式做了横向扩展。</span>
  <span class="hljs-keyword">new</span> DeploymentOptions()
    .setInstances(<span class="hljs-number">4</span>));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blockingserverinterceptor"><a class="anchor" href="#_blockingserverinterceptor"></a>BlockingServerInterceptor</h4>
<div class="paragraph">
<p>gRPC <a href="https://grpc.io/grpc-java/javadoc/io/grpc/ServerInterceptor.html">ServerInterceptor</a> 是一个机制，
该机制在向服务端发起请求之前拦截该方法调用。
它有着同步的行为并且在Vert.x event loop上执行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">VertxServer rpcServer = VertxServerBuilder
  .forAddress(vertx, <span class="hljs-string">"my.host"</span>, <span class="hljs-number">8080</span>)
  .addService(ServerInterceptors.intercept(service, myInterceptor))
  .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>假设我们有一个拦截器，它阻塞了eventloop：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServerInterceptor</span> </span>{
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> &lt;Q, A&gt; ServerCall.<span class="hljs-function">Listener&lt;Q&gt; <span class="hljs-title">interceptCall</span><span class="hljs-params">(
    ServerCall&lt;Q, A&gt; call, Metadata headers, ServerCallHandler&lt;Q, A&gt; next)</span> </span>{
    <span class="hljs-comment">// 例如做一些复杂操作并更新元数据。</span>
    <span class="hljs-keyword">return</span> next.startCall(call, headers);
  }
}
MyInterceptor myInterceptor = <span class="hljs-keyword">new</span> MyInterceptor();</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了避免阻塞，您应该包装这个拦截器，让它在Vert.x的worker线程上执行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ServerInterceptor wrapped =
  BlockingServerInterceptor.wrap(vertx, myInterceptor);

<span class="hljs-comment">// 创建服务</span>
VertxServer rpcServer = VertxServerBuilder
  .forAddress(vertx, <span class="hljs-string">"my.host"</span>, <span class="hljs-number">8080</span>)
  .addService(ServerInterceptors.intercept(service, wrapped))
  .build();

<span class="hljs-comment">// 开启</span>
rpcServer.start();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_context_server_interceptor"><a class="anchor" href="#_context_server_interceptor"></a>Context Server Interceptor</h4>
<div class="paragraph">
<p>一个 abstract context server interceptor 允许拦截向服务发起的请求并提取元数据
到Vert.x context。这个Context不依赖于thread locals，所以使用Vert.x API是安全的。
这个拦截器应该在首位（或者首先添加到拦截器列表的其中之一）</p>
</div>
<div class="paragraph">
<p>session id 则是一个典型的用法。一个客户端可以创建客户端拦截器并向所有连接设置一个session id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Metadata extraHeaders = <span class="hljs-keyword">new</span> Metadata();
extraHeaders.put(
  Metadata.Key.of(<span class="hljs-string">"sessionId"</span>, Metadata.ASCII_STRING_MARSHALLER), theSessionId);

ClientInterceptor clientInterceptor = MetadataUtils
  .newAttachHeadersInterceptor(extraHeaders);

channel = VertxChannelBuilder.forAddress(vertx, <span class="hljs-string">"localhost"</span>, port)
  .intercept(clientInterceptor)
  .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在服务端一侧，可以像如下添加拦截器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">BindableService service = <span class="hljs-keyword">new</span> VertxGreeterGrpc.GreeterVertxImplBase() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;HelloReply&gt; <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request)</span> </span>{
    <span class="hljs-keyword">return</span> Future.succeededFuture(
      HelloReply.newBuilder().setMessage(<span class="hljs-string">"Hello "</span> + request.getName()).build());
  }
};

ServerInterceptor contextInterceptor = <span class="hljs-keyword">new</span> ContextServerInterceptor() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">(Metadata metadata, ConcurrentMap&lt;String, String&gt; context)</span> </span>{
    context.put(<span class="hljs-string">"sessionId"</span>, metadata.get(SESSION_ID_METADATA_KEY));
  }
};

<span class="hljs-comment">// 创建服务</span>
VertxServer rpcServer = VertxServerBuilder
  .forAddress(vertx, <span class="hljs-string">"my.host"</span>, <span class="hljs-number">8080</span>)
  .addService(ServerInterceptors.intercept(service, contextInterceptor))
  .build();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grpc_client"><a class="anchor" href="#_grpc_client"></a>gRPC 客户端</h3>
<div class="paragraph">
<p>没有客户端的服务端是没用的，所以我们创建一个客户端。创建客户端和创建服务端的步骤有重叠。
首先我们需要预先有一个RPC的定义，否则就不会有服务端，然后这个相同的定义会被编译。</p>
</div>
<div class="paragraph">
<p>请注意：编译器即生成基本服务也会生成客户端存根，所以如果您已经编译了一次，那么您就无需再次编译。</p>
</div>
<div class="paragraph">
<p>每一个客户端存根都必须有一个服务端通信channel相对应，
所以首先我们需要创建一个gRPC channel：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ManagedChannel channel = VertxChannelBuilder
  .forAddress(vertx, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">8080</span>)
  .usePlaintext()
  .build();

<span class="hljs-comment">// 获取一个存根来与远程服务交互</span>
GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦存根生成，我们可以和服务端进行交互，此时这会更加简单，因为存根已经提供了
正确的方法定义和正确的参数类型定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HelloRequest request = HelloRequest.newBuilder().setName(<span class="hljs-string">"Julien"</span>).build();

<span class="hljs-comment">// 调用远程服务</span>
stub.sayHello(request, <span class="hljs-keyword">new</span> StreamObserver&lt;HelloReply&gt;() {
  <span class="hljs-keyword">private</span> HelloReply helloReply;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNext</span><span class="hljs-params">(HelloReply helloReply)</span> </span>{
    <span class="hljs-keyword">this</span>.helloReply = helloReply;
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(Throwable throwable)</span> </span>{
    System.out.println(<span class="hljs-string">"Coult not reach server "</span> + throwable.getMessage());
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompleted</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">"Got the server response: "</span> + helloReply.getMessage());
  }
});</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_using_vert_x_future_and_streams_2"><a class="anchor" href="#_using_vert_x_future_and_streams_2"></a>使用 Vert.x 的 future 和 streams</h4>
<div class="paragraph">
<p>前述示例用一个gRPC客户端基于gRPC异步架构（例如 <code>io.grpc.stub.StreamObserver</code> ）来执行异步操作。
代码是由 protoc 编译器生成的。</p>
</div>
<div class="paragraph">
<p>上述配置作用于下列插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">protocPlugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-grpc-protoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${stack.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>io.vertx.grpc.protoc.plugin.VertxGrpcGenerator<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">protocPlugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>它用Vert.x的异步架构（ 例如 <code>Future</code> 或 <code>ReadStream</code> 或 <code>WriteStream</code> ）生成客户端版本，这样在Vert.x生态中更加方便。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HelloRequest request = HelloRequest.newBuilder().setName(<span class="hljs-string">"Julien"</span>).build();

<span class="hljs-comment">// Call the remote service</span>
Future&lt;HelloReply&gt; future = stub.sayHello(request);

<span class="hljs-comment">// Listen to completion events</span>
future
  .onSuccess(helloReply -&gt; System.out.println(<span class="hljs-string">"Got the server response: "</span> + helloReply.getMessage())).onFailure(err -&gt; System.out.println(<span class="hljs-string">"Coult not reach server "</span> + err));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_gzip_compression"><a class="anchor" href="#_client_gzip_compression"></a>客户端gzip压缩</h4>
<div class="paragraph">
<p>您可以启用gzip压缩来让客户端发送压缩消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GreeterGrpc.GreeterStub stub = GreeterGrpc
  .newStub(channel)
  .withCompression(<span class="hljs-string">"gzip"</span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
只要客户端支持，您可以使用任何其他的压缩器，他们在构建 <code>ManagedChannel</code> 时被注册。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_configuration_2"><a class="anchor" href="#_ssl_configuration_2"></a>SSL 配置</h4>
<div class="paragraph">
<p>如果您先前启用了SSL，那么您的客户端也必须用SSL，我们需要像如下配置channel：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ManagedChannel channel = VertxChannelBuilder.
  forAddress(vertx, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">8080</span>)
  .useSsl(options -&gt; options
    .setSsl(<span class="hljs-keyword">true</span>)
    .setUseAlpn(<span class="hljs-keyword">true</span>)
    .setTrustStoreOptions(<span class="hljs-keyword">new</span> JksOptions()
      .setPath(<span class="hljs-string">"client-truststore.jks"</span>)
      .setPassword(<span class="hljs-string">"secret"</span>)))
  .build();</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content">
因为gRPC用了 HTTP/2 作为传输协议，客户端SSL/TLS的启用必须有 <a href="https://wikipedia.org/wiki/Application-Layer_Protocol_Negotiation">Application-Layer Protocol Negotiation</a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_configuration"><a class="anchor" href="#_advanced_configuration"></a>高级配置</h2>
<div class="sectionbody">
<div class="paragraph">
<p>直到现在，所有的gRPC示例都使用标准的默认配置，但是还有更多的配置项。如果您需要完整控制服务端的配置，
那么您应该查阅文档： <code><a href="../../apidocs/io/vertx/grpc/VertxServerBuilder.html">VertxServerBuilder</a></code> ，
如果您需要控制客户端channel，则查阅 <code><a href="../../apidocs/io/vertx/grpc/VertxChannelBuilder.html">VertxChannelBuilder</a></code> 。 Vert.x gRPC继承了 grpc-java 项目（Netty传输），因此建议阅读其 <a href="http://www.grpc.io/grpc-java/javadoc/">文档</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_transports"><a class="anchor" href="#_native_transports"></a>本地传输</h2>
<div class="sectionbody">
<div class="paragraph">
<p>客户端和服务端可以用Netty的本地传输来部署，这是在创建Vert.x实例时实现的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Vertx.vertx(<span class="hljs-keyword">new</span> VertxOptions().setPreferNativeTransport(<span class="hljs-keyword">true</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>了解更多本地传输的信息，请查阅 Vert.x Core 文档。</p>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">联系渠道</a></li><li><a href="https://how-to.vertx.io/">操作指南</a></li><li><a href="https://start.vertx.io/">应用生成器</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse 基金会</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">隐私政策</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">使用条款</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">版权代理</a></li><li><a href="https://www.eclipse.org/legal/">法律资源</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x<br/>Eclipse Vert.x 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>协议下获得了双重许可。<br class="footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a> 设计。</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.0.0/vertx-grpc/java","title":"Vert.x gRPC","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_grpc_types\"\u003egRPC类型\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_a_simple_hello_world\"\u003e一个简单的 Hello World\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_compile_the_rpc_definition\"\u003e编译RPC的定义\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_grpc_server\"\u003egRPC 服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_grpc_client\"\u003egRPC 客户端\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_advanced_configuration\"\u003e高级配置\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_native_transports\"\u003e本地传输\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eVert.x gRPC\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e可以在维基百科看到对gRPC全面的介绍\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre\u003egRPC是一个由谷歌开发的开源远程方法调用（RPC）系统。\n它用HTTP/2作为传输协议，以协议Buffer作为接口描述语言，\n它提供一些特性，例如认证、双向streaming和flow的控制，\n阻塞或非阻塞绑定，和撤销、超时操作。\n它为很多语言生成跨平台客户端和服务端。\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x gRPC是一个将谷歌风格gRPC编程风格对应到Vert.x风格的模块。作为这个模块的用户，\n您会更加习惯于用Vert.x Streams和Futures的编码风格从而体验到\ngRPC的好处。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e更多关于gRPC的信息请查看官方文档 \u003ca href=\"http://www.grpc.io/\" class=\"bare\"\u003ehttp://www.grpc.io/\u003c/a\u003e 。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eVert.x gRPC 额外支持：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e用Verticle横向扩展gRPC服务\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e非阻塞的本地传输\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_grpc_types\"\u003e\u003ca class=\"anchor\" href=\"#_grpc_types\"\u003e\u003c/a\u003egRPC类型\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e用gRPC，您将受益于HTTP/2协议，这意味着您会获得异步流的支持，\n同时您的远程方法调用会有如下特性：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e客户端发出stream请求，服务端响应单个对象\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e客户端发出stream请求，服务端响应stream\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e客户端发送单个对象请求，服务端响应单个对象\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e客户端发送单个对象请求，服务端响应stream\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e尽管对于非专业认识来讲，这也许看起来和其他基于HTTP协议实现的RPC没有区别，但您需要注意一点，\n那就是在HTTP/2协议下，在响应到达之前您的请求不必完成。这意味着\n您的通信通道是全双工的。全双工允可以减小响应延迟并且增强应用的响应能力。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_a_simple_hello_world\"\u003e\u003ca class=\"anchor\" href=\"#_a_simple_hello_world\"\u003e\u003c/a\u003e一个简单的 Hello World\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了开始您的第一个Hello World示例，您需要定义协议。gRPC要求\n用 \u003ccode\u003eprotobuffer\u003c/code\u003e 格式来定义协议。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-proto\" data-lang=\"proto\"\u003esyntax = \"proto3\";\n\noption java_multiple_files = true;\noption java_package = \"examples\";\noption java_outer_classname = \"HelloWorldProto\";\npackage helloworld;\n\n// 服务定义。\nservice Greeter {\n // 发送请求\n rpc SayHello (HelloRequest) returns (HelloReply) {}\n}\n\n// 包含用户名字的请求消息\nmessage HelloRequest {\n string name = 1;\n}\n\n// 包含请求信息的响应消息\nmessage HelloReply {\n string message = 1;\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这是一个非常普通的示例，用来展示单次请求单次响应。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_compile_the_rpc_definition\"\u003e\u003ca class=\"anchor\" href=\"#_compile_the_rpc_definition\"\u003e\u003c/a\u003e编译RPC的定义\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e要用前述的定义，那么我们需要将其编译。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您 \u003ca href=\"https://github.com/google/protobuf/tree/master/java#installation---without-maven\"\u003e喜欢\u003c/a\u003e ，您可以用 \u003ccode\u003eprotoc\u003c/code\u003e 编译器来编译原始文件，您也可以添加如下依赖：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您用Apache Maven，您需要添加如下插件：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.xolstice.maven.plugins\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eprotobuf-maven-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e0.6.1\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eprotocArtifact\u003c/span\u003e\u0026gt;\u003c/span\u003ecom.google.protobuf:protoc:3.2.0:exe:${os.detected.classifier}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eprotocArtifact\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003epluginId\u003c/span\u003e\u0026gt;\u003c/span\u003egrpc-java\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003epluginId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003epluginArtifact\u003c/span\u003e\u0026gt;\u003c/span\u003eio.grpc:protoc-gen-grpc-java:${vertx.grpc.version}:exe:${os.detected.classifier}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003epluginArtifact\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eprotocPlugins\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e${stack.version}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx.grpc.protoc.plugin.VertxGrpcGenerator\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eprotocPlugins\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexecutions\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexecution\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003ecompile\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoutputDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003e${project.basedir}/src/main/java\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoutputDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eclearOutputDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003efalse\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eclearOutputDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoals\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003ecompile\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003ecompile-custom\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoals\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexecution\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexecution\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003etest-compile\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoals\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003etest-compile\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003etest-compile-custom\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoal\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egoals\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexecution\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexecutions\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e${os.detected.classifier}\u003c/code\u003e 属性在构建时用来区分操作系统，在苹果系统（OSX）中，\n需要替换为 \u003cem\u003eosx-x86_64\u003c/em\u003e ，其他同理。要使用它，您需要在 \u003ccode\u003epom.xml\u003c/code\u003e 文件中添加 \u003ca href=\"https://github.com/trustin/os-maven-plugin\"\u003eos-maven-plugin\u003c/a\u003e\n插件：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebuild\u003c/span\u003e\u0026gt;\u003c/span\u003e\n ...\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eextensions\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eextension\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003ekr.motd.maven\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eos-maven-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e1.4.1.Final\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eextension\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eextensions\u003c/span\u003e\u0026gt;\u003c/span\u003e\n ...\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebuild\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个插件会编译 \u003ccode\u003esrc/main/proto\u003c/code\u003e 目录下的原始文件，并且使其对您的项目可用。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您正在用Gradle，那么您需要加入如下依赖：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003e...\napply \u003cspan class=\"hljs-string\"\u003eplugin:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'com.google.protobuf'\u003c/span\u003e\n...\nbuildscript {\n ...\n dependencies {\n   \u003cspan class=\"hljs-comment\"\u003e// ASSUMES GRADLE 2.12 OR HIGHER. Use plugin version 0.7.5 with earlier gradle versions\u003c/span\u003e\n   classpath \u003cspan class=\"hljs-string\"\u003e'com.google.protobuf:protobuf-gradle-plugin:0.8.0'\u003c/span\u003e\n }\n}\n...\nprotobuf {\n protoc {\n   artifact = \u003cspan class=\"hljs-string\"\u003e'com.google.protobuf:protoc:3.2.0'\u003c/span\u003e\n }\n plugins {\n   grpc {\n     artifact = \u003cspan class=\"hljs-string\"\u003e\"io.grpc:protoc-gen-grpc-java:1.25.0\"\u003c/span\u003e\n   }\n   vertx {\n     artifact = \u003cspan class=\"hljs-string\"\u003e\"io.vertx:vertx-grpc-protoc-plugin:${vertx.grpc.version}\"\u003c/span\u003e\n   }\n }\n generateProtoTasks {\n   all()*.plugins {\n     grpc\n     vertx\n   }\n }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e这个插件会编译 \u003ccode\u003ebuild/generated/source/proto/main\u003c/code\u003e 目录下的原始文件，然后使其对项目可用。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_grpc_server\"\u003e\u003ca class=\"anchor\" href=\"#_grpc_server\"\u003e\u003c/a\u003egRPC 服务\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您已经拥有您的RPC基础代码，现在该实现您自己的服务器了。由前述可知，\n我们的服务需要实现 \u003ccode\u003esayHello\u003c/code\u003e 方法，该方法接收 \u003ccode\u003eHelloRequest\u003c/code\u003e 对象，然后返回\n一个 \u003ccode\u003eHelloReply\u003c/code\u003e 对象，所以 您可以像如下实现：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eGreeterGrpc.GreeterImplBase service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e GreeterGrpc.GreeterImplBase() {\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\n    HelloRequest request,\n    StreamObserver\u0026lt;HelloReply\u0026gt; responseObserver)\u003c/span\u003e \u003c/span\u003e{\n\n    responseObserver.onNext(\n      HelloReply.newBuilder()\n        .setMessage(request.getName())\n        .build());\n    responseObserver.onCompleted();\n  }\n};\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您愿意，您可以让它在服务上可用。Vert.x使服务的创建变得很简单，\n您只需要添加如下代码：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertxServer rpcServer = VertxServerBuilder\n  .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"my.host\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .addService(service)\n  .build();\n\n\u003cspan class=\"hljs-comment\"\u003e// 异步启动\u003c/span\u003e\nrpcServer.start();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_vert_x_future_and_streams\"\u003e\u003ca class=\"anchor\" href=\"#_using_vert_x_future_and_streams\"\u003e\u003c/a\u003e使用Vert.x future和streams\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e前述示例通过gRPC异步架构（ 例如 \u003ccode\u003eio.grpc.stub.StreamObserver\u003c/code\u003e ）进行异步处理的方式来使用gRPC服务。\n这些代码由 protoc 编译器生成。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e上述插件的配置作用于以下插件。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e${stack.version}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx.grpc.protoc.plugin.VertxGrpcGenerator\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e它用Vert.x的异步架构（ 例如 \u003ccode\u003eFuture\u003c/code\u003e 或 \u003ccode\u003eReadStream\u003c/code\u003e 或 \u003ccode\u003eWriteStream\u003c/code\u003e ）生成服务版本，这样在Vert.x生态中更加方便。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertxGreeterGrpc.GreeterVertxImplBase service =\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e VertxGreeterGrpc.GreeterVertxImplBase() {\n    \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;HelloReply\u0026gt; \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(HelloRequest request)\u003c/span\u003e \u003c/span\u003e{\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(\n        HelloReply.newBuilder()\n          .setMessage(request.getName())\n          .build());\n    }\n  };\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_server_gzip_compression\"\u003e\u003ca class=\"anchor\" href=\"#_server_gzip_compression\"\u003e\u003c/a\u003e服务 gzip 压缩\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以启用gzip压缩来告诉服务端来返回压缩的响应\n（服务器会自动处理压缩过的请求）\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertxGreeterGrpc.GreeterVertxImplBase service =\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e VertxGreeterGrpc.GreeterVertxImplBase() {\n    \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;HelloReply\u0026gt; \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(HelloRequest request)\u003c/span\u003e \u003c/span\u003e{\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(\n        HelloReply.newBuilder()\n          .setMessage(request.getName())\n          .build());\n    }\n  }\n    .withCompression(\u003cspan class=\"hljs-string\"\u003e\"gzip\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003ewithCompression\u003c/code\u003e 配置是由Vert.x gRPC protoc 插件生成。\n您也可以在默认服务上启用压缩功能\n（将 \u003ccode\u003eResponseObserver\u003c/code\u003e 转换成 \u003ccode\u003eServerCallStreamObserver\u003c/code\u003e 并在响应之前调用 \u003ccode\u003esetCompression\u003c/code\u003e ）\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eGreeterGrpc.GreeterImplBase service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e GreeterGrpc.GreeterImplBase() {\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\n    HelloRequest request,\n    StreamObserver\u0026lt;HelloReply\u0026gt; responseObserver)\u003c/span\u003e \u003c/span\u003e{\n\n    ((ServerCallStreamObserver) responseObserver)\n      .setCompression(\u003cspan class=\"hljs-string\"\u003e\"gzip\"\u003c/span\u003e);\n\n    responseObserver.onNext(\n      HelloReply.newBuilder()\n        .setMessage(request.getName())\n        .build());\n\n    responseObserver.onCompleted();\n  }\n};\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n只要服务端支持，您可以使用任何其他的压缩器，在构建 \u003ccode\u003eManagedChannel\u003c/code\u003e 时注册它们。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_ssl_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_ssl_configuration\"\u003e\u003c/a\u003eSSL 配置\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e前一个例子很简单，但您的RPC并不安全。为了让RPC更安全，我们应该启用SSL/TLS：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertxServerBuilder builder = VertxServerBuilder.forPort(vertx, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .useSsl(options -\u0026gt; options\n    .setSsl(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n    .setUseAlpn(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n    .setKeyStoreOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JksOptions()\n      .setPath(\u003cspan class=\"hljs-string\"\u003e\"server-keystore.jks\"\u003c/span\u003e)\n      .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e恭喜您拥有了第一个gRPC服务。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock important\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e重要\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n因为gRPC用HTTP/2作为传输协议，SSL/TLS服务的启用必须拥有 \u003ca href=\"https://wikipedia.org/wiki/Application-Layer_Protocol_Negotiation\"\u003eApplication-Layer Protocol Negotiation\u003c/a\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_server_scaling\"\u003e\u003ca class=\"anchor\" href=\"#_server_scaling\"\u003e\u003c/a\u003e服务横向扩展\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果你将一个Verticle部署了多个实例，gRPC服务将\n在verticle event-loops上横向扩展。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003evertx.deployVerticle(\n\n  \u003cspan class=\"hljs-comment\"\u003e// Verticle supplier - 被调用了4次\u003c/span\u003e\n  () -\u0026gt; \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e AbstractVerticle() {\n\n    BindableService service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e GreeterGrpc.GreeterImplBase() {\n      \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\n        HelloRequest request,\n        StreamObserver\u0026lt;HelloReply\u0026gt; responseObserver)\u003c/span\u003e \u003c/span\u003e{\n\n        responseObserver.onNext(\n          HelloReply.newBuilder()\n            .setMessage(request.getName())\n            .build());\n\n        responseObserver.onCompleted();\n      }\n    };\n\n    \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estart\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethrows\u003c/span\u003e Exception \u003c/span\u003e{\n      VertxServerBuilder\n        .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"my.host\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n        .addService(service)\n        .build()\n        .start();\n    }\n  },\n\n  \u003cspan class=\"hljs-comment\"\u003e// 部署4个实例，即服务以4个eventloop的形式做了横向扩展。\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e DeploymentOptions()\n    .setInstances(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_blockingserverinterceptor\"\u003e\u003ca class=\"anchor\" href=\"#_blockingserverinterceptor\"\u003e\u003c/a\u003eBlockingServerInterceptor\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003egRPC \u003ca href=\"https://grpc.io/grpc-java/javadoc/io/grpc/ServerInterceptor.html\"\u003eServerInterceptor\u003c/a\u003e 是一个机制，\n该机制在向服务端发起请求之前拦截该方法调用。\n它有着同步的行为并且在Vert.x event loop上执行。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertxServer rpcServer = VertxServerBuilder\n  .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"my.host\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .addService(ServerInterceptors.intercept(service, myInterceptor))\n  .build();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e假设我们有一个拦截器，它阻塞了eventloop：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eMyInterceptor\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eServerInterceptor\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u0026lt;Q, A\u0026gt; ServerCall.\u003cspan class=\"hljs-function\"\u003eListener\u0026lt;Q\u0026gt; \u003cspan class=\"hljs-title\"\u003einterceptCall\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\n    ServerCall\u0026lt;Q, A\u0026gt; call, Metadata headers, ServerCallHandler\u0026lt;Q, A\u0026gt; next)\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 例如做一些复杂操作并更新元数据。\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next.startCall(call, headers);\n  }\n}\nMyInterceptor myInterceptor = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e MyInterceptor();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e为了避免阻塞，您应该包装这个拦截器，让它在Vert.x的worker线程上执行。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eServerInterceptor wrapped =\n  BlockingServerInterceptor.wrap(vertx, myInterceptor);\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建服务\u003c/span\u003e\nVertxServer rpcServer = VertxServerBuilder\n  .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"my.host\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .addService(ServerInterceptors.intercept(service, wrapped))\n  .build();\n\n\u003cspan class=\"hljs-comment\"\u003e// 开启\u003c/span\u003e\nrpcServer.start();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_context_server_interceptor\"\u003e\u003ca class=\"anchor\" href=\"#_context_server_interceptor\"\u003e\u003c/a\u003eContext Server Interceptor\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一个 abstract context server interceptor 允许拦截向服务发起的请求并提取元数据\n到Vert.x context。这个Context不依赖于thread locals，所以使用Vert.x API是安全的。\n这个拦截器应该在首位（或者首先添加到拦截器列表的其中之一）\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003esession id 则是一个典型的用法。一个客户端可以创建客户端拦截器并向所有连接设置一个session id:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eMetadata extraHeaders = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Metadata();\nextraHeaders.put(\n  Metadata.Key.of(\u003cspan class=\"hljs-string\"\u003e\"sessionId\"\u003c/span\u003e, Metadata.ASCII_STRING_MARSHALLER), theSessionId);\n\nClientInterceptor clientInterceptor = MetadataUtils\n  .newAttachHeadersInterceptor(extraHeaders);\n\nchannel = VertxChannelBuilder.forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e, port)\n  .intercept(clientInterceptor)\n  .build();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e在服务端一侧，可以像如下添加拦截器：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eBindableService service = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e VertxGreeterGrpc.GreeterVertxImplBase() {\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Future\u0026lt;HelloReply\u0026gt; \u003cspan class=\"hljs-title\"\u003esayHello\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(HelloRequest request)\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(\n      HelloReply.newBuilder().setMessage(\u003cspan class=\"hljs-string\"\u003e\"Hello \"\u003c/span\u003e + request.getName()).build());\n  }\n};\n\nServerInterceptor contextInterceptor = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ContextServerInterceptor() {\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ebind\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Metadata metadata, ConcurrentMap\u0026lt;String, String\u0026gt; context)\u003c/span\u003e \u003c/span\u003e{\n    context.put(\u003cspan class=\"hljs-string\"\u003e\"sessionId\"\u003c/span\u003e, metadata.get(SESSION_ID_METADATA_KEY));\n  }\n};\n\n\u003cspan class=\"hljs-comment\"\u003e// 创建服务\u003c/span\u003e\nVertxServer rpcServer = VertxServerBuilder\n  .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"my.host\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .addService(ServerInterceptors.intercept(service, contextInterceptor))\n  .build();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_grpc_client\"\u003e\u003ca class=\"anchor\" href=\"#_grpc_client\"\u003e\u003c/a\u003egRPC 客户端\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e没有客户端的服务端是没用的，所以我们创建一个客户端。创建客户端和创建服务端的步骤有重叠。\n首先我们需要预先有一个RPC的定义，否则就不会有服务端，然后这个相同的定义会被编译。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e请注意：编译器即生成基本服务也会生成客户端存根，所以如果您已经编译了一次，那么您就无需再次编译。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e每一个客户端存根都必须有一个服务端通信channel相对应，\n所以首先我们需要创建一个gRPC channel：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eManagedChannel channel = VertxChannelBuilder\n  .forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .usePlaintext()\n  .build();\n\n\u003cspan class=\"hljs-comment\"\u003e// 获取一个存根来与远程服务交互\u003c/span\u003e\nGreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e一旦存根生成，我们可以和服务端进行交互，此时这会更加简单，因为存根已经提供了\n正确的方法定义和正确的参数类型定义：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eHelloRequest request = HelloRequest.newBuilder().setName(\u003cspan class=\"hljs-string\"\u003e\"Julien\"\u003c/span\u003e).build();\n\n\u003cspan class=\"hljs-comment\"\u003e// 调用远程服务\u003c/span\u003e\nstub.sayHello(request, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StreamObserver\u0026lt;HelloReply\u0026gt;() {\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e HelloReply helloReply;\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonNext\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(HelloReply helloReply)\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.helloReply = helloReply;\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonError\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Throwable throwable)\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Coult not reach server \"\u003c/span\u003e + throwable.getMessage());\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonCompleted\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got the server response: \"\u003c/span\u003e + helloReply.getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_using_vert_x_future_and_streams_2\"\u003e\u003ca class=\"anchor\" href=\"#_using_vert_x_future_and_streams_2\"\u003e\u003c/a\u003e使用 Vert.x 的 future 和 streams\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e前述示例用一个gRPC客户端基于gRPC异步架构（例如 \u003ccode\u003eio.grpc.stub.StreamObserver\u003c/code\u003e ）来执行异步操作。\n代码是由 protoc 编译器生成的。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e上述配置作用于下列插件：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eid\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-grpc-protoc-plugin\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e${stack.version}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx.grpc.protoc.plugin.VertxGrpcGenerator\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003emainClass\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eprotocPlugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e它用Vert.x的异步架构（ 例如 \u003ccode\u003eFuture\u003c/code\u003e 或 \u003ccode\u003eReadStream\u003c/code\u003e 或 \u003ccode\u003eWriteStream\u003c/code\u003e ）生成客户端版本，这样在Vert.x生态中更加方便。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eHelloRequest request = HelloRequest.newBuilder().setName(\u003cspan class=\"hljs-string\"\u003e\"Julien\"\u003c/span\u003e).build();\n\n\u003cspan class=\"hljs-comment\"\u003e// Call the remote service\u003c/span\u003e\nFuture\u0026lt;HelloReply\u0026gt; future = stub.sayHello(request);\n\n\u003cspan class=\"hljs-comment\"\u003e// Listen to completion events\u003c/span\u003e\nfuture\n  .onSuccess(helloReply -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got the server response: \"\u003c/span\u003e + helloReply.getMessage())).onFailure(err -\u0026gt; System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Coult not reach server \"\u003c/span\u003e + err));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_client_gzip_compression\"\u003e\u003ca class=\"anchor\" href=\"#_client_gzip_compression\"\u003e\u003c/a\u003e客户端gzip压缩\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e您可以启用gzip压缩来让客户端发送压缩消息。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eGreeterGrpc.GreeterStub stub = GreeterGrpc\n  .newStub(channel)\n  .withCompression(\u003cspan class=\"hljs-string\"\u003e\"gzip\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n只要客户端支持，您可以使用任何其他的压缩器，他们在构建 \u003ccode\u003eManagedChannel\u003c/code\u003e 时被注册。\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_ssl_configuration_2\"\u003e\u003ca class=\"anchor\" href=\"#_ssl_configuration_2\"\u003e\u003c/a\u003eSSL 配置\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e如果您先前启用了SSL，那么您的客户端也必须用SSL，我们需要像如下配置channel：\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eManagedChannel channel = VertxChannelBuilder.\n  forAddress(vertx, \u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n  .useSsl(options -\u0026gt; options\n    .setSsl(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n    .setUseAlpn(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e)\n    .setTrustStoreOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JksOptions()\n      .setPath(\u003cspan class=\"hljs-string\"\u003e\"client-truststore.jks\"\u003c/span\u003e)\n      .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)))\n  .build();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock important\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e重要\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n因为gRPC用了 HTTP/2 作为传输协议，客户端SSL/TLS的启用必须有 \u003ca href=\"https://wikipedia.org/wiki/Application-Layer_Protocol_Negotiation\"\u003eApplication-Layer Protocol Negotiation\u003c/a\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_advanced_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_advanced_configuration\"\u003e\u003c/a\u003e高级配置\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e直到现在，所有的gRPC示例都使用标准的默认配置，但是还有更多的配置项。如果您需要完整控制服务端的配置，\n那么您应该查阅文档： \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/grpc/VertxServerBuilder.html\"\u003eVertxServerBuilder\u003c/a\u003e\u003c/code\u003e ，\n如果您需要控制客户端channel，则查阅 \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/grpc/VertxChannelBuilder.html\"\u003eVertxChannelBuilder\u003c/a\u003e\u003c/code\u003e 。 Vert.x gRPC继承了 grpc-java 项目（Netty传输），因此建议阅读其 \u003ca href=\"http://www.grpc.io/grpc-java/javadoc/\"\u003e文档\u003c/a\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_native_transports\"\u003e\u003ca class=\"anchor\" href=\"#_native_transports\"\u003e\u003c/a\u003e本地传输\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e客户端和服务端可以用Netty的本地传输来部署，这是在创建Vert.x实例时实现的。\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eVertx.vertx(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e VertxOptions().setPreferNativeTransport(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e了解更多本地传输的信息，请查阅 Vert.x Core 文档。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.0.0"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.0.0","vertx-grpc","java"]},"buildId":"wu5KuMZJZz8yyCszqln_j","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.dd672925a2e24782fa8b.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.9018d0edef70f2f225a9.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-a029dc5d19ec928c6924.js" async=""></script><script src="/_next/static/wu5KuMZJZz8yyCszqln_j/_buildManifest.js" async=""></script><script src="/_next/static/wu5KuMZJZz8yyCszqln_j/_ssgManifest.js" async=""></script></body></html>