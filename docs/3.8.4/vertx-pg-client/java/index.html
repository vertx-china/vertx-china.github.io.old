<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>PostgreSQL 客户端 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/eclipse-vertx/vertx-sql-client" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.f20dca63.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.f20dca63.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.f6b3df68d79eb424ded3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" as="script"/></head><body><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">App generator <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">Channels</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">How-To’s <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x User Group" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x User Group</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_usage">Usage</a></li>
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#_connecting_to_postgresql">Connecting to PostgreSQL</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_data_object">data object</a></li>
<li><a href="#_connection_uri">connection uri</a></li>
<li><a href="#_environment_variables">environment variables</a></li>
</ul>
</li>
<li><a href="#_running_queries">Running queries</a>
<ul class="sectlevel2">
<li><a href="#_prepared_queries">Prepared queries</a></li>
<li><a href="#_batches">Batches</a></li>
</ul>
</li>
<li><a href="#_using_connections">Using connections</a></li>
<li><a href="#_using_transactions">Using transactions</a>
<ul class="sectlevel2">
<li><a href="#_transactions_with_connections">Transactions with connections</a></li>
<li><a href="#_simplified_transaction_api">Simplified transaction API</a></li>
</ul>
</li>
<li><a href="#_cursors_and_streaming">Cursors and streaming</a></li>
<li><a href="#_postgresql_type_mapping">PostgreSQL type mapping</a>
<ul class="sectlevel2">
<li><a href="#_handling_json">Handling JSON</a></li>
<li><a href="#_handling_numeric">Handling NUMERIC</a></li>
</ul>
</li>
<li><a href="#_handling_arrays">Handling arrays</a></li>
<li><a href="#_handling_custom_types">Handling custom types</a></li>
<li><a href="#_handling_text_search">Handling text search</a></li>
<li><a href="#_collector_queries">Collector queries</a></li>
<li><a href="#_pubsub">Pub/sub</a></li>
<li><a href="#_cancelling_request">Cancelling Request</a></li>
<li><a href="#_using_ssltls">Using SSL/TLS</a></li>
<li><a href="#_using_a_proxy">Using a proxy</a></li>
<li><a href="#_rxjava_2_api">RxJava 2 API</a>
<ul class="sectlevel2">
<li><a href="#_streaming">Streaming</a></li>
<li><a href="#_transaction">Transaction</a></li>
</ul>
</li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/eclipse-vertx/vertx-sql-client"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-examples"><a href="https://github.com/vert-x3/vertx-examples/tree/4.x/sql-client-examples"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Examples</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-pg-client/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.0.3<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-pg-client/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.0.3<!-- -->)</li></a><a href="/docs/3.9.6/vertx-pg-client/java/"><li class="dropdown-item has-active-siblings">v<!-- -->3.9.6</li></a></ul></div></span></div></div><div><h1>Reactive PostgreSQL Client</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Reactive PostgreSQL Client is a client for PostgreSQL with a straightforward API focusing on
scalability and low overhead.</p>
</div>
<div class="paragraph">
<p>The client is reactive and non blocking, allowing to handle many database connections with a single thread.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Event driven</p>
</li>
<li>
<p>Lightweight</p>
</li>
<li>
<p>Built-in connection pooling</p>
</li>
<li>
<p>Prepared queries caching</p>
</li>
<li>
<p>Publish / subscribe using PostgreSQL <code>NOTIFY/LISTEN</code></p>
</li>
<li>
<p>Batch and cursor</p>
</li>
<li>
<p>Row streaming</p>
</li>
<li>
<p>Command pipeling</p>
</li>
<li>
<p>RxJava 1 and RxJava 2</p>
</li>
<li>
<p>Direct memory to object without unnecessary copies</p>
</li>
<li>
<p>Java 8 Date and Time</p>
</li>
<li>
<p>SSL/TLS</p>
</li>
<li>
<p>Unix domain socket</p>
</li>
<li>
<p>HTTP/1.x CONNECT, SOCKS4a or SOCKS5 proxy support</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the Reactive PostgreSQL Client add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-pg-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
 compile <span class="hljs-string">'io.vertx:vertx-pg-client:3.8.4'</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is the simplest way to connect, query and disconnect</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the client pool</span>
PgPool client = PgPool.pool(connectOptions, poolOptions);

<span class="hljs-comment">// A simple query</span>
client.query(<span class="hljs-string">"SELECT * FROM users WHERE id='julien'"</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; result = ar.result();
    System.out.println(<span class="hljs-string">"Got "</span> + result.size() + <span class="hljs-string">" rows "</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }

  <span class="hljs-comment">// Now close the pool</span>
  client.close();
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connecting_to_postgresql"><a class="anchor" href="#_connecting_to_postgresql"></a>Connecting to PostgreSQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the time you will use a pool to connect to PostgreSQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
PgPool client = PgPool.pool(connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pooled client uses a connection pool and any operation will borrow a connection from the pool
to execute the operation and release it to the pool.</p>
</div>
<div class="paragraph">
<p>If you are running with Vert.x you can pass it your Vertx instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);
<span class="hljs-comment">// Create the pooled client</span>
PgPool client = PgPool.pool(vertx, connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to release the pool when you don&#8217;t need it anymore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you need to execute several operations on the same connection, you need to use a client
<code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html">connection</a></code>.</p>
</div>
<div class="paragraph">
<p>You can easily get one from the pool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
PgPool client = PgPool.pool(vertx, connectOptions, poolOptions);

<span class="hljs-comment">// Get a connection from the pool</span>
client.getConnection(ar1 -&gt; {

  <span class="hljs-keyword">if</span> (ar1.succeeded()) {

    System.out.println(<span class="hljs-string">"Connected"</span>);

    <span class="hljs-comment">// Obtain our connection</span>
    SqlConnection conn = ar1.result();

    <span class="hljs-comment">// All operations execute on the same connection</span>
    conn.query(<span class="hljs-string">"SELECT * FROM users WHERE id='julien'"</span>, ar2 -&gt; {
      <span class="hljs-keyword">if</span> (ar2.succeeded()) {
        conn.query(<span class="hljs-string">"SELECT * FROM users WHERE id='emad'"</span>, ar3 -&gt; {
          <span class="hljs-comment">// Release the connection to the pool</span>
          conn.close();
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Release the connection to the pool</span>
        conn.close();
      }
    });
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Could not connect: "</span> + ar1.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you are done with the connection you must close it to release it to the pool, so it can be reused.</p>
</div>
<div class="paragraph">
<p>Sometimes you want to improve performance via Unix domain socket connection, we achieve this with Vert.x Native transports.</p>
</div>
<div class="paragraph">
<p>Make sure you have added the required <code>netty-transport-native</code> dependency in your classpath and enabled the Unix domain socket option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setHost(<span class="hljs-string">"/var/run/postgresql"</span>)
  .setPort(<span class="hljs-number">5432</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>);

<span class="hljs-comment">// Pool options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions()
  .setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pooled client</span>
PgPool client = PgPool.pool(connectOptions, poolOptions);

<span class="hljs-comment">// Create the pooled client with a vertx instance</span>
<span class="hljs-comment">// Make sure the vertx instance has enabled native transports</span>
PgPool client2 = PgPool.pool(vertx, connectOptions, poolOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information can be found in the [Vert.x documentation](<a href="https://vertx.io/docs/vertx-core/java/#_native_transports" class="bare">https://vertx.io/docs/vertx-core/java/#_native_transports</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several alternatives for you to configure the client.</p>
</div>
<div class="sect2">
<h3 id="_data_object"><a class="anchor" href="#_data_object"></a>data object</h3>
<div class="paragraph">
<p>A simple way to configure the client is to specify a <code>PgConnectOptions</code> data object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>);

<span class="hljs-comment">// Pool Options</span>
PoolOptions poolOptions = <span class="hljs-keyword">new</span> PoolOptions().setMaxSize(<span class="hljs-number">5</span>);

<span class="hljs-comment">// Create the pool from the data object</span>
PgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);

pool.getConnection(ar -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure the generic properties with the <code>setProperties</code> or <code>addProperty</code> methods. Note <code>setProperties</code> will override the default client properties.</p>
</div>
<div class="paragraph">
<p>For example, you can set a default schema for the connection with adding a <code>search_path</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions connectOptions = <span class="hljs-keyword">new</span> PgConnectOptions();

<span class="hljs-comment">// Set the default schema</span>
connectOptions.addProperty(<span class="hljs-string">"search_path"</span>, <span class="hljs-string">"myschema"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the available properties can be found in the <a href="https://www.postgresql.org/docs/current/runtime-config-client.html">PostgreSQL Manuals</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connection_uri"><a class="anchor" href="#_connection_uri"></a>connection uri</h3>
<div class="paragraph">
<p>Apart from configuring with a <code>PgConnectOptions</code> data object, We also provide you an alternative way to connect when you want to configure with a connection URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String connectionUri = <span class="hljs-string">"postgresql://dbuser:secretpassword@database.server.com:3211/mydb"</span>;

<span class="hljs-comment">// Create the pool from the connection URI</span>
PgPool pool = PgPool.pool(connectionUri);

<span class="hljs-comment">// Create the connection from the connection URI</span>
PgConnection.connect(vertx, connectionUri, res -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about connection string formats can be found in the <a href="https://www.postgresql.org/docs/9.6/static/libpq-connect.html#LIBPQ-CONNSTRING">PostgreSQL Manuals</a>.</p>
</div>
<div class="paragraph">
<p>Currently the client supports the following parameter key words in connection uri</p>
</div>
<div class="ulist">
<ul>
<li>
<p>host</p>
</li>
<li>
<p>hostaddr</p>
</li>
<li>
<p>port</p>
</li>
<li>
<p>user</p>
</li>
<li>
<p>password</p>
</li>
<li>
<p>dbname</p>
</li>
<li>
<p>sslmode</p>
</li>
<li>
<p>properties including(application_name, fallback_application_name, search_path)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: configuring properties in connection URI will override the default properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>environment variables</h3>
<div class="paragraph">
<p>You can also use environment variables to set default connection setting values, this is useful
when you want to avoid hard-coding database connection information. You can refer to the <a href="https://www.postgresql.org/docs/9.6/static/libpq-envars.html">official documentation</a>
for more details. The following parameters are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PGHOST</code></p>
</li>
<li>
<p><code>PGHOSTADDR</code></p>
</li>
<li>
<p><code>PGPORT</code></p>
</li>
<li>
<p><code>PGDATABASE</code></p>
</li>
<li>
<p><code>PGUSER</code></p>
</li>
<li>
<p><code>PGPASSWORD</code></p>
</li>
<li>
<p><code>PGSSLMODE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a data object or a connection URI string to connect, environment variables will take precedence over them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ PGUSER=user \
 PGHOST=the-host \
 PGPASSWORD=secret \
 PGDATABASE=the-db \
 PGPORT=<span class="hljs-number">5432</span> \
 PGSSLMODE=DISABLE</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgPool pool = PgPool.pool();

<span class="hljs-comment">// Create the connection from the environment variables</span>
PgConnection.connect(vertx, res -&gt; {
  <span class="hljs-comment">// Handling your connection</span>
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_queries"><a class="anchor" href="#_running_queries"></a>Running queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you don&#8217;t need a transaction or run single queries, you can run queries directly on the pool; the pool
will use one of its connection to run the query and return the result to you.</p>
</div>
<div class="paragraph">
<p>Here is how to run simple queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.query(<span class="hljs-string">"SELECT * FROM users WHERE id='julien'"</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; result = ar.result();
    System.out.println(<span class="hljs-string">"Got "</span> + result.size() + <span class="hljs-string">" rows "</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_prepared_queries"><a class="anchor" href="#_prepared_queries"></a>Prepared queries</h3>
<div class="paragraph">
<p>You can do the same with prepared queries.</p>
</div>
<div class="paragraph">
<p>The SQL string can refer to parameters by position, using the database syntax `$1`, `$2`, etc…​</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"SELECT * FROM users WHERE id=$1"</span>, Tuple.of(<span class="hljs-string">"julien"</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(<span class="hljs-string">"Got "</span> + rows.size() + <span class="hljs-string">" rows "</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query methods provides an asynchronous <code><a href="../../apidocs/io/vertx/sqlclient/RowSet.html">RowSet</a></code> instance that works for <em>SELECT</em> queries</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"SELECT first_name, last_name FROM users"</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">"User "</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">" "</span> + row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>or <em>UPDATE</em>/<em>INSERT</em> queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"INSERT INTO users (first_name, last_name) VALUES ($1, $2)"</span>, Tuple.of(<span class="hljs-string">"Julien"</span>, <span class="hljs-string">"Viet"</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code> gives you access to your data by index</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.out.println(<span class="hljs-string">"User "</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">" "</span> + row.getString(<span class="hljs-number">1</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or by name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.out.println(<span class="hljs-string">"User "</span> + row.getString(<span class="hljs-string">"first_name"</span>) + <span class="hljs-string">" "</span> + row.getString(<span class="hljs-string">"last_name"</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client will not do any magic here and the column name is identified with the name in the table regardless of how your SQL text is.</p>
</div>
<div class="paragraph">
<p>You can access a wide variety of of types</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String firstName = row.getString(<span class="hljs-string">"first_name"</span>);
Boolean male = row.getBoolean(<span class="hljs-string">"male"</span>);
Integer age = row.getInteger(<span class="hljs-string">"age"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can cache prepared queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connectOptions.setCachePreparedStatements(<span class="hljs-keyword">true</span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_batches"><a class="anchor" href="#_batches"></a>Batches</h3>
<div class="paragraph">
<p>You can execute prepared batch</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Tuple&gt; batch = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
batch.add(Tuple.of(<span class="hljs-string">"julien"</span>, <span class="hljs-string">"Julien Viet"</span>));
batch.add(Tuple.of(<span class="hljs-string">"emad"</span>, <span class="hljs-string">"Emad Alblueshi"</span>));

<span class="hljs-comment">// Execute the prepared batch</span>
client.preparedBatch(<span class="hljs-string">"INSERT INTO USERS (id, name) VALUES ($1, $2)"</span>, batch, res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {

    <span class="hljs-comment">// Process rows</span>
    RowSet&lt;Row&gt; rows = res.result();
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Batch failed "</span> + res.cause());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can fetch generated keys with a 'RETURNING' clause in your query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"INSERT INTO color (color_name) VALUES ($1), ($2), ($3) RETURNING color_id"</span>, Tuple.of(<span class="hljs-string">"white"</span>, <span class="hljs-string">"red"</span>, <span class="hljs-string">"blue"</span>), ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">"generated key: "</span> + row.getInteger(<span class="hljs-string">"color_id"</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_connections"><a class="anchor" href="#_using_connections"></a>Using connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you need to execute sequential queries (without a transaction), you can create a new connection
or borrow one from the pool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.getConnection(ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded()) {
    SqlConnection connection = ar1.result();

    connection.query(<span class="hljs-string">"SELECT * FROM users WHERE id='julien'"</span>, ar2 -&gt; {
      <span class="hljs-keyword">if</span> (ar1.succeeded()) {
        connection.query(<span class="hljs-string">"SELECT * FROM users WHERE id='paulo'"</span>, ar3 -&gt; {
          <span class="hljs-comment">// Do something with rows and return the connection to the pool</span>
          connection.close();
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Return the connection to the pool</span>
        connection.close();
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prepared queries can be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">"SELECT * FROM users WHERE first_name LIKE $1"</span>, ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded()) {
    PreparedQuery pq = ar1.result();
    pq.execute(Tuple.of(<span class="hljs-string">"julien"</span>), ar2 -&gt; {
      <span class="hljs-keyword">if</span> (ar2.succeeded()) {
        <span class="hljs-comment">// All rows</span>
        RowSet&lt;Row&gt; rows = ar2.result();
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
prepared query caching depends on the <code><a href="../../apidocs/io/vertx/sqlclient/SqlConnectOptions.html#setCachePreparedStatements-boolean-">setCachePreparedStatements</a></code> and
does not depend on whether you are creating prepared queries or use <code><a href="../../apidocs/io/vertx/sqlclient/SqlClient.html#preparedQuery-java.lang.String-io.vertx.core.Handler-">direct prepared queries</a></code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code><a href="../../apidocs/io/vertx/sqlclient/PreparedQuery.html">PreparedQuery</a></code> can perform efficient batching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">"INSERT INTO USERS (id, name) VALUES ($1, $2)"</span>, ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded()) {
    PreparedQuery prepared = ar1.result();

    <span class="hljs-comment">// Create a query : bind parameters</span>
    List&lt;Tuple&gt; batch = <span class="hljs-keyword">new</span> ArrayList();

    <span class="hljs-comment">// Add commands to the createBatch</span>
    batch.add(Tuple.of(<span class="hljs-string">"julien"</span>, <span class="hljs-string">"Julien Viet"</span>));
    batch.add(Tuple.of(<span class="hljs-string">"emad"</span>, <span class="hljs-string">"Emad Alblueshi"</span>));

    prepared.batch(batch, res -&gt; {
      <span class="hljs-keyword">if</span> (res.succeeded()) {

        <span class="hljs-comment">// Process rows</span>
        RowSet&lt;Row&gt; rows = res.result();
      } <span class="hljs-keyword">else</span> {
        System.out.println(<span class="hljs-string">"Batch failed "</span> + res.cause());
      }
    });
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_transactions"><a class="anchor" href="#_using_transactions"></a>Using transactions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_transactions_with_connections"><a class="anchor" href="#_transactions_with_connections"></a>Transactions with connections</h3>
<div class="paragraph">
<p>You can execute transaction using SQL <code>BEGIN</code>/<code>COMMIT</code>/<code>ROLLBACK</code>, if you do so you must use
a <code><a href="../../apidocs/io/vertx/sqlclient/SqlConnection.html">SqlConnection</a></code> and manage it yourself.</p>
</div>
<div class="paragraph">
<p>Or you can use the transaction API of <code><a href="../../apidocs/io/vertx/sqlclient/SqlConnection.html">SqlConnection</a></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.getConnection(res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {

    <span class="hljs-comment">// Transaction must use a connection</span>
    SqlConnection conn = res.result();

    <span class="hljs-comment">// Begin the transaction</span>
    Transaction tx = conn.begin();

    <span class="hljs-comment">// Various statements</span>
    conn.query(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')"</span>, ar1 -&gt; {
      <span class="hljs-keyword">if</span> (ar1.succeeded()) {
        conn.query(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')"</span>, ar2 -&gt; {
          <span class="hljs-keyword">if</span> (ar2.succeeded()) {
            <span class="hljs-comment">// Commit the transaction</span>
            tx.commit(ar3 -&gt; {
              <span class="hljs-keyword">if</span> (ar3.succeeded()) {
                System.out.println(<span class="hljs-string">"Transaction succeeded"</span>);
              } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Transaction failed "</span> + ar3.cause().getMessage());
              }
              <span class="hljs-comment">// Return the connection to the pool</span>
              conn.close();
            });
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Return the connection to the pool</span>
            conn.close();
          }
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Return the connection to the pool</span>
        conn.close();
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When PostgreSQL reports the current transaction is failed (e.g the infamous <em>current transaction is aborted, commands ignored until
end of transaction block</em>), the transaction is rollbacked and the <code><a href="../../apidocs/io/vertx/sqlclient/Transaction.html#abortHandler-io.vertx.core.Handler-">abortHandler</a></code>
is called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">tx.abortHandler(v -&gt; {
  System.out.println(<span class="hljs-string">"Transaction failed =&gt; rollbacked"</span>);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simplified_transaction_api"><a class="anchor" href="#_simplified_transaction_api"></a>Simplified transaction API</h3>
<div class="paragraph">
<p>When you use a pool, you can start a transaction directly on the pool.</p>
</div>
<div class="paragraph">
<p>It borrows a connection from the pool, begins the transaction and releases the connection to the pool when the transaction ends.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.begin(res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {

    <span class="hljs-comment">// Get the transaction</span>
    Transaction tx = res.result();

    <span class="hljs-comment">// Various statements</span>
    tx.query(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')"</span>, ar1 -&gt; {
      <span class="hljs-keyword">if</span> (ar1.succeeded()) {
        tx.query(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')"</span>, ar2 -&gt; {
          <span class="hljs-keyword">if</span> (ar2.succeeded()) {
            <span class="hljs-comment">// Commit the transaction</span>
            <span class="hljs-comment">// the connection will automatically return to the pool</span>
            tx.commit(ar3 -&gt; {
              <span class="hljs-keyword">if</span> (ar3.succeeded()) {
                System.out.println(<span class="hljs-string">"Transaction succeeded"</span>);
              } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Transaction failed "</span> + ar3.cause().getMessage());
              }
            });
          }
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// No need to close connection as transaction will abort and be returned to the pool</span>
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">
this code will not close the connection because it will always be released back to the pool when the transaction
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cursors_and_streaming"><a class="anchor" href="#_cursors_and_streaming"></a>Cursors and streaming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default prepared query execution fetches all rows, you can use a
<code><a href="../../apidocs/io/vertx/sqlclient/Cursor.html">Cursor</a></code> to control the amount of rows you want to read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">"SELECT * FROM users WHERE first_name LIKE $1"</span>, ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded()) {
    PreparedQuery pq = ar1.result();

    <span class="hljs-comment">// Cursors require to run within a transaction</span>
    Transaction tx = connection.begin();

    <span class="hljs-comment">// Create a cursor</span>
    Cursor cursor = pq.cursor(Tuple.of(<span class="hljs-string">"julien"</span>));

    <span class="hljs-comment">// Read 50 rows</span>
    cursor.read(<span class="hljs-number">50</span>, ar2 -&gt; {
      <span class="hljs-keyword">if</span> (ar2.succeeded()) {
        RowSet&lt;Row&gt; rows = ar2.result();

        <span class="hljs-comment">// Check for more ?</span>
        <span class="hljs-keyword">if</span> (cursor.hasMore()) {
          <span class="hljs-comment">// Repeat the process...</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// No more rows - commit the transaction</span>
          tx.commit();
        }
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cursors shall be closed when they are released prematurely:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">cursor.read(<span class="hljs-number">50</span>, ar2 -&gt; {
  <span class="hljs-keyword">if</span> (ar2.succeeded()) {
    <span class="hljs-comment">// Close the cursor</span>
    cursor.close();
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>A stream API is also available for cursors, which can be more convenient, specially with the Rxified version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.prepare(<span class="hljs-string">"SELECT * FROM users WHERE first_name LIKE $1"</span>, ar1 -&gt; {
  <span class="hljs-keyword">if</span> (ar1.succeeded()) {
    PreparedQuery pq = ar1.result();

    <span class="hljs-comment">// Streams require to run within a transaction</span>
    Transaction tx = connection.begin();

    <span class="hljs-comment">// Fetch 50 rows at a time</span>
    RowStream&lt;Row&gt; stream = pq.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">"julien"</span>));

    <span class="hljs-comment">// Use the stream</span>
    stream.exceptionHandler(err -&gt; {
      System.out.println(<span class="hljs-string">"Error: "</span> + err.getMessage());
    });
    stream.endHandler(v -&gt; {
      tx.commit();
      System.out.println(<span class="hljs-string">"End of stream"</span>);
    });
    stream.handler(row -&gt; {
      System.out.println(<span class="hljs-string">"User: "</span> + row.getString(<span class="hljs-string">"last_name"</span>));
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stream read the rows by batch of <code>50</code> and stream them, when the rows have been passed to the handler,
a new batch of <code>50</code> is read and so on.</p>
</div>
<div class="paragraph">
<p>The stream can be resumed or paused, the loaded rows will remain in memory until they are delivered and the cursor
will stop iterating.</p>
</div>
<div class="paragraph">
<p>Note: PostreSQL destroys cursors at the end of a transaction, so the cursor API shall be used
within a transaction, otherwise you will likely get the <code>34000</code> PostgreSQL error.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_postgresql_type_mapping"><a class="anchor" href="#_postgresql_type_mapping"></a>PostgreSQL type mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Currently the client supports the following PostgreSQL types</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BOOLEAN (<code>java.lang.Boolean</code>)</p>
</li>
<li>
<p>INT2 (<code>java.lang.Short</code>)</p>
</li>
<li>
<p>INT4 (<code>java.lang.Integer</code>)</p>
</li>
<li>
<p>INT8 (<code>java.lang.Long</code>)</p>
</li>
<li>
<p>FLOAT4 (<code>java.lang.Float</code>)</p>
</li>
<li>
<p>FLOAT8 (<code>java.lang.Double</code>)</p>
</li>
<li>
<p>CHAR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>VARCHAR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>TEXT (<code>java.lang.String</code>)</p>
</li>
<li>
<p>ENUM (<code>java.lang.String</code>)</p>
</li>
<li>
<p>NAME (<code>java.lang.String</code>)</p>
</li>
<li>
<p>SERIAL2 (<code>java.lang.Short</code>)</p>
</li>
<li>
<p>SERIAL4 (<code>java.lang.Integer</code>)</p>
</li>
<li>
<p>SERIAL8 (<code>java.lang.Long</code>)</p>
</li>
<li>
<p>NUMERIC (<code>io.vertx.sqlclient.data.Numeric</code>)</p>
</li>
<li>
<p>UUID (<code>java.util.UUID</code>)</p>
</li>
<li>
<p>DATE (<code>java.time.LocalDate</code>)</p>
</li>
<li>
<p>TIME (<code>java.time.LocalTime</code>)</p>
</li>
<li>
<p>TIMETZ (<code>java.time.OffsetTime</code>)</p>
</li>
<li>
<p>TIMESTAMP (<code>java.time.LocalDateTime</code>)</p>
</li>
<li>
<p>TIMESTAMPTZ (<code>java.time.OffsetDateTime</code>)</p>
</li>
<li>
<p>INTERVAL (<code>io.vertx.pgclient.data.Interval</code>)</p>
</li>
<li>
<p>BYTEA (<code>io.vertx.core.buffer.Buffer</code>)</p>
</li>
<li>
<p>JSON (<code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>, <code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p>
</li>
<li>
<p>JSONB (<code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>, <code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p>
</li>
<li>
<p>POINT (<code>io.vertx.pgclient.data.Point</code>)</p>
</li>
<li>
<p>LINE (<code>io.vertx.pgclient.data.Line</code>)</p>
</li>
<li>
<p>LSEG (<code>io.vertx.pgclient.data.LineSegment</code>)</p>
</li>
<li>
<p>BOX (<code>io.vertx.pgclient.data.Box</code>)</p>
</li>
<li>
<p>PATH (<code>io.vertx.pgclient.data.Path</code>)</p>
</li>
<li>
<p>POLYGON (<code>io.vertx.pgclient.data.Polygon</code>)</p>
</li>
<li>
<p>CIRCLE (<code>io.vertx.pgclient.data.Circle</code>)</p>
</li>
<li>
<p>TSVECTOR (<code>java.lang.String</code>)</p>
</li>
<li>
<p>TSQUERY (<code>java.lang.String</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tuple decoding uses the above types when storing values, it also performs on the flu conversion the actual value when possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.query(<span class="hljs-string">"SELECT 1::BIGINT \"VAL\""</span>, ar -&gt; {
  RowSet&lt;Row&gt; rowSet = ar.result();
  Row row = rowSet.iterator().next();

  <span class="hljs-comment">// Stored as java.lang.Long</span>
  Object value = row.getValue(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// Convert to java.lang.Integer</span>
  Integer intValue = row.getInteger(<span class="hljs-number">0</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tuple encoding uses the above type mapping for encoding, unless the type is numeric in which case <code>java.lang.Number</code> is used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">pool.query(<span class="hljs-string">"SELECT 1::BIGINT \"VAL\""</span>, ar -&gt; {
  RowSet&lt;Row&gt; rowSet = ar.result();
  Row row = rowSet.iterator().next();

  <span class="hljs-comment">// Stored as java.lang.Long</span>
  Object value = row.getValue(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// Convert to java.lang.Integer</span>
  Integer intValue = row.getInteger(<span class="hljs-number">0</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Arrays of these types are supported.</p>
</div>
<div class="sect2">
<h3 id="_handling_json"><a class="anchor" href="#_handling_json"></a>Handling JSON</h3>
<div class="paragraph">
<p>PostgreSQL <code>JSON</code> and <code>JSONB</code> types are represented by the following Java types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>Number</code></p>
</li>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>io.vertx.core.json.JsonObject</code></p>
</li>
<li>
<p><code>io.vertx.core.json.JsonArray</code></p>
</li>
<li>
<p><code>io.vertx.sqlclient.Tuple#JSON_NULL</code> for representing the JSON null literal</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tuple tuple = Tuple.of(
  Tuple.JSON_NULL,
  <span class="hljs-keyword">new</span> JsonObject().put(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>),
  <span class="hljs-number">3</span>);

<span class="hljs-comment">// Retrieving json</span>
Object value = tuple.getValue(<span class="hljs-number">0</span>); <span class="hljs-comment">// Expect JSON_NULL</span>

<span class="hljs-comment">//</span>
value = tuple.get(JsonObject<span class="hljs-class">.<span class="hljs-keyword">class</span>, 1)</span>; <span class="hljs-comment">// Expect JSON object</span>

<span class="hljs-comment">//</span>
value = tuple.get(Integer<span class="hljs-class">.<span class="hljs-keyword">class</span>, 2)</span>; <span class="hljs-comment">// Expect 3</span>
value = tuple.getInteger(<span class="hljs-number">2</span>); <span class="hljs-comment">// Expect 3</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_numeric"><a class="anchor" href="#_handling_numeric"></a>Handling NUMERIC</h3>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/sqlclient/data/Numeric.html">Numeric</a></code> Java type is used to represent the PostgreSQL <code>NUMERIC</code> type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Numeric numeric = row.get(Numeric<span class="hljs-class">.<span class="hljs-keyword">class</span>, 0)</span>;
<span class="hljs-keyword">if</span> (numeric.isNaN()) {
  <span class="hljs-comment">// Handle NaN</span>
} <span class="hljs-keyword">else</span> {
  BigDecimal value = numeric.bigDecimalValue();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_arrays"><a class="anchor" href="#_handling_arrays"></a>Handling arrays</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Arrays are available on <code><a href="../../apidocs/io/vertx/sqlclient/Tuple.html">Tuple</a></code> and <code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tuple tuple = Tuple.of(<span class="hljs-keyword">new</span> String[]{ <span class="hljs-string">"a"</span>, <span class="hljs-string">"tuple"</span>, <span class="hljs-string">"with"</span>, <span class="hljs-string">"arrays"</span> });

<span class="hljs-comment">// Add a string array to the tuple</span>
tuple.addStringArray(<span class="hljs-keyword">new</span> String[]{<span class="hljs-string">"another"</span>, <span class="hljs-string">"array"</span>});

<span class="hljs-comment">// Get the first array of string</span>
String[] array = tuple.getStringArray(<span class="hljs-number">0</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_custom_types"><a class="anchor" href="#_handling_custom_types"></a>Handling custom types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strings are used to represent custom types, both sent to and returned from Postgres.</p>
</div>
<div class="paragraph">
<p>You can read from PostgreSQL and get the custom type as a string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"SELECT address, (address).city FROM address_book WHERE id=$1"</span>, Tuple.of(<span class="hljs-number">3</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">"Full Address "</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">", City "</span> + row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also write to PostgreSQL by providing a string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"INSERT INTO address_book (id, address) VALUES ($1, $2)"</span>, Tuple.of(<span class="hljs-number">3</span>, <span class="hljs-string">"('Anytown', 'Second Ave', false)"</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    System.out.println(rows.rowCount());
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_text_search"><a class="anchor" href="#_handling_text_search"></a>Handling text search</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Text search is handling using java <code>String</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"SELECT to_tsvector( $1 ) @@ to_tsquery( $2 )"</span>, Tuple.of(<span class="hljs-string">"fat cats ate fat rats"</span>, <span class="hljs-string">"fat &amp; rat"</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">"Match : "</span> + row.getBoolean(<span class="hljs-number">0</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tsvector</code> and <code>tsquery</code> can be fetched from db using java <code>String</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.preparedQuery(<span class="hljs-string">"SELECT to_tsvector( $1 ), to_tsquery( $2 )"</span>, Tuple.of(<span class="hljs-string">"fat cats ate fat rats"</span>, <span class="hljs-string">"fat &amp; rat"</span>),  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    RowSet&lt;Row&gt; rows = ar.result();
    <span class="hljs-keyword">for</span> (Row row : rows) {
      System.out.println(<span class="hljs-string">"Vector : "</span> + row.getString(<span class="hljs-number">0</span>) + <span class="hljs-string">", query : "</span>+row.getString(<span class="hljs-number">1</span>));
    }
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collector_queries"><a class="anchor" href="#_collector_queries"></a>Collector queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Java collectors with the query API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Collector&lt;Row, ?, Map&lt;Long, String&gt;&gt; collector = Collectors.toMap(
  row -&gt; row.getLong(<span class="hljs-string">"id"</span>),
  row -&gt; row.getString(<span class="hljs-string">"last_name"</span>));

<span class="hljs-comment">// Run the query with the collector</span>
client.query(<span class="hljs-string">"SELECT * FROM users"</span>,
  collector,
  ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    SqlResult&lt;Map&lt;Long, String&gt;&gt; result = ar.result();

    <span class="hljs-comment">// Get the map created by the collector</span>
    Map&lt;Long, String&gt; map = result.value();
    System.out.println(<span class="hljs-string">"Got "</span> + map);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The collector processing must not keep a reference on the <code><a href="../../apidocs/io/vertx/sqlclient/Row.html">Row</a></code> as
there is a single row used for processing the entire set.</p>
</div>
<div class="paragraph">
<p>The Java <code>Collectors</code> provides many interesting predefined collectors, for example you can
create easily create a string directly from the row set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Collector&lt;Row, ?, String&gt; collector = Collectors.mapping(
  row -&gt; row.getString(<span class="hljs-string">"last_name"</span>),
  Collectors.joining(<span class="hljs-string">","</span>, <span class="hljs-string">"("</span>, <span class="hljs-string">")"</span>)
);

<span class="hljs-comment">// Run the query with the collector</span>
client.query(<span class="hljs-string">"SELECT * FROM users"</span>,
  collector,
  ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      SqlResult&lt;String&gt; result = ar.result();

      <span class="hljs-comment">// Get the string created by the collector</span>
      String list = result.value();
      System.out.println(<span class="hljs-string">"Got "</span> + list);
    } <span class="hljs-keyword">else</span> {
      System.out.println(<span class="hljs-string">"Failure: "</span> + ar.cause().getMessage());
    }
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pubsub"><a class="anchor" href="#_pubsub"></a>Pub/sub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL supports pub/sub communication channels.</p>
</div>
<div class="paragraph">
<p>You can set a <code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html#notificationHandler-io.vertx.core.Handler-">notificationHandler</a></code> to receive
PostgreSQL notifications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.notificationHandler(notification -&gt; {
  System.out.println(<span class="hljs-string">"Received "</span> + notification.getPayload() + <span class="hljs-string">" on channel "</span> + notification.getChannel());
});

connection.query(<span class="hljs-string">"LISTEN some-channel"</span>, ar -&gt; {
  System.out.println(<span class="hljs-string">"Subscribed to channel"</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html">PgSubscriber</a></code> is a channel manager managing a single connection that
provides per channel subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>)
);

<span class="hljs-comment">// You can set the channel before connect</span>
subscriber.channel(<span class="hljs-string">"channel1"</span>).handler(payload -&gt; {
  System.out.println(<span class="hljs-string">"Received "</span> + payload);
});

subscriber.connect(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {

    <span class="hljs-comment">// Or you can set the channel after connect</span>
    subscriber.channel(<span class="hljs-string">"channel2"</span>).handler(payload -&gt; {
      System.out.println(<span class="hljs-string">"Received "</span> + payload);
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel name that is given to the channel method will be the exact name of the channel as held by PostgreSQL for sending
notifications.  Note this is different than the representation of the channel name in SQL, and
internally <code><a href="../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html">PgSubscriber</a></code> will prepare the submitted channel name as a quoted identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>)
);

subscriber.connect(ar -&gt; {
    <span class="hljs-keyword">if</span> (ar.succeeded()) {
      <span class="hljs-comment">// Complex channel name - name in PostgreSQL requires a quoted ID</span>
      subscriber.channel(<span class="hljs-string">"Complex.Channel.Name"</span>).handler(payload -&gt; {
        System.out.println(<span class="hljs-string">"Received "</span> + payload);
      });
      subscriber.channel(<span class="hljs-string">"Complex.Channel.Name"</span>).subscribeHandler(subscribed -&gt; {
    	  subscriber.actualConnection().query(
    			  <span class="hljs-string">"NOTIFY \"Complex.Channel.Name\", 'msg'"</span>, notified -&gt; {
    		  System.out.println(<span class="hljs-string">"Notified \"Complex.Channel.Name\""</span>);
    	  });
      });

      <span class="hljs-comment">// PostgreSQL simple ID's are forced lower-case</span>
      subscriber.channel(<span class="hljs-string">"simple_channel"</span>).handler(payload -&gt; {
          System.out.println(<span class="hljs-string">"Received "</span> + payload);
      });
      subscriber.channel(<span class="hljs-string">"simple_channel"</span>).subscribeHandler(subscribed -&gt; {
    	  <span class="hljs-comment">// The following simple channel identifier is forced to lower case</span>
          subscriber.actualConnection().query(
        		<span class="hljs-string">"NOTIFY Simple_CHANNEL, 'msg'"</span>, notified -&gt; {
      		  System.out.println(<span class="hljs-string">"Notified simple_channel"</span>);
      	  });
      });

      <span class="hljs-comment">// The following channel name is longer than the current</span>
      <span class="hljs-comment">// (NAMEDATALEN = 64) - 1 == 63 character limit and will be truncated</span>
      subscriber.channel(
    		  <span class="hljs-string">"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb"</span>
    		  ).handler(payload -&gt; {
          System.out.println(<span class="hljs-string">"Received "</span> + payload);
      });
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide a reconnect policy as a function that takes the number of <code>retries</code> as argument and returns an <code>amountOfTime</code>
value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when <code>amountOfTime &lt; 0</code>: the subscriber is closed and there is no retry</p>
</li>
<li>
<p>when <code>amountOfTime = 0</code>: the subscriber retries to connect immediately</p>
</li>
<li>
<p>when <code>amountOfTime &gt; 0</code>: the subscriber retries after <code>amountOfTime</code> milliseconds</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgSubscriber subscriber = PgSubscriber.subscriber(vertx, <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>)
);

<span class="hljs-comment">// Reconnect at most 10 times after 100 ms each</span>
subscriber.reconnectPolicy(retries -&gt; {
  <span class="hljs-keyword">if</span> (retries &lt; <span class="hljs-number">10</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">100L</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1L</span>;
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default policy is to not reconnect.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cancelling_request"><a class="anchor" href="#_cancelling_request"></a>Cancelling Request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL supports cancellation of requests in progress. You can cancel inflight requests using <code><a href="../../apidocs/io/vertx/pgclient/PgConnection.html#cancelRequest-io.vertx.core.Handler-">cancelRequest</a></code>. Cancelling a request opens a new connection to the server and cancels the request and then close the connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">connection.query(<span class="hljs-string">"SELECT pg_sleep(20)"</span>, ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    <span class="hljs-comment">// imagine this is a long query and is still running</span>
    System.out.println(<span class="hljs-string">"Query success"</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// the server will abort the current query after cancelling request</span>
    System.out.println(<span class="hljs-string">"Failed to query due to "</span> + ar.cause().getMessage());
  }
});
connection.cancelRequest(ar -&gt; {
  <span class="hljs-keyword">if</span> (ar.succeeded()) {
    System.out.println(<span class="hljs-string">"Cancelling request has been sent"</span>);
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Failed to send cancelling request"</span>);
  }
});</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The cancellation signal might or might not have any effect — for example, if it arrives after the backend has finished processing the query, then it will have no effect. If the cancellation is effective, it results in the current command being terminated early with an error message.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>More information can be found in the <a href="https://www.postgresql.org/docs/11/protocol-flow.html#id-1.10.5.7.9">official documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_ssltls"><a class="anchor" href="#_using_ssltls"></a>Using SSL/TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the client to use SSL connection, you can configure the <code><a href="../../apidocs/io/vertx/pgclient/PgConnectOptions.html">PgConnectOptions</a></code>
like a Vert.x <code>NetClient</code>.
All <a href="https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-PROTECTION">SSL modes</a> are supported and you are able to configure <code>sslmode</code>. The client is in <code>DISABLE</code> SSL mode by default.
<code>ssl</code> parameter is kept as a mere shortcut for setting <code>sslmode</code>. <code>setSsl(true)</code> is equivalent to <code>setSslMode(VERIFY_CA)</code> and <code>setSsl(false)</code> is equivalent to <code>setSslMode(DISABLE)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">PgConnectOptions options = <span class="hljs-keyword">new</span> PgConnectOptions()
  .setPort(<span class="hljs-number">5432</span>)
  .setHost(<span class="hljs-string">"the-host"</span>)
  .setDatabase(<span class="hljs-string">"the-db"</span>)
  .setUser(<span class="hljs-string">"user"</span>)
  .setPassword(<span class="hljs-string">"secret"</span>)
  .setSslMode(SslMode.VERIFY_CA)
  .setPemTrustOptions(<span class="hljs-keyword">new</span> PemTrustOptions().addCertPath(<span class="hljs-string">"/path/to/cert.pem"</span>));

PgConnection.connect(vertx, options, res -&gt; {
  <span class="hljs-keyword">if</span> (res.succeeded()) {
    <span class="hljs-comment">// Connected with SSL</span>
  } <span class="hljs-keyword">else</span> {
    System.out.println(<span class="hljs-string">"Could not connect "</span> + res.cause());
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information can be found in the <a href="http://vertx.io/docs/vertx-core/java/#ssl">Vert.x documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_proxy"><a class="anchor" href="#_using_a_proxy"></a>Using a proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also configure the client to use an HTTP/1.x CONNECT, SOCKS4a or SOCKS5 proxy.</p>
</div>
<div class="paragraph">
<p>More information can be found in the <a href="http://vertx.io/docs/vertx-core/java/#_using_a_proxy_for_client_connections">Vert.x documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rxjava_2_api"><a class="anchor" href="#_rxjava_2_api"></a>RxJava 2 API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Rxified API supports RxJava 1 and RxJava 2, the following examples use RxJava 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Single&lt;RowSet&lt;Row&gt;&gt; single = pool.rxQuery(<span class="hljs-string">"SELECT * FROM users WHERE id='julien'"</span>);

<span class="hljs-comment">// Execute the query</span>
single.subscribe(result -&gt; {
  System.out.println(<span class="hljs-string">"Got "</span> + result.size() + <span class="hljs-string">" rows "</span>);
}, err -&gt; {
  System.out.println(<span class="hljs-string">"Failure: "</span> + err.getMessage());
});</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_streaming"><a class="anchor" href="#_streaming"></a>Streaming</h3>
<div class="paragraph">
<p>RxJava 2 supports <code>Observable</code> and <code>Flowable</code> types, these are exposed using
the <code><a href="../../apidocs/io/vertx/reactivex/sqlclient/RowStream.html">RowStream</a></code> that you can get
from a <code><a href="../../apidocs/io/vertx/reactivex/sqlclient/PreparedQuery.html">PreparedQuery</a></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Observable&lt;Row&gt; observable = pool.rxBegin() <span class="hljs-comment">// Cursors require a transaction</span>
  .flatMapObservable(tx -&gt; tx
    .rxPrepare(<span class="hljs-string">"SELECT * FROM users WHERE first_name LIKE $1"</span>)
    .flatMapObservable(preparedQuery -&gt; {
      <span class="hljs-comment">// Fetch 50 rows at a time</span>
      RowStream&lt;Row&gt; stream = preparedQuery.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">"julien"</span>));
      <span class="hljs-keyword">return</span> stream.toObservable();
    })
    <span class="hljs-comment">// Commit the transaction after usage</span>
    .doAfterTerminate(tx::commit));

<span class="hljs-comment">// Then subscribe</span>
observable.subscribe(row -&gt; {
  System.out.println(<span class="hljs-string">"User: "</span> + row.getString(<span class="hljs-string">"last_name"</span>));
}, err -&gt; {
  System.out.println(<span class="hljs-string">"Error: "</span> + err.getMessage());
}, () -&gt; {
  System.out.println(<span class="hljs-string">"End of stream"</span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same example using <code>Flowable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Flowable&lt;Row&gt; flowable = pool.rxBegin()  <span class="hljs-comment">// Cursors require a transaction</span>
  .flatMapPublisher(tx -&gt; tx.rxPrepare(<span class="hljs-string">"SELECT * FROM users WHERE first_name LIKE $1"</span>)
    .flatMapPublisher(preparedQuery -&gt; {
      <span class="hljs-comment">// Fetch 50 rows at a time</span>
      RowStream&lt;Row&gt; stream = preparedQuery.createStream(<span class="hljs-number">50</span>, Tuple.of(<span class="hljs-string">"julien"</span>));
      <span class="hljs-keyword">return</span> stream.toFlowable();
    })
    <span class="hljs-comment">// Commit the transaction after usage</span>
    .doAfterTerminate(tx::commit));

<span class="hljs-comment">// Then subscribe</span>
flowable.subscribe(<span class="hljs-keyword">new</span> Subscriber&lt;Row&gt;() {

  <span class="hljs-keyword">private</span> Subscription sub;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">(Subscription subscription)</span> </span>{
    sub = subscription;
    subscription.request(<span class="hljs-number">1</span>);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNext</span><span class="hljs-params">(Row row)</span> </span>{
    sub.request(<span class="hljs-number">1</span>);
    System.out.println(<span class="hljs-string">"User: "</span> + row.getString(<span class="hljs-string">"last_name"</span>));
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(Throwable err)</span> </span>{
    System.out.println(<span class="hljs-string">"Error: "</span> + err.getMessage());
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">"End of stream"</span>);
  }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transaction"><a class="anchor" href="#_transaction"></a>Transaction</h3>
<div class="paragraph">
<p>The simplified transaction API allows to easily write transactional
asynchronous flows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Completable completable = pool
  .rxBegin()
  .flatMapCompletable(tx -&gt; tx
    .rxQuery(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')"</span>)
    .flatMap(result -&gt; tx.rxQuery(<span class="hljs-string">"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')"</span>))
    .flatMapCompletable(result -&gt; tx.rxCommit()));

completable.subscribe(() -&gt; {
  <span class="hljs-comment">// Transaction succeeded</span>
}, err -&gt; {
  <span class="hljs-comment">// Transaction failed</span>
});</code></pre>
</div>
</div>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">Channels</a></li><li><a href="https://how-to.vertx.io/">How-To’s</a></li><li><a href="https://start.vertx.io/">App Generator</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse Foundation</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li><li><a href="https://www.eclipse.org/legal/">Legal Resources</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x<br/>Eclipse Vert.x is open source and dual-licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a> and the <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>. <br class="footer-copyright-break"/>Website design by <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a>.</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"3.8.4/vertx-pg-client/java","title":"Reactive PostgreSQL Client","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_usage\"\u003eUsage\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_getting_started\"\u003eGetting started\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connecting_to_postgresql\"\u003eConnecting to PostgreSQL\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_configuration\"\u003eConfiguration\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_data_object\"\u003edata object\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_connection_uri\"\u003econnection uri\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_environment_variables\"\u003eenvironment variables\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_running_queries\"\u003eRunning queries\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_prepared_queries\"\u003ePrepared queries\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_batches\"\u003eBatches\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_connections\"\u003eUsing connections\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_transactions\"\u003eUsing transactions\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_transactions_with_connections\"\u003eTransactions with connections\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_simplified_transaction_api\"\u003eSimplified transaction API\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_cursors_and_streaming\"\u003eCursors and streaming\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_postgresql_type_mapping\"\u003ePostgreSQL type mapping\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_handling_json\"\u003eHandling JSON\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_numeric\"\u003eHandling NUMERIC\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_arrays\"\u003eHandling arrays\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_custom_types\"\u003eHandling custom types\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_handling_text_search\"\u003eHandling text search\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_collector_queries\"\u003eCollector queries\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_pubsub\"\u003ePub/sub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_cancelling_request\"\u003eCancelling Request\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_ssltls\"\u003eUsing SSL/TLS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_using_a_proxy\"\u003eUsing a proxy\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_rxjava_2_api\"\u003eRxJava 2 API\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_streaming\"\u003eStreaming\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_transaction\"\u003eTransaction\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eReactive PostgreSQL Client\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Reactive PostgreSQL Client is a client for PostgreSQL with a straightforward API focusing on\nscalability and low overhead.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client is reactive and non blocking, allowing to handle many database connections with a single thread.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eEvent driven\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLightweight\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBuilt-in connection pooling\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePrepared queries caching\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePublish / subscribe using PostgreSQL \u003ccode\u003eNOTIFY/LISTEN\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBatch and cursor\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRow streaming\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCommand pipeling\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRxJava 1 and RxJava 2\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDirect memory to object without unnecessary copies\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJava 8 Date and Time\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSSL/TLS\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUnix domain socket\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHTTP/1.x CONNECT, SOCKS4a or SOCKS5 proxy support\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_usage\"\u003e\u003ca class=\"anchor\" href=\"#_usage\"\u003e\u003c/a\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo use the Reactive PostgreSQL Client add the following dependency to the \u003cem\u003edependencies\u003c/em\u003e section of your build descriptor:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (in your \u003ccode\u003epom.xml\u003c/code\u003e):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-pg-client\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e3.8.4\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (in your \u003ccode\u003ebuild.gradle\u003c/code\u003e file):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003edependencies {\n compile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-pg-client:3.8.4'\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_getting_started\"\u003e\u003ca class=\"anchor\" href=\"#_getting_started\"\u003e\u003c/a\u003eGetting started\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is the simplest way to connect, query and disconnect\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the client pool\u003c/span\u003e\nPgPool client = PgPool.pool(connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// A simple query\u003c/span\u003e\nclient.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='julien'\"\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; result = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\" rows \"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// Now close the pool\u003c/span\u003e\n  client.close();\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_connecting_to_postgresql\"\u003e\u003ca class=\"anchor\" href=\"#_connecting_to_postgresql\"\u003e\u003c/a\u003eConnecting to PostgreSQL\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMost of the time you will use a pool to connect to PostgreSQL:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool client = PgPool.pool(connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe pooled client uses a connection pool and any operation will borrow a connection from the pool\nto execute the operation and release it to the pool.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you are running with Vert.x you can pass it your Vertx instance:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool client = PgPool.pool(vertx, connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou need to release the pool when you don\u0026#8217;t need it anymore:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.close();\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen you need to execute several operations on the same connection, you need to use a client\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html\"\u003econnection\u003c/a\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can easily get one from the pool:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool client = PgPool.pool(vertx, connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// Get a connection from the pool\u003c/span\u003e\nclient.getConnection(ar1 -\u0026gt; {\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Connected\"\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment\"\u003e// Obtain our connection\u003c/span\u003e\n    SqlConnection conn = ar1.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// All operations execute on the same connection\u003c/span\u003e\n    conn.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='julien'\"\u003c/span\u003e, ar2 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n        conn.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='emad'\"\u003c/span\u003e, ar3 -\u0026gt; {\n          \u003cspan class=\"hljs-comment\"\u003e// Release the connection to the pool\u003c/span\u003e\n          conn.close();\n        });\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// Release the connection to the pool\u003c/span\u003e\n        conn.close();\n      }\n    });\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Could not connect: \"\u003c/span\u003e + ar1.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOnce you are done with the connection you must close it to release it to the pool, so it can be reused.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSometimes you want to improve performance via Unix domain socket connection, we achieve this with Vert.x Native transports.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMake sure you have added the required \u003ccode\u003enetty-transport-native\u003c/code\u003e dependency in your classpath and enabled the Unix domain socket option.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"/var/run/postgresql\"\u003c/span\u003e)\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions()\n  .setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client\u003c/span\u003e\nPgPool client = PgPool.pool(connectOptions, poolOptions);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pooled client with a vertx instance\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Make sure the vertx instance has enabled native transports\u003c/span\u003e\nPgPool client2 = PgPool.pool(vertx, connectOptions, poolOptions);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information can be found in the [Vert.x documentation](\u003ca href=\"https://vertx.io/docs/vertx-core/java/#_native_transports\" class=\"bare\"\u003ehttps://vertx.io/docs/vertx-core/java/#_native_transports\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003e\u003ca class=\"anchor\" href=\"#_configuration\"\u003e\u003c/a\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere are several alternatives for you to configure the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_data_object\"\u003e\u003ca class=\"anchor\" href=\"#_data_object\"\u003e\u003c/a\u003edata object\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA simple way to configure the client is to specify a \u003ccode\u003ePgConnectOptions\u003c/code\u003e data object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Pool Options\u003c/span\u003e\nPoolOptions poolOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PoolOptions().setMaxSize(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pool from the data object\u003c/span\u003e\nPgPool pool = PgPool.pool(vertx, connectOptions, poolOptions);\n\npool.getConnection(ar -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also configure the generic properties with the \u003ccode\u003esetProperties\u003c/code\u003e or \u003ccode\u003eaddProperty\u003c/code\u003e methods. Note \u003ccode\u003esetProperties\u003c/code\u003e will override the default client properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor example, you can set a default schema for the connection with adding a \u003ccode\u003esearch_path\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions connectOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions();\n\n\u003cspan class=\"hljs-comment\"\u003e// Set the default schema\u003c/span\u003e\nconnectOptions.addProperty(\u003cspan class=\"hljs-string\"\u003e\"search_path\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"myschema\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information about the available properties can be found in the \u003ca href=\"https://www.postgresql.org/docs/current/runtime-config-client.html\"\u003ePostgreSQL Manuals\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_connection_uri\"\u003e\u003ca class=\"anchor\" href=\"#_connection_uri\"\u003e\u003c/a\u003econnection uri\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eApart from configuring with a \u003ccode\u003ePgConnectOptions\u003c/code\u003e data object, We also provide you an alternative way to connect when you want to configure with a connection URI:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eString connectionUri = \u003cspan class=\"hljs-string\"\u003e\"postgresql://dbuser:secretpassword@database.server.com:3211/mydb\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the pool from the connection URI\u003c/span\u003e\nPgPool pool = PgPool.pool(connectionUri);\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the connection from the connection URI\u003c/span\u003e\nPgConnection.connect(vertx, connectionUri, res -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information about connection string formats can be found in the \u003ca href=\"https://www.postgresql.org/docs/9.6/static/libpq-connect.html#LIBPQ-CONNSTRING\"\u003ePostgreSQL Manuals\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCurrently the client supports the following parameter key words in connection uri\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ehost\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehostaddr\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eport\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003euser\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epassword\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edbname\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003esslmode\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eproperties including(application_name, fallback_application_name, search_path)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNote: configuring properties in connection URI will override the default properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_environment_variables\"\u003e\u003ca class=\"anchor\" href=\"#_environment_variables\"\u003e\u003c/a\u003eenvironment variables\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also use environment variables to set default connection setting values, this is useful\nwhen you want to avoid hard-coding database connection information. You can refer to the \u003ca href=\"https://www.postgresql.org/docs/9.6/static/libpq-envars.html\"\u003eofficial documentation\u003c/a\u003e\nfor more details. The following parameters are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGHOST\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGHOSTADDR\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGPORT\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGDATABASE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGUSER\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGPASSWORD\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePGSSLMODE\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you don\u0026#8217;t specify a data object or a connection URI string to connect, environment variables will take precedence over them.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e$ PGUSER=user \\\n PGHOST=the-host \\\n PGPASSWORD=secret \\\n PGDATABASE=the-db \\\n PGPORT=\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e \\\n PGSSLMODE=DISABLE\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgPool pool = PgPool.pool();\n\n\u003cspan class=\"hljs-comment\"\u003e// Create the connection from the environment variables\u003c/span\u003e\nPgConnection.connect(vertx, res -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Handling your connection\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_running_queries\"\u003e\u003ca class=\"anchor\" href=\"#_running_queries\"\u003e\u003c/a\u003eRunning queries\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen you don\u0026#8217;t need a transaction or run single queries, you can run queries directly on the pool; the pool\nwill use one of its connection to run the query and return the result to you.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is how to run simple queries:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='julien'\"\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; result = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\" rows \"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prepared_queries\"\u003e\u003ca class=\"anchor\" href=\"#_prepared_queries\"\u003e\u003c/a\u003ePrepared queries\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can do the same with prepared queries.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe SQL string can refer to parameters by position, using the database syntax `$1`, `$2`, etc…​\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id=$1\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + rows.size() + \u003cspan class=\"hljs-string\"\u003e\" rows \"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eQuery methods provides an asynchronous \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/RowSet.html\"\u003eRowSet\u003c/a\u003e\u003c/code\u003e instance that works for \u003cem\u003eSELECT\u003c/em\u003e queries\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT first_name, last_name FROM users\"\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"User \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eor \u003cem\u003eUPDATE\u003c/em\u003e/\u003cem\u003eINSERT\u003c/em\u003e queries:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO users (first_name, last_name) VALUES ($1, $2)\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"Julien\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Viet\"\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e gives you access to your data by index\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSystem.out.println(\u003cspan class=\"hljs-string\"\u003e\"User \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eor by name\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSystem.out.println(\u003cspan class=\"hljs-string\"\u003e\"User \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\"first_name\"\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e));\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client will not do any magic here and the column name is identified with the name in the table regardless of how your SQL text is.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can access a wide variety of of types\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eString firstName = row.getString(\u003cspan class=\"hljs-string\"\u003e\"first_name\"\u003c/span\u003e);\nBoolean male = row.getBoolean(\u003cspan class=\"hljs-string\"\u003e\"male\"\u003c/span\u003e);\nInteger age = row.getInteger(\u003cspan class=\"hljs-string\"\u003e\"age\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can cache prepared queries:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnectOptions.setCachePreparedStatements(\u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_batches\"\u003e\u003ca class=\"anchor\" href=\"#_batches\"\u003e\u003c/a\u003eBatches\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can execute prepared batch\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eList\u0026lt;Tuple\u0026gt; batch = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ArrayList\u0026lt;\u0026gt;();\nbatch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Julien Viet\"\u003c/span\u003e));\nbatch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"emad\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Emad Alblueshi\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Execute the prepared batch\u003c/span\u003e\nclient.preparedBatch(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO USERS (id, name) VALUES ($1, $2)\"\u003c/span\u003e, batch, res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Process rows\u003c/span\u003e\n    RowSet\u0026lt;Row\u0026gt; rows = res.result();\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Batch failed \"\u003c/span\u003e + res.cause());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can fetch generated keys with a 'RETURNING' clause in your query:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO color (color_name) VALUES ($1), ($2), ($3) RETURNING color_id\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"white\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"red\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"blue\"\u003c/span\u003e), ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"generated key: \"\u003c/span\u003e + row.getInteger(\u003cspan class=\"hljs-string\"\u003e\"color_id\"\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_connections\"\u003e\u003ca class=\"anchor\" href=\"#_using_connections\"\u003e\u003c/a\u003eUsing connections\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen you need to execute sequential queries (without a transaction), you can create a new connection\nor borrow one from the pool:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.getConnection(ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n    SqlConnection connection = ar1.result();\n\n    connection.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='julien'\"\u003c/span\u003e, ar2 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n        connection.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='paulo'\"\u003c/span\u003e, ar3 -\u0026gt; {\n          \u003cspan class=\"hljs-comment\"\u003e// Do something with rows and return the connection to the pool\u003c/span\u003e\n          connection.close();\n        });\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n        connection.close();\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePrepared queries can be created:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE first_name LIKE $1\"\u003c/span\u003e, ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n    PreparedQuery pq = ar1.result();\n    pq.execute(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e), ar2 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n        \u003cspan class=\"hljs-comment\"\u003e// All rows\u003c/span\u003e\n        RowSet\u0026lt;Row\u0026gt; rows = ar2.result();\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nprepared query caching depends on the \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnectOptions.html#setCachePreparedStatements-boolean-\"\u003esetCachePreparedStatements\u003c/a\u003e\u003c/code\u003e and\ndoes not depend on whether you are creating prepared queries or use \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlClient.html#preparedQuery-java.lang.String-io.vertx.core.Handler-\"\u003edirect prepared queries\u003c/a\u003e\u003c/code\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/PreparedQuery.html\"\u003ePreparedQuery\u003c/a\u003e\u003c/code\u003e can perform efficient batching:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO USERS (id, name) VALUES ($1, $2)\"\u003c/span\u003e, ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n    PreparedQuery prepared = ar1.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Create a query : bind parameters\u003c/span\u003e\n    List\u0026lt;Tuple\u0026gt; batch = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ArrayList();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Add commands to the createBatch\u003c/span\u003e\n    batch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Julien Viet\"\u003c/span\u003e));\n    batch.add(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"emad\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Emad Alblueshi\"\u003c/span\u003e));\n\n    prepared.batch(batch, res -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n\n        \u003cspan class=\"hljs-comment\"\u003e// Process rows\u003c/span\u003e\n        RowSet\u0026lt;Row\u0026gt; rows = res.result();\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Batch failed \"\u003c/span\u003e + res.cause());\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_transactions\"\u003e\u003ca class=\"anchor\" href=\"#_using_transactions\"\u003e\u003c/a\u003eUsing transactions\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_transactions_with_connections\"\u003e\u003ca class=\"anchor\" href=\"#_transactions_with_connections\"\u003e\u003c/a\u003eTransactions with connections\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can execute transaction using SQL \u003ccode\u003eBEGIN\u003c/code\u003e/\u003ccode\u003eCOMMIT\u003c/code\u003e/\u003ccode\u003eROLLBACK\u003c/code\u003e, if you do so you must use\na \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\"\u003eSqlConnection\u003c/a\u003e\u003c/code\u003e and manage it yourself.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOr you can use the transaction API of \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\"\u003eSqlConnection\u003c/a\u003e\u003c/code\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.getConnection(res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Transaction must use a connection\u003c/span\u003e\n    SqlConnection conn = res.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Begin the transaction\u003c/span\u003e\n    Transaction tx = conn.begin();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Various statements\u003c/span\u003e\n    conn.query(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')\"\u003c/span\u003e, ar1 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n        conn.query(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')\"\u003c/span\u003e, ar2 -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n            \u003cspan class=\"hljs-comment\"\u003e// Commit the transaction\u003c/span\u003e\n            tx.commit(ar3 -\u0026gt; {\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar3.succeeded()) {\n                System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Transaction succeeded\"\u003c/span\u003e);\n              } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Transaction failed \"\u003c/span\u003e + ar3.cause().getMessage());\n              }\n              \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n              conn.close();\n            });\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n            conn.close();\n          }\n        });\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// Return the connection to the pool\u003c/span\u003e\n        conn.close();\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen PostgreSQL reports the current transaction is failed (e.g the infamous \u003cem\u003ecurrent transaction is aborted, commands ignored until\nend of transaction block\u003c/em\u003e), the transaction is rollbacked and the \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Transaction.html#abortHandler-io.vertx.core.Handler-\"\u003eabortHandler\u003c/a\u003e\u003c/code\u003e\nis called:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003etx.abortHandler(v -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Transaction failed =\u0026gt; rollbacked\"\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_simplified_transaction_api\"\u003e\u003ca class=\"anchor\" href=\"#_simplified_transaction_api\"\u003e\u003c/a\u003eSimplified transaction API\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen you use a pool, you can start a transaction directly on the pool.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIt borrows a connection from the pool, begins the transaction and releases the connection to the pool when the transaction ends.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.begin(res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Get the transaction\u003c/span\u003e\n    Transaction tx = res.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Various statements\u003c/span\u003e\n    tx.query(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')\"\u003c/span\u003e, ar1 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n        tx.query(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')\"\u003c/span\u003e, ar2 -\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n            \u003cspan class=\"hljs-comment\"\u003e// Commit the transaction\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e// the connection will automatically return to the pool\u003c/span\u003e\n            tx.commit(ar3 -\u0026gt; {\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar3.succeeded()) {\n                System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Transaction succeeded\"\u003c/span\u003e);\n              } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Transaction failed \"\u003c/span\u003e + ar3.cause().getMessage());\n              }\n            });\n          }\n        });\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// No need to close connection as transaction will abort and be returned to the pool\u003c/span\u003e\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003cdiv class=\"title\"\u003e注意\u003c/div\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nthis code will not close the connection because it will always be released back to the pool when the transaction\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cursors_and_streaming\"\u003e\u003ca class=\"anchor\" href=\"#_cursors_and_streaming\"\u003e\u003c/a\u003eCursors and streaming\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default prepared query execution fetches all rows, you can use a\n\u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Cursor.html\"\u003eCursor\u003c/a\u003e\u003c/code\u003e to control the amount of rows you want to read:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE first_name LIKE $1\"\u003c/span\u003e, ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n    PreparedQuery pq = ar1.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Cursors require to run within a transaction\u003c/span\u003e\n    Transaction tx = connection.begin();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Create a cursor\u003c/span\u003e\n    Cursor cursor = pq.cursor(Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e));\n\n    \u003cspan class=\"hljs-comment\"\u003e// Read 50 rows\u003c/span\u003e\n    cursor.read(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, ar2 -\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n        RowSet\u0026lt;Row\u0026gt; rows = ar2.result();\n\n        \u003cspan class=\"hljs-comment\"\u003e// Check for more ?\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cursor.hasMore()) {\n          \u003cspan class=\"hljs-comment\"\u003e// Repeat the process...\u003c/span\u003e\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          \u003cspan class=\"hljs-comment\"\u003e// No more rows - commit the transaction\u003c/span\u003e\n          tx.commit();\n        }\n      }\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCursors shall be closed when they are released prematurely:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ecursor.read(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, ar2 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar2.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// Close the cursor\u003c/span\u003e\n    cursor.close();\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA stream API is also available for cursors, which can be more convenient, specially with the Rxified version.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.prepare(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE first_name LIKE $1\"\u003c/span\u003e, ar1 -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar1.succeeded()) {\n    PreparedQuery pq = ar1.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Streams require to run within a transaction\u003c/span\u003e\n    Transaction tx = connection.begin();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n    RowStream\u0026lt;Row\u0026gt; stream = pq.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e));\n\n    \u003cspan class=\"hljs-comment\"\u003e// Use the stream\u003c/span\u003e\n    stream.exceptionHandler(err -\u0026gt; {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Error: \"\u003c/span\u003e + err.getMessage());\n    });\n    stream.endHandler(v -\u0026gt; {\n      tx.commit();\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"End of stream\"\u003c/span\u003e);\n    });\n    stream.handler(row -\u0026gt; {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"User: \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e));\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe stream read the rows by batch of \u003ccode\u003e50\u003c/code\u003e and stream them, when the rows have been passed to the handler,\na new batch of \u003ccode\u003e50\u003c/code\u003e is read and so on.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe stream can be resumed or paused, the loaded rows will remain in memory until they are delivered and the cursor\nwill stop iterating.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNote: PostreSQL destroys cursors at the end of a transaction, so the cursor API shall be used\nwithin a transaction, otherwise you will likely get the \u003ccode\u003e34000\u003c/code\u003e PostgreSQL error.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_postgresql_type_mapping\"\u003e\u003ca class=\"anchor\" href=\"#_postgresql_type_mapping\"\u003e\u003c/a\u003ePostgreSQL type mapping\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCurrently the client supports the following PostgreSQL types\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eBOOLEAN (\u003ccode\u003ejava.lang.Boolean\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT2 (\u003ccode\u003ejava.lang.Short\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT4 (\u003ccode\u003ejava.lang.Integer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINT8 (\u003ccode\u003ejava.lang.Long\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFLOAT4 (\u003ccode\u003ejava.lang.Float\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFLOAT8 (\u003ccode\u003ejava.lang.Double\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCHAR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eVARCHAR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTEXT (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eENUM (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNAME (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL2 (\u003ccode\u003ejava.lang.Short\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL4 (\u003ccode\u003ejava.lang.Integer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSERIAL8 (\u003ccode\u003ejava.lang.Long\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNUMERIC (\u003ccode\u003eio.vertx.sqlclient.data.Numeric\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUUID (\u003ccode\u003ejava.util.UUID\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDATE (\u003ccode\u003ejava.time.LocalDate\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIME (\u003ccode\u003ejava.time.LocalTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMETZ (\u003ccode\u003ejava.time.OffsetTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMESTAMP (\u003ccode\u003ejava.time.LocalDateTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTIMESTAMPTZ (\u003ccode\u003ejava.time.OffsetDateTime\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eINTERVAL (\u003ccode\u003eio.vertx.pgclient.data.Interval\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBYTEA (\u003ccode\u003eio.vertx.core.buffer.Buffer\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJSON (\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e, \u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e, \u003ccode\u003eNumber\u003c/code\u003e, \u003ccode\u003eBoolean\u003c/code\u003e, \u003ccode\u003eString\u003c/code\u003e, \u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJSONB (\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e, \u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e, \u003ccode\u003eNumber\u003c/code\u003e, \u003ccode\u003eBoolean\u003c/code\u003e, \u003ccode\u003eString\u003c/code\u003e, \u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePOINT (\u003ccode\u003eio.vertx.pgclient.data.Point\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLINE (\u003ccode\u003eio.vertx.pgclient.data.Line\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLSEG (\u003ccode\u003eio.vertx.pgclient.data.LineSegment\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBOX (\u003ccode\u003eio.vertx.pgclient.data.Box\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePATH (\u003ccode\u003eio.vertx.pgclient.data.Path\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePOLYGON (\u003ccode\u003eio.vertx.pgclient.data.Polygon\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCIRCLE (\u003ccode\u003eio.vertx.pgclient.data.Circle\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTSVECTOR (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTSQUERY (\u003ccode\u003ejava.lang.String\u003c/code\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTuple decoding uses the above types when storing values, it also performs on the flu conversion the actual value when possible:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT 1::BIGINT \\\"VAL\\\"\"\u003c/span\u003e, ar -\u0026gt; {\n  RowSet\u0026lt;Row\u0026gt; rowSet = ar.result();\n  Row row = rowSet.iterator().next();\n\n  \u003cspan class=\"hljs-comment\"\u003e// Stored as java.lang.Long\u003c/span\u003e\n  Object value = row.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Convert to java.lang.Integer\u003c/span\u003e\n  Integer intValue = row.getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTuple encoding uses the above type mapping for encoding, unless the type is numeric in which case \u003ccode\u003ejava.lang.Number\u003c/code\u003e is used instead:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003epool.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT 1::BIGINT \\\"VAL\\\"\"\u003c/span\u003e, ar -\u0026gt; {\n  RowSet\u0026lt;Row\u0026gt; rowSet = ar.result();\n  Row row = rowSet.iterator().next();\n\n  \u003cspan class=\"hljs-comment\"\u003e// Stored as java.lang.Long\u003c/span\u003e\n  Object value = row.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Convert to java.lang.Integer\u003c/span\u003e\n  Integer intValue = row.getInteger(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eArrays of these types are supported.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_json\"\u003e\u003ca class=\"anchor\" href=\"#_handling_json\"\u003e\u003c/a\u003eHandling JSON\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL \u003ccode\u003eJSON\u003c/code\u003e and \u003ccode\u003eJSONB\u003c/code\u003e types are represented by the following Java types:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eString\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eNumber\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eBoolean\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.core.json.JsonObject\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.core.json.JsonArray\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eio.vertx.sqlclient.Tuple#JSON_NULL\u003c/code\u003e for representing the JSON null literal\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eTuple tuple = Tuple.of(\n  Tuple.JSON_NULL,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject().put(\u003cspan class=\"hljs-string\"\u003e\"foo\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"bar\"\u003c/span\u003e),\n  \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Retrieving json\u003c/span\u003e\nObject value = tuple.getValue(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect JSON_NULL\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\nvalue = tuple.get(JsonObject\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, 1)\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// Expect JSON object\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\nvalue = tuple.get(Integer\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, 2)\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// Expect 3\u003c/span\u003e\nvalue = tuple.getInteger(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Expect 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_handling_numeric\"\u003e\u003ca class=\"anchor\" href=\"#_handling_numeric\"\u003e\u003c/a\u003eHandling NUMERIC\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/data/Numeric.html\"\u003eNumeric\u003c/a\u003e\u003c/code\u003e Java type is used to represent the PostgreSQL \u003ccode\u003eNUMERIC\u003c/code\u003e type.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eNumeric numeric = row.get(Numeric\u003cspan class=\"hljs-class\"\u003e.\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e, 0)\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (numeric.isNaN()) {\n  \u003cspan class=\"hljs-comment\"\u003e// Handle NaN\u003c/span\u003e\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  BigDecimal value = numeric.bigDecimalValue();\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_arrays\"\u003e\u003ca class=\"anchor\" href=\"#_handling_arrays\"\u003e\u003c/a\u003eHandling arrays\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eArrays are available on \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Tuple.html\"\u003eTuple\u003c/a\u003e\u003c/code\u003e and \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eTuple tuple = Tuple.of(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e String[]{ \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"tuple\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"with\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"arrays\"\u003c/span\u003e });\n\n\u003cspan class=\"hljs-comment\"\u003e// Add a string array to the tuple\u003c/span\u003e\ntuple.addStringArray(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e String[]{\u003cspan class=\"hljs-string\"\u003e\"another\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"array\"\u003c/span\u003e});\n\n\u003cspan class=\"hljs-comment\"\u003e// Get the first array of string\u003c/span\u003e\nString[] array = tuple.getStringArray(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_custom_types\"\u003e\u003ca class=\"anchor\" href=\"#_handling_custom_types\"\u003e\u003c/a\u003eHandling custom types\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eStrings are used to represent custom types, both sent to and returned from Postgres.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can read from PostgreSQL and get the custom type as a string\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT address, (address).city FROM address_book WHERE id=$1\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Full Address \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\", City \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also write to PostgreSQL by providing a string\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO address_book (id, address) VALUES ($1, $2)\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"('Anytown', 'Second Ave', false)\"\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_handling_text_search\"\u003e\u003ca class=\"anchor\" href=\"#_handling_text_search\"\u003e\u003c/a\u003eHandling text search\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eText search is handling using java \u003ccode\u003eString\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT to_tsvector( $1 ) @@ to_tsquery( $2 )\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"fat cats ate fat rats\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"fat \u0026amp; rat\"\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Match : \"\u003c/span\u003e + row.getBoolean(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etsvector\u003c/code\u003e and \u003ccode\u003etsquery\u003c/code\u003e can be fetched from db using java \u003ccode\u003eString\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eclient.preparedQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT to_tsvector( $1 ), to_tsquery( $2 )\"\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"fat cats ate fat rats\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"fat \u0026amp; rat\"\u003c/span\u003e),  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    RowSet\u0026lt;Row\u0026gt; rows = ar.result();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (Row row : rows) {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Vector : \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\", query : \"\u003c/span\u003e+row.getString(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_collector_queries\"\u003e\u003ca class=\"anchor\" href=\"#_collector_queries\"\u003e\u003c/a\u003eCollector queries\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can use Java collectors with the query API:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCollector\u0026lt;Row, ?, Map\u0026lt;Long, String\u0026gt;\u0026gt; collector = Collectors.toMap(\n  row -\u0026gt; row.getLong(\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e),\n  row -\u0026gt; row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-comment\"\u003e// Run the query with the collector\u003c/span\u003e\nclient.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users\"\u003c/span\u003e,\n  collector,\n  ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    SqlResult\u0026lt;Map\u0026lt;Long, String\u0026gt;\u0026gt; result = ar.result();\n\n    \u003cspan class=\"hljs-comment\"\u003e// Get the map created by the collector\u003c/span\u003e\n    Map\u0026lt;Long, String\u0026gt; map = result.value();\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + map);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe collector processing must not keep a reference on the \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/sqlclient/Row.html\"\u003eRow\u003c/a\u003e\u003c/code\u003e as\nthere is a single row used for processing the entire set.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Java \u003ccode\u003eCollectors\u003c/code\u003e provides many interesting predefined collectors, for example you can\ncreate easily create a string directly from the row set:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCollector\u0026lt;Row, ?, String\u0026gt; collector = Collectors.mapping(\n  row -\u0026gt; row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e),\n  Collectors.joining(\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"(\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\")\"\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// Run the query with the collector\u003c/span\u003e\nclient.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users\"\u003c/span\u003e,\n  collector,\n  ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      SqlResult\u0026lt;String\u0026gt; result = ar.result();\n\n      \u003cspan class=\"hljs-comment\"\u003e// Get the string created by the collector\u003c/span\u003e\n      String list = result.value();\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + list);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + ar.cause().getMessage());\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_pubsub\"\u003e\u003ca class=\"anchor\" href=\"#_pubsub\"\u003e\u003c/a\u003ePub/sub\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL supports pub/sub communication channels.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can set a \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html#notificationHandler-io.vertx.core.Handler-\"\u003enotificationHandler\u003c/a\u003e\u003c/code\u003e to receive\nPostgreSQL notifications:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.notificationHandler(notification -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + notification.getPayload() + \u003cspan class=\"hljs-string\"\u003e\" on channel \"\u003c/span\u003e + notification.getChannel());\n});\n\nconnection.query(\u003cspan class=\"hljs-string\"\u003e\"LISTEN some-channel\"\u003c/span\u003e, ar -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Subscribed to channel\"\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html\"\u003ePgSubscriber\u003c/a\u003e\u003c/code\u003e is a channel manager managing a single connection that\nprovides per channel subscription:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// You can set the channel before connect\u003c/span\u003e\nsubscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"channel1\"\u003c/span\u003e).handler(payload -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + payload);\n});\n\nsubscriber.connect(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Or you can set the channel after connect\u003c/span\u003e\n    subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"channel2\"\u003c/span\u003e).handler(payload -\u0026gt; {\n      System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + payload);\n    });\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe channel name that is given to the channel method will be the exact name of the channel as held by PostgreSQL for sending\nnotifications.  Note this is different than the representation of the channel name in SQL, and\ninternally \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/pubsub/PgSubscriber.html\"\u003ePgSubscriber\u003c/a\u003e\u003c/code\u003e will prepare the submitted channel name as a quoted identifier:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)\n);\n\nsubscriber.connect(ar -\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n      \u003cspan class=\"hljs-comment\"\u003e// Complex channel name - name in PostgreSQL requires a quoted ID\u003c/span\u003e\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"Complex.Channel.Name\"\u003c/span\u003e).handler(payload -\u0026gt; {\n        System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + payload);\n      });\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"Complex.Channel.Name\"\u003c/span\u003e).subscribeHandler(subscribed -\u0026gt; {\n    \t  subscriber.actualConnection().query(\n    \t\t\t  \u003cspan class=\"hljs-string\"\u003e\"NOTIFY \\\"Complex.Channel.Name\\\", 'msg'\"\u003c/span\u003e, notified -\u0026gt; {\n    \t\t  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Notified \\\"Complex.Channel.Name\\\"\"\u003c/span\u003e);\n    \t  });\n      });\n\n      \u003cspan class=\"hljs-comment\"\u003e// PostgreSQL simple ID's are forced lower-case\u003c/span\u003e\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"simple_channel\"\u003c/span\u003e).handler(payload -\u0026gt; {\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + payload);\n      });\n      subscriber.channel(\u003cspan class=\"hljs-string\"\u003e\"simple_channel\"\u003c/span\u003e).subscribeHandler(subscribed -\u0026gt; {\n    \t  \u003cspan class=\"hljs-comment\"\u003e// The following simple channel identifier is forced to lower case\u003c/span\u003e\n          subscriber.actualConnection().query(\n        \t\t\u003cspan class=\"hljs-string\"\u003e\"NOTIFY Simple_CHANNEL, 'msg'\"\u003c/span\u003e, notified -\u0026gt; {\n      \t\t  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Notified simple_channel\"\u003c/span\u003e);\n      \t  });\n      });\n\n      \u003cspan class=\"hljs-comment\"\u003e// The following channel name is longer than the current\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// (NAMEDATALEN = 64) - 1 == 63 character limit and will be truncated\u003c/span\u003e\n      subscriber.channel(\n    \t\t  \u003cspan class=\"hljs-string\"\u003e\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb\"\u003c/span\u003e\n    \t\t  ).handler(payload -\u0026gt; {\n          System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Received \"\u003c/span\u003e + payload);\n      });\n    }\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can provide a reconnect policy as a function that takes the number of \u003ccode\u003eretries\u003c/code\u003e as argument and returns an \u003ccode\u003eamountOfTime\u003c/code\u003e\nvalue:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ewhen \u003ccode\u003eamountOfTime \u0026lt; 0\u003c/code\u003e: the subscriber is closed and there is no retry\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ewhen \u003ccode\u003eamountOfTime = 0\u003c/code\u003e: the subscriber retries to connect immediately\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ewhen \u003ccode\u003eamountOfTime \u0026gt; 0\u003c/code\u003e: the subscriber retries after \u003ccode\u003eamountOfTime\u003c/code\u003e milliseconds\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgSubscriber subscriber = PgSubscriber.subscriber(vertx, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// Reconnect at most 10 times after 100 ms each\u003c/span\u003e\nsubscriber.reconnectPolicy(retries -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (retries \u0026lt; \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100L\u003c/span\u003e;\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e -\u003cspan class=\"hljs-number\"\u003e1L\u003c/span\u003e;\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe default policy is to not reconnect.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cancelling_request\"\u003e\u003ca class=\"anchor\" href=\"#_cancelling_request\"\u003e\u003c/a\u003eCancelling Request\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePostgreSQL supports cancellation of requests in progress. You can cancel inflight requests using \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnection.html#cancelRequest-io.vertx.core.Handler-\"\u003ecancelRequest\u003c/a\u003e\u003c/code\u003e. Cancelling a request opens a new connection to the server and cancels the request and then close the connection.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003econnection.query(\u003cspan class=\"hljs-string\"\u003e\"SELECT pg_sleep(20)\"\u003c/span\u003e, ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// imagine this is a long query and is still running\u003c/span\u003e\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Query success\"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// the server will abort the current query after cancelling request\u003c/span\u003e\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failed to query due to \"\u003c/span\u003e + ar.cause().getMessage());\n  }\n});\nconnection.cancelRequest(ar -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ar.succeeded()) {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Cancelling request has been sent\"\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failed to send cancelling request\"\u003c/span\u003e);\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"quoteblock\"\u003e\n\u003cblockquote\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe cancellation signal might or might not have any effect — for example, if it arrives after the backend has finished processing the query, then it will have no effect. If the cancellation is effective, it results in the current command being terminated early with an error message.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/blockquote\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information can be found in the \u003ca href=\"https://www.postgresql.org/docs/11/protocol-flow.html#id-1.10.5.7.9\"\u003eofficial documentation\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_ssltls\"\u003e\u003ca class=\"anchor\" href=\"#_using_ssltls\"\u003e\u003c/a\u003eUsing SSL/TLS\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo configure the client to use SSL connection, you can configure the \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/pgclient/PgConnectOptions.html\"\u003ePgConnectOptions\u003c/a\u003e\u003c/code\u003e\nlike a Vert.x \u003ccode\u003eNetClient\u003c/code\u003e.\nAll \u003ca href=\"https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-PROTECTION\"\u003eSSL modes\u003c/a\u003e are supported and you are able to configure \u003ccode\u003esslmode\u003c/code\u003e. The client is in \u003ccode\u003eDISABLE\u003c/code\u003e SSL mode by default.\n\u003ccode\u003essl\u003c/code\u003e parameter is kept as a mere shortcut for setting \u003ccode\u003esslmode\u003c/code\u003e. \u003ccode\u003esetSsl(true)\u003c/code\u003e is equivalent to \u003ccode\u003esetSslMode(VERIFY_CA)\u003c/code\u003e and \u003ccode\u003esetSsl(false)\u003c/code\u003e is equivalent to \u003ccode\u003esetSslMode(DISABLE)\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003ePgConnectOptions options = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PgConnectOptions()\n  .setPort(\u003cspan class=\"hljs-number\"\u003e5432\u003c/span\u003e)\n  .setHost(\u003cspan class=\"hljs-string\"\u003e\"the-host\"\u003c/span\u003e)\n  .setDatabase(\u003cspan class=\"hljs-string\"\u003e\"the-db\"\u003c/span\u003e)\n  .setUser(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e)\n  .setPassword(\u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e)\n  .setSslMode(SslMode.VERIFY_CA)\n  .setPemTrustOptions(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PemTrustOptions().addCertPath(\u003cspan class=\"hljs-string\"\u003e\"/path/to/cert.pem\"\u003c/span\u003e));\n\nPgConnection.connect(vertx, options, res -\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.succeeded()) {\n    \u003cspan class=\"hljs-comment\"\u003e// Connected with SSL\u003c/span\u003e\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Could not connect \"\u003c/span\u003e + res.cause());\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information can be found in the \u003ca href=\"http://vertx.io/docs/vertx-core/java/#ssl\"\u003eVert.x documentation\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_using_a_proxy\"\u003e\u003ca class=\"anchor\" href=\"#_using_a_proxy\"\u003e\u003c/a\u003eUsing a proxy\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also configure the client to use an HTTP/1.x CONNECT, SOCKS4a or SOCKS5 proxy.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMore information can be found in the \u003ca href=\"http://vertx.io/docs/vertx-core/java/#_using_a_proxy_for_client_connections\"\u003eVert.x documentation\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_rxjava_2_api\"\u003e\u003ca class=\"anchor\" href=\"#_rxjava_2_api\"\u003e\u003c/a\u003eRxJava 2 API\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Rxified API supports RxJava 1 and RxJava 2, the following examples use RxJava 2.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eSingle\u0026lt;RowSet\u0026lt;Row\u0026gt;\u0026gt; single = pool.rxQuery(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE id='julien'\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// Execute the query\u003c/span\u003e\nsingle.subscribe(result -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Got \"\u003c/span\u003e + result.size() + \u003cspan class=\"hljs-string\"\u003e\" rows \"\u003c/span\u003e);\n}, err -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Failure: \"\u003c/span\u003e + err.getMessage());\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_streaming\"\u003e\u003ca class=\"anchor\" href=\"#_streaming\"\u003e\u003c/a\u003eStreaming\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRxJava 2 supports \u003ccode\u003eObservable\u003c/code\u003e and \u003ccode\u003eFlowable\u003c/code\u003e types, these are exposed using\nthe \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/reactivex/sqlclient/RowStream.html\"\u003eRowStream\u003c/a\u003e\u003c/code\u003e that you can get\nfrom a \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/reactivex/sqlclient/PreparedQuery.html\"\u003ePreparedQuery\u003c/a\u003e\u003c/code\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eObservable\u0026lt;Row\u0026gt; observable = pool.rxBegin() \u003cspan class=\"hljs-comment\"\u003e// Cursors require a transaction\u003c/span\u003e\n  .flatMapObservable(tx -\u0026gt; tx\n    .rxPrepare(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE first_name LIKE $1\"\u003c/span\u003e)\n    .flatMapObservable(preparedQuery -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n      RowStream\u0026lt;Row\u0026gt; stream = preparedQuery.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e));\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e stream.toObservable();\n    })\n    \u003cspan class=\"hljs-comment\"\u003e// Commit the transaction after usage\u003c/span\u003e\n    .doAfterTerminate(tx::commit));\n\n\u003cspan class=\"hljs-comment\"\u003e// Then subscribe\u003c/span\u003e\nobservable.subscribe(row -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"User: \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e));\n}, err -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Error: \"\u003c/span\u003e + err.getMessage());\n}, () -\u0026gt; {\n  System.out.println(\u003cspan class=\"hljs-string\"\u003e\"End of stream\"\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe same example using \u003ccode\u003eFlowable\u003c/code\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eFlowable\u0026lt;Row\u0026gt; flowable = pool.rxBegin()  \u003cspan class=\"hljs-comment\"\u003e// Cursors require a transaction\u003c/span\u003e\n  .flatMapPublisher(tx -\u0026gt; tx.rxPrepare(\u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM users WHERE first_name LIKE $1\"\u003c/span\u003e)\n    .flatMapPublisher(preparedQuery -\u0026gt; {\n      \u003cspan class=\"hljs-comment\"\u003e// Fetch 50 rows at a time\u003c/span\u003e\n      RowStream\u0026lt;Row\u0026gt; stream = preparedQuery.createStream(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, Tuple.of(\u003cspan class=\"hljs-string\"\u003e\"julien\"\u003c/span\u003e));\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e stream.toFlowable();\n    })\n    \u003cspan class=\"hljs-comment\"\u003e// Commit the transaction after usage\u003c/span\u003e\n    .doAfterTerminate(tx::commit));\n\n\u003cspan class=\"hljs-comment\"\u003e// Then subscribe\u003c/span\u003e\nflowable.subscribe(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Subscriber\u0026lt;Row\u0026gt;() {\n\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e Subscription sub;\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonSubscribe\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Subscription subscription)\u003c/span\u003e \u003c/span\u003e{\n    sub = subscription;\n    subscription.request(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonNext\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Row row)\u003c/span\u003e \u003c/span\u003e{\n    sub.request(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"User: \"\u003c/span\u003e + row.getString(\u003cspan class=\"hljs-string\"\u003e\"last_name\"\u003c/span\u003e));\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonError\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Throwable err)\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"Error: \"\u003c/span\u003e + err.getMessage());\n  }\n\n  \u003cspan class=\"hljs-meta\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonComplete\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n    System.out.println(\u003cspan class=\"hljs-string\"\u003e\"End of stream\"\u003c/span\u003e);\n  }\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_transaction\"\u003e\u003ca class=\"anchor\" href=\"#_transaction\"\u003e\u003c/a\u003eTransaction\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe simplified transaction API allows to easily write transactional\nasynchronous flows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eCompletable completable = pool\n  .rxBegin()\n  .flatMapCompletable(tx -\u0026gt; tx\n    .rxQuery(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')\"\u003c/span\u003e)\n    .flatMap(result -\u0026gt; tx.rxQuery(\u003cspan class=\"hljs-string\"\u003e\"INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')\"\u003c/span\u003e))\n    .flatMapCompletable(result -\u0026gt; tx.rxCommit()));\n\ncompletable.subscribe(() -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Transaction succeeded\u003c/span\u003e\n}, err -\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Transaction failed\u003c/span\u003e\n});\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["3.8.4","vertx-pg-client","java"]},"buildId":"4QySOxHX4ARCYiwmlOhZy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.3b9874ba65db13e7d868.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.f6b3df68d79eb424ded3.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-f144718c033f8d0b431b.js" async=""></script><script src="/_next/static/4QySOxHX4ARCYiwmlOhZy/_buildManifest.js" async=""></script><script src="/_next/static/4QySOxHX4ARCYiwmlOhZy/_ssgManifest.js" async=""></script></body></html>