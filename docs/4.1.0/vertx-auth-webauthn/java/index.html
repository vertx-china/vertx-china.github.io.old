<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>Webauthn 鉴权与授权 | Eclipse Vert.x</title><link rel="preload" href="https://api.github.com/repos/vert-x3/vertx-auth" as="fetch" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/styles.bee17d6f.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.bee17d6f.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" as="script"/><link rel="preload" href="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7689a0583e30048c05ff.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-3a425d1828d3af7aa498.js" as="script"/></head><body data-build-time="2021-06-02T07:28:29.254Z" data-build-commit-id="67762caa5fd3e52463054160d8d010c0f359a90e" data-build-run-id="898581520"><div id="__next"><main class="page docs"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">开始<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/introduction-to-vertx-and-reactive/"><li class="dropdown-item">简介</li></a><a href="/get-started/"><li class="dropdown-item">开始</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">应用生成器 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/docs/">文档</a><span class="navbar-menu-item with-drop-down"><div class="dropdown"><a class="dropdown-title">资源<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu"><a href="/faq/"><li class="dropdown-item">答疑</li></a><a href="/channels/"><li class="dropdown-item">联系渠道</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer"><li class="dropdown-item">操作指南 <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer"><li class="dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="navbar-menu-item" href="/blog/">博客</a><a class="navbar-menu-item" href="/community/">社区</a><a class="navbar-menu-item" href="/translation/">翻译团队</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x 用户组" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x 用户组</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a><a href="https://shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad" class="navbar-social-link" title="Vert.x中国用户组QQ群" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Vert.x中国用户组QQ群"><title>Vert.x中国用户组QQ群</title><path d="M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836C19.526 4.632 17.351 0 12 0S4.474 4.632 4.474 9.241c0 .274.013.804.014.836l-1.08 2.695a38.97 38.97 0 0 0-.802 2.264c-1.021 3.283-.69 4.643-.438 4.673.54.065 2.103-2.472 2.103-2.472 0 1.469.756 3.387 2.394 4.771-.612.188-1.363.479-1.845.835-.434.32-.379.646-.301.778.343.578 5.883.369 7.482.189 1.6.18 7.14.389 7.483-.189.078-.132.132-.458-.301-.778-.483-.356-1.233-.646-1.846-.836 1.637-1.384 2.393-3.302 2.393-4.771 0 0 1.563 2.537 2.103 2.472.251-.03.581-1.39-.438-4.673zM12.662 4.846c.039-1.052.659-1.878 1.385-1.846s1.281.912 1.242 1.964c-.039 1.051-.659 1.878-1.385 1.846s-1.282-.912-1.242-1.964zM9.954 3c.725-.033 1.345.794 1.384 1.846.04 1.052-.517 1.931-1.242 1.963-.726.033-1.346-.794-1.385-1.845C8.672 3.912 9.228 3.033 9.954 3zM7.421 8.294c.194-.43 2.147-.908 4.566-.908h.026c2.418 0 4.372.479 4.566.908a.14.14 0 0 1 .014.061c0 .031-.01.059-.026.083-.163.238-2.333 1.416-4.553 1.416h-.026c-2.221 0-4.39-1.178-4.553-1.416a.136.136 0 0 1-.014-.144zm10.422 8.622c-.22 3.676-2.403 5.987-5.774 6.021h-.137c-3.37-.033-5.554-2.345-5.773-6.021-.081-1.35.001-2.496.147-3.43.318.063.638.122.958.176v3.506s1.658.334 3.318.103v-3.225c.488.027.96.04 1.406.034h.025c1.678.021 3.714-.204 5.683-.594.146.934.227 2.08.147 3.43zM10.48 5.804c.313-.041.542-.409.508-.825-.033-.415-.314-.72-.629-.679-.313.04-.541.409-.508.824.034.417.315.72.629.68zM14.479 5.156c.078.037.221.042.289-.146.035-.095.025-.165-.009-.214-.023-.033-.133-.118-.371-.176-.904-.22-1.341.384-1.405.499-.04.072-.012.176.056.227.067.051.139.037.179-.006.58-.628 1.21-.208 1.261-.184z"></path></svg></a></div></div></div></div></header><div class="page-content docs-content"><div class="container"><div class="docs-content-wrapper"><aside class=""><div class="docs-content-wrapper-sidebar"><div class="search-panel"><div class="search"><input type="text" placeholder="Search..." value=""/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon-delete"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div><ul class="search-results"></ul><div class="search-results-none">No results.</div></div><div class="docs-content-toc"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_webauthn_api">WebAuthn API</a></li>
<li><a href="#_registration">Registration</a></li>
<li><a href="#_login">Login</a></li>
<li><a href="#_device_attestation">Device Attestation</a></li>
<li><a href="#_a_simple_example">A simple example</a>
<ul class="sectlevel2">
<li><a href="#_create_a_registration_request">Create a Registration request</a></li>
<li><a href="#_verify_the_registration_request">Verify the registration request</a></li>
<li><a href="#_create_a_login_request">Create a Login request</a></li>
<li><a href="#_verify_the_login_request">Verify the Login request</a></li>
</ul>
</li>
<li><a href="#_metadata_service">Metadata Service</a></li>
<li><a href="#_updating_certificates">Updating Certificates</a></li>
</ul>
</div></div></div></aside><div class="docs-content-sidebar-toggle"><div style="position:relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="docs-content-inner"><div class="docs-content-metadata"><div class="docs-content-metadata-left"><div class="docs-content-metadata-repo"><div class="github-stars"><a href="https://github.com/vert-x3/vertx-auth"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>null stars</a></div></div><div><a href="https://vertx.io/docs/apidocs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> API</a></div><div class="docs-content-metadata-edit"><a href="https://github.com/vertx-china/vertx-web-site/tree/master/docs/translation/vertx-auth-webauthn/java"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> 改进翻译</a></div><span class="docs-content-metadata-version"><div class="dropdown"><a class="dropdown-title">v4.1.0<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="dropdown-menu align-right"><a href="/docs/vertx-auth-webauthn/java/"><li class="dropdown-item active has-active-siblings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg>Latest (v<!-- -->4.1.0<!-- -->)</li></a><a href="/docs/4.0.3/vertx-auth-webauthn/java/"><li class="dropdown-item has-active-siblings">v<!-- -->4.0.3</li></a></ul></div></span></div></div><div><h1>WebAuthn auth provider</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This component contains an out of the box a <a href="https://github.com/herrjemand/awesome-webauthn#server-libs">FIDO CONFORMANT</a>
WebAuthn implementation. To use this project, add the following dependency to the <em>dependencies</em> section of your build
descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-auth-webauthn<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">'io.vertx:vertx-auth-webauthn:4.1.0'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API">WebAuthn (Web Authentication)</a> is a web standard
for authenticating users to web-based applications using public/private key cryptography. Strictly speaking, WebAuthn is
just the name of the browser API and is part of <a href="https://fidoalliance.org/fido2/">FIDO2</a>. FIDO2 is the overarching term of
a set of specifications, including WebAuthn and CTAP. FIDO2 is the successor of the FIDO Universal 2nd Factor (U2F)
legacy protocol.</p>
</div>
<div class="paragraph">
<p>As an application developer, we don&#8217;t deal with CTAP (Client-to-Authenticator Protocol), which is the protocol that the
browser uses to speak with an authenticator like a FIDO security key.</p>
</div>
<div class="paragraph">
<p>FIDO2 works with public/private keys. The user has an authenticator, which creates public/private key pairs. These key
pairs are different for each site. The public key is transferred to the server and stored in the user&#8217;s account. The
private key never leaves the authenticator. To login, the server first creates a random challenge (a random sequence of
bytes), sends it to the authenticator. The authenticator signs the challenge with his private key and sends the
signature back to the server. The server verifies the signature with the stored public key and grants access if the
signature is valid.</p>
</div>
<div class="paragraph">
<p>Traditionally this technology needs a hardware security token like a <a href="https://www.yubico.com/products/">Yubico key</a> or a
key from <a href="https://www.ftsafe.com/Products/FIDO">Feitian</a> to name two brands.</p>
</div>
<div class="paragraph">
<p>FIDO2 still supports these hardware keys, but the technology also supports alternatives. If you have an Android 7+ phone
or a Windows 10 system, you don&#8217;t need to buy a FIDO2 security key if you want to play with WebAuthn.</p>
</div>
<div class="paragraph">
<p>In <a href="https://fidoalliance.org/news-your-google-android-7-phone-is-now-a-fido2-security-key/">April 2019, Google announced</a>
that any phone running Android 7+ can function as a FIDO2 security key. In
<a href="https://www.microsoft.com/en-us/microsoft-365/blog/2018/11/20/sign-in-to-your-microsoft-account-without-a-password-using-windows-hello-or-a-security-key/">November 2018, Microsoft announced</a>
that you can use Windows Hello as a security key for FIDO2. In <a href="https://developer.apple.com/videos/play/wwdc2020/10670/">June 2020 Apple announced</a>
that you can use iOS FaceID and TouchID for the web by adopting webauthn standard.</p>
</div>
<div class="paragraph">
<p>WebAuthn is implemented in Edge, Firefox, Chrome, and Safari. Visit <a href="https://caniuse.com" class="bare">https://caniuse.com</a> to check out the current state
of implementations: <a href="https://caniuse.com/#search=webauthn" class="bare">https://caniuse.com/#search=webauthn</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_webauthn_api"><a class="anchor" href="#_webauthn_api"></a>WebAuthn API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API">Web Authentication API</a> is an extension of
the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Credential_Management_API">Credential Management API</a>.</p>
</div>
<div class="paragraph">
<p>WebAuthn extends the two functions from the Credential Management API <a href="https://developer.mozilla.org/en-US/docs/Web/API/CredentialsContainer/create">navigator.credentials.create()</a>
and <a href="https://developer.mozilla.org/en-US/docs/Web/API/CredentialsContainer/get">navigator.credentials.get()</a> so they
accept a publicKey parameter.</p>
</div>
<div class="paragraph">
<p>To simplify the usage of the API a simple JavaScript client application is provided here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-auth-webauthn<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>client<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>js<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile <span class="hljs-string">'io.vertx:vertx-auth-webauthn:4.1.0:client@js'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The script should be used in cooperation with vertx-web as it handles the API interaction between the web layer and the
auth code in this library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registration"><a class="anchor" href="#_registration"></a>Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Registration is the process of enrolling a new authenticator to the database and associate with the user.</p>
</div>
<div class="paragraph">
<p>The process takes 2 steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A call to generate a <code><a href="../../apidocs/io/vertx/ext/auth/webauthn/WebAuthn.html#createCredentialsOptions-io.vertx.core.json.JsonObject-">createCredentialsOptions</a></code></p>
</li>
<li>
<p>A call with the solution to the challenge to the normal <code>authenticate</code> API method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the solution is correct, the new authenticator should be added to the storage and be usable for login purposes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_login"><a class="anchor" href="#_login"></a>Login</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like the registration, login is a 2 step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A call to generate a <code><a href="../../apidocs/io/vertx/ext/auth/webauthn/WebAuthn.html#getCredentialsOptions-java.lang.String-">getCredentialsOptions</a></code></p>
</li>
<li>
<p>A call with the solution to the challenge to the normal <code>authenticate</code> API method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the challenge is correctly solved, the user is considered logged in.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_device_attestation"><a class="anchor" href="#_device_attestation"></a>Device Attestation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When an authenticator registers a new key pair with a service, the authenticator signs the public key with an
attestation certificate. The attestation certificate is built into the authenticator during manufacturing time and is
specific to a device model. That is, all "Samsung Galaxy S8" phones, manufactured at a specific time or particular
manufacturing run, have the same attestation certificate.</p>
</div>
<div class="paragraph">
<p>Different devices have different attestation formats. The pre-defined attestation formats in WebAuthn are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Packed</code> - a generic attestation format that is commonly used by devices whose sole function is as a WebAuthn authenticator, such as security keys.</p>
</li>
<li>
<p><code>TPM</code> - the Trusted Platform Module (TPM) is a set of specifications from the Trusted Platform Group (TPG). This attestation format is commonly found in desktop computers and is used by Windows Hello as its preferred attestation format.</p>
</li>
<li>
<p><code>Android Key Attestation</code> - one of the features added in Android O was Android Key Attestation, which enables the Android operating system to attest to keys.</p>
</li>
<li>
<p><code>Android SafetyNet</code> - prior to Android Key Attestation, the only option for Android devices was to create Android SafetyNet attestations</p>
</li>
<li>
<p><code>FIDO U2F</code> - security keys that implement the FIDO U2F standard use this format</p>
</li>
<li>
<p><code>Apple</code> - Verifies the Anonymous Apple device attestation.</p>
</li>
<li>
<p><code>none</code> - browsers may prompt users whether they want a site to be allowed to see their attestation data and/or may remove attestation data from the authenticator&#8217;s response if the <code>attestation</code> parameter in <code>navigator.credentials.create()</code> is set to <code>none</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The purpose of attestation is to cryptographically prove that a newly generated key pair came from a specific device.
This provides a root of trust for a newly generated key pair as well as being able to identify the attributes of a
device being used (how the private key is protected; if / what kind of biometric is being used; whether a device has
been certified; etc.).</p>
</div>
<div class="paragraph">
<p>It should be noted that while attestation provides the capability for a root of trust, validating the root of trust is
frequently not necessary. When registering an authenticator for a new account, typically a Trust On First Use (TOFU)
model applies; and when adding an authenticator to an existing account, a user has already been authenticated and has
established a secure session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_simple_example"><a class="anchor" href="#_a_simple_example"></a>A simple example</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_registration_request"><a class="anchor" href="#_create_a_registration_request"></a>Create a Registration request</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">WebAuthn webAuthN = WebAuthn.create(
  vertx,
  <span class="hljs-keyword">new</span> WebAuthnOptions()
    .setRelyingParty(<span class="hljs-keyword">new</span> RelyingParty().setName(<span class="hljs-string">"ACME Corporation"</span>)))
  .authenticatorFetcher(query -&gt; {
    <span class="hljs-comment">// function that fetches some authenticators from a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture(authenticators);
  })
  .authenticatorUpdater(authenticator -&gt; {
    <span class="hljs-comment">// function that updates an authenticator to a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture();
  });

<span class="hljs-comment">// some user</span>
JsonObject user = <span class="hljs-keyword">new</span> JsonObject()
  <span class="hljs-comment">// id is expected to be a base64url string</span>
  .put(<span class="hljs-string">"id"</span>, <span class="hljs-string">"000000000000000000000000"</span>)
  .put(<span class="hljs-string">"rawId"</span>, <span class="hljs-string">"000000000000000000000000"</span>)
  .put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"john.doe@email.com"</span>)
  <span class="hljs-comment">// optionally</span>
  .put(<span class="hljs-string">"displayName"</span>, <span class="hljs-string">"John Doe"</span>)
  .put(<span class="hljs-string">"icon"</span>, <span class="hljs-string">"https://pics.example.com/00/p/aBjjjpqPb.png"</span>);

webAuthN
  .createCredentialsOptions(user)
  .onSuccess(challengeResponse -&gt; {
    <span class="hljs-comment">// return the challenge to the browser</span>
    <span class="hljs-comment">// for further processing</span>
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verify_the_registration_request"><a class="anchor" href="#_verify_the_registration_request"></a>Verify the registration request</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">WebAuthn webAuthN = WebAuthn.create(
  vertx,
  <span class="hljs-keyword">new</span> WebAuthnOptions()
    .setRelyingParty(<span class="hljs-keyword">new</span> RelyingParty().setName(<span class="hljs-string">"ACME Corporation"</span>)))
  .authenticatorFetcher(query -&gt; {
    <span class="hljs-comment">// function that fetches some authenticators from a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture(authenticators);
  })
  .authenticatorUpdater(authenticator -&gt; {
    <span class="hljs-comment">// function that updates an authenticator to a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture();
  });

<span class="hljs-comment">// the response received from the browser</span>
JsonObject request = <span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"id"</span>, <span class="hljs-string">"Q-MHP0Xq20CKM5LW3qBt9gu5vdOYLNZc3jCcgyyL..."</span>)
  .put(<span class="hljs-string">"rawId"</span>, <span class="hljs-string">"Q-MHP0Xq20CKM5LW3qBt9gu5vdOYLNZc3jCcgyyL..."</span>)
  .put(<span class="hljs-string">"type"</span>, <span class="hljs-string">"public-key"</span>)
  .put(<span class="hljs-string">"response"</span>, <span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">"attestationObject"</span>, <span class="hljs-string">"o2NmbXRkbm9uZWdhdHRTdG10oGhhdXRoRGF0YVj..."</span>)
    .put(<span class="hljs-string">"clientDataJSON"</span>, <span class="hljs-string">"eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlb..."</span>));

webAuthN
  .authenticate(
    <span class="hljs-keyword">new</span> JsonObject()
      <span class="hljs-comment">// the username you want to link to</span>
      .put(<span class="hljs-string">"username"</span>, <span class="hljs-string">"paulo"</span>)
      <span class="hljs-comment">// the server origin</span>
      .put(<span class="hljs-string">"origin"</span>, <span class="hljs-string">"https://192.168.178.206.xip.io:8443"</span>)
      <span class="hljs-comment">// the server domain</span>
      .put(<span class="hljs-string">"domain"</span>, <span class="hljs-string">"192.168.178.206.xip.io"</span>)
      <span class="hljs-comment">// the challenge given on the previous step</span>
      .put(<span class="hljs-string">"challenge"</span>, <span class="hljs-string">"BH7EKIDXU6Ct_96xTzG0l62qMhW_Ef_K4MQdDLoVNc1UX..."</span>)
      .put(<span class="hljs-string">"webauthn"</span>, request))
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// success!</span>
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_login_request"><a class="anchor" href="#_create_a_login_request"></a>Create a Login request</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">WebAuthn webAuthN = WebAuthn.create(
  vertx,
  <span class="hljs-keyword">new</span> WebAuthnOptions()
    .setRelyingParty(<span class="hljs-keyword">new</span> RelyingParty().setName(<span class="hljs-string">"ACME Corporation"</span>)))
  .authenticatorFetcher(query -&gt; {
    <span class="hljs-comment">// function that fetches some authenticators from a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture(authenticators);
  })
  .authenticatorUpdater(authenticator -&gt; {
    <span class="hljs-comment">// function that updates an authenticator to a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture();
  });

<span class="hljs-comment">// Login only requires the username and can even be set to null if</span>
<span class="hljs-comment">// resident keys are supported, in this case the authenticator remembers</span>
<span class="hljs-comment">// the public key used for the relying party</span>
webAuthN.getCredentialsOptions(<span class="hljs-string">"paulo"</span>)
  .onSuccess(challengeResponse -&gt; {
    <span class="hljs-comment">// return the challenge to the browser</span>
    <span class="hljs-comment">// for further processing</span>
  });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verify_the_login_request"><a class="anchor" href="#_verify_the_login_request"></a>Verify the Login request</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">WebAuthn webAuthN = WebAuthn.create(
  vertx,
  <span class="hljs-keyword">new</span> WebAuthnOptions()
    .setRelyingParty(<span class="hljs-keyword">new</span> RelyingParty().setName(<span class="hljs-string">"ACME Corporation"</span>)))
  .authenticatorFetcher(query -&gt; {
    <span class="hljs-comment">// function that fetches some authenticators from a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture(authenticators);
  })
  .authenticatorUpdater(authenticator -&gt; {
    <span class="hljs-comment">// function that updates an authenticator to a</span>
    <span class="hljs-comment">// persistence storage</span>
    <span class="hljs-keyword">return</span> Future.succeededFuture();
  });

<span class="hljs-comment">// The response from the login challenge request</span>
JsonObject body = <span class="hljs-keyword">new</span> JsonObject()
  .put(<span class="hljs-string">"id"</span>, <span class="hljs-string">"rYLaf9xagyA2YnO-W3CZDW8udSg8VeMMm25nenU7nCSxUqy1pEzOdb9o..."</span>)
  .put(<span class="hljs-string">"rawId"</span>, <span class="hljs-string">"rYLaf9xagyA2YnO-W3CZDW8udSg8VeMMm25nenU7nCSxUqy1pEzOdb9o..."</span>)
  .put(<span class="hljs-string">"type"</span>, <span class="hljs-string">"public-key"</span>)
  .put(<span class="hljs-string">"response"</span>, <span class="hljs-keyword">new</span> JsonObject()
    .put(<span class="hljs-string">"authenticatorData"</span>, <span class="hljs-string">"fxV8VVBPmz66RLzscHpg5yjRhO..."</span>)
    .put(<span class="hljs-string">"clientDataJSON"</span>, <span class="hljs-string">"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlb..."</span>)
    .put(<span class="hljs-string">"signature"</span>, <span class="hljs-string">"MEUCIFXjL0ONRuLP1hkdlRJ8d0ofuRAS12c6w8WgByr-0yQZA..."</span>)
    .put(<span class="hljs-string">"userHandle"</span>, <span class="hljs-string">""</span>));

webAuthN.authenticate(<span class="hljs-keyword">new</span> JsonObject()
  <span class="hljs-comment">// the username you want to link to</span>
  .put(<span class="hljs-string">"username"</span>, <span class="hljs-string">"paulo"</span>)
  <span class="hljs-comment">// the server origin</span>
  .put(<span class="hljs-string">"origin"</span>, <span class="hljs-string">"https://192.168.178.206.xip.io:8443"</span>)
  <span class="hljs-comment">// the server domain</span>
  .put(<span class="hljs-string">"domain"</span>, <span class="hljs-string">"192.168.178.206.xip.io"</span>)
  <span class="hljs-comment">// the challenge given on the previous step</span>
  .put(<span class="hljs-string">"challenge"</span>, <span class="hljs-string">"BH7EKIDXU6Ct_96xTzG0l62qMhW_Ef_K4MQdDLoVNc1UX..."</span>)
  .put(<span class="hljs-string">"webauthn"</span>, body))
  .onSuccess(user -&gt; {
    <span class="hljs-comment">// success!</span>
  });</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metadata_service"><a class="anchor" href="#_metadata_service"></a>Metadata Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The current module passes all FIDO2 compliance tests <strong>including</strong> the yet to be final FIDO2 Metadata Service API.
This means that we follow the spec and this handler <strong>can</strong> detect tokens that have been marked as not trustable
by the token vendor. For example, when a security bug allowed a private key to be extracted from a token.</p>
</div>
<div class="paragraph">
<p>In order to support the Metadata Service API, as a user you need to register yourself or your application at:
<a href="https://fidoalliance.org/metadata/">https://fidoalliance.org/metadata</a></p>
</div>
<div class="paragraph">
<p>With this the <code>APIKey</code> given to you you can configure the application as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">final</span> WebAuthnOptions webAuthnOptions = <span class="hljs-keyword">new</span> WebAuthnOptions()
  <span class="hljs-comment">// in order to fully trust the MDS tokens we should load the CRLs as</span>
  <span class="hljs-comment">// described on https://fidoalliance.org/metadata/</span>

  <span class="hljs-comment">// here the content of: http://mds.fidoalliance.org/Root.crl</span>
  .addRootCrl(
    <span class="hljs-string">"MIIB1jCCAV0CAQEwCg..."</span>)
  <span class="hljs-comment">// here the content of: http://mds.fidoalliance.org/CA-1.crl</span>
  .addRootCrl(
    <span class="hljs-string">"MIIB5DCCAYoCAQEwCg..."</span>);

<span class="hljs-comment">// create the webauthn security object like before</span>
<span class="hljs-keyword">final</span> WebAuthn webAuthN = WebAuthn.create(vertx, webAuthnOptions);

webAuthN.metaDataService()
  .fetchTOC(<span class="hljs-string">"https://mds2.fidoalliance.org/?token=your-access-token-string"</span>)
  .onSuccess(allOk -&gt; {
    <span class="hljs-comment">// if all metadata was downloaded and parsed correctly allOk is true</span>
    <span class="hljs-comment">// the processing will not stop if a entry is corrupt, in that case that</span>
    <span class="hljs-comment">// specific entry is skipped and the flag is false. That also means that</span>
    <span class="hljs-comment">// that entry will be tagged and "not trustable" as we can't make any</span>
    <span class="hljs-comment">// valid decision.</span>
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_certificates"><a class="anchor" href="#_updating_certificates"></a>Updating Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Almost all device attestations are based on <code>X509</code> Certificate checks. This means that certificates can and will expire
at some point in time. By default, the current "Active" certificates are hardcoded on the <code>WebAuthnOptions</code> object.</p>
</div>
<div class="paragraph">
<p>However if your application needs to update a certificate on it&#8217;s own, say for example, use a more up to date one, or
another with a different cypher, then you can replace the default <code>root</code> certificates for each attestation by calling:
<code>WebAuthnOptions.putRootCertificate(String, String)</code>, where the first parameter is the attestation name or "mds" for
FIDO MetaData Service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
<li>
<p>u2f</p>
</li>
<li>
<p>packed</p>
</li>
<li>
<p>android-key</p>
</li>
<li>
<p>android-safetynet</p>
</li>
<li>
<p>tpm</p>
</li>
<li>
<p>apple</p>
</li>
<li>
<p>mds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And the second the PEM formatted X509 Certificate (Boundaries are not required).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">final</span> WebAuthnOptions webAuthnOptions = <span class="hljs-keyword">new</span> WebAuthnOptions()
  <span class="hljs-comment">// fido2 MDS custom ROOT certificate</span>
  .putRootCertificate(<span class="hljs-string">"mds"</span>, <span class="hljs-string">"MIIB1jCCAV0CAQEwCg..."</span>)
  <span class="hljs-comment">// updated google root certificate from (https://pki.goog/repository/)</span>
  .putRootCertificate(<span class="hljs-string">"android-safetynet"</span>, <span class="hljs-string">"MIIDvDCCAqSgAwIBAgINAgPk9GHs..."</span>);</code></pre>
</div>
</div>
</div>
</div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMjMyLjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3ptNDE0LTI2Ni45aC0xNS4zdjQyLjJoLTguNVY2LjloLTE1LjJWMGgzOXY2Ljl6TTExOTMgMGwxNC4yIDM3LjdMMTIyMS4zIDBoMTF2NDkuMWgtOC41VjMyLjlsLjgtMjEuNy0xNC41IDM3LjloLTYuMWwtMTQuNS0zNy44LjggMjEuNnYxNi4yaC04LjVWMGgxMS4yeiIvPjwvc3ZnPg==" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">文档</a></li><li><a href="/download/">下载</a></li><li><a href="/blog/">博客</a></li><li><a href="/community/">社区</a></li><li><a href="/translation/">翻译团队</a></li><li><a href="https://github.com/eclipse-vertx/vert.x">GitHub</a></li><li><a href="https://github.com/vertx-china/vertx-web-site">翻译GitHub</a></li></ul></div><div class="footer-nav-list"><h5>资源</h5><ul class=""><li><a href="/faq/">答疑</a></li><li><a href="/channels/">联系渠道</a></li><li><a href="https://how-to.vertx.io/">操作指南</a></li><li><a href="https://start.vertx.io/">应用生成器</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse 基金会</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">隐私政策</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">使用条款</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">版权代理</a></li><li><a href="https://www.eclipse.org/legal/">法律资源</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2021<!-- --> Eclipse Vert.x™<br/>Eclipse Vert.x™ 是开源的，并在<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a>和<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>协议下获得了双重许可。<br class="footer-copyright-break"/>网站由 <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a> 设计。</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"4.1.0/vertx-auth-webauthn/java","title":"WebAuthn auth provider","fallbackGitHubStars":null,"toc":"\u003cdiv id=\"toc\" class=\"toc\"\u003e\n\u003cdiv id=\"toctitle\"\u003eTable of Contents\u003c/div\u003e\n\u003cul class=\"sectlevel1\"\u003e\n\u003cli\u003e\u003ca href=\"#_webauthn_api\"\u003eWebAuthn API\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_registration\"\u003eRegistration\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_login\"\u003eLogin\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_device_attestation\"\u003eDevice Attestation\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_a_simple_example\"\u003eA simple example\u003c/a\u003e\n\u003cul class=\"sectlevel2\"\u003e\n\u003cli\u003e\u003ca href=\"#_create_a_registration_request\"\u003eCreate a Registration request\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_verify_the_registration_request\"\u003eVerify the registration request\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_create_a_login_request\"\u003eCreate a Login request\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_verify_the_login_request\"\u003eVerify the Login request\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_metadata_service\"\u003eMetadata Service\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#_updating_certificates\"\u003eUpdating Certificates\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e","contents":"\u003ch1\u003eWebAuthn auth provider\u003c/h1\u003e\n\n\u003cdiv id=\"preamble\"\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis component contains an out of the box a \u003ca href=\"https://github.com/herrjemand/awesome-webauthn#server-libs\"\u003eFIDO CONFORMANT\u003c/a\u003e\nWebAuthn implementation. To use this project, add the following dependency to the \u003cem\u003edependencies\u003c/em\u003e section of your build\ndescriptor:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (in your \u003ccode\u003epom.xml\u003c/code\u003e):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-auth-webauthn\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (in your \u003ccode\u003ebuild.gradle\u003c/code\u003e file):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-auth-webauthn:4.1.0'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API\"\u003eWebAuthn (Web Authentication)\u003c/a\u003e is a web standard\nfor authenticating users to web-based applications using public/private key cryptography. Strictly speaking, WebAuthn is\njust the name of the browser API and is part of \u003ca href=\"https://fidoalliance.org/fido2/\"\u003eFIDO2\u003c/a\u003e. FIDO2 is the overarching term of\na set of specifications, including WebAuthn and CTAP. FIDO2 is the successor of the FIDO Universal 2nd Factor (U2F)\nlegacy protocol.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs an application developer, we don\u0026#8217;t deal with CTAP (Client-to-Authenticator Protocol), which is the protocol that the\nbrowser uses to speak with an authenticator like a FIDO security key.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFIDO2 works with public/private keys. The user has an authenticator, which creates public/private key pairs. These key\npairs are different for each site. The public key is transferred to the server and stored in the user\u0026#8217;s account. The\nprivate key never leaves the authenticator. To login, the server first creates a random challenge (a random sequence of\nbytes), sends it to the authenticator. The authenticator signs the challenge with his private key and sends the\nsignature back to the server. The server verifies the signature with the stored public key and grants access if the\nsignature is valid.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTraditionally this technology needs a hardware security token like a \u003ca href=\"https://www.yubico.com/products/\"\u003eYubico key\u003c/a\u003e or a\nkey from \u003ca href=\"https://www.ftsafe.com/Products/FIDO\"\u003eFeitian\u003c/a\u003e to name two brands.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFIDO2 still supports these hardware keys, but the technology also supports alternatives. If you have an Android 7+ phone\nor a Windows 10 system, you don\u0026#8217;t need to buy a FIDO2 security key if you want to play with WebAuthn.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn \u003ca href=\"https://fidoalliance.org/news-your-google-android-7-phone-is-now-a-fido2-security-key/\"\u003eApril 2019, Google announced\u003c/a\u003e\nthat any phone running Android 7+ can function as a FIDO2 security key. In\n\u003ca href=\"https://www.microsoft.com/en-us/microsoft-365/blog/2018/11/20/sign-in-to-your-microsoft-account-without-a-password-using-windows-hello-or-a-security-key/\"\u003eNovember 2018, Microsoft announced\u003c/a\u003e\nthat you can use Windows Hello as a security key for FIDO2. In \u003ca href=\"https://developer.apple.com/videos/play/wwdc2020/10670/\"\u003eJune 2020 Apple announced\u003c/a\u003e\nthat you can use iOS FaceID and TouchID for the web by adopting webauthn standard.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWebAuthn is implemented in Edge, Firefox, Chrome, and Safari. Visit \u003ca href=\"https://caniuse.com\" class=\"bare\"\u003ehttps://caniuse.com\u003c/a\u003e to check out the current state\nof implementations: \u003ca href=\"https://caniuse.com/#search=webauthn\" class=\"bare\"\u003ehttps://caniuse.com/#search=webauthn\u003c/a\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_webauthn_api\"\u003e\u003ca class=\"anchor\" href=\"#_webauthn_api\"\u003e\u003c/a\u003eWebAuthn API\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API\"\u003eWeb Authentication API\u003c/a\u003e is an extension of\nthe \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Credential_Management_API\"\u003eCredential Management API\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWebAuthn extends the two functions from the Credential Management API \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/CredentialsContainer/create\"\u003enavigator.credentials.create()\u003c/a\u003e\nand \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/CredentialsContainer/get\"\u003enavigator.credentials.get()\u003c/a\u003e so they\naccept a publicKey parameter.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo simplify the usage of the API a simple JavaScript client application is provided here:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMaven (in your \u003ccode\u003epom.xml\u003c/code\u003e):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eio.vertx\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003evertx-auth-webauthn\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003eclient\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eclassifier\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etype\u003c/span\u003e\u0026gt;\u003c/span\u003ejs\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etype\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.0\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eGradle (in your \u003ccode\u003ebuild.gradle\u003c/code\u003e file):\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-groovy\" data-lang=\"groovy\"\u003ecompile \u003cspan class=\"hljs-string\"\u003e'io.vertx:vertx-auth-webauthn:4.1.0:client@js'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe script should be used in cooperation with vertx-web as it handles the API interaction between the web layer and the\nauth code in this library.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_registration\"\u003e\u003ca class=\"anchor\" href=\"#_registration\"\u003e\u003c/a\u003eRegistration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRegistration is the process of enrolling a new authenticator to the database and associate with the user.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe process takes 2 steps:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eA call to generate a \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/webauthn/WebAuthn.html#createCredentialsOptions-io.vertx.core.json.JsonObject-\"\u003ecreateCredentialsOptions\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eA call with the solution to the challenge to the normal \u003ccode\u003eauthenticate\u003c/code\u003e API method.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the solution is correct, the new authenticator should be added to the storage and be usable for login purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_login\"\u003e\u003ca class=\"anchor\" href=\"#_login\"\u003e\u003c/a\u003eLogin\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eLike the registration, login is a 2 step process:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eA call to generate a \u003ccode\u003e\u003ca href=\"../../apidocs/io/vertx/ext/auth/webauthn/WebAuthn.html#getCredentialsOptions-java.lang.String-\"\u003egetCredentialsOptions\u003c/a\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eA call with the solution to the challenge to the normal \u003ccode\u003eauthenticate\u003c/code\u003e API method.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen the challenge is correctly solved, the user is considered logged in.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_device_attestation\"\u003e\u003ca class=\"anchor\" href=\"#_device_attestation\"\u003e\u003c/a\u003eDevice Attestation\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen an authenticator registers a new key pair with a service, the authenticator signs the public key with an\nattestation certificate. The attestation certificate is built into the authenticator during manufacturing time and is\nspecific to a device model. That is, all \"Samsung Galaxy S8\" phones, manufactured at a specific time or particular\nmanufacturing run, have the same attestation certificate.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDifferent devices have different attestation formats. The pre-defined attestation formats in WebAuthn are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePacked\u003c/code\u003e - a generic attestation format that is commonly used by devices whose sole function is as a WebAuthn authenticator, such as security keys.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTPM\u003c/code\u003e - the Trusted Platform Module (TPM) is a set of specifications from the Trusted Platform Group (TPG). This attestation format is commonly found in desktop computers and is used by Windows Hello as its preferred attestation format.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eAndroid Key Attestation\u003c/code\u003e - one of the features added in Android O was Android Key Attestation, which enables the Android operating system to attest to keys.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eAndroid SafetyNet\u003c/code\u003e - prior to Android Key Attestation, the only option for Android devices was to create Android SafetyNet attestations\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eFIDO U2F\u003c/code\u003e - security keys that implement the FIDO U2F standard use this format\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eApple\u003c/code\u003e - Verifies the Anonymous Apple device attestation.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003enone\u003c/code\u003e - browsers may prompt users whether they want a site to be allowed to see their attestation data and/or may remove attestation data from the authenticator\u0026#8217;s response if the \u003ccode\u003eattestation\u003c/code\u003e parameter in \u003ccode\u003enavigator.credentials.create()\u003c/code\u003e is set to \u003ccode\u003enone\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe purpose of attestation is to cryptographically prove that a newly generated key pair came from a specific device.\nThis provides a root of trust for a newly generated key pair as well as being able to identify the attributes of a\ndevice being used (how the private key is protected; if / what kind of biometric is being used; whether a device has\nbeen certified; etc.).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIt should be noted that while attestation provides the capability for a root of trust, validating the root of trust is\nfrequently not necessary. When registering an authenticator for a new account, typically a Trust On First Use (TOFU)\nmodel applies; and when adding an authenticator to an existing account, a user has already been authenticated and has\nestablished a secure session.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_a_simple_example\"\u003e\u003ca class=\"anchor\" href=\"#_a_simple_example\"\u003e\u003c/a\u003eA simple example\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_create_a_registration_request\"\u003e\u003ca class=\"anchor\" href=\"#_create_a_registration_request\"\u003e\u003c/a\u003eCreate a Registration request\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eWebAuthn webAuthN = WebAuthn.create(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n    .setRelyingParty(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e RelyingParty().setName(\u003cspan class=\"hljs-string\"\u003e\"ACME Corporation\"\u003c/span\u003e)))\n  .authenticatorFetcher(query -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that fetches some authenticators from a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(authenticators);\n  })\n  .authenticatorUpdater(authenticator -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that updates an authenticator to a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture();\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// some user\u003c/span\u003e\nJsonObject user = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  \u003cspan class=\"hljs-comment\"\u003e// id is expected to be a base64url string\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"000000000000000000000000\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"rawId\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"000000000000000000000000\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"john.doe@email.com\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// optionally\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"displayName\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"John Doe\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"icon\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"https://pics.example.com/00/p/aBjjjpqPb.png\"\u003c/span\u003e);\n\nwebAuthN\n  .createCredentialsOptions(user)\n  .onSuccess(challengeResponse -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// return the challenge to the browser\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// for further processing\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_verify_the_registration_request\"\u003e\u003ca class=\"anchor\" href=\"#_verify_the_registration_request\"\u003e\u003c/a\u003eVerify the registration request\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eWebAuthn webAuthN = WebAuthn.create(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n    .setRelyingParty(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e RelyingParty().setName(\u003cspan class=\"hljs-string\"\u003e\"ACME Corporation\"\u003c/span\u003e)))\n  .authenticatorFetcher(query -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that fetches some authenticators from a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(authenticators);\n  })\n  .authenticatorUpdater(authenticator -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that updates an authenticator to a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture();\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// the response received from the browser\u003c/span\u003e\nJsonObject request = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Q-MHP0Xq20CKM5LW3qBt9gu5vdOYLNZc3jCcgyyL...\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"rawId\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Q-MHP0Xq20CKM5LW3qBt9gu5vdOYLNZc3jCcgyyL...\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"public-key\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"response\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\"attestationObject\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"o2NmbXRkbm9uZWdhdHRTdG10oGhhdXRoRGF0YVj...\"\u003c/span\u003e)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"clientDataJSON\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlb...\"\u003c/span\u003e));\n\nwebAuthN\n  .authenticate(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n      \u003cspan class=\"hljs-comment\"\u003e// the username you want to link to\u003c/span\u003e\n      .put(\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"paulo\"\u003c/span\u003e)\n      \u003cspan class=\"hljs-comment\"\u003e// the server origin\u003c/span\u003e\n      .put(\u003cspan class=\"hljs-string\"\u003e\"origin\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"https://192.168.178.206.xip.io:8443\"\u003c/span\u003e)\n      \u003cspan class=\"hljs-comment\"\u003e// the server domain\u003c/span\u003e\n      .put(\u003cspan class=\"hljs-string\"\u003e\"domain\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"192.168.178.206.xip.io\"\u003c/span\u003e)\n      \u003cspan class=\"hljs-comment\"\u003e// the challenge given on the previous step\u003c/span\u003e\n      .put(\u003cspan class=\"hljs-string\"\u003e\"challenge\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"BH7EKIDXU6Ct_96xTzG0l62qMhW_Ef_K4MQdDLoVNc1UX...\"\u003c/span\u003e)\n      .put(\u003cspan class=\"hljs-string\"\u003e\"webauthn\"\u003c/span\u003e, request))\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// success!\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_create_a_login_request\"\u003e\u003ca class=\"anchor\" href=\"#_create_a_login_request\"\u003e\u003c/a\u003eCreate a Login request\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eWebAuthn webAuthN = WebAuthn.create(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n    .setRelyingParty(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e RelyingParty().setName(\u003cspan class=\"hljs-string\"\u003e\"ACME Corporation\"\u003c/span\u003e)))\n  .authenticatorFetcher(query -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that fetches some authenticators from a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(authenticators);\n  })\n  .authenticatorUpdater(authenticator -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that updates an authenticator to a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture();\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// Login only requires the username and can even be set to null if\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// resident keys are supported, in this case the authenticator remembers\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// the public key used for the relying party\u003c/span\u003e\nwebAuthN.getCredentialsOptions(\u003cspan class=\"hljs-string\"\u003e\"paulo\"\u003c/span\u003e)\n  .onSuccess(challengeResponse -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// return the challenge to the browser\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// for further processing\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_verify_the_login_request\"\u003e\u003ca class=\"anchor\" href=\"#_verify_the_login_request\"\u003e\u003c/a\u003eVerify the Login request\u003c/h3\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eWebAuthn webAuthN = WebAuthn.create(\n  vertx,\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n    .setRelyingParty(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e RelyingParty().setName(\u003cspan class=\"hljs-string\"\u003e\"ACME Corporation\"\u003c/span\u003e)))\n  .authenticatorFetcher(query -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that fetches some authenticators from a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture(authenticators);\n  })\n  .authenticatorUpdater(authenticator -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// function that updates an authenticator to a\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// persistence storage\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Future.succeededFuture();\n  });\n\n\u003cspan class=\"hljs-comment\"\u003e// The response from the login challenge request\u003c/span\u003e\nJsonObject body = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  .put(\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rYLaf9xagyA2YnO-W3CZDW8udSg8VeMMm25nenU7nCSxUqy1pEzOdb9o...\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"rawId\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rYLaf9xagyA2YnO-W3CZDW8udSg8VeMMm25nenU7nCSxUqy1pEzOdb9o...\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"public-key\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"response\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n    .put(\u003cspan class=\"hljs-string\"\u003e\"authenticatorData\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"fxV8VVBPmz66RLzscHpg5yjRhO...\"\u003c/span\u003e)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"clientDataJSON\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlb...\"\u003c/span\u003e)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"signature\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"MEUCIFXjL0ONRuLP1hkdlRJ8d0ofuRAS12c6w8WgByr-0yQZA...\"\u003c/span\u003e)\n    .put(\u003cspan class=\"hljs-string\"\u003e\"userHandle\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e));\n\nwebAuthN.authenticate(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e JsonObject()\n  \u003cspan class=\"hljs-comment\"\u003e// the username you want to link to\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"paulo\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// the server origin\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"origin\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"https://192.168.178.206.xip.io:8443\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// the server domain\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"domain\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"192.168.178.206.xip.io\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// the challenge given on the previous step\u003c/span\u003e\n  .put(\u003cspan class=\"hljs-string\"\u003e\"challenge\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"BH7EKIDXU6Ct_96xTzG0l62qMhW_Ef_K4MQdDLoVNc1UX...\"\u003c/span\u003e)\n  .put(\u003cspan class=\"hljs-string\"\u003e\"webauthn\"\u003c/span\u003e, body))\n  .onSuccess(user -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// success!\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_metadata_service\"\u003e\u003ca class=\"anchor\" href=\"#_metadata_service\"\u003e\u003c/a\u003eMetadata Service\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe current module passes all FIDO2 compliance tests \u003cstrong\u003eincluding\u003c/strong\u003e the yet to be final FIDO2 Metadata Service API.\nThis means that we follow the spec and this handler \u003cstrong\u003ecan\u003c/strong\u003e detect tokens that have been marked as not trustable\nby the token vendor. For example, when a security bug allowed a private key to be extracted from a token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn order to support the Metadata Service API, as a user you need to register yourself or your application at:\n\u003ca href=\"https://fidoalliance.org/metadata/\"\u003ehttps://fidoalliance.org/metadata\u003c/a\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith this the \u003ccode\u003eAPIKey\u003c/code\u003e given to you you can configure the application as:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e WebAuthnOptions webAuthnOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n  \u003cspan class=\"hljs-comment\"\u003e// in order to fully trust the MDS tokens we should load the CRLs as\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// described on https://fidoalliance.org/metadata/\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// here the content of: http://mds.fidoalliance.org/Root.crl\u003c/span\u003e\n  .addRootCrl(\n    \u003cspan class=\"hljs-string\"\u003e\"MIIB1jCCAV0CAQEwCg...\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// here the content of: http://mds.fidoalliance.org/CA-1.crl\u003c/span\u003e\n  .addRootCrl(\n    \u003cspan class=\"hljs-string\"\u003e\"MIIB5DCCAYoCAQEwCg...\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// create the webauthn security object like before\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e WebAuthn webAuthN = WebAuthn.create(vertx, webAuthnOptions);\n\nwebAuthN.metaDataService()\n  .fetchTOC(\u003cspan class=\"hljs-string\"\u003e\"https://mds2.fidoalliance.org/?token=your-access-token-string\"\u003c/span\u003e)\n  .onSuccess(allOk -\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// if all metadata was downloaded and parsed correctly allOk is true\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// the processing will not stop if a entry is corrupt, in that case that\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// specific entry is skipped and the flag is false. That also means that\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// that entry will be tagged and \"not trustable\" as we can't make any\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// valid decision.\u003c/span\u003e\n  });\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_updating_certificates\"\u003e\u003ca class=\"anchor\" href=\"#_updating_certificates\"\u003e\u003c/a\u003eUpdating Certificates\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAlmost all device attestations are based on \u003ccode\u003eX509\u003c/code\u003e Certificate checks. This means that certificates can and will expire\nat some point in time. By default, the current \"Active\" certificates are hardcoded on the \u003ccode\u003eWebAuthnOptions\u003c/code\u003e object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHowever if your application needs to update a certificate on it\u0026#8217;s own, say for example, use a more up to date one, or\nanother with a different cypher, then you can replace the default \u003ccode\u003eroot\u003c/code\u003e certificates for each attestation by calling:\n\u003ccode\u003eWebAuthnOptions.putRootCertificate(String, String)\u003c/code\u003e, where the first parameter is the attestation name or \"mds\" for\nFIDO MetaData Service:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003enone\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eu2f\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epacked\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eandroid-key\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eandroid-safetynet\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etpm\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eapple\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emds\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd the second the PEM formatted X509 Certificate (Boundaries are not required).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlight\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"hljs-keyword\"\u003efinal\u003c/span\u003e WebAuthnOptions webAuthnOptions = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebAuthnOptions()\n  \u003cspan class=\"hljs-comment\"\u003e// fido2 MDS custom ROOT certificate\u003c/span\u003e\n  .putRootCertificate(\u003cspan class=\"hljs-string\"\u003e\"mds\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"MIIB1jCCAV0CAQEwCg...\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// updated google root certificate from (https://pki.goog/repository/)\u003c/span\u003e\n  .putRootCertificate(\u003cspan class=\"hljs-string\"\u003e\"android-safetynet\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"MIIDvDCCAqSgAwIBAgINAgPk9GHs...\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e","version":"4.1.0"},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["4.1.0","vertx-auth-webauthn","java"]},"buildId":"GB9oRpiEz9ZDxLliLSSO7","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a5c89434732593ca2fd.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.7064a0f84b2a7c13404a.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5df0631eea625b022d3730b3f1bf573e1b8deb37.2c5d42edba8dda0b0ba3.js" async=""></script><script src="/_next/static/chunks/31acfd8439b7c9eee4abe9f59c7500d6c943ee0d.7689a0583e30048c05ff.js" async=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-3a425d1828d3af7aa498.js" async=""></script><script src="/_next/static/GB9oRpiEz9ZDxLliLSSO7/_buildManifest.js" async=""></script><script src="/_next/static/GB9oRpiEz9ZDxLliLSSO7/_ssgManifest.js" async=""></script></body></html>